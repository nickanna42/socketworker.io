//client file

module.exports = function(socketURL, socketOptions) {
    const workerURI = new Blob([decodeURIComponent("(function()%7Bfunction%20r(e%2Cn%2Ct)%7Bfunction%20o(i%2Cf)%7Bif(!n%5Bi%5D)%7Bif(!e%5Bi%5D)%7Bvar%20c%3D%22function%22%3D%3Dtypeof%20require%26%26require%3Bif(!f%26%26c)return%20c(i%2C!0)%3Bif(u)return%20u(i%2C!0)%3Bvar%20a%3Dnew%20Error(%22Cannot%20find%20module%20'%22%2Bi%2B%22'%22)%3Bthrow%20a.code%3D%22MODULE_NOT_FOUND%22%2Ca%7Dvar%20p%3Dn%5Bi%5D%3D%7Bexports%3A%7B%7D%7D%3Be%5Bi%5D%5B0%5D.call(p.exports%2Cfunction(r)%7Bvar%20n%3De%5Bi%5D%5B1%5D%5Br%5D%3Breturn%20o(n%7C%7Cr)%7D%2Cp%2Cp.exports%2Cr%2Ce%2Cn%2Ct)%7Dreturn%20n%5Bi%5D.exports%7Dfor(var%20u%3D%22function%22%3D%3Dtypeof%20require%26%26require%2Ci%3D0%3Bi%3Ct.length%3Bi%2B%2B)o(t%5Bi%5D)%3Breturn%20o%7Dreturn%20r%7D)()(%7B1%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0Amodule.exports%20%3D%20after%0A%0Afunction%20after(count%2C%20callback%2C%20err_cb)%20%7B%0A%20%20%20%20var%20bail%20%3D%20false%0A%20%20%20%20err_cb%20%3D%20err_cb%20%7C%7C%20noop%0A%20%20%20%20proxy.count%20%3D%20count%0A%0A%20%20%20%20return%20(count%20%3D%3D%3D%200)%20%3F%20callback()%20%3A%20proxy%0A%0A%20%20%20%20function%20proxy(err%2C%20result)%20%7B%0A%20%20%20%20%20%20%20%20if%20(proxy.count%20%3C%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error('after%20called%20too%20many%20times')%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20--proxy.count%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20after%20first%20error%2C%20rest%20are%20passed%20to%20err_cb%0A%20%20%20%20%20%20%20%20if%20(err)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20bail%20%3D%20true%0A%20%20%20%20%20%20%20%20%20%20%20%20callback(err)%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20future%20error%20callbacks%20will%20go%20to%20error%20handler%0A%20%20%20%20%20%20%20%20%20%20%20%20callback%20%3D%20err_cb%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(proxy.count%20%3D%3D%3D%200%20%26%26%20!bail)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20callback(null%2C%20result)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%0A%0Afunction%20noop()%20%7B%7D%0A%0A%7D%2C%7B%7D%5D%2C2%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F**%0A%20*%20An%20abstraction%20for%20slicing%20an%20arraybuffer%20even%20when%0A%20*%20ArrayBuffer.prototype.slice%20is%20not%20supported%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Amodule.exports%20%3D%20function(arraybuffer%2C%20start%2C%20end)%20%7B%0A%20%20var%20bytes%20%3D%20arraybuffer.byteLength%3B%0A%20%20start%20%3D%20start%20%7C%7C%200%3B%0A%20%20end%20%3D%20end%20%7C%7C%20bytes%3B%0A%0A%20%20if%20(arraybuffer.slice)%20%7B%20return%20arraybuffer.slice(start%2C%20end)%3B%20%7D%0A%0A%20%20if%20(start%20%3C%200)%20%7B%20start%20%2B%3D%20bytes%3B%20%7D%0A%20%20if%20(end%20%3C%200)%20%7B%20end%20%2B%3D%20bytes%3B%20%7D%0A%20%20if%20(end%20%3E%20bytes)%20%7B%20end%20%3D%20bytes%3B%20%7D%0A%0A%20%20if%20(start%20%3E%3D%20bytes%20%7C%7C%20start%20%3E%3D%20end%20%7C%7C%20bytes%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20return%20new%20ArrayBuffer(0)%3B%0A%20%20%7D%0A%0A%20%20var%20abv%20%3D%20new%20Uint8Array(arraybuffer)%3B%0A%20%20var%20result%20%3D%20new%20Uint8Array(end%20-%20start)%3B%0A%20%20for%20(var%20i%20%3D%20start%2C%20ii%20%3D%200%3B%20i%20%3C%20end%3B%20i%2B%2B%2C%20ii%2B%2B)%20%7B%0A%20%20%20%20result%5Bii%5D%20%3D%20abv%5Bi%5D%3B%0A%20%20%7D%0A%20%20return%20result.buffer%3B%0A%7D%3B%0A%0A%7D%2C%7B%7D%5D%2C3%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0A%2F**%0A%20*%20Expose%20%60Backoff%60.%0A%20*%2F%0A%0Amodule.exports%20%3D%20Backoff%3B%0A%0A%2F**%0A%20*%20Initialize%20backoff%20timer%20with%20%60opts%60.%0A%20*%0A%20*%20-%20%60min%60%20initial%20timeout%20in%20milliseconds%20%5B100%5D%0A%20*%20-%20%60max%60%20max%20timeout%20%5B10000%5D%0A%20*%20-%20%60jitter%60%20%5B0%5D%0A%20*%20-%20%60factor%60%20%5B2%5D%0A%20*%0A%20*%20%40param%20%7BObject%7D%20opts%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20Backoff(opts)%20%7B%0A%20%20opts%20%3D%20opts%20%7C%7C%20%7B%7D%3B%0A%20%20this.ms%20%3D%20opts.min%20%7C%7C%20100%3B%0A%20%20this.max%20%3D%20opts.max%20%7C%7C%2010000%3B%0A%20%20this.factor%20%3D%20opts.factor%20%7C%7C%202%3B%0A%20%20this.jitter%20%3D%20opts.jitter%20%3E%200%20%26%26%20opts.jitter%20%3C%3D%201%20%3F%20opts.jitter%20%3A%200%3B%0A%20%20this.attempts%20%3D%200%3B%0A%7D%0A%0A%2F**%0A%20*%20Return%20the%20backoff%20duration.%0A%20*%0A%20*%20%40return%20%7BNumber%7D%0A%20*%20%40api%20public%0A%20*%2F%0A%0ABackoff.prototype.duration%20%3D%20function()%7B%0A%20%20var%20ms%20%3D%20this.ms%20*%20Math.pow(this.factor%2C%20this.attempts%2B%2B)%3B%0A%20%20if%20(this.jitter)%20%7B%0A%20%20%20%20var%20rand%20%3D%20%20Math.random()%3B%0A%20%20%20%20var%20deviation%20%3D%20Math.floor(rand%20*%20this.jitter%20*%20ms)%3B%0A%20%20%20%20ms%20%3D%20(Math.floor(rand%20*%2010)%20%26%201)%20%3D%3D%200%20%20%3F%20ms%20-%20deviation%20%3A%20ms%20%2B%20deviation%3B%0A%20%20%7D%0A%20%20return%20Math.min(ms%2C%20this.max)%20%7C%200%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Reset%20the%20number%20of%20attempts.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0ABackoff.prototype.reset%20%3D%20function()%7B%0A%20%20this.attempts%20%3D%200%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Set%20the%20minimum%20duration%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0ABackoff.prototype.setMin%20%3D%20function(min)%7B%0A%20%20this.ms%20%3D%20min%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Set%20the%20maximum%20duration%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0ABackoff.prototype.setMax%20%3D%20function(max)%7B%0A%20%20this.max%20%3D%20max%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Set%20the%20jitter%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0ABackoff.prototype.setJitter%20%3D%20function(jitter)%7B%0A%20%20this.jitter%20%3D%20jitter%3B%0A%7D%3B%0A%0A%0A%7D%2C%7B%7D%5D%2C4%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F*%0A%20*%20base64-arraybuffer%0A%20*%20https%3A%2F%2Fgithub.com%2Fniklasvh%2Fbase64-arraybuffer%0A%20*%0A%20*%20Copyright%20(c)%202012%20Niklas%20von%20Hertzen%0A%20*%20Licensed%20under%20the%20MIT%20license.%0A%20*%2F%0A(function()%7B%0A%20%20%22use%20strict%22%3B%0A%0A%20%20var%20chars%20%3D%20%22ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%2B%2F%22%3B%0A%0A%20%20%2F%2F%20Use%20a%20lookup%20table%20to%20find%20the%20index.%0A%20%20var%20lookup%20%3D%20new%20Uint8Array(256)%3B%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20chars.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20lookup%5Bchars.charCodeAt(i)%5D%20%3D%20i%3B%0A%20%20%7D%0A%0A%20%20exports.encode%20%3D%20function(arraybuffer)%20%7B%0A%20%20%20%20var%20bytes%20%3D%20new%20Uint8Array(arraybuffer)%2C%0A%20%20%20%20i%2C%20len%20%3D%20bytes.length%2C%20base64%20%3D%20%22%22%3B%0A%0A%20%20%20%20for%20(i%20%3D%200%3B%20i%20%3C%20len%3B%20i%2B%3D3)%20%7B%0A%20%20%20%20%20%20base64%20%2B%3D%20chars%5Bbytes%5Bi%5D%20%3E%3E%202%5D%3B%0A%20%20%20%20%20%20base64%20%2B%3D%20chars%5B((bytes%5Bi%5D%20%26%203)%20%3C%3C%204)%20%7C%20(bytes%5Bi%20%2B%201%5D%20%3E%3E%204)%5D%3B%0A%20%20%20%20%20%20base64%20%2B%3D%20chars%5B((bytes%5Bi%20%2B%201%5D%20%26%2015)%20%3C%3C%202)%20%7C%20(bytes%5Bi%20%2B%202%5D%20%3E%3E%206)%5D%3B%0A%20%20%20%20%20%20base64%20%2B%3D%20chars%5Bbytes%5Bi%20%2B%202%5D%20%26%2063%5D%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20((len%20%25%203)%20%3D%3D%3D%202)%20%7B%0A%20%20%20%20%20%20base64%20%3D%20base64.substring(0%2C%20base64.length%20-%201)%20%2B%20%22%3D%22%3B%0A%20%20%20%20%7D%20else%20if%20(len%20%25%203%20%3D%3D%3D%201)%20%7B%0A%20%20%20%20%20%20base64%20%3D%20base64.substring(0%2C%20base64.length%20-%202)%20%2B%20%22%3D%3D%22%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20return%20base64%3B%0A%20%20%7D%3B%0A%0A%20%20exports.decode%20%3D%20%20function(base64)%20%7B%0A%20%20%20%20var%20bufferLength%20%3D%20base64.length%20*%200.75%2C%0A%20%20%20%20len%20%3D%20base64.length%2C%20i%2C%20p%20%3D%200%2C%0A%20%20%20%20encoded1%2C%20encoded2%2C%20encoded3%2C%20encoded4%3B%0A%0A%20%20%20%20if%20(base64%5Bbase64.length%20-%201%5D%20%3D%3D%3D%20%22%3D%22)%20%7B%0A%20%20%20%20%20%20bufferLength--%3B%0A%20%20%20%20%20%20if%20(base64%5Bbase64.length%20-%202%5D%20%3D%3D%3D%20%22%3D%22)%20%7B%0A%20%20%20%20%20%20%20%20bufferLength--%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20arraybuffer%20%3D%20new%20ArrayBuffer(bufferLength)%2C%0A%20%20%20%20bytes%20%3D%20new%20Uint8Array(arraybuffer)%3B%0A%0A%20%20%20%20for%20(i%20%3D%200%3B%20i%20%3C%20len%3B%20i%2B%3D4)%20%7B%0A%20%20%20%20%20%20encoded1%20%3D%20lookup%5Bbase64.charCodeAt(i)%5D%3B%0A%20%20%20%20%20%20encoded2%20%3D%20lookup%5Bbase64.charCodeAt(i%2B1)%5D%3B%0A%20%20%20%20%20%20encoded3%20%3D%20lookup%5Bbase64.charCodeAt(i%2B2)%5D%3B%0A%20%20%20%20%20%20encoded4%20%3D%20lookup%5Bbase64.charCodeAt(i%2B3)%5D%3B%0A%0A%20%20%20%20%20%20bytes%5Bp%2B%2B%5D%20%3D%20(encoded1%20%3C%3C%202)%20%7C%20(encoded2%20%3E%3E%204)%3B%0A%20%20%20%20%20%20bytes%5Bp%2B%2B%5D%20%3D%20((encoded2%20%26%2015)%20%3C%3C%204)%20%7C%20(encoded3%20%3E%3E%202)%3B%0A%20%20%20%20%20%20bytes%5Bp%2B%2B%5D%20%3D%20((encoded3%20%26%203)%20%3C%3C%206)%20%7C%20(encoded4%20%26%2063)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20return%20arraybuffer%3B%0A%20%20%7D%3B%0A%7D)()%3B%0A%0A%7D%2C%7B%7D%5D%2C5%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A'use%20strict'%0A%0Aexports.byteLength%20%3D%20byteLength%0Aexports.toByteArray%20%3D%20toByteArray%0Aexports.fromByteArray%20%3D%20fromByteArray%0A%0Avar%20lookup%20%3D%20%5B%5D%0Avar%20revLookup%20%3D%20%5B%5D%0Avar%20Arr%20%3D%20typeof%20Uint8Array%20!%3D%3D%20'undefined'%20%3F%20Uint8Array%20%3A%20Array%0A%0Avar%20code%20%3D%20'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%2B%2F'%0Afor%20(var%20i%20%3D%200%2C%20len%20%3D%20code.length%3B%20i%20%3C%20len%3B%20%2B%2Bi)%20%7B%0A%20%20lookup%5Bi%5D%20%3D%20code%5Bi%5D%0A%20%20revLookup%5Bcode.charCodeAt(i)%5D%20%3D%20i%0A%7D%0A%0A%2F%2F%20Support%20decoding%20URL-safe%20base64%20strings%2C%20as%20Node.js%20does.%0A%2F%2F%20See%3A%20https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FBase64%23URL_applications%0ArevLookup%5B'-'.charCodeAt(0)%5D%20%3D%2062%0ArevLookup%5B'_'.charCodeAt(0)%5D%20%3D%2063%0A%0Afunction%20getLens%20(b64)%20%7B%0A%20%20var%20len%20%3D%20b64.length%0A%0A%20%20if%20(len%20%25%204%20%3E%200)%20%7B%0A%20%20%20%20throw%20new%20Error('Invalid%20string.%20Length%20must%20be%20a%20multiple%20of%204')%0A%20%20%7D%0A%0A%20%20%2F%2F%20Trim%20off%20extra%20bytes%20after%20placeholder%20bytes%20are%20found%0A%20%20%2F%2F%20See%3A%20https%3A%2F%2Fgithub.com%2Fbeatgammit%2Fbase64-js%2Fissues%2F42%0A%20%20var%20validLen%20%3D%20b64.indexOf('%3D')%0A%20%20if%20(validLen%20%3D%3D%3D%20-1)%20validLen%20%3D%20len%0A%0A%20%20var%20placeHoldersLen%20%3D%20validLen%20%3D%3D%3D%20len%0A%20%20%20%20%3F%200%0A%20%20%20%20%3A%204%20-%20(validLen%20%25%204)%0A%0A%20%20return%20%5BvalidLen%2C%20placeHoldersLen%5D%0A%7D%0A%0A%2F%2F%20base64%20is%204%2F3%20%2B%20up%20to%20two%20characters%20of%20the%20original%20data%0Afunction%20byteLength%20(b64)%20%7B%0A%20%20var%20lens%20%3D%20getLens(b64)%0A%20%20var%20validLen%20%3D%20lens%5B0%5D%0A%20%20var%20placeHoldersLen%20%3D%20lens%5B1%5D%0A%20%20return%20((validLen%20%2B%20placeHoldersLen)%20*%203%20%2F%204)%20-%20placeHoldersLen%0A%7D%0A%0Afunction%20_byteLength%20(b64%2C%20validLen%2C%20placeHoldersLen)%20%7B%0A%20%20return%20((validLen%20%2B%20placeHoldersLen)%20*%203%20%2F%204)%20-%20placeHoldersLen%0A%7D%0A%0Afunction%20toByteArray%20(b64)%20%7B%0A%20%20var%20tmp%0A%20%20var%20lens%20%3D%20getLens(b64)%0A%20%20var%20validLen%20%3D%20lens%5B0%5D%0A%20%20var%20placeHoldersLen%20%3D%20lens%5B1%5D%0A%0A%20%20var%20arr%20%3D%20new%20Arr(_byteLength(b64%2C%20validLen%2C%20placeHoldersLen))%0A%0A%20%20var%20curByte%20%3D%200%0A%0A%20%20%2F%2F%20if%20there%20are%20placeholders%2C%20only%20get%20up%20to%20the%20last%20complete%204%20chars%0A%20%20var%20len%20%3D%20placeHoldersLen%20%3E%200%0A%20%20%20%20%3F%20validLen%20-%204%0A%20%20%20%20%3A%20validLen%0A%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20len%3B%20i%20%2B%3D%204)%20%7B%0A%20%20%20%20tmp%20%3D%0A%20%20%20%20%20%20(revLookup%5Bb64.charCodeAt(i)%5D%20%3C%3C%2018)%20%7C%0A%20%20%20%20%20%20(revLookup%5Bb64.charCodeAt(i%20%2B%201)%5D%20%3C%3C%2012)%20%7C%0A%20%20%20%20%20%20(revLookup%5Bb64.charCodeAt(i%20%2B%202)%5D%20%3C%3C%206)%20%7C%0A%20%20%20%20%20%20revLookup%5Bb64.charCodeAt(i%20%2B%203)%5D%0A%20%20%20%20arr%5BcurByte%2B%2B%5D%20%3D%20(tmp%20%3E%3E%2016)%20%26%200xFF%0A%20%20%20%20arr%5BcurByte%2B%2B%5D%20%3D%20(tmp%20%3E%3E%208)%20%26%200xFF%0A%20%20%20%20arr%5BcurByte%2B%2B%5D%20%3D%20tmp%20%26%200xFF%0A%20%20%7D%0A%0A%20%20if%20(placeHoldersLen%20%3D%3D%3D%202)%20%7B%0A%20%20%20%20tmp%20%3D%0A%20%20%20%20%20%20(revLookup%5Bb64.charCodeAt(i)%5D%20%3C%3C%202)%20%7C%0A%20%20%20%20%20%20(revLookup%5Bb64.charCodeAt(i%20%2B%201)%5D%20%3E%3E%204)%0A%20%20%20%20arr%5BcurByte%2B%2B%5D%20%3D%20tmp%20%26%200xFF%0A%20%20%7D%0A%0A%20%20if%20(placeHoldersLen%20%3D%3D%3D%201)%20%7B%0A%20%20%20%20tmp%20%3D%0A%20%20%20%20%20%20(revLookup%5Bb64.charCodeAt(i)%5D%20%3C%3C%2010)%20%7C%0A%20%20%20%20%20%20(revLookup%5Bb64.charCodeAt(i%20%2B%201)%5D%20%3C%3C%204)%20%7C%0A%20%20%20%20%20%20(revLookup%5Bb64.charCodeAt(i%20%2B%202)%5D%20%3E%3E%202)%0A%20%20%20%20arr%5BcurByte%2B%2B%5D%20%3D%20(tmp%20%3E%3E%208)%20%26%200xFF%0A%20%20%20%20arr%5BcurByte%2B%2B%5D%20%3D%20tmp%20%26%200xFF%0A%20%20%7D%0A%0A%20%20return%20arr%0A%7D%0A%0Afunction%20tripletToBase64%20(num)%20%7B%0A%20%20return%20lookup%5Bnum%20%3E%3E%2018%20%26%200x3F%5D%20%2B%0A%20%20%20%20lookup%5Bnum%20%3E%3E%2012%20%26%200x3F%5D%20%2B%0A%20%20%20%20lookup%5Bnum%20%3E%3E%206%20%26%200x3F%5D%20%2B%0A%20%20%20%20lookup%5Bnum%20%26%200x3F%5D%0A%7D%0A%0Afunction%20encodeChunk%20(uint8%2C%20start%2C%20end)%20%7B%0A%20%20var%20tmp%0A%20%20var%20output%20%3D%20%5B%5D%0A%20%20for%20(var%20i%20%3D%20start%3B%20i%20%3C%20end%3B%20i%20%2B%3D%203)%20%7B%0A%20%20%20%20tmp%20%3D%0A%20%20%20%20%20%20((uint8%5Bi%5D%20%3C%3C%2016)%20%26%200xFF0000)%20%2B%0A%20%20%20%20%20%20((uint8%5Bi%20%2B%201%5D%20%3C%3C%208)%20%26%200xFF00)%20%2B%0A%20%20%20%20%20%20(uint8%5Bi%20%2B%202%5D%20%26%200xFF)%0A%20%20%20%20output.push(tripletToBase64(tmp))%0A%20%20%7D%0A%20%20return%20output.join('')%0A%7D%0A%0Afunction%20fromByteArray%20(uint8)%20%7B%0A%20%20var%20tmp%0A%20%20var%20len%20%3D%20uint8.length%0A%20%20var%20extraBytes%20%3D%20len%20%25%203%20%2F%2F%20if%20we%20have%201%20byte%20left%2C%20pad%202%20bytes%0A%20%20var%20parts%20%3D%20%5B%5D%0A%20%20var%20maxChunkLength%20%3D%2016383%20%2F%2F%20must%20be%20multiple%20of%203%0A%0A%20%20%2F%2F%20go%20through%20the%20array%20every%20three%20bytes%2C%20we'll%20deal%20with%20trailing%20stuff%20later%0A%20%20for%20(var%20i%20%3D%200%2C%20len2%20%3D%20len%20-%20extraBytes%3B%20i%20%3C%20len2%3B%20i%20%2B%3D%20maxChunkLength)%20%7B%0A%20%20%20%20parts.push(encodeChunk(%0A%20%20%20%20%20%20uint8%2C%20i%2C%20(i%20%2B%20maxChunkLength)%20%3E%20len2%20%3F%20len2%20%3A%20(i%20%2B%20maxChunkLength)%0A%20%20%20%20))%0A%20%20%7D%0A%0A%20%20%2F%2F%20pad%20the%20end%20with%20zeros%2C%20but%20make%20sure%20to%20not%20forget%20the%20extra%20bytes%0A%20%20if%20(extraBytes%20%3D%3D%3D%201)%20%7B%0A%20%20%20%20tmp%20%3D%20uint8%5Blen%20-%201%5D%0A%20%20%20%20parts.push(%0A%20%20%20%20%20%20lookup%5Btmp%20%3E%3E%202%5D%20%2B%0A%20%20%20%20%20%20lookup%5B(tmp%20%3C%3C%204)%20%26%200x3F%5D%20%2B%0A%20%20%20%20%20%20'%3D%3D'%0A%20%20%20%20)%0A%20%20%7D%20else%20if%20(extraBytes%20%3D%3D%3D%202)%20%7B%0A%20%20%20%20tmp%20%3D%20(uint8%5Blen%20-%202%5D%20%3C%3C%208)%20%2B%20uint8%5Blen%20-%201%5D%0A%20%20%20%20parts.push(%0A%20%20%20%20%20%20lookup%5Btmp%20%3E%3E%2010%5D%20%2B%0A%20%20%20%20%20%20lookup%5B(tmp%20%3E%3E%204)%20%26%200x3F%5D%20%2B%0A%20%20%20%20%20%20lookup%5B(tmp%20%3C%3C%202)%20%26%200x3F%5D%20%2B%0A%20%20%20%20%20%20'%3D'%0A%20%20%20%20)%0A%20%20%7D%0A%0A%20%20return%20parts.join('')%0A%7D%0A%0A%7D%2C%7B%7D%5D%2C6%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%2F**%0A%20*%20Create%20a%20blob%20builder%20even%20when%20vendor%20prefixes%20exist%0A%20*%2F%0A%0Avar%20BlobBuilder%20%3D%20global.BlobBuilder%0A%20%20%7C%7C%20global.WebKitBlobBuilder%0A%20%20%7C%7C%20global.MSBlobBuilder%0A%20%20%7C%7C%20global.MozBlobBuilder%3B%0A%0A%2F**%0A%20*%20Check%20if%20Blob%20constructor%20is%20supported%0A%20*%2F%0A%0Avar%20blobSupported%20%3D%20(function()%20%7B%0A%20%20try%20%7B%0A%20%20%20%20var%20a%20%3D%20new%20Blob(%5B'hi'%5D)%3B%0A%20%20%20%20return%20a.size%20%3D%3D%3D%202%3B%0A%20%20%7D%20catch(e)%20%7B%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%7D)()%3B%0A%0A%2F**%0A%20*%20Check%20if%20Blob%20constructor%20supports%20ArrayBufferViews%0A%20*%20Fails%20in%20Safari%206%2C%20so%20we%20need%20to%20map%20to%20ArrayBuffers%20there.%0A%20*%2F%0A%0Avar%20blobSupportsArrayBufferView%20%3D%20blobSupported%20%26%26%20(function()%20%7B%0A%20%20try%20%7B%0A%20%20%20%20var%20b%20%3D%20new%20Blob(%5Bnew%20Uint8Array(%5B1%2C2%5D)%5D)%3B%0A%20%20%20%20return%20b.size%20%3D%3D%3D%202%3B%0A%20%20%7D%20catch(e)%20%7B%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%7D)()%3B%0A%0A%2F**%0A%20*%20Check%20if%20BlobBuilder%20is%20supported%0A%20*%2F%0A%0Avar%20blobBuilderSupported%20%3D%20BlobBuilder%0A%20%20%26%26%20BlobBuilder.prototype.append%0A%20%20%26%26%20BlobBuilder.prototype.getBlob%3B%0A%0A%2F**%0A%20*%20Helper%20function%20that%20maps%20ArrayBufferViews%20to%20ArrayBuffers%0A%20*%20Used%20by%20BlobBuilder%20constructor%20and%20old%20browsers%20that%20didn't%0A%20*%20support%20it%20in%20the%20Blob%20constructor.%0A%20*%2F%0A%0Afunction%20mapArrayBufferViews(ary)%20%7B%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20ary.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20var%20chunk%20%3D%20ary%5Bi%5D%3B%0A%20%20%20%20if%20(chunk.buffer%20instanceof%20ArrayBuffer)%20%7B%0A%20%20%20%20%20%20var%20buf%20%3D%20chunk.buffer%3B%0A%0A%20%20%20%20%20%20%2F%2F%20if%20this%20is%20a%20subarray%2C%20make%20a%20copy%20so%20we%20only%0A%20%20%20%20%20%20%2F%2F%20include%20the%20subarray%20region%20from%20the%20underlying%20buffer%0A%20%20%20%20%20%20if%20(chunk.byteLength%20!%3D%3D%20buf.byteLength)%20%7B%0A%20%20%20%20%20%20%20%20var%20copy%20%3D%20new%20Uint8Array(chunk.byteLength)%3B%0A%20%20%20%20%20%20%20%20copy.set(new%20Uint8Array(buf%2C%20chunk.byteOffset%2C%20chunk.byteLength))%3B%0A%20%20%20%20%20%20%20%20buf%20%3D%20copy.buffer%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20ary%5Bi%5D%20%3D%20buf%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0Afunction%20BlobBuilderConstructor(ary%2C%20options)%20%7B%0A%20%20options%20%3D%20options%20%7C%7C%20%7B%7D%3B%0A%0A%20%20var%20bb%20%3D%20new%20BlobBuilder()%3B%0A%20%20mapArrayBufferViews(ary)%3B%0A%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20ary.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20bb.append(ary%5Bi%5D)%3B%0A%20%20%7D%0A%0A%20%20return%20(options.type)%20%3F%20bb.getBlob(options.type)%20%3A%20bb.getBlob()%3B%0A%7D%3B%0A%0Afunction%20BlobConstructor(ary%2C%20options)%20%7B%0A%20%20mapArrayBufferViews(ary)%3B%0A%20%20return%20new%20Blob(ary%2C%20options%20%7C%7C%20%7B%7D)%3B%0A%7D%3B%0A%0Amodule.exports%20%3D%20(function()%20%7B%0A%20%20if%20(blobSupported)%20%7B%0A%20%20%20%20return%20blobSupportsArrayBufferView%20%3F%20global.Blob%20%3A%20BlobConstructor%3B%0A%20%20%7D%20else%20if%20(blobBuilderSupported)%20%7B%0A%20%20%20%20return%20BlobBuilderConstructor%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20return%20undefined%3B%0A%20%20%7D%0A%7D)()%3B%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%7D%5D%2C7%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0A%7D%2C%7B%7D%5D%2C8%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F*!%0A%20*%20The%20buffer%20module%20from%20node.js%2C%20for%20the%20browser.%0A%20*%0A%20*%20%40author%20%20%20Feross%20Aboukhadijeh%20%3Chttps%3A%2F%2Ffeross.org%3E%0A%20*%20%40license%20%20MIT%0A%20*%2F%0A%2F*%20eslint-disable%20no-proto%20*%2F%0A%0A'use%20strict'%0A%0Avar%20base64%20%3D%20require('base64-js')%0Avar%20ieee754%20%3D%20require('ieee754')%0A%0Aexports.Buffer%20%3D%20Buffer%0Aexports.SlowBuffer%20%3D%20SlowBuffer%0Aexports.INSPECT_MAX_BYTES%20%3D%2050%0A%0Avar%20K_MAX_LENGTH%20%3D%200x7fffffff%0Aexports.kMaxLength%20%3D%20K_MAX_LENGTH%0A%0A%2F**%0A%20*%20If%20%60Buffer.TYPED_ARRAY_SUPPORT%60%3A%0A%20*%20%20%20%3D%3D%3D%20true%20%20%20%20Use%20Uint8Array%20implementation%20(fastest)%0A%20*%20%20%20%3D%3D%3D%20false%20%20%20Print%20warning%20and%20recommend%20using%20%60buffer%60%20v4.x%20which%20has%20an%20Object%0A%20*%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20implementation%20(most%20compatible%2C%20even%20IE6)%0A%20*%0A%20*%20Browsers%20that%20support%20typed%20arrays%20are%20IE%2010%2B%2C%20Firefox%204%2B%2C%20Chrome%207%2B%2C%20Safari%205.1%2B%2C%0A%20*%20Opera%2011.6%2B%2C%20iOS%204.2%2B.%0A%20*%0A%20*%20We%20report%20that%20the%20browser%20does%20not%20support%20typed%20arrays%20if%20the%20are%20not%20subclassable%0A%20*%20using%20__proto__.%20Firefox%204-29%20lacks%20support%20for%20adding%20new%20properties%20to%20%60Uint8Array%60%0A%20*%20(See%3A%20https%3A%2F%2Fbugzilla.mozilla.org%2Fshow_bug.cgi%3Fid%3D695438).%20IE%2010%20lacks%20support%0A%20*%20for%20__proto__%20and%20has%20a%20buggy%20typed%20array%20implementation.%0A%20*%2F%0ABuffer.TYPED_ARRAY_SUPPORT%20%3D%20typedArraySupport()%0A%0Aif%20(!Buffer.TYPED_ARRAY_SUPPORT%20%26%26%20typeof%20console%20!%3D%3D%20'undefined'%20%26%26%0A%20%20%20%20typeof%20console.error%20%3D%3D%3D%20'function')%20%7B%0A%20%20console.error(%0A%20%20%20%20'This%20browser%20lacks%20typed%20array%20(Uint8Array)%20support%20which%20is%20required%20by%20'%20%2B%0A%20%20%20%20'%60buffer%60%20v5.x.%20Use%20%60buffer%60%20v4.x%20if%20you%20require%20old%20browser%20support.'%0A%20%20)%0A%7D%0A%0Afunction%20typedArraySupport%20()%20%7B%0A%20%20%2F%2F%20Can%20typed%20array%20instances%20can%20be%20augmented%3F%0A%20%20try%20%7B%0A%20%20%20%20var%20arr%20%3D%20new%20Uint8Array(1)%0A%20%20%20%20arr.__proto__%20%3D%20%7B__proto__%3A%20Uint8Array.prototype%2C%20foo%3A%20function%20()%20%7B%20return%2042%20%7D%7D%0A%20%20%20%20return%20arr.foo()%20%3D%3D%3D%2042%0A%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20return%20false%0A%20%20%7D%0A%7D%0A%0AObject.defineProperty(Buffer.prototype%2C%20'parent'%2C%20%7B%0A%20%20get%3A%20function%20()%20%7B%0A%20%20%20%20if%20(!(this%20instanceof%20Buffer))%20%7B%0A%20%20%20%20%20%20return%20undefined%0A%20%20%20%20%7D%0A%20%20%20%20return%20this.buffer%0A%20%20%7D%0A%7D)%0A%0AObject.defineProperty(Buffer.prototype%2C%20'offset'%2C%20%7B%0A%20%20get%3A%20function%20()%20%7B%0A%20%20%20%20if%20(!(this%20instanceof%20Buffer))%20%7B%0A%20%20%20%20%20%20return%20undefined%0A%20%20%20%20%7D%0A%20%20%20%20return%20this.byteOffset%0A%20%20%7D%0A%7D)%0A%0Afunction%20createBuffer%20(length)%20%7B%0A%20%20if%20(length%20%3E%20K_MAX_LENGTH)%20%7B%0A%20%20%20%20throw%20new%20RangeError('Invalid%20typed%20array%20length')%0A%20%20%7D%0A%20%20%2F%2F%20Return%20an%20augmented%20%60Uint8Array%60%20instance%0A%20%20var%20buf%20%3D%20new%20Uint8Array(length)%0A%20%20buf.__proto__%20%3D%20Buffer.prototype%0A%20%20return%20buf%0A%7D%0A%0A%2F**%0A%20*%20The%20Buffer%20constructor%20returns%20instances%20of%20%60Uint8Array%60%20that%20have%20their%0A%20*%20prototype%20changed%20to%20%60Buffer.prototype%60.%20Furthermore%2C%20%60Buffer%60%20is%20a%20subclass%20of%0A%20*%20%60Uint8Array%60%2C%20so%20the%20returned%20instances%20will%20have%20all%20the%20node%20%60Buffer%60%20methods%0A%20*%20and%20the%20%60Uint8Array%60%20methods.%20Square%20bracket%20notation%20works%20as%20expected%20--%20it%0A%20*%20returns%20a%20single%20octet.%0A%20*%0A%20*%20The%20%60Uint8Array%60%20prototype%20remains%20unmodified.%0A%20*%2F%0A%0Afunction%20Buffer%20(arg%2C%20encodingOrOffset%2C%20length)%20%7B%0A%20%20%2F%2F%20Common%20case.%0A%20%20if%20(typeof%20arg%20%3D%3D%3D%20'number')%20%7B%0A%20%20%20%20if%20(typeof%20encodingOrOffset%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20%20%20throw%20new%20Error(%0A%20%20%20%20%20%20%20%20'If%20encoding%20is%20specified%20then%20the%20first%20argument%20must%20be%20a%20string'%0A%20%20%20%20%20%20)%0A%20%20%20%20%7D%0A%20%20%20%20return%20allocUnsafe(arg)%0A%20%20%7D%0A%20%20return%20from(arg%2C%20encodingOrOffset%2C%20length)%0A%7D%0A%0A%2F%2F%20Fix%20subarray()%20in%20ES2016.%20See%3A%20https%3A%2F%2Fgithub.com%2Ffeross%2Fbuffer%2Fpull%2F97%0Aif%20(typeof%20Symbol%20!%3D%3D%20'undefined'%20%26%26%20Symbol.species%20%26%26%0A%20%20%20%20Buffer%5BSymbol.species%5D%20%3D%3D%3D%20Buffer)%20%7B%0A%20%20Object.defineProperty(Buffer%2C%20Symbol.species%2C%20%7B%0A%20%20%20%20value%3A%20null%2C%0A%20%20%20%20configurable%3A%20true%2C%0A%20%20%20%20enumerable%3A%20false%2C%0A%20%20%20%20writable%3A%20false%0A%20%20%7D)%0A%7D%0A%0ABuffer.poolSize%20%3D%208192%20%2F%2F%20not%20used%20by%20this%20implementation%0A%0Afunction%20from%20(value%2C%20encodingOrOffset%2C%20length)%20%7B%0A%20%20if%20(typeof%20value%20%3D%3D%3D%20'number')%20%7B%0A%20%20%20%20throw%20new%20TypeError('%22value%22%20argument%20must%20not%20be%20a%20number')%0A%20%20%7D%0A%0A%20%20if%20(isArrayBuffer(value)%20%7C%7C%20(value%20%26%26%20isArrayBuffer(value.buffer)))%20%7B%0A%20%20%20%20return%20fromArrayBuffer(value%2C%20encodingOrOffset%2C%20length)%0A%20%20%7D%0A%0A%20%20if%20(typeof%20value%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20return%20fromString(value%2C%20encodingOrOffset)%0A%20%20%7D%0A%0A%20%20return%20fromObject(value)%0A%7D%0A%0A%2F**%0A%20*%20Functionally%20equivalent%20to%20Buffer(arg%2C%20encoding)%20but%20throws%20a%20TypeError%0A%20*%20if%20value%20is%20a%20number.%0A%20*%20Buffer.from(str%5B%2C%20encoding%5D)%0A%20*%20Buffer.from(array)%0A%20*%20Buffer.from(buffer)%0A%20*%20Buffer.from(arrayBuffer%5B%2C%20byteOffset%5B%2C%20length%5D%5D)%0A%20**%2F%0ABuffer.from%20%3D%20function%20(value%2C%20encodingOrOffset%2C%20length)%20%7B%0A%20%20return%20from(value%2C%20encodingOrOffset%2C%20length)%0A%7D%0A%0A%2F%2F%20Note%3A%20Change%20prototype%20*after*%20Buffer.from%20is%20defined%20to%20workaround%20Chrome%20bug%3A%0A%2F%2F%20https%3A%2F%2Fgithub.com%2Ffeross%2Fbuffer%2Fpull%2F148%0ABuffer.prototype.__proto__%20%3D%20Uint8Array.prototype%0ABuffer.__proto__%20%3D%20Uint8Array%0A%0Afunction%20assertSize%20(size)%20%7B%0A%20%20if%20(typeof%20size%20!%3D%3D%20'number')%20%7B%0A%20%20%20%20throw%20new%20TypeError('%22size%22%20argument%20must%20be%20of%20type%20number')%0A%20%20%7D%20else%20if%20(size%20%3C%200)%20%7B%0A%20%20%20%20throw%20new%20RangeError('%22size%22%20argument%20must%20not%20be%20negative')%0A%20%20%7D%0A%7D%0A%0Afunction%20alloc%20(size%2C%20fill%2C%20encoding)%20%7B%0A%20%20assertSize(size)%0A%20%20if%20(size%20%3C%3D%200)%20%7B%0A%20%20%20%20return%20createBuffer(size)%0A%20%20%7D%0A%20%20if%20(fill%20!%3D%3D%20undefined)%20%7B%0A%20%20%20%20%2F%2F%20Only%20pay%20attention%20to%20encoding%20if%20it's%20a%20string.%20This%0A%20%20%20%20%2F%2F%20prevents%20accidentally%20sending%20in%20a%20number%20that%20would%0A%20%20%20%20%2F%2F%20be%20interpretted%20as%20a%20start%20offset.%0A%20%20%20%20return%20typeof%20encoding%20%3D%3D%3D%20'string'%0A%20%20%20%20%20%20%3F%20createBuffer(size).fill(fill%2C%20encoding)%0A%20%20%20%20%20%20%3A%20createBuffer(size).fill(fill)%0A%20%20%7D%0A%20%20return%20createBuffer(size)%0A%7D%0A%0A%2F**%0A%20*%20Creates%20a%20new%20filled%20Buffer%20instance.%0A%20*%20alloc(size%5B%2C%20fill%5B%2C%20encoding%5D%5D)%0A%20**%2F%0ABuffer.alloc%20%3D%20function%20(size%2C%20fill%2C%20encoding)%20%7B%0A%20%20return%20alloc(size%2C%20fill%2C%20encoding)%0A%7D%0A%0Afunction%20allocUnsafe%20(size)%20%7B%0A%20%20assertSize(size)%0A%20%20return%20createBuffer(size%20%3C%200%20%3F%200%20%3A%20checked(size)%20%7C%200)%0A%7D%0A%0A%2F**%0A%20*%20Equivalent%20to%20Buffer(num)%2C%20by%20default%20creates%20a%20non-zero-filled%20Buffer%20instance.%0A%20*%20*%2F%0ABuffer.allocUnsafe%20%3D%20function%20(size)%20%7B%0A%20%20return%20allocUnsafe(size)%0A%7D%0A%2F**%0A%20*%20Equivalent%20to%20SlowBuffer(num)%2C%20by%20default%20creates%20a%20non-zero-filled%20Buffer%20instance.%0A%20*%2F%0ABuffer.allocUnsafeSlow%20%3D%20function%20(size)%20%7B%0A%20%20return%20allocUnsafe(size)%0A%7D%0A%0Afunction%20fromString%20(string%2C%20encoding)%20%7B%0A%20%20if%20(typeof%20encoding%20!%3D%3D%20'string'%20%7C%7C%20encoding%20%3D%3D%3D%20'')%20%7B%0A%20%20%20%20encoding%20%3D%20'utf8'%0A%20%20%7D%0A%0A%20%20if%20(!Buffer.isEncoding(encoding))%20%7B%0A%20%20%20%20throw%20new%20TypeError('Unknown%20encoding%3A%20'%20%2B%20encoding)%0A%20%20%7D%0A%0A%20%20var%20length%20%3D%20byteLength(string%2C%20encoding)%20%7C%200%0A%20%20var%20buf%20%3D%20createBuffer(length)%0A%0A%20%20var%20actual%20%3D%20buf.write(string%2C%20encoding)%0A%0A%20%20if%20(actual%20!%3D%3D%20length)%20%7B%0A%20%20%20%20%2F%2F%20Writing%20a%20hex%20string%2C%20for%20example%2C%20that%20contains%20invalid%20characters%20will%0A%20%20%20%20%2F%2F%20cause%20everything%20after%20the%20first%20invalid%20character%20to%20be%20ignored.%20(e.g.%0A%20%20%20%20%2F%2F%20'abxxcd'%20will%20be%20treated%20as%20'ab')%0A%20%20%20%20buf%20%3D%20buf.slice(0%2C%20actual)%0A%20%20%7D%0A%0A%20%20return%20buf%0A%7D%0A%0Afunction%20fromArrayLike%20(array)%20%7B%0A%20%20var%20length%20%3D%20array.length%20%3C%200%20%3F%200%20%3A%20checked(array.length)%20%7C%200%0A%20%20var%20buf%20%3D%20createBuffer(length)%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20length%3B%20i%20%2B%3D%201)%20%7B%0A%20%20%20%20buf%5Bi%5D%20%3D%20array%5Bi%5D%20%26%20255%0A%20%20%7D%0A%20%20return%20buf%0A%7D%0A%0Afunction%20fromArrayBuffer%20(array%2C%20byteOffset%2C%20length)%20%7B%0A%20%20if%20(byteOffset%20%3C%200%20%7C%7C%20array.byteLength%20%3C%20byteOffset)%20%7B%0A%20%20%20%20throw%20new%20RangeError('%22offset%22%20is%20outside%20of%20buffer%20bounds')%0A%20%20%7D%0A%0A%20%20if%20(array.byteLength%20%3C%20byteOffset%20%2B%20(length%20%7C%7C%200))%20%7B%0A%20%20%20%20throw%20new%20RangeError('%22length%22%20is%20outside%20of%20buffer%20bounds')%0A%20%20%7D%0A%0A%20%20var%20buf%0A%20%20if%20(byteOffset%20%3D%3D%3D%20undefined%20%26%26%20length%20%3D%3D%3D%20undefined)%20%7B%0A%20%20%20%20buf%20%3D%20new%20Uint8Array(array)%0A%20%20%7D%20else%20if%20(length%20%3D%3D%3D%20undefined)%20%7B%0A%20%20%20%20buf%20%3D%20new%20Uint8Array(array%2C%20byteOffset)%0A%20%20%7D%20else%20%7B%0A%20%20%20%20buf%20%3D%20new%20Uint8Array(array%2C%20byteOffset%2C%20length)%0A%20%20%7D%0A%0A%20%20%2F%2F%20Return%20an%20augmented%20%60Uint8Array%60%20instance%0A%20%20buf.__proto__%20%3D%20Buffer.prototype%0A%20%20return%20buf%0A%7D%0A%0Afunction%20fromObject%20(obj)%20%7B%0A%20%20if%20(Buffer.isBuffer(obj))%20%7B%0A%20%20%20%20var%20len%20%3D%20checked(obj.length)%20%7C%200%0A%20%20%20%20var%20buf%20%3D%20createBuffer(len)%0A%0A%20%20%20%20if%20(buf.length%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%20%20return%20buf%0A%20%20%20%20%7D%0A%0A%20%20%20%20obj.copy(buf%2C%200%2C%200%2C%20len)%0A%20%20%20%20return%20buf%0A%20%20%7D%0A%0A%20%20if%20(obj)%20%7B%0A%20%20%20%20if%20(ArrayBuffer.isView(obj)%20%7C%7C%20'length'%20in%20obj)%20%7B%0A%20%20%20%20%20%20if%20(typeof%20obj.length%20!%3D%3D%20'number'%20%7C%7C%20numberIsNaN(obj.length))%20%7B%0A%20%20%20%20%20%20%20%20return%20createBuffer(0)%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20fromArrayLike(obj)%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(obj.type%20%3D%3D%3D%20'Buffer'%20%26%26%20Array.isArray(obj.data))%20%7B%0A%20%20%20%20%20%20return%20fromArrayLike(obj.data)%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20throw%20new%20TypeError('The%20first%20argument%20must%20be%20one%20of%20type%20string%2C%20Buffer%2C%20ArrayBuffer%2C%20Array%2C%20or%20Array-like%20Object.')%0A%7D%0A%0Afunction%20checked%20(length)%20%7B%0A%20%20%2F%2F%20Note%3A%20cannot%20use%20%60length%20%3C%20K_MAX_LENGTH%60%20here%20because%20that%20fails%20when%0A%20%20%2F%2F%20length%20is%20NaN%20(which%20is%20otherwise%20coerced%20to%20zero.)%0A%20%20if%20(length%20%3E%3D%20K_MAX_LENGTH)%20%7B%0A%20%20%20%20throw%20new%20RangeError('Attempt%20to%20allocate%20Buffer%20larger%20than%20maximum%20'%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'size%3A%200x'%20%2B%20K_MAX_LENGTH.toString(16)%20%2B%20'%20bytes')%0A%20%20%7D%0A%20%20return%20length%20%7C%200%0A%7D%0A%0Afunction%20SlowBuffer%20(length)%20%7B%0A%20%20if%20(%2Blength%20!%3D%20length)%20%7B%20%2F%2F%20eslint-disable-line%20eqeqeq%0A%20%20%20%20length%20%3D%200%0A%20%20%7D%0A%20%20return%20Buffer.alloc(%2Blength)%0A%7D%0A%0ABuffer.isBuffer%20%3D%20function%20isBuffer%20(b)%20%7B%0A%20%20return%20b%20!%3D%20null%20%26%26%20b._isBuffer%20%3D%3D%3D%20true%0A%7D%0A%0ABuffer.compare%20%3D%20function%20compare%20(a%2C%20b)%20%7B%0A%20%20if%20(!Buffer.isBuffer(a)%20%7C%7C%20!Buffer.isBuffer(b))%20%7B%0A%20%20%20%20throw%20new%20TypeError('Arguments%20must%20be%20Buffers')%0A%20%20%7D%0A%0A%20%20if%20(a%20%3D%3D%3D%20b)%20return%200%0A%0A%20%20var%20x%20%3D%20a.length%0A%20%20var%20y%20%3D%20b.length%0A%0A%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20Math.min(x%2C%20y)%3B%20i%20%3C%20len%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20if%20(a%5Bi%5D%20!%3D%3D%20b%5Bi%5D)%20%7B%0A%20%20%20%20%20%20x%20%3D%20a%5Bi%5D%0A%20%20%20%20%20%20y%20%3D%20b%5Bi%5D%0A%20%20%20%20%20%20break%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20if%20(x%20%3C%20y)%20return%20-1%0A%20%20if%20(y%20%3C%20x)%20return%201%0A%20%20return%200%0A%7D%0A%0ABuffer.isEncoding%20%3D%20function%20isEncoding%20(encoding)%20%7B%0A%20%20switch%20(String(encoding).toLowerCase())%20%7B%0A%20%20%20%20case%20'hex'%3A%0A%20%20%20%20case%20'utf8'%3A%0A%20%20%20%20case%20'utf-8'%3A%0A%20%20%20%20case%20'ascii'%3A%0A%20%20%20%20case%20'latin1'%3A%0A%20%20%20%20case%20'binary'%3A%0A%20%20%20%20case%20'base64'%3A%0A%20%20%20%20case%20'ucs2'%3A%0A%20%20%20%20case%20'ucs-2'%3A%0A%20%20%20%20case%20'utf16le'%3A%0A%20%20%20%20case%20'utf-16le'%3A%0A%20%20%20%20%20%20return%20true%0A%20%20%20%20default%3A%0A%20%20%20%20%20%20return%20false%0A%20%20%7D%0A%7D%0A%0ABuffer.concat%20%3D%20function%20concat%20(list%2C%20length)%20%7B%0A%20%20if%20(!Array.isArray(list))%20%7B%0A%20%20%20%20throw%20new%20TypeError('%22list%22%20argument%20must%20be%20an%20Array%20of%20Buffers')%0A%20%20%7D%0A%0A%20%20if%20(list.length%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20return%20Buffer.alloc(0)%0A%20%20%7D%0A%0A%20%20var%20i%0A%20%20if%20(length%20%3D%3D%3D%20undefined)%20%7B%0A%20%20%20%20length%20%3D%200%0A%20%20%20%20for%20(i%20%3D%200%3B%20i%20%3C%20list.length%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20%20%20length%20%2B%3D%20list%5Bi%5D.length%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20var%20buffer%20%3D%20Buffer.allocUnsafe(length)%0A%20%20var%20pos%20%3D%200%0A%20%20for%20(i%20%3D%200%3B%20i%20%3C%20list.length%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20var%20buf%20%3D%20list%5Bi%5D%0A%20%20%20%20if%20(ArrayBuffer.isView(buf))%20%7B%0A%20%20%20%20%20%20buf%20%3D%20Buffer.from(buf)%0A%20%20%20%20%7D%0A%20%20%20%20if%20(!Buffer.isBuffer(buf))%20%7B%0A%20%20%20%20%20%20throw%20new%20TypeError('%22list%22%20argument%20must%20be%20an%20Array%20of%20Buffers')%0A%20%20%20%20%7D%0A%20%20%20%20buf.copy(buffer%2C%20pos)%0A%20%20%20%20pos%20%2B%3D%20buf.length%0A%20%20%7D%0A%20%20return%20buffer%0A%7D%0A%0Afunction%20byteLength%20(string%2C%20encoding)%20%7B%0A%20%20if%20(Buffer.isBuffer(string))%20%7B%0A%20%20%20%20return%20string.length%0A%20%20%7D%0A%20%20if%20(ArrayBuffer.isView(string)%20%7C%7C%20isArrayBuffer(string))%20%7B%0A%20%20%20%20return%20string.byteLength%0A%20%20%7D%0A%20%20if%20(typeof%20string%20!%3D%3D%20'string')%20%7B%0A%20%20%20%20string%20%3D%20''%20%2B%20string%0A%20%20%7D%0A%0A%20%20var%20len%20%3D%20string.length%0A%20%20if%20(len%20%3D%3D%3D%200)%20return%200%0A%0A%20%20%2F%2F%20Use%20a%20for%20loop%20to%20avoid%20recursion%0A%20%20var%20loweredCase%20%3D%20false%0A%20%20for%20(%3B%3B)%20%7B%0A%20%20%20%20switch%20(encoding)%20%7B%0A%20%20%20%20%20%20case%20'ascii'%3A%0A%20%20%20%20%20%20case%20'latin1'%3A%0A%20%20%20%20%20%20case%20'binary'%3A%0A%20%20%20%20%20%20%20%20return%20len%0A%20%20%20%20%20%20case%20'utf8'%3A%0A%20%20%20%20%20%20case%20'utf-8'%3A%0A%20%20%20%20%20%20case%20undefined%3A%0A%20%20%20%20%20%20%20%20return%20utf8ToBytes(string).length%0A%20%20%20%20%20%20case%20'ucs2'%3A%0A%20%20%20%20%20%20case%20'ucs-2'%3A%0A%20%20%20%20%20%20case%20'utf16le'%3A%0A%20%20%20%20%20%20case%20'utf-16le'%3A%0A%20%20%20%20%20%20%20%20return%20len%20*%202%0A%20%20%20%20%20%20case%20'hex'%3A%0A%20%20%20%20%20%20%20%20return%20len%20%3E%3E%3E%201%0A%20%20%20%20%20%20case%20'base64'%3A%0A%20%20%20%20%20%20%20%20return%20base64ToBytes(string).length%0A%20%20%20%20%20%20default%3A%0A%20%20%20%20%20%20%20%20if%20(loweredCase)%20return%20utf8ToBytes(string).length%20%2F%2F%20assume%20utf8%0A%20%20%20%20%20%20%20%20encoding%20%3D%20(''%20%2B%20encoding).toLowerCase()%0A%20%20%20%20%20%20%20%20loweredCase%20%3D%20true%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0ABuffer.byteLength%20%3D%20byteLength%0A%0Afunction%20slowToString%20(encoding%2C%20start%2C%20end)%20%7B%0A%20%20var%20loweredCase%20%3D%20false%0A%0A%20%20%2F%2F%20No%20need%20to%20verify%20that%20%22this.length%20%3C%3D%20MAX_UINT32%22%20since%20it's%20a%20read-only%0A%20%20%2F%2F%20property%20of%20a%20typed%20array.%0A%0A%20%20%2F%2F%20This%20behaves%20neither%20like%20String%20nor%20Uint8Array%20in%20that%20we%20set%20start%2Fend%0A%20%20%2F%2F%20to%20their%20upper%2Flower%20bounds%20if%20the%20value%20passed%20is%20out%20of%20range.%0A%20%20%2F%2F%20undefined%20is%20handled%20specially%20as%20per%20ECMA-262%206th%20Edition%2C%0A%20%20%2F%2F%20Section%2013.3.3.7%20Runtime%20Semantics%3A%20KeyedBindingInitialization.%0A%20%20if%20(start%20%3D%3D%3D%20undefined%20%7C%7C%20start%20%3C%200)%20%7B%0A%20%20%20%20start%20%3D%200%0A%20%20%7D%0A%20%20%2F%2F%20Return%20early%20if%20start%20%3E%20this.length.%20Done%20here%20to%20prevent%20potential%20uint32%0A%20%20%2F%2F%20coercion%20fail%20below.%0A%20%20if%20(start%20%3E%20this.length)%20%7B%0A%20%20%20%20return%20''%0A%20%20%7D%0A%0A%20%20if%20(end%20%3D%3D%3D%20undefined%20%7C%7C%20end%20%3E%20this.length)%20%7B%0A%20%20%20%20end%20%3D%20this.length%0A%20%20%7D%0A%0A%20%20if%20(end%20%3C%3D%200)%20%7B%0A%20%20%20%20return%20''%0A%20%20%7D%0A%0A%20%20%2F%2F%20Force%20coersion%20to%20uint32.%20This%20will%20also%20coerce%20falsey%2FNaN%20values%20to%200.%0A%20%20end%20%3E%3E%3E%3D%200%0A%20%20start%20%3E%3E%3E%3D%200%0A%0A%20%20if%20(end%20%3C%3D%20start)%20%7B%0A%20%20%20%20return%20''%0A%20%20%7D%0A%0A%20%20if%20(!encoding)%20encoding%20%3D%20'utf8'%0A%0A%20%20while%20(true)%20%7B%0A%20%20%20%20switch%20(encoding)%20%7B%0A%20%20%20%20%20%20case%20'hex'%3A%0A%20%20%20%20%20%20%20%20return%20hexSlice(this%2C%20start%2C%20end)%0A%0A%20%20%20%20%20%20case%20'utf8'%3A%0A%20%20%20%20%20%20case%20'utf-8'%3A%0A%20%20%20%20%20%20%20%20return%20utf8Slice(this%2C%20start%2C%20end)%0A%0A%20%20%20%20%20%20case%20'ascii'%3A%0A%20%20%20%20%20%20%20%20return%20asciiSlice(this%2C%20start%2C%20end)%0A%0A%20%20%20%20%20%20case%20'latin1'%3A%0A%20%20%20%20%20%20case%20'binary'%3A%0A%20%20%20%20%20%20%20%20return%20latin1Slice(this%2C%20start%2C%20end)%0A%0A%20%20%20%20%20%20case%20'base64'%3A%0A%20%20%20%20%20%20%20%20return%20base64Slice(this%2C%20start%2C%20end)%0A%0A%20%20%20%20%20%20case%20'ucs2'%3A%0A%20%20%20%20%20%20case%20'ucs-2'%3A%0A%20%20%20%20%20%20case%20'utf16le'%3A%0A%20%20%20%20%20%20case%20'utf-16le'%3A%0A%20%20%20%20%20%20%20%20return%20utf16leSlice(this%2C%20start%2C%20end)%0A%0A%20%20%20%20%20%20default%3A%0A%20%20%20%20%20%20%20%20if%20(loweredCase)%20throw%20new%20TypeError('Unknown%20encoding%3A%20'%20%2B%20encoding)%0A%20%20%20%20%20%20%20%20encoding%20%3D%20(encoding%20%2B%20'').toLowerCase()%0A%20%20%20%20%20%20%20%20loweredCase%20%3D%20true%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0A%2F%2F%20This%20property%20is%20used%20by%20%60Buffer.isBuffer%60%20(and%20the%20%60is-buffer%60%20npm%20package)%0A%2F%2F%20to%20detect%20a%20Buffer%20instance.%20It's%20not%20possible%20to%20use%20%60instanceof%20Buffer%60%0A%2F%2F%20reliably%20in%20a%20browserify%20context%20because%20there%20could%20be%20multiple%20different%0A%2F%2F%20copies%20of%20the%20'buffer'%20package%20in%20use.%20This%20method%20works%20even%20for%20Buffer%0A%2F%2F%20instances%20that%20were%20created%20from%20another%20copy%20of%20the%20%60buffer%60%20package.%0A%2F%2F%20See%3A%20https%3A%2F%2Fgithub.com%2Ffeross%2Fbuffer%2Fissues%2F154%0ABuffer.prototype._isBuffer%20%3D%20true%0A%0Afunction%20swap%20(b%2C%20n%2C%20m)%20%7B%0A%20%20var%20i%20%3D%20b%5Bn%5D%0A%20%20b%5Bn%5D%20%3D%20b%5Bm%5D%0A%20%20b%5Bm%5D%20%3D%20i%0A%7D%0A%0ABuffer.prototype.swap16%20%3D%20function%20swap16%20()%20%7B%0A%20%20var%20len%20%3D%20this.length%0A%20%20if%20(len%20%25%202%20!%3D%3D%200)%20%7B%0A%20%20%20%20throw%20new%20RangeError('Buffer%20size%20must%20be%20a%20multiple%20of%2016-bits')%0A%20%20%7D%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20len%3B%20i%20%2B%3D%202)%20%7B%0A%20%20%20%20swap(this%2C%20i%2C%20i%20%2B%201)%0A%20%20%7D%0A%20%20return%20this%0A%7D%0A%0ABuffer.prototype.swap32%20%3D%20function%20swap32%20()%20%7B%0A%20%20var%20len%20%3D%20this.length%0A%20%20if%20(len%20%25%204%20!%3D%3D%200)%20%7B%0A%20%20%20%20throw%20new%20RangeError('Buffer%20size%20must%20be%20a%20multiple%20of%2032-bits')%0A%20%20%7D%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20len%3B%20i%20%2B%3D%204)%20%7B%0A%20%20%20%20swap(this%2C%20i%2C%20i%20%2B%203)%0A%20%20%20%20swap(this%2C%20i%20%2B%201%2C%20i%20%2B%202)%0A%20%20%7D%0A%20%20return%20this%0A%7D%0A%0ABuffer.prototype.swap64%20%3D%20function%20swap64%20()%20%7B%0A%20%20var%20len%20%3D%20this.length%0A%20%20if%20(len%20%25%208%20!%3D%3D%200)%20%7B%0A%20%20%20%20throw%20new%20RangeError('Buffer%20size%20must%20be%20a%20multiple%20of%2064-bits')%0A%20%20%7D%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20len%3B%20i%20%2B%3D%208)%20%7B%0A%20%20%20%20swap(this%2C%20i%2C%20i%20%2B%207)%0A%20%20%20%20swap(this%2C%20i%20%2B%201%2C%20i%20%2B%206)%0A%20%20%20%20swap(this%2C%20i%20%2B%202%2C%20i%20%2B%205)%0A%20%20%20%20swap(this%2C%20i%20%2B%203%2C%20i%20%2B%204)%0A%20%20%7D%0A%20%20return%20this%0A%7D%0A%0ABuffer.prototype.toString%20%3D%20function%20toString%20()%20%7B%0A%20%20var%20length%20%3D%20this.length%0A%20%20if%20(length%20%3D%3D%3D%200)%20return%20''%0A%20%20if%20(arguments.length%20%3D%3D%3D%200)%20return%20utf8Slice(this%2C%200%2C%20length)%0A%20%20return%20slowToString.apply(this%2C%20arguments)%0A%7D%0A%0ABuffer.prototype.toLocaleString%20%3D%20Buffer.prototype.toString%0A%0ABuffer.prototype.equals%20%3D%20function%20equals%20(b)%20%7B%0A%20%20if%20(!Buffer.isBuffer(b))%20throw%20new%20TypeError('Argument%20must%20be%20a%20Buffer')%0A%20%20if%20(this%20%3D%3D%3D%20b)%20return%20true%0A%20%20return%20Buffer.compare(this%2C%20b)%20%3D%3D%3D%200%0A%7D%0A%0ABuffer.prototype.inspect%20%3D%20function%20inspect%20()%20%7B%0A%20%20var%20str%20%3D%20''%0A%20%20var%20max%20%3D%20exports.INSPECT_MAX_BYTES%0A%20%20if%20(this.length%20%3E%200)%20%7B%0A%20%20%20%20str%20%3D%20this.toString('hex'%2C%200%2C%20max).match(%2F.%7B2%7D%2Fg).join('%20')%0A%20%20%20%20if%20(this.length%20%3E%20max)%20str%20%2B%3D%20'%20...%20'%0A%20%20%7D%0A%20%20return%20'%3CBuffer%20'%20%2B%20str%20%2B%20'%3E'%0A%7D%0A%0ABuffer.prototype.compare%20%3D%20function%20compare%20(target%2C%20start%2C%20end%2C%20thisStart%2C%20thisEnd)%20%7B%0A%20%20if%20(!Buffer.isBuffer(target))%20%7B%0A%20%20%20%20throw%20new%20TypeError('Argument%20must%20be%20a%20Buffer')%0A%20%20%7D%0A%0A%20%20if%20(start%20%3D%3D%3D%20undefined)%20%7B%0A%20%20%20%20start%20%3D%200%0A%20%20%7D%0A%20%20if%20(end%20%3D%3D%3D%20undefined)%20%7B%0A%20%20%20%20end%20%3D%20target%20%3F%20target.length%20%3A%200%0A%20%20%7D%0A%20%20if%20(thisStart%20%3D%3D%3D%20undefined)%20%7B%0A%20%20%20%20thisStart%20%3D%200%0A%20%20%7D%0A%20%20if%20(thisEnd%20%3D%3D%3D%20undefined)%20%7B%0A%20%20%20%20thisEnd%20%3D%20this.length%0A%20%20%7D%0A%0A%20%20if%20(start%20%3C%200%20%7C%7C%20end%20%3E%20target.length%20%7C%7C%20thisStart%20%3C%200%20%7C%7C%20thisEnd%20%3E%20this.length)%20%7B%0A%20%20%20%20throw%20new%20RangeError('out%20of%20range%20index')%0A%20%20%7D%0A%0A%20%20if%20(thisStart%20%3E%3D%20thisEnd%20%26%26%20start%20%3E%3D%20end)%20%7B%0A%20%20%20%20return%200%0A%20%20%7D%0A%20%20if%20(thisStart%20%3E%3D%20thisEnd)%20%7B%0A%20%20%20%20return%20-1%0A%20%20%7D%0A%20%20if%20(start%20%3E%3D%20end)%20%7B%0A%20%20%20%20return%201%0A%20%20%7D%0A%0A%20%20start%20%3E%3E%3E%3D%200%0A%20%20end%20%3E%3E%3E%3D%200%0A%20%20thisStart%20%3E%3E%3E%3D%200%0A%20%20thisEnd%20%3E%3E%3E%3D%200%0A%0A%20%20if%20(this%20%3D%3D%3D%20target)%20return%200%0A%0A%20%20var%20x%20%3D%20thisEnd%20-%20thisStart%0A%20%20var%20y%20%3D%20end%20-%20start%0A%20%20var%20len%20%3D%20Math.min(x%2C%20y)%0A%0A%20%20var%20thisCopy%20%3D%20this.slice(thisStart%2C%20thisEnd)%0A%20%20var%20targetCopy%20%3D%20target.slice(start%2C%20end)%0A%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20len%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20if%20(thisCopy%5Bi%5D%20!%3D%3D%20targetCopy%5Bi%5D)%20%7B%0A%20%20%20%20%20%20x%20%3D%20thisCopy%5Bi%5D%0A%20%20%20%20%20%20y%20%3D%20targetCopy%5Bi%5D%0A%20%20%20%20%20%20break%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20if%20(x%20%3C%20y)%20return%20-1%0A%20%20if%20(y%20%3C%20x)%20return%201%0A%20%20return%200%0A%7D%0A%0A%2F%2F%20Finds%20either%20the%20first%20index%20of%20%60val%60%20in%20%60buffer%60%20at%20offset%20%3E%3D%20%60byteOffset%60%2C%0A%2F%2F%20OR%20the%20last%20index%20of%20%60val%60%20in%20%60buffer%60%20at%20offset%20%3C%3D%20%60byteOffset%60.%0A%2F%2F%0A%2F%2F%20Arguments%3A%0A%2F%2F%20-%20buffer%20-%20a%20Buffer%20to%20search%0A%2F%2F%20-%20val%20-%20a%20string%2C%20Buffer%2C%20or%20number%0A%2F%2F%20-%20byteOffset%20-%20an%20index%20into%20%60buffer%60%3B%20will%20be%20clamped%20to%20an%20int32%0A%2F%2F%20-%20encoding%20-%20an%20optional%20encoding%2C%20relevant%20is%20val%20is%20a%20string%0A%2F%2F%20-%20dir%20-%20true%20for%20indexOf%2C%20false%20for%20lastIndexOf%0Afunction%20bidirectionalIndexOf%20(buffer%2C%20val%2C%20byteOffset%2C%20encoding%2C%20dir)%20%7B%0A%20%20%2F%2F%20Empty%20buffer%20means%20no%20match%0A%20%20if%20(buffer.length%20%3D%3D%3D%200)%20return%20-1%0A%0A%20%20%2F%2F%20Normalize%20byteOffset%0A%20%20if%20(typeof%20byteOffset%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20encoding%20%3D%20byteOffset%0A%20%20%20%20byteOffset%20%3D%200%0A%20%20%7D%20else%20if%20(byteOffset%20%3E%200x7fffffff)%20%7B%0A%20%20%20%20byteOffset%20%3D%200x7fffffff%0A%20%20%7D%20else%20if%20(byteOffset%20%3C%20-0x80000000)%20%7B%0A%20%20%20%20byteOffset%20%3D%20-0x80000000%0A%20%20%7D%0A%20%20byteOffset%20%3D%20%2BbyteOffset%20%20%2F%2F%20Coerce%20to%20Number.%0A%20%20if%20(numberIsNaN(byteOffset))%20%7B%0A%20%20%20%20%2F%2F%20byteOffset%3A%20it%20it's%20undefined%2C%20null%2C%20NaN%2C%20%22foo%22%2C%20etc%2C%20search%20whole%20buffer%0A%20%20%20%20byteOffset%20%3D%20dir%20%3F%200%20%3A%20(buffer.length%20-%201)%0A%20%20%7D%0A%0A%20%20%2F%2F%20Normalize%20byteOffset%3A%20negative%20offsets%20start%20from%20the%20end%20of%20the%20buffer%0A%20%20if%20(byteOffset%20%3C%200)%20byteOffset%20%3D%20buffer.length%20%2B%20byteOffset%0A%20%20if%20(byteOffset%20%3E%3D%20buffer.length)%20%7B%0A%20%20%20%20if%20(dir)%20return%20-1%0A%20%20%20%20else%20byteOffset%20%3D%20buffer.length%20-%201%0A%20%20%7D%20else%20if%20(byteOffset%20%3C%200)%20%7B%0A%20%20%20%20if%20(dir)%20byteOffset%20%3D%200%0A%20%20%20%20else%20return%20-1%0A%20%20%7D%0A%0A%20%20%2F%2F%20Normalize%20val%0A%20%20if%20(typeof%20val%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20val%20%3D%20Buffer.from(val%2C%20encoding)%0A%20%20%7D%0A%0A%20%20%2F%2F%20Finally%2C%20search%20either%20indexOf%20(if%20dir%20is%20true)%20or%20lastIndexOf%0A%20%20if%20(Buffer.isBuffer(val))%20%7B%0A%20%20%20%20%2F%2F%20Special%20case%3A%20looking%20for%20empty%20string%2Fbuffer%20always%20fails%0A%20%20%20%20if%20(val.length%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%20%20return%20-1%0A%20%20%20%20%7D%0A%20%20%20%20return%20arrayIndexOf(buffer%2C%20val%2C%20byteOffset%2C%20encoding%2C%20dir)%0A%20%20%7D%20else%20if%20(typeof%20val%20%3D%3D%3D%20'number')%20%7B%0A%20%20%20%20val%20%3D%20val%20%26%200xFF%20%2F%2F%20Search%20for%20a%20byte%20value%20%5B0-255%5D%0A%20%20%20%20if%20(typeof%20Uint8Array.prototype.indexOf%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20%20%20if%20(dir)%20%7B%0A%20%20%20%20%20%20%20%20return%20Uint8Array.prototype.indexOf.call(buffer%2C%20val%2C%20byteOffset)%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20return%20Uint8Array.prototype.lastIndexOf.call(buffer%2C%20val%2C%20byteOffset)%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20return%20arrayIndexOf(buffer%2C%20%5B%20val%20%5D%2C%20byteOffset%2C%20encoding%2C%20dir)%0A%20%20%7D%0A%0A%20%20throw%20new%20TypeError('val%20must%20be%20string%2C%20number%20or%20Buffer')%0A%7D%0A%0Afunction%20arrayIndexOf%20(arr%2C%20val%2C%20byteOffset%2C%20encoding%2C%20dir)%20%7B%0A%20%20var%20indexSize%20%3D%201%0A%20%20var%20arrLength%20%3D%20arr.length%0A%20%20var%20valLength%20%3D%20val.length%0A%0A%20%20if%20(encoding%20!%3D%3D%20undefined)%20%7B%0A%20%20%20%20encoding%20%3D%20String(encoding).toLowerCase()%0A%20%20%20%20if%20(encoding%20%3D%3D%3D%20'ucs2'%20%7C%7C%20encoding%20%3D%3D%3D%20'ucs-2'%20%7C%7C%0A%20%20%20%20%20%20%20%20encoding%20%3D%3D%3D%20'utf16le'%20%7C%7C%20encoding%20%3D%3D%3D%20'utf-16le')%20%7B%0A%20%20%20%20%20%20if%20(arr.length%20%3C%202%20%7C%7C%20val.length%20%3C%202)%20%7B%0A%20%20%20%20%20%20%20%20return%20-1%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20indexSize%20%3D%202%0A%20%20%20%20%20%20arrLength%20%2F%3D%202%0A%20%20%20%20%20%20valLength%20%2F%3D%202%0A%20%20%20%20%20%20byteOffset%20%2F%3D%202%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20function%20read%20(buf%2C%20i)%20%7B%0A%20%20%20%20if%20(indexSize%20%3D%3D%3D%201)%20%7B%0A%20%20%20%20%20%20return%20buf%5Bi%5D%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20return%20buf.readUInt16BE(i%20*%20indexSize)%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20var%20i%0A%20%20if%20(dir)%20%7B%0A%20%20%20%20var%20foundIndex%20%3D%20-1%0A%20%20%20%20for%20(i%20%3D%20byteOffset%3B%20i%20%3C%20arrLength%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20if%20(read(arr%2C%20i)%20%3D%3D%3D%20read(val%2C%20foundIndex%20%3D%3D%3D%20-1%20%3F%200%20%3A%20i%20-%20foundIndex))%20%7B%0A%20%20%20%20%20%20%20%20if%20(foundIndex%20%3D%3D%3D%20-1)%20foundIndex%20%3D%20i%0A%20%20%20%20%20%20%20%20if%20(i%20-%20foundIndex%20%2B%201%20%3D%3D%3D%20valLength)%20return%20foundIndex%20*%20indexSize%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20if%20(foundIndex%20!%3D%3D%20-1)%20i%20-%3D%20i%20-%20foundIndex%0A%20%20%20%20%20%20%20%20foundIndex%20%3D%20-1%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%20else%20%7B%0A%20%20%20%20if%20(byteOffset%20%2B%20valLength%20%3E%20arrLength)%20byteOffset%20%3D%20arrLength%20-%20valLength%0A%20%20%20%20for%20(i%20%3D%20byteOffset%3B%20i%20%3E%3D%200%3B%20i--)%20%7B%0A%20%20%20%20%20%20var%20found%20%3D%20true%0A%20%20%20%20%20%20for%20(var%20j%20%3D%200%3B%20j%20%3C%20valLength%3B%20j%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20if%20(read(arr%2C%20i%20%2B%20j)%20!%3D%3D%20read(val%2C%20j))%20%7B%0A%20%20%20%20%20%20%20%20%20%20found%20%3D%20false%0A%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20(found)%20return%20i%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20return%20-1%0A%7D%0A%0ABuffer.prototype.includes%20%3D%20function%20includes%20(val%2C%20byteOffset%2C%20encoding)%20%7B%0A%20%20return%20this.indexOf(val%2C%20byteOffset%2C%20encoding)%20!%3D%3D%20-1%0A%7D%0A%0ABuffer.prototype.indexOf%20%3D%20function%20indexOf%20(val%2C%20byteOffset%2C%20encoding)%20%7B%0A%20%20return%20bidirectionalIndexOf(this%2C%20val%2C%20byteOffset%2C%20encoding%2C%20true)%0A%7D%0A%0ABuffer.prototype.lastIndexOf%20%3D%20function%20lastIndexOf%20(val%2C%20byteOffset%2C%20encoding)%20%7B%0A%20%20return%20bidirectionalIndexOf(this%2C%20val%2C%20byteOffset%2C%20encoding%2C%20false)%0A%7D%0A%0Afunction%20hexWrite%20(buf%2C%20string%2C%20offset%2C%20length)%20%7B%0A%20%20offset%20%3D%20Number(offset)%20%7C%7C%200%0A%20%20var%20remaining%20%3D%20buf.length%20-%20offset%0A%20%20if%20(!length)%20%7B%0A%20%20%20%20length%20%3D%20remaining%0A%20%20%7D%20else%20%7B%0A%20%20%20%20length%20%3D%20Number(length)%0A%20%20%20%20if%20(length%20%3E%20remaining)%20%7B%0A%20%20%20%20%20%20length%20%3D%20remaining%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20var%20strLen%20%3D%20string.length%0A%0A%20%20if%20(length%20%3E%20strLen%20%2F%202)%20%7B%0A%20%20%20%20length%20%3D%20strLen%20%2F%202%0A%20%20%7D%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20length%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20var%20parsed%20%3D%20parseInt(string.substr(i%20*%202%2C%202)%2C%2016)%0A%20%20%20%20if%20(numberIsNaN(parsed))%20return%20i%0A%20%20%20%20buf%5Boffset%20%2B%20i%5D%20%3D%20parsed%0A%20%20%7D%0A%20%20return%20i%0A%7D%0A%0Afunction%20utf8Write%20(buf%2C%20string%2C%20offset%2C%20length)%20%7B%0A%20%20return%20blitBuffer(utf8ToBytes(string%2C%20buf.length%20-%20offset)%2C%20buf%2C%20offset%2C%20length)%0A%7D%0A%0Afunction%20asciiWrite%20(buf%2C%20string%2C%20offset%2C%20length)%20%7B%0A%20%20return%20blitBuffer(asciiToBytes(string)%2C%20buf%2C%20offset%2C%20length)%0A%7D%0A%0Afunction%20latin1Write%20(buf%2C%20string%2C%20offset%2C%20length)%20%7B%0A%20%20return%20asciiWrite(buf%2C%20string%2C%20offset%2C%20length)%0A%7D%0A%0Afunction%20base64Write%20(buf%2C%20string%2C%20offset%2C%20length)%20%7B%0A%20%20return%20blitBuffer(base64ToBytes(string)%2C%20buf%2C%20offset%2C%20length)%0A%7D%0A%0Afunction%20ucs2Write%20(buf%2C%20string%2C%20offset%2C%20length)%20%7B%0A%20%20return%20blitBuffer(utf16leToBytes(string%2C%20buf.length%20-%20offset)%2C%20buf%2C%20offset%2C%20length)%0A%7D%0A%0ABuffer.prototype.write%20%3D%20function%20write%20(string%2C%20offset%2C%20length%2C%20encoding)%20%7B%0A%20%20%2F%2F%20Buffer%23write(string)%0A%20%20if%20(offset%20%3D%3D%3D%20undefined)%20%7B%0A%20%20%20%20encoding%20%3D%20'utf8'%0A%20%20%20%20length%20%3D%20this.length%0A%20%20%20%20offset%20%3D%200%0A%20%20%2F%2F%20Buffer%23write(string%2C%20encoding)%0A%20%20%7D%20else%20if%20(length%20%3D%3D%3D%20undefined%20%26%26%20typeof%20offset%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20encoding%20%3D%20offset%0A%20%20%20%20length%20%3D%20this.length%0A%20%20%20%20offset%20%3D%200%0A%20%20%2F%2F%20Buffer%23write(string%2C%20offset%5B%2C%20length%5D%5B%2C%20encoding%5D)%0A%20%20%7D%20else%20if%20(isFinite(offset))%20%7B%0A%20%20%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20%20%20if%20(isFinite(length))%20%7B%0A%20%20%20%20%20%20length%20%3D%20length%20%3E%3E%3E%200%0A%20%20%20%20%20%20if%20(encoding%20%3D%3D%3D%20undefined)%20encoding%20%3D%20'utf8'%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20encoding%20%3D%20length%0A%20%20%20%20%20%20length%20%3D%20undefined%0A%20%20%20%20%7D%0A%20%20%7D%20else%20%7B%0A%20%20%20%20throw%20new%20Error(%0A%20%20%20%20%20%20'Buffer.write(string%2C%20encoding%2C%20offset%5B%2C%20length%5D)%20is%20no%20longer%20supported'%0A%20%20%20%20)%0A%20%20%7D%0A%0A%20%20var%20remaining%20%3D%20this.length%20-%20offset%0A%20%20if%20(length%20%3D%3D%3D%20undefined%20%7C%7C%20length%20%3E%20remaining)%20length%20%3D%20remaining%0A%0A%20%20if%20((string.length%20%3E%200%20%26%26%20(length%20%3C%200%20%7C%7C%20offset%20%3C%200))%20%7C%7C%20offset%20%3E%20this.length)%20%7B%0A%20%20%20%20throw%20new%20RangeError('Attempt%20to%20write%20outside%20buffer%20bounds')%0A%20%20%7D%0A%0A%20%20if%20(!encoding)%20encoding%20%3D%20'utf8'%0A%0A%20%20var%20loweredCase%20%3D%20false%0A%20%20for%20(%3B%3B)%20%7B%0A%20%20%20%20switch%20(encoding)%20%7B%0A%20%20%20%20%20%20case%20'hex'%3A%0A%20%20%20%20%20%20%20%20return%20hexWrite(this%2C%20string%2C%20offset%2C%20length)%0A%0A%20%20%20%20%20%20case%20'utf8'%3A%0A%20%20%20%20%20%20case%20'utf-8'%3A%0A%20%20%20%20%20%20%20%20return%20utf8Write(this%2C%20string%2C%20offset%2C%20length)%0A%0A%20%20%20%20%20%20case%20'ascii'%3A%0A%20%20%20%20%20%20%20%20return%20asciiWrite(this%2C%20string%2C%20offset%2C%20length)%0A%0A%20%20%20%20%20%20case%20'latin1'%3A%0A%20%20%20%20%20%20case%20'binary'%3A%0A%20%20%20%20%20%20%20%20return%20latin1Write(this%2C%20string%2C%20offset%2C%20length)%0A%0A%20%20%20%20%20%20case%20'base64'%3A%0A%20%20%20%20%20%20%20%20%2F%2F%20Warning%3A%20maxLength%20not%20taken%20into%20account%20in%20base64Write%0A%20%20%20%20%20%20%20%20return%20base64Write(this%2C%20string%2C%20offset%2C%20length)%0A%0A%20%20%20%20%20%20case%20'ucs2'%3A%0A%20%20%20%20%20%20case%20'ucs-2'%3A%0A%20%20%20%20%20%20case%20'utf16le'%3A%0A%20%20%20%20%20%20case%20'utf-16le'%3A%0A%20%20%20%20%20%20%20%20return%20ucs2Write(this%2C%20string%2C%20offset%2C%20length)%0A%0A%20%20%20%20%20%20default%3A%0A%20%20%20%20%20%20%20%20if%20(loweredCase)%20throw%20new%20TypeError('Unknown%20encoding%3A%20'%20%2B%20encoding)%0A%20%20%20%20%20%20%20%20encoding%20%3D%20(''%20%2B%20encoding).toLowerCase()%0A%20%20%20%20%20%20%20%20loweredCase%20%3D%20true%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0ABuffer.prototype.toJSON%20%3D%20function%20toJSON%20()%20%7B%0A%20%20return%20%7B%0A%20%20%20%20type%3A%20'Buffer'%2C%0A%20%20%20%20data%3A%20Array.prototype.slice.call(this._arr%20%7C%7C%20this%2C%200)%0A%20%20%7D%0A%7D%0A%0Afunction%20base64Slice%20(buf%2C%20start%2C%20end)%20%7B%0A%20%20if%20(start%20%3D%3D%3D%200%20%26%26%20end%20%3D%3D%3D%20buf.length)%20%7B%0A%20%20%20%20return%20base64.fromByteArray(buf)%0A%20%20%7D%20else%20%7B%0A%20%20%20%20return%20base64.fromByteArray(buf.slice(start%2C%20end))%0A%20%20%7D%0A%7D%0A%0Afunction%20utf8Slice%20(buf%2C%20start%2C%20end)%20%7B%0A%20%20end%20%3D%20Math.min(buf.length%2C%20end)%0A%20%20var%20res%20%3D%20%5B%5D%0A%0A%20%20var%20i%20%3D%20start%0A%20%20while%20(i%20%3C%20end)%20%7B%0A%20%20%20%20var%20firstByte%20%3D%20buf%5Bi%5D%0A%20%20%20%20var%20codePoint%20%3D%20null%0A%20%20%20%20var%20bytesPerSequence%20%3D%20(firstByte%20%3E%200xEF)%20%3F%204%0A%20%20%20%20%20%20%3A%20(firstByte%20%3E%200xDF)%20%3F%203%0A%20%20%20%20%20%20%3A%20(firstByte%20%3E%200xBF)%20%3F%202%0A%20%20%20%20%20%20%3A%201%0A%0A%20%20%20%20if%20(i%20%2B%20bytesPerSequence%20%3C%3D%20end)%20%7B%0A%20%20%20%20%20%20var%20secondByte%2C%20thirdByte%2C%20fourthByte%2C%20tempCodePoint%0A%0A%20%20%20%20%20%20switch%20(bytesPerSequence)%20%7B%0A%20%20%20%20%20%20%20%20case%201%3A%0A%20%20%20%20%20%20%20%20%20%20if%20(firstByte%20%3C%200x80)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20codePoint%20%3D%20firstByte%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20case%202%3A%0A%20%20%20%20%20%20%20%20%20%20secondByte%20%3D%20buf%5Bi%20%2B%201%5D%0A%20%20%20%20%20%20%20%20%20%20if%20((secondByte%20%26%200xC0)%20%3D%3D%3D%200x80)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20tempCodePoint%20%3D%20(firstByte%20%26%200x1F)%20%3C%3C%200x6%20%7C%20(secondByte%20%26%200x3F)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(tempCodePoint%20%3E%200x7F)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20codePoint%20%3D%20tempCodePoint%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20case%203%3A%0A%20%20%20%20%20%20%20%20%20%20secondByte%20%3D%20buf%5Bi%20%2B%201%5D%0A%20%20%20%20%20%20%20%20%20%20thirdByte%20%3D%20buf%5Bi%20%2B%202%5D%0A%20%20%20%20%20%20%20%20%20%20if%20((secondByte%20%26%200xC0)%20%3D%3D%3D%200x80%20%26%26%20(thirdByte%20%26%200xC0)%20%3D%3D%3D%200x80)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20tempCodePoint%20%3D%20(firstByte%20%26%200xF)%20%3C%3C%200xC%20%7C%20(secondByte%20%26%200x3F)%20%3C%3C%200x6%20%7C%20(thirdByte%20%26%200x3F)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(tempCodePoint%20%3E%200x7FF%20%26%26%20(tempCodePoint%20%3C%200xD800%20%7C%7C%20tempCodePoint%20%3E%200xDFFF))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20codePoint%20%3D%20tempCodePoint%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20case%204%3A%0A%20%20%20%20%20%20%20%20%20%20secondByte%20%3D%20buf%5Bi%20%2B%201%5D%0A%20%20%20%20%20%20%20%20%20%20thirdByte%20%3D%20buf%5Bi%20%2B%202%5D%0A%20%20%20%20%20%20%20%20%20%20fourthByte%20%3D%20buf%5Bi%20%2B%203%5D%0A%20%20%20%20%20%20%20%20%20%20if%20((secondByte%20%26%200xC0)%20%3D%3D%3D%200x80%20%26%26%20(thirdByte%20%26%200xC0)%20%3D%3D%3D%200x80%20%26%26%20(fourthByte%20%26%200xC0)%20%3D%3D%3D%200x80)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20tempCodePoint%20%3D%20(firstByte%20%26%200xF)%20%3C%3C%200x12%20%7C%20(secondByte%20%26%200x3F)%20%3C%3C%200xC%20%7C%20(thirdByte%20%26%200x3F)%20%3C%3C%200x6%20%7C%20(fourthByte%20%26%200x3F)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(tempCodePoint%20%3E%200xFFFF%20%26%26%20tempCodePoint%20%3C%200x110000)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20codePoint%20%3D%20tempCodePoint%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(codePoint%20%3D%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%2F%2F%20we%20did%20not%20generate%20a%20valid%20codePoint%20so%20insert%20a%0A%20%20%20%20%20%20%2F%2F%20replacement%20char%20(U%2BFFFD)%20and%20advance%20only%201%20byte%0A%20%20%20%20%20%20codePoint%20%3D%200xFFFD%0A%20%20%20%20%20%20bytesPerSequence%20%3D%201%0A%20%20%20%20%7D%20else%20if%20(codePoint%20%3E%200xFFFF)%20%7B%0A%20%20%20%20%20%20%2F%2F%20encode%20to%20utf16%20(surrogate%20pair%20dance)%0A%20%20%20%20%20%20codePoint%20-%3D%200x10000%0A%20%20%20%20%20%20res.push(codePoint%20%3E%3E%3E%2010%20%26%200x3FF%20%7C%200xD800)%0A%20%20%20%20%20%20codePoint%20%3D%200xDC00%20%7C%20codePoint%20%26%200x3FF%0A%20%20%20%20%7D%0A%0A%20%20%20%20res.push(codePoint)%0A%20%20%20%20i%20%2B%3D%20bytesPerSequence%0A%20%20%7D%0A%0A%20%20return%20decodeCodePointsArray(res)%0A%7D%0A%0A%2F%2F%20Based%20on%20http%3A%2F%2Fstackoverflow.com%2Fa%2F22747272%2F680742%2C%20the%20browser%20with%0A%2F%2F%20the%20lowest%20limit%20is%20Chrome%2C%20with%200x10000%20args.%0A%2F%2F%20We%20go%201%20magnitude%20less%2C%20for%20safety%0Avar%20MAX_ARGUMENTS_LENGTH%20%3D%200x1000%0A%0Afunction%20decodeCodePointsArray%20(codePoints)%20%7B%0A%20%20var%20len%20%3D%20codePoints.length%0A%20%20if%20(len%20%3C%3D%20MAX_ARGUMENTS_LENGTH)%20%7B%0A%20%20%20%20return%20String.fromCharCode.apply(String%2C%20codePoints)%20%2F%2F%20avoid%20extra%20slice()%0A%20%20%7D%0A%0A%20%20%2F%2F%20Decode%20in%20chunks%20to%20avoid%20%22call%20stack%20size%20exceeded%22.%0A%20%20var%20res%20%3D%20''%0A%20%20var%20i%20%3D%200%0A%20%20while%20(i%20%3C%20len)%20%7B%0A%20%20%20%20res%20%2B%3D%20String.fromCharCode.apply(%0A%20%20%20%20%20%20String%2C%0A%20%20%20%20%20%20codePoints.slice(i%2C%20i%20%2B%3D%20MAX_ARGUMENTS_LENGTH)%0A%20%20%20%20)%0A%20%20%7D%0A%20%20return%20res%0A%7D%0A%0Afunction%20asciiSlice%20(buf%2C%20start%2C%20end)%20%7B%0A%20%20var%20ret%20%3D%20''%0A%20%20end%20%3D%20Math.min(buf.length%2C%20end)%0A%0A%20%20for%20(var%20i%20%3D%20start%3B%20i%20%3C%20end%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20ret%20%2B%3D%20String.fromCharCode(buf%5Bi%5D%20%26%200x7F)%0A%20%20%7D%0A%20%20return%20ret%0A%7D%0A%0Afunction%20latin1Slice%20(buf%2C%20start%2C%20end)%20%7B%0A%20%20var%20ret%20%3D%20''%0A%20%20end%20%3D%20Math.min(buf.length%2C%20end)%0A%0A%20%20for%20(var%20i%20%3D%20start%3B%20i%20%3C%20end%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20ret%20%2B%3D%20String.fromCharCode(buf%5Bi%5D)%0A%20%20%7D%0A%20%20return%20ret%0A%7D%0A%0Afunction%20hexSlice%20(buf%2C%20start%2C%20end)%20%7B%0A%20%20var%20len%20%3D%20buf.length%0A%0A%20%20if%20(!start%20%7C%7C%20start%20%3C%200)%20start%20%3D%200%0A%20%20if%20(!end%20%7C%7C%20end%20%3C%200%20%7C%7C%20end%20%3E%20len)%20end%20%3D%20len%0A%0A%20%20var%20out%20%3D%20''%0A%20%20for%20(var%20i%20%3D%20start%3B%20i%20%3C%20end%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20out%20%2B%3D%20toHex(buf%5Bi%5D)%0A%20%20%7D%0A%20%20return%20out%0A%7D%0A%0Afunction%20utf16leSlice%20(buf%2C%20start%2C%20end)%20%7B%0A%20%20var%20bytes%20%3D%20buf.slice(start%2C%20end)%0A%20%20var%20res%20%3D%20''%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20bytes.length%3B%20i%20%2B%3D%202)%20%7B%0A%20%20%20%20res%20%2B%3D%20String.fromCharCode(bytes%5Bi%5D%20%2B%20(bytes%5Bi%20%2B%201%5D%20*%20256))%0A%20%20%7D%0A%20%20return%20res%0A%7D%0A%0ABuffer.prototype.slice%20%3D%20function%20slice%20(start%2C%20end)%20%7B%0A%20%20var%20len%20%3D%20this.length%0A%20%20start%20%3D%20~~start%0A%20%20end%20%3D%20end%20%3D%3D%3D%20undefined%20%3F%20len%20%3A%20~~end%0A%0A%20%20if%20(start%20%3C%200)%20%7B%0A%20%20%20%20start%20%2B%3D%20len%0A%20%20%20%20if%20(start%20%3C%200)%20start%20%3D%200%0A%20%20%7D%20else%20if%20(start%20%3E%20len)%20%7B%0A%20%20%20%20start%20%3D%20len%0A%20%20%7D%0A%0A%20%20if%20(end%20%3C%200)%20%7B%0A%20%20%20%20end%20%2B%3D%20len%0A%20%20%20%20if%20(end%20%3C%200)%20end%20%3D%200%0A%20%20%7D%20else%20if%20(end%20%3E%20len)%20%7B%0A%20%20%20%20end%20%3D%20len%0A%20%20%7D%0A%0A%20%20if%20(end%20%3C%20start)%20end%20%3D%20start%0A%0A%20%20var%20newBuf%20%3D%20this.subarray(start%2C%20end)%0A%20%20%2F%2F%20Return%20an%20augmented%20%60Uint8Array%60%20instance%0A%20%20newBuf.__proto__%20%3D%20Buffer.prototype%0A%20%20return%20newBuf%0A%7D%0A%0A%2F*%0A%20*%20Need%20to%20make%20sure%20that%20buffer%20isn't%20trying%20to%20write%20out%20of%20bounds.%0A%20*%2F%0Afunction%20checkOffset%20(offset%2C%20ext%2C%20length)%20%7B%0A%20%20if%20((offset%20%25%201)%20!%3D%3D%200%20%7C%7C%20offset%20%3C%200)%20throw%20new%20RangeError('offset%20is%20not%20uint')%0A%20%20if%20(offset%20%2B%20ext%20%3E%20length)%20throw%20new%20RangeError('Trying%20to%20access%20beyond%20buffer%20length')%0A%7D%0A%0ABuffer.prototype.readUIntLE%20%3D%20function%20readUIntLE%20(offset%2C%20byteLength%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20byteLength%20%3D%20byteLength%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%20byteLength%2C%20this.length)%0A%0A%20%20var%20val%20%3D%20this%5Boffset%5D%0A%20%20var%20mul%20%3D%201%0A%20%20var%20i%20%3D%200%0A%20%20while%20(%2B%2Bi%20%3C%20byteLength%20%26%26%20(mul%20*%3D%200x100))%20%7B%0A%20%20%20%20val%20%2B%3D%20this%5Boffset%20%2B%20i%5D%20*%20mul%0A%20%20%7D%0A%0A%20%20return%20val%0A%7D%0A%0ABuffer.prototype.readUIntBE%20%3D%20function%20readUIntBE%20(offset%2C%20byteLength%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20byteLength%20%3D%20byteLength%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20%7B%0A%20%20%20%20checkOffset(offset%2C%20byteLength%2C%20this.length)%0A%20%20%7D%0A%0A%20%20var%20val%20%3D%20this%5Boffset%20%2B%20--byteLength%5D%0A%20%20var%20mul%20%3D%201%0A%20%20while%20(byteLength%20%3E%200%20%26%26%20(mul%20*%3D%200x100))%20%7B%0A%20%20%20%20val%20%2B%3D%20this%5Boffset%20%2B%20--byteLength%5D%20*%20mul%0A%20%20%7D%0A%0A%20%20return%20val%0A%7D%0A%0ABuffer.prototype.readUInt8%20%3D%20function%20readUInt8%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%201%2C%20this.length)%0A%20%20return%20this%5Boffset%5D%0A%7D%0A%0ABuffer.prototype.readUInt16LE%20%3D%20function%20readUInt16LE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%202%2C%20this.length)%0A%20%20return%20this%5Boffset%5D%20%7C%20(this%5Boffset%20%2B%201%5D%20%3C%3C%208)%0A%7D%0A%0ABuffer.prototype.readUInt16BE%20%3D%20function%20readUInt16BE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%202%2C%20this.length)%0A%20%20return%20(this%5Boffset%5D%20%3C%3C%208)%20%7C%20this%5Boffset%20%2B%201%5D%0A%7D%0A%0ABuffer.prototype.readUInt32LE%20%3D%20function%20readUInt32LE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%204%2C%20this.length)%0A%0A%20%20return%20((this%5Boffset%5D)%20%7C%0A%20%20%20%20%20%20(this%5Boffset%20%2B%201%5D%20%3C%3C%208)%20%7C%0A%20%20%20%20%20%20(this%5Boffset%20%2B%202%5D%20%3C%3C%2016))%20%2B%0A%20%20%20%20%20%20(this%5Boffset%20%2B%203%5D%20*%200x1000000)%0A%7D%0A%0ABuffer.prototype.readUInt32BE%20%3D%20function%20readUInt32BE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%204%2C%20this.length)%0A%0A%20%20return%20(this%5Boffset%5D%20*%200x1000000)%20%2B%0A%20%20%20%20((this%5Boffset%20%2B%201%5D%20%3C%3C%2016)%20%7C%0A%20%20%20%20(this%5Boffset%20%2B%202%5D%20%3C%3C%208)%20%7C%0A%20%20%20%20this%5Boffset%20%2B%203%5D)%0A%7D%0A%0ABuffer.prototype.readIntLE%20%3D%20function%20readIntLE%20(offset%2C%20byteLength%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20byteLength%20%3D%20byteLength%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%20byteLength%2C%20this.length)%0A%0A%20%20var%20val%20%3D%20this%5Boffset%5D%0A%20%20var%20mul%20%3D%201%0A%20%20var%20i%20%3D%200%0A%20%20while%20(%2B%2Bi%20%3C%20byteLength%20%26%26%20(mul%20*%3D%200x100))%20%7B%0A%20%20%20%20val%20%2B%3D%20this%5Boffset%20%2B%20i%5D%20*%20mul%0A%20%20%7D%0A%20%20mul%20*%3D%200x80%0A%0A%20%20if%20(val%20%3E%3D%20mul)%20val%20-%3D%20Math.pow(2%2C%208%20*%20byteLength)%0A%0A%20%20return%20val%0A%7D%0A%0ABuffer.prototype.readIntBE%20%3D%20function%20readIntBE%20(offset%2C%20byteLength%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20byteLength%20%3D%20byteLength%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%20byteLength%2C%20this.length)%0A%0A%20%20var%20i%20%3D%20byteLength%0A%20%20var%20mul%20%3D%201%0A%20%20var%20val%20%3D%20this%5Boffset%20%2B%20--i%5D%0A%20%20while%20(i%20%3E%200%20%26%26%20(mul%20*%3D%200x100))%20%7B%0A%20%20%20%20val%20%2B%3D%20this%5Boffset%20%2B%20--i%5D%20*%20mul%0A%20%20%7D%0A%20%20mul%20*%3D%200x80%0A%0A%20%20if%20(val%20%3E%3D%20mul)%20val%20-%3D%20Math.pow(2%2C%208%20*%20byteLength)%0A%0A%20%20return%20val%0A%7D%0A%0ABuffer.prototype.readInt8%20%3D%20function%20readInt8%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%201%2C%20this.length)%0A%20%20if%20(!(this%5Boffset%5D%20%26%200x80))%20return%20(this%5Boffset%5D)%0A%20%20return%20((0xff%20-%20this%5Boffset%5D%20%2B%201)%20*%20-1)%0A%7D%0A%0ABuffer.prototype.readInt16LE%20%3D%20function%20readInt16LE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%202%2C%20this.length)%0A%20%20var%20val%20%3D%20this%5Boffset%5D%20%7C%20(this%5Boffset%20%2B%201%5D%20%3C%3C%208)%0A%20%20return%20(val%20%26%200x8000)%20%3F%20val%20%7C%200xFFFF0000%20%3A%20val%0A%7D%0A%0ABuffer.prototype.readInt16BE%20%3D%20function%20readInt16BE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%202%2C%20this.length)%0A%20%20var%20val%20%3D%20this%5Boffset%20%2B%201%5D%20%7C%20(this%5Boffset%5D%20%3C%3C%208)%0A%20%20return%20(val%20%26%200x8000)%20%3F%20val%20%7C%200xFFFF0000%20%3A%20val%0A%7D%0A%0ABuffer.prototype.readInt32LE%20%3D%20function%20readInt32LE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%204%2C%20this.length)%0A%0A%20%20return%20(this%5Boffset%5D)%20%7C%0A%20%20%20%20(this%5Boffset%20%2B%201%5D%20%3C%3C%208)%20%7C%0A%20%20%20%20(this%5Boffset%20%2B%202%5D%20%3C%3C%2016)%20%7C%0A%20%20%20%20(this%5Boffset%20%2B%203%5D%20%3C%3C%2024)%0A%7D%0A%0ABuffer.prototype.readInt32BE%20%3D%20function%20readInt32BE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%204%2C%20this.length)%0A%0A%20%20return%20(this%5Boffset%5D%20%3C%3C%2024)%20%7C%0A%20%20%20%20(this%5Boffset%20%2B%201%5D%20%3C%3C%2016)%20%7C%0A%20%20%20%20(this%5Boffset%20%2B%202%5D%20%3C%3C%208)%20%7C%0A%20%20%20%20(this%5Boffset%20%2B%203%5D)%0A%7D%0A%0ABuffer.prototype.readFloatLE%20%3D%20function%20readFloatLE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%204%2C%20this.length)%0A%20%20return%20ieee754.read(this%2C%20offset%2C%20true%2C%2023%2C%204)%0A%7D%0A%0ABuffer.prototype.readFloatBE%20%3D%20function%20readFloatBE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%204%2C%20this.length)%0A%20%20return%20ieee754.read(this%2C%20offset%2C%20false%2C%2023%2C%204)%0A%7D%0A%0ABuffer.prototype.readDoubleLE%20%3D%20function%20readDoubleLE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%208%2C%20this.length)%0A%20%20return%20ieee754.read(this%2C%20offset%2C%20true%2C%2052%2C%208)%0A%7D%0A%0ABuffer.prototype.readDoubleBE%20%3D%20function%20readDoubleBE%20(offset%2C%20noAssert)%20%7B%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkOffset(offset%2C%208%2C%20this.length)%0A%20%20return%20ieee754.read(this%2C%20offset%2C%20false%2C%2052%2C%208)%0A%7D%0A%0Afunction%20checkInt%20(buf%2C%20value%2C%20offset%2C%20ext%2C%20max%2C%20min)%20%7B%0A%20%20if%20(!Buffer.isBuffer(buf))%20throw%20new%20TypeError('%22buffer%22%20argument%20must%20be%20a%20Buffer%20instance')%0A%20%20if%20(value%20%3E%20max%20%7C%7C%20value%20%3C%20min)%20throw%20new%20RangeError('%22value%22%20argument%20is%20out%20of%20bounds')%0A%20%20if%20(offset%20%2B%20ext%20%3E%20buf.length)%20throw%20new%20RangeError('Index%20out%20of%20range')%0A%7D%0A%0ABuffer.prototype.writeUIntLE%20%3D%20function%20writeUIntLE%20(value%2C%20offset%2C%20byteLength%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20byteLength%20%3D%20byteLength%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20%7B%0A%20%20%20%20var%20maxBytes%20%3D%20Math.pow(2%2C%208%20*%20byteLength)%20-%201%0A%20%20%20%20checkInt(this%2C%20value%2C%20offset%2C%20byteLength%2C%20maxBytes%2C%200)%0A%20%20%7D%0A%0A%20%20var%20mul%20%3D%201%0A%20%20var%20i%20%3D%200%0A%20%20this%5Boffset%5D%20%3D%20value%20%26%200xFF%0A%20%20while%20(%2B%2Bi%20%3C%20byteLength%20%26%26%20(mul%20*%3D%200x100))%20%7B%0A%20%20%20%20this%5Boffset%20%2B%20i%5D%20%3D%20(value%20%2F%20mul)%20%26%200xFF%0A%20%20%7D%0A%0A%20%20return%20offset%20%2B%20byteLength%0A%7D%0A%0ABuffer.prototype.writeUIntBE%20%3D%20function%20writeUIntBE%20(value%2C%20offset%2C%20byteLength%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20byteLength%20%3D%20byteLength%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20%7B%0A%20%20%20%20var%20maxBytes%20%3D%20Math.pow(2%2C%208%20*%20byteLength)%20-%201%0A%20%20%20%20checkInt(this%2C%20value%2C%20offset%2C%20byteLength%2C%20maxBytes%2C%200)%0A%20%20%7D%0A%0A%20%20var%20i%20%3D%20byteLength%20-%201%0A%20%20var%20mul%20%3D%201%0A%20%20this%5Boffset%20%2B%20i%5D%20%3D%20value%20%26%200xFF%0A%20%20while%20(--i%20%3E%3D%200%20%26%26%20(mul%20*%3D%200x100))%20%7B%0A%20%20%20%20this%5Boffset%20%2B%20i%5D%20%3D%20(value%20%2F%20mul)%20%26%200xFF%0A%20%20%7D%0A%0A%20%20return%20offset%20%2B%20byteLength%0A%7D%0A%0ABuffer.prototype.writeUInt8%20%3D%20function%20writeUInt8%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkInt(this%2C%20value%2C%20offset%2C%201%2C%200xff%2C%200)%0A%20%20this%5Boffset%5D%20%3D%20(value%20%26%200xff)%0A%20%20return%20offset%20%2B%201%0A%7D%0A%0ABuffer.prototype.writeUInt16LE%20%3D%20function%20writeUInt16LE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkInt(this%2C%20value%2C%20offset%2C%202%2C%200xffff%2C%200)%0A%20%20this%5Boffset%5D%20%3D%20(value%20%26%200xff)%0A%20%20this%5Boffset%20%2B%201%5D%20%3D%20(value%20%3E%3E%3E%208)%0A%20%20return%20offset%20%2B%202%0A%7D%0A%0ABuffer.prototype.writeUInt16BE%20%3D%20function%20writeUInt16BE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkInt(this%2C%20value%2C%20offset%2C%202%2C%200xffff%2C%200)%0A%20%20this%5Boffset%5D%20%3D%20(value%20%3E%3E%3E%208)%0A%20%20this%5Boffset%20%2B%201%5D%20%3D%20(value%20%26%200xff)%0A%20%20return%20offset%20%2B%202%0A%7D%0A%0ABuffer.prototype.writeUInt32LE%20%3D%20function%20writeUInt32LE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkInt(this%2C%20value%2C%20offset%2C%204%2C%200xffffffff%2C%200)%0A%20%20this%5Boffset%20%2B%203%5D%20%3D%20(value%20%3E%3E%3E%2024)%0A%20%20this%5Boffset%20%2B%202%5D%20%3D%20(value%20%3E%3E%3E%2016)%0A%20%20this%5Boffset%20%2B%201%5D%20%3D%20(value%20%3E%3E%3E%208)%0A%20%20this%5Boffset%5D%20%3D%20(value%20%26%200xff)%0A%20%20return%20offset%20%2B%204%0A%7D%0A%0ABuffer.prototype.writeUInt32BE%20%3D%20function%20writeUInt32BE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkInt(this%2C%20value%2C%20offset%2C%204%2C%200xffffffff%2C%200)%0A%20%20this%5Boffset%5D%20%3D%20(value%20%3E%3E%3E%2024)%0A%20%20this%5Boffset%20%2B%201%5D%20%3D%20(value%20%3E%3E%3E%2016)%0A%20%20this%5Boffset%20%2B%202%5D%20%3D%20(value%20%3E%3E%3E%208)%0A%20%20this%5Boffset%20%2B%203%5D%20%3D%20(value%20%26%200xff)%0A%20%20return%20offset%20%2B%204%0A%7D%0A%0ABuffer.prototype.writeIntLE%20%3D%20function%20writeIntLE%20(value%2C%20offset%2C%20byteLength%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20%7B%0A%20%20%20%20var%20limit%20%3D%20Math.pow(2%2C%20(8%20*%20byteLength)%20-%201)%0A%0A%20%20%20%20checkInt(this%2C%20value%2C%20offset%2C%20byteLength%2C%20limit%20-%201%2C%20-limit)%0A%20%20%7D%0A%0A%20%20var%20i%20%3D%200%0A%20%20var%20mul%20%3D%201%0A%20%20var%20sub%20%3D%200%0A%20%20this%5Boffset%5D%20%3D%20value%20%26%200xFF%0A%20%20while%20(%2B%2Bi%20%3C%20byteLength%20%26%26%20(mul%20*%3D%200x100))%20%7B%0A%20%20%20%20if%20(value%20%3C%200%20%26%26%20sub%20%3D%3D%3D%200%20%26%26%20this%5Boffset%20%2B%20i%20-%201%5D%20!%3D%3D%200)%20%7B%0A%20%20%20%20%20%20sub%20%3D%201%0A%20%20%20%20%7D%0A%20%20%20%20this%5Boffset%20%2B%20i%5D%20%3D%20((value%20%2F%20mul)%20%3E%3E%200)%20-%20sub%20%26%200xFF%0A%20%20%7D%0A%0A%20%20return%20offset%20%2B%20byteLength%0A%7D%0A%0ABuffer.prototype.writeIntBE%20%3D%20function%20writeIntBE%20(value%2C%20offset%2C%20byteLength%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20%7B%0A%20%20%20%20var%20limit%20%3D%20Math.pow(2%2C%20(8%20*%20byteLength)%20-%201)%0A%0A%20%20%20%20checkInt(this%2C%20value%2C%20offset%2C%20byteLength%2C%20limit%20-%201%2C%20-limit)%0A%20%20%7D%0A%0A%20%20var%20i%20%3D%20byteLength%20-%201%0A%20%20var%20mul%20%3D%201%0A%20%20var%20sub%20%3D%200%0A%20%20this%5Boffset%20%2B%20i%5D%20%3D%20value%20%26%200xFF%0A%20%20while%20(--i%20%3E%3D%200%20%26%26%20(mul%20*%3D%200x100))%20%7B%0A%20%20%20%20if%20(value%20%3C%200%20%26%26%20sub%20%3D%3D%3D%200%20%26%26%20this%5Boffset%20%2B%20i%20%2B%201%5D%20!%3D%3D%200)%20%7B%0A%20%20%20%20%20%20sub%20%3D%201%0A%20%20%20%20%7D%0A%20%20%20%20this%5Boffset%20%2B%20i%5D%20%3D%20((value%20%2F%20mul)%20%3E%3E%200)%20-%20sub%20%26%200xFF%0A%20%20%7D%0A%0A%20%20return%20offset%20%2B%20byteLength%0A%7D%0A%0ABuffer.prototype.writeInt8%20%3D%20function%20writeInt8%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkInt(this%2C%20value%2C%20offset%2C%201%2C%200x7f%2C%20-0x80)%0A%20%20if%20(value%20%3C%200)%20value%20%3D%200xff%20%2B%20value%20%2B%201%0A%20%20this%5Boffset%5D%20%3D%20(value%20%26%200xff)%0A%20%20return%20offset%20%2B%201%0A%7D%0A%0ABuffer.prototype.writeInt16LE%20%3D%20function%20writeInt16LE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkInt(this%2C%20value%2C%20offset%2C%202%2C%200x7fff%2C%20-0x8000)%0A%20%20this%5Boffset%5D%20%3D%20(value%20%26%200xff)%0A%20%20this%5Boffset%20%2B%201%5D%20%3D%20(value%20%3E%3E%3E%208)%0A%20%20return%20offset%20%2B%202%0A%7D%0A%0ABuffer.prototype.writeInt16BE%20%3D%20function%20writeInt16BE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkInt(this%2C%20value%2C%20offset%2C%202%2C%200x7fff%2C%20-0x8000)%0A%20%20this%5Boffset%5D%20%3D%20(value%20%3E%3E%3E%208)%0A%20%20this%5Boffset%20%2B%201%5D%20%3D%20(value%20%26%200xff)%0A%20%20return%20offset%20%2B%202%0A%7D%0A%0ABuffer.prototype.writeInt32LE%20%3D%20function%20writeInt32LE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkInt(this%2C%20value%2C%20offset%2C%204%2C%200x7fffffff%2C%20-0x80000000)%0A%20%20this%5Boffset%5D%20%3D%20(value%20%26%200xff)%0A%20%20this%5Boffset%20%2B%201%5D%20%3D%20(value%20%3E%3E%3E%208)%0A%20%20this%5Boffset%20%2B%202%5D%20%3D%20(value%20%3E%3E%3E%2016)%0A%20%20this%5Boffset%20%2B%203%5D%20%3D%20(value%20%3E%3E%3E%2024)%0A%20%20return%20offset%20%2B%204%0A%7D%0A%0ABuffer.prototype.writeInt32BE%20%3D%20function%20writeInt32BE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20checkInt(this%2C%20value%2C%20offset%2C%204%2C%200x7fffffff%2C%20-0x80000000)%0A%20%20if%20(value%20%3C%200)%20value%20%3D%200xffffffff%20%2B%20value%20%2B%201%0A%20%20this%5Boffset%5D%20%3D%20(value%20%3E%3E%3E%2024)%0A%20%20this%5Boffset%20%2B%201%5D%20%3D%20(value%20%3E%3E%3E%2016)%0A%20%20this%5Boffset%20%2B%202%5D%20%3D%20(value%20%3E%3E%3E%208)%0A%20%20this%5Boffset%20%2B%203%5D%20%3D%20(value%20%26%200xff)%0A%20%20return%20offset%20%2B%204%0A%7D%0A%0Afunction%20checkIEEE754%20(buf%2C%20value%2C%20offset%2C%20ext%2C%20max%2C%20min)%20%7B%0A%20%20if%20(offset%20%2B%20ext%20%3E%20buf.length)%20throw%20new%20RangeError('Index%20out%20of%20range')%0A%20%20if%20(offset%20%3C%200)%20throw%20new%20RangeError('Index%20out%20of%20range')%0A%7D%0A%0Afunction%20writeFloat%20(buf%2C%20value%2C%20offset%2C%20littleEndian%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20%7B%0A%20%20%20%20checkIEEE754(buf%2C%20value%2C%20offset%2C%204%2C%203.4028234663852886e%2B38%2C%20-3.4028234663852886e%2B38)%0A%20%20%7D%0A%20%20ieee754.write(buf%2C%20value%2C%20offset%2C%20littleEndian%2C%2023%2C%204)%0A%20%20return%20offset%20%2B%204%0A%7D%0A%0ABuffer.prototype.writeFloatLE%20%3D%20function%20writeFloatLE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20return%20writeFloat(this%2C%20value%2C%20offset%2C%20true%2C%20noAssert)%0A%7D%0A%0ABuffer.prototype.writeFloatBE%20%3D%20function%20writeFloatBE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20return%20writeFloat(this%2C%20value%2C%20offset%2C%20false%2C%20noAssert)%0A%7D%0A%0Afunction%20writeDouble%20(buf%2C%20value%2C%20offset%2C%20littleEndian%2C%20noAssert)%20%7B%0A%20%20value%20%3D%20%2Bvalue%0A%20%20offset%20%3D%20offset%20%3E%3E%3E%200%0A%20%20if%20(!noAssert)%20%7B%0A%20%20%20%20checkIEEE754(buf%2C%20value%2C%20offset%2C%208%2C%201.7976931348623157E%2B308%2C%20-1.7976931348623157E%2B308)%0A%20%20%7D%0A%20%20ieee754.write(buf%2C%20value%2C%20offset%2C%20littleEndian%2C%2052%2C%208)%0A%20%20return%20offset%20%2B%208%0A%7D%0A%0ABuffer.prototype.writeDoubleLE%20%3D%20function%20writeDoubleLE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20return%20writeDouble(this%2C%20value%2C%20offset%2C%20true%2C%20noAssert)%0A%7D%0A%0ABuffer.prototype.writeDoubleBE%20%3D%20function%20writeDoubleBE%20(value%2C%20offset%2C%20noAssert)%20%7B%0A%20%20return%20writeDouble(this%2C%20value%2C%20offset%2C%20false%2C%20noAssert)%0A%7D%0A%0A%2F%2F%20copy(targetBuffer%2C%20targetStart%3D0%2C%20sourceStart%3D0%2C%20sourceEnd%3Dbuffer.length)%0ABuffer.prototype.copy%20%3D%20function%20copy%20(target%2C%20targetStart%2C%20start%2C%20end)%20%7B%0A%20%20if%20(!Buffer.isBuffer(target))%20throw%20new%20TypeError('argument%20should%20be%20a%20Buffer')%0A%20%20if%20(!start)%20start%20%3D%200%0A%20%20if%20(!end%20%26%26%20end%20!%3D%3D%200)%20end%20%3D%20this.length%0A%20%20if%20(targetStart%20%3E%3D%20target.length)%20targetStart%20%3D%20target.length%0A%20%20if%20(!targetStart)%20targetStart%20%3D%200%0A%20%20if%20(end%20%3E%200%20%26%26%20end%20%3C%20start)%20end%20%3D%20start%0A%0A%20%20%2F%2F%20Copy%200%20bytes%3B%20we're%20done%0A%20%20if%20(end%20%3D%3D%3D%20start)%20return%200%0A%20%20if%20(target.length%20%3D%3D%3D%200%20%7C%7C%20this.length%20%3D%3D%3D%200)%20return%200%0A%0A%20%20%2F%2F%20Fatal%20error%20conditions%0A%20%20if%20(targetStart%20%3C%200)%20%7B%0A%20%20%20%20throw%20new%20RangeError('targetStart%20out%20of%20bounds')%0A%20%20%7D%0A%20%20if%20(start%20%3C%200%20%7C%7C%20start%20%3E%3D%20this.length)%20throw%20new%20RangeError('Index%20out%20of%20range')%0A%20%20if%20(end%20%3C%200)%20throw%20new%20RangeError('sourceEnd%20out%20of%20bounds')%0A%0A%20%20%2F%2F%20Are%20we%20oob%3F%0A%20%20if%20(end%20%3E%20this.length)%20end%20%3D%20this.length%0A%20%20if%20(target.length%20-%20targetStart%20%3C%20end%20-%20start)%20%7B%0A%20%20%20%20end%20%3D%20target.length%20-%20targetStart%20%2B%20start%0A%20%20%7D%0A%0A%20%20var%20len%20%3D%20end%20-%20start%0A%0A%20%20if%20(this%20%3D%3D%3D%20target%20%26%26%20typeof%20Uint8Array.prototype.copyWithin%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20%2F%2F%20Use%20built-in%20when%20available%2C%20missing%20from%20IE11%0A%20%20%20%20this.copyWithin(targetStart%2C%20start%2C%20end)%0A%20%20%7D%20else%20if%20(this%20%3D%3D%3D%20target%20%26%26%20start%20%3C%20targetStart%20%26%26%20targetStart%20%3C%20end)%20%7B%0A%20%20%20%20%2F%2F%20descending%20copy%20from%20end%0A%20%20%20%20for%20(var%20i%20%3D%20len%20-%201%3B%20i%20%3E%3D%200%3B%20--i)%20%7B%0A%20%20%20%20%20%20target%5Bi%20%2B%20targetStart%5D%20%3D%20this%5Bi%20%2B%20start%5D%0A%20%20%20%20%7D%0A%20%20%7D%20else%20%7B%0A%20%20%20%20Uint8Array.prototype.set.call(%0A%20%20%20%20%20%20target%2C%0A%20%20%20%20%20%20this.subarray(start%2C%20end)%2C%0A%20%20%20%20%20%20targetStart%0A%20%20%20%20)%0A%20%20%7D%0A%0A%20%20return%20len%0A%7D%0A%0A%2F%2F%20Usage%3A%0A%2F%2F%20%20%20%20buffer.fill(number%5B%2C%20offset%5B%2C%20end%5D%5D)%0A%2F%2F%20%20%20%20buffer.fill(buffer%5B%2C%20offset%5B%2C%20end%5D%5D)%0A%2F%2F%20%20%20%20buffer.fill(string%5B%2C%20offset%5B%2C%20end%5D%5D%5B%2C%20encoding%5D)%0ABuffer.prototype.fill%20%3D%20function%20fill%20(val%2C%20start%2C%20end%2C%20encoding)%20%7B%0A%20%20%2F%2F%20Handle%20string%20cases%3A%0A%20%20if%20(typeof%20val%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20if%20(typeof%20start%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20%20%20encoding%20%3D%20start%0A%20%20%20%20%20%20start%20%3D%200%0A%20%20%20%20%20%20end%20%3D%20this.length%0A%20%20%20%20%7D%20else%20if%20(typeof%20end%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20%20%20encoding%20%3D%20end%0A%20%20%20%20%20%20end%20%3D%20this.length%0A%20%20%20%20%7D%0A%20%20%20%20if%20(encoding%20!%3D%3D%20undefined%20%26%26%20typeof%20encoding%20!%3D%3D%20'string')%20%7B%0A%20%20%20%20%20%20throw%20new%20TypeError('encoding%20must%20be%20a%20string')%0A%20%20%20%20%7D%0A%20%20%20%20if%20(typeof%20encoding%20%3D%3D%3D%20'string'%20%26%26%20!Buffer.isEncoding(encoding))%20%7B%0A%20%20%20%20%20%20throw%20new%20TypeError('Unknown%20encoding%3A%20'%20%2B%20encoding)%0A%20%20%20%20%7D%0A%20%20%20%20if%20(val.length%20%3D%3D%3D%201)%20%7B%0A%20%20%20%20%20%20var%20code%20%3D%20val.charCodeAt(0)%0A%20%20%20%20%20%20if%20((encoding%20%3D%3D%3D%20'utf8'%20%26%26%20code%20%3C%20128)%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20encoding%20%3D%3D%3D%20'latin1')%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20Fast%20path%3A%20If%20%60val%60%20fits%20into%20a%20single%20byte%2C%20use%20that%20numeric%20value.%0A%20%20%20%20%20%20%20%20val%20%3D%20code%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%20else%20if%20(typeof%20val%20%3D%3D%3D%20'number')%20%7B%0A%20%20%20%20val%20%3D%20val%20%26%20255%0A%20%20%7D%0A%0A%20%20%2F%2F%20Invalid%20ranges%20are%20not%20set%20to%20a%20default%2C%20so%20can%20range%20check%20early.%0A%20%20if%20(start%20%3C%200%20%7C%7C%20this.length%20%3C%20start%20%7C%7C%20this.length%20%3C%20end)%20%7B%0A%20%20%20%20throw%20new%20RangeError('Out%20of%20range%20index')%0A%20%20%7D%0A%0A%20%20if%20(end%20%3C%3D%20start)%20%7B%0A%20%20%20%20return%20this%0A%20%20%7D%0A%0A%20%20start%20%3D%20start%20%3E%3E%3E%200%0A%20%20end%20%3D%20end%20%3D%3D%3D%20undefined%20%3F%20this.length%20%3A%20end%20%3E%3E%3E%200%0A%0A%20%20if%20(!val)%20val%20%3D%200%0A%0A%20%20var%20i%0A%20%20if%20(typeof%20val%20%3D%3D%3D%20'number')%20%7B%0A%20%20%20%20for%20(i%20%3D%20start%3B%20i%20%3C%20end%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20%20%20this%5Bi%5D%20%3D%20val%0A%20%20%20%20%7D%0A%20%20%7D%20else%20%7B%0A%20%20%20%20var%20bytes%20%3D%20Buffer.isBuffer(val)%0A%20%20%20%20%20%20%3F%20val%0A%20%20%20%20%20%20%3A%20new%20Buffer(val%2C%20encoding)%0A%20%20%20%20var%20len%20%3D%20bytes.length%0A%20%20%20%20if%20(len%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%20%20throw%20new%20TypeError('The%20value%20%22'%20%2B%20val%20%2B%0A%20%20%20%20%20%20%20%20'%22%20is%20invalid%20for%20argument%20%22value%22')%0A%20%20%20%20%7D%0A%20%20%20%20for%20(i%20%3D%200%3B%20i%20%3C%20end%20-%20start%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20%20%20this%5Bi%20%2B%20start%5D%20%3D%20bytes%5Bi%20%25%20len%5D%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20return%20this%0A%7D%0A%0A%2F%2F%20HELPER%20FUNCTIONS%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%0Avar%20INVALID_BASE64_RE%20%3D%20%2F%5B%5E%2B%2F0-9A-Za-z-_%5D%2Fg%0A%0Afunction%20base64clean%20(str)%20%7B%0A%20%20%2F%2F%20Node%20takes%20equal%20signs%20as%20end%20of%20the%20Base64%20encoding%0A%20%20str%20%3D%20str.split('%3D')%5B0%5D%0A%20%20%2F%2F%20Node%20strips%20out%20invalid%20characters%20like%20%5Cn%20and%20%5Ct%20from%20the%20string%2C%20base64-js%20does%20not%0A%20%20str%20%3D%20str.trim().replace(INVALID_BASE64_RE%2C%20'')%0A%20%20%2F%2F%20Node%20converts%20strings%20with%20length%20%3C%202%20to%20''%0A%20%20if%20(str.length%20%3C%202)%20return%20''%0A%20%20%2F%2F%20Node%20allows%20for%20non-padded%20base64%20strings%20(missing%20trailing%20%3D%3D%3D)%2C%20base64-js%20does%20not%0A%20%20while%20(str.length%20%25%204%20!%3D%3D%200)%20%7B%0A%20%20%20%20str%20%3D%20str%20%2B%20'%3D'%0A%20%20%7D%0A%20%20return%20str%0A%7D%0A%0Afunction%20toHex%20(n)%20%7B%0A%20%20if%20(n%20%3C%2016)%20return%20'0'%20%2B%20n.toString(16)%0A%20%20return%20n.toString(16)%0A%7D%0A%0Afunction%20utf8ToBytes%20(string%2C%20units)%20%7B%0A%20%20units%20%3D%20units%20%7C%7C%20Infinity%0A%20%20var%20codePoint%0A%20%20var%20length%20%3D%20string.length%0A%20%20var%20leadSurrogate%20%3D%20null%0A%20%20var%20bytes%20%3D%20%5B%5D%0A%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20length%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20codePoint%20%3D%20string.charCodeAt(i)%0A%0A%20%20%20%20%2F%2F%20is%20surrogate%20component%0A%20%20%20%20if%20(codePoint%20%3E%200xD7FF%20%26%26%20codePoint%20%3C%200xE000)%20%7B%0A%20%20%20%20%20%20%2F%2F%20last%20char%20was%20a%20lead%0A%20%20%20%20%20%20if%20(!leadSurrogate)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20no%20lead%20yet%0A%20%20%20%20%20%20%20%20if%20(codePoint%20%3E%200xDBFF)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20unexpected%20trail%0A%20%20%20%20%20%20%20%20%20%20if%20((units%20-%3D%203)%20%3E%20-1)%20bytes.push(0xEF%2C%200xBF%2C%200xBD)%0A%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(i%20%2B%201%20%3D%3D%3D%20length)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20unpaired%20lead%0A%20%20%20%20%20%20%20%20%20%20if%20((units%20-%3D%203)%20%3E%20-1)%20bytes.push(0xEF%2C%200xBF%2C%200xBD)%0A%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20valid%20lead%0A%20%20%20%20%20%20%20%20leadSurrogate%20%3D%20codePoint%0A%0A%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F%2F%202%20leads%20in%20a%20row%0A%20%20%20%20%20%20if%20(codePoint%20%3C%200xDC00)%20%7B%0A%20%20%20%20%20%20%20%20if%20((units%20-%3D%203)%20%3E%20-1)%20bytes.push(0xEF%2C%200xBF%2C%200xBD)%0A%20%20%20%20%20%20%20%20leadSurrogate%20%3D%20codePoint%0A%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F%2F%20valid%20surrogate%20pair%0A%20%20%20%20%20%20codePoint%20%3D%20(leadSurrogate%20-%200xD800%20%3C%3C%2010%20%7C%20codePoint%20-%200xDC00)%20%2B%200x10000%0A%20%20%20%20%7D%20else%20if%20(leadSurrogate)%20%7B%0A%20%20%20%20%20%20%2F%2F%20valid%20bmp%20char%2C%20but%20last%20char%20was%20a%20lead%0A%20%20%20%20%20%20if%20((units%20-%3D%203)%20%3E%20-1)%20bytes.push(0xEF%2C%200xBF%2C%200xBD)%0A%20%20%20%20%7D%0A%0A%20%20%20%20leadSurrogate%20%3D%20null%0A%0A%20%20%20%20%2F%2F%20encode%20utf8%0A%20%20%20%20if%20(codePoint%20%3C%200x80)%20%7B%0A%20%20%20%20%20%20if%20((units%20-%3D%201)%20%3C%200)%20break%0A%20%20%20%20%20%20bytes.push(codePoint)%0A%20%20%20%20%7D%20else%20if%20(codePoint%20%3C%200x800)%20%7B%0A%20%20%20%20%20%20if%20((units%20-%3D%202)%20%3C%200)%20break%0A%20%20%20%20%20%20bytes.push(%0A%20%20%20%20%20%20%20%20codePoint%20%3E%3E%200x6%20%7C%200xC0%2C%0A%20%20%20%20%20%20%20%20codePoint%20%26%200x3F%20%7C%200x80%0A%20%20%20%20%20%20)%0A%20%20%20%20%7D%20else%20if%20(codePoint%20%3C%200x10000)%20%7B%0A%20%20%20%20%20%20if%20((units%20-%3D%203)%20%3C%200)%20break%0A%20%20%20%20%20%20bytes.push(%0A%20%20%20%20%20%20%20%20codePoint%20%3E%3E%200xC%20%7C%200xE0%2C%0A%20%20%20%20%20%20%20%20codePoint%20%3E%3E%200x6%20%26%200x3F%20%7C%200x80%2C%0A%20%20%20%20%20%20%20%20codePoint%20%26%200x3F%20%7C%200x80%0A%20%20%20%20%20%20)%0A%20%20%20%20%7D%20else%20if%20(codePoint%20%3C%200x110000)%20%7B%0A%20%20%20%20%20%20if%20((units%20-%3D%204)%20%3C%200)%20break%0A%20%20%20%20%20%20bytes.push(%0A%20%20%20%20%20%20%20%20codePoint%20%3E%3E%200x12%20%7C%200xF0%2C%0A%20%20%20%20%20%20%20%20codePoint%20%3E%3E%200xC%20%26%200x3F%20%7C%200x80%2C%0A%20%20%20%20%20%20%20%20codePoint%20%3E%3E%200x6%20%26%200x3F%20%7C%200x80%2C%0A%20%20%20%20%20%20%20%20codePoint%20%26%200x3F%20%7C%200x80%0A%20%20%20%20%20%20)%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20throw%20new%20Error('Invalid%20code%20point')%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20return%20bytes%0A%7D%0A%0Afunction%20asciiToBytes%20(str)%20%7B%0A%20%20var%20byteArray%20%3D%20%5B%5D%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20str.length%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20%2F%2F%20Node's%20code%20seems%20to%20be%20doing%20this%20and%20not%20%26%200x7F..%0A%20%20%20%20byteArray.push(str.charCodeAt(i)%20%26%200xFF)%0A%20%20%7D%0A%20%20return%20byteArray%0A%7D%0A%0Afunction%20utf16leToBytes%20(str%2C%20units)%20%7B%0A%20%20var%20c%2C%20hi%2C%20lo%0A%20%20var%20byteArray%20%3D%20%5B%5D%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20str.length%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20if%20((units%20-%3D%202)%20%3C%200)%20break%0A%0A%20%20%20%20c%20%3D%20str.charCodeAt(i)%0A%20%20%20%20hi%20%3D%20c%20%3E%3E%208%0A%20%20%20%20lo%20%3D%20c%20%25%20256%0A%20%20%20%20byteArray.push(lo)%0A%20%20%20%20byteArray.push(hi)%0A%20%20%7D%0A%0A%20%20return%20byteArray%0A%7D%0A%0Afunction%20base64ToBytes%20(str)%20%7B%0A%20%20return%20base64.toByteArray(base64clean(str))%0A%7D%0A%0Afunction%20blitBuffer%20(src%2C%20dst%2C%20offset%2C%20length)%20%7B%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20length%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20if%20((i%20%2B%20offset%20%3E%3D%20dst.length)%20%7C%7C%20(i%20%3E%3D%20src.length))%20break%0A%20%20%20%20dst%5Bi%20%2B%20offset%5D%20%3D%20src%5Bi%5D%0A%20%20%7D%0A%20%20return%20i%0A%7D%0A%0A%2F%2F%20ArrayBuffers%20from%20another%20context%20(i.e.%20an%20iframe)%20do%20not%20pass%20the%20%60instanceof%60%20check%0A%2F%2F%20but%20they%20should%20be%20treated%20as%20valid.%20See%3A%20https%3A%2F%2Fgithub.com%2Ffeross%2Fbuffer%2Fissues%2F166%0Afunction%20isArrayBuffer%20(obj)%20%7B%0A%20%20return%20obj%20instanceof%20ArrayBuffer%20%7C%7C%0A%20%20%20%20(obj%20!%3D%20null%20%26%26%20obj.constructor%20!%3D%20null%20%26%26%20obj.constructor.name%20%3D%3D%3D%20'ArrayBuffer'%20%26%26%0A%20%20%20%20%20%20typeof%20obj.byteLength%20%3D%3D%3D%20'number')%0A%7D%0A%0Afunction%20numberIsNaN%20(obj)%20%7B%0A%20%20return%20obj%20!%3D%3D%20obj%20%2F%2F%20eslint-disable-line%20no-self-compare%0A%7D%0A%0A%7D%2C%7B%22base64-js%22%3A5%2C%22ieee754%22%3A28%7D%5D%2C9%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F**%0A%20*%20Slice%20reference.%0A%20*%2F%0A%0Avar%20slice%20%3D%20%5B%5D.slice%3B%0A%0A%2F**%0A%20*%20Bind%20%60obj%60%20to%20%60fn%60.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20obj%0A%20*%20%40param%20%7BFunction%7CString%7D%20fn%20or%20string%0A%20*%20%40return%20%7BFunction%7D%0A%20*%20%40api%20public%0A%20*%2F%0A%0Amodule.exports%20%3D%20function(obj%2C%20fn)%7B%0A%20%20if%20('string'%20%3D%3D%20typeof%20fn)%20fn%20%3D%20obj%5Bfn%5D%3B%0A%20%20if%20('function'%20!%3D%20typeof%20fn)%20throw%20new%20Error('bind()%20requires%20a%20function')%3B%0A%20%20var%20args%20%3D%20slice.call(arguments%2C%202)%3B%0A%20%20return%20function()%7B%0A%20%20%20%20return%20fn.apply(obj%2C%20args.concat(slice.call(arguments)))%3B%0A%20%20%7D%0A%7D%3B%0A%0A%7D%2C%7B%7D%5D%2C10%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0D%0A%2F**%0D%0A%20*%20Expose%20%60Emitter%60.%0D%0A%20*%2F%0D%0A%0D%0Aif%20(typeof%20module%20!%3D%3D%20'undefined')%20%7B%0D%0A%20%20module.exports%20%3D%20Emitter%3B%0D%0A%7D%0D%0A%0D%0A%2F**%0D%0A%20*%20Initialize%20a%20new%20%60Emitter%60.%0D%0A%20*%0D%0A%20*%20%40api%20public%0D%0A%20*%2F%0D%0A%0D%0Afunction%20Emitter(obj)%20%7B%0D%0A%20%20if%20(obj)%20return%20mixin(obj)%3B%0D%0A%7D%3B%0D%0A%0D%0A%2F**%0D%0A%20*%20Mixin%20the%20emitter%20properties.%0D%0A%20*%0D%0A%20*%20%40param%20%7BObject%7D%20obj%0D%0A%20*%20%40return%20%7BObject%7D%0D%0A%20*%20%40api%20private%0D%0A%20*%2F%0D%0A%0D%0Afunction%20mixin(obj)%20%7B%0D%0A%20%20for%20(var%20key%20in%20Emitter.prototype)%20%7B%0D%0A%20%20%20%20obj%5Bkey%5D%20%3D%20Emitter.prototype%5Bkey%5D%3B%0D%0A%20%20%7D%0D%0A%20%20return%20obj%3B%0D%0A%7D%0D%0A%0D%0A%2F**%0D%0A%20*%20Listen%20on%20the%20given%20%60event%60%20with%20%60fn%60.%0D%0A%20*%0D%0A%20*%20%40param%20%7BString%7D%20event%0D%0A%20*%20%40param%20%7BFunction%7D%20fn%0D%0A%20*%20%40return%20%7BEmitter%7D%0D%0A%20*%20%40api%20public%0D%0A%20*%2F%0D%0A%0D%0AEmitter.prototype.on%20%3D%0D%0AEmitter.prototype.addEventListener%20%3D%20function(event%2C%20fn)%7B%0D%0A%20%20this._callbacks%20%3D%20this._callbacks%20%7C%7C%20%7B%7D%3B%0D%0A%20%20(this._callbacks%5B'%24'%20%2B%20event%5D%20%3D%20this._callbacks%5B'%24'%20%2B%20event%5D%20%7C%7C%20%5B%5D)%0D%0A%20%20%20%20.push(fn)%3B%0D%0A%20%20return%20this%3B%0D%0A%7D%3B%0D%0A%0D%0A%2F**%0D%0A%20*%20Adds%20an%20%60event%60%20listener%20that%20will%20be%20invoked%20a%20single%0D%0A%20*%20time%20then%20automatically%20removed.%0D%0A%20*%0D%0A%20*%20%40param%20%7BString%7D%20event%0D%0A%20*%20%40param%20%7BFunction%7D%20fn%0D%0A%20*%20%40return%20%7BEmitter%7D%0D%0A%20*%20%40api%20public%0D%0A%20*%2F%0D%0A%0D%0AEmitter.prototype.once%20%3D%20function(event%2C%20fn)%7B%0D%0A%20%20function%20on()%20%7B%0D%0A%20%20%20%20this.off(event%2C%20on)%3B%0D%0A%20%20%20%20fn.apply(this%2C%20arguments)%3B%0D%0A%20%20%7D%0D%0A%0D%0A%20%20on.fn%20%3D%20fn%3B%0D%0A%20%20this.on(event%2C%20on)%3B%0D%0A%20%20return%20this%3B%0D%0A%7D%3B%0D%0A%0D%0A%2F**%0D%0A%20*%20Remove%20the%20given%20callback%20for%20%60event%60%20or%20all%0D%0A%20*%20registered%20callbacks.%0D%0A%20*%0D%0A%20*%20%40param%20%7BString%7D%20event%0D%0A%20*%20%40param%20%7BFunction%7D%20fn%0D%0A%20*%20%40return%20%7BEmitter%7D%0D%0A%20*%20%40api%20public%0D%0A%20*%2F%0D%0A%0D%0AEmitter.prototype.off%20%3D%0D%0AEmitter.prototype.removeListener%20%3D%0D%0AEmitter.prototype.removeAllListeners%20%3D%0D%0AEmitter.prototype.removeEventListener%20%3D%20function(event%2C%20fn)%7B%0D%0A%20%20this._callbacks%20%3D%20this._callbacks%20%7C%7C%20%7B%7D%3B%0D%0A%0D%0A%20%20%2F%2F%20all%0D%0A%20%20if%20(0%20%3D%3D%20arguments.length)%20%7B%0D%0A%20%20%20%20this._callbacks%20%3D%20%7B%7D%3B%0D%0A%20%20%20%20return%20this%3B%0D%0A%20%20%7D%0D%0A%0D%0A%20%20%2F%2F%20specific%20event%0D%0A%20%20var%20callbacks%20%3D%20this._callbacks%5B'%24'%20%2B%20event%5D%3B%0D%0A%20%20if%20(!callbacks)%20return%20this%3B%0D%0A%0D%0A%20%20%2F%2F%20remove%20all%20handlers%0D%0A%20%20if%20(1%20%3D%3D%20arguments.length)%20%7B%0D%0A%20%20%20%20delete%20this._callbacks%5B'%24'%20%2B%20event%5D%3B%0D%0A%20%20%20%20return%20this%3B%0D%0A%20%20%7D%0D%0A%0D%0A%20%20%2F%2F%20remove%20specific%20handler%0D%0A%20%20var%20cb%3B%0D%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20callbacks.length%3B%20i%2B%2B)%20%7B%0D%0A%20%20%20%20cb%20%3D%20callbacks%5Bi%5D%3B%0D%0A%20%20%20%20if%20(cb%20%3D%3D%3D%20fn%20%7C%7C%20cb.fn%20%3D%3D%3D%20fn)%20%7B%0D%0A%20%20%20%20%20%20callbacks.splice(i%2C%201)%3B%0D%0A%20%20%20%20%20%20break%3B%0D%0A%20%20%20%20%7D%0D%0A%20%20%7D%0D%0A%20%20return%20this%3B%0D%0A%7D%3B%0D%0A%0D%0A%2F**%0D%0A%20*%20Emit%20%60event%60%20with%20the%20given%20args.%0D%0A%20*%0D%0A%20*%20%40param%20%7BString%7D%20event%0D%0A%20*%20%40param%20%7BMixed%7D%20...%0D%0A%20*%20%40return%20%7BEmitter%7D%0D%0A%20*%2F%0D%0A%0D%0AEmitter.prototype.emit%20%3D%20function(event)%7B%0D%0A%20%20this._callbacks%20%3D%20this._callbacks%20%7C%7C%20%7B%7D%3B%0D%0A%20%20var%20args%20%3D%20%5B%5D.slice.call(arguments%2C%201)%0D%0A%20%20%20%20%2C%20callbacks%20%3D%20this._callbacks%5B'%24'%20%2B%20event%5D%3B%0D%0A%0D%0A%20%20if%20(callbacks)%20%7B%0D%0A%20%20%20%20callbacks%20%3D%20callbacks.slice(0)%3B%0D%0A%20%20%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20callbacks.length%3B%20i%20%3C%20len%3B%20%2B%2Bi)%20%7B%0D%0A%20%20%20%20%20%20callbacks%5Bi%5D.apply(this%2C%20args)%3B%0D%0A%20%20%20%20%7D%0D%0A%20%20%7D%0D%0A%0D%0A%20%20return%20this%3B%0D%0A%7D%3B%0D%0A%0D%0A%2F**%0D%0A%20*%20Return%20array%20of%20callbacks%20for%20%60event%60.%0D%0A%20*%0D%0A%20*%20%40param%20%7BString%7D%20event%0D%0A%20*%20%40return%20%7BArray%7D%0D%0A%20*%20%40api%20public%0D%0A%20*%2F%0D%0A%0D%0AEmitter.prototype.listeners%20%3D%20function(event)%7B%0D%0A%20%20this._callbacks%20%3D%20this._callbacks%20%7C%7C%20%7B%7D%3B%0D%0A%20%20return%20this._callbacks%5B'%24'%20%2B%20event%5D%20%7C%7C%20%5B%5D%3B%0D%0A%7D%3B%0D%0A%0D%0A%2F**%0D%0A%20*%20Check%20if%20this%20emitter%20has%20%60event%60%20handlers.%0D%0A%20*%0D%0A%20*%20%40param%20%7BString%7D%20event%0D%0A%20*%20%40return%20%7BBoolean%7D%0D%0A%20*%20%40api%20public%0D%0A%20*%2F%0D%0A%0D%0AEmitter.prototype.hasListeners%20%3D%20function(event)%7B%0D%0A%20%20return%20!!%20this.listeners(event).length%3B%0D%0A%7D%3B%0D%0A%0A%7D%2C%7B%7D%5D%2C11%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0Amodule.exports%20%3D%20function(a%2C%20b)%7B%0A%20%20var%20fn%20%3D%20function()%7B%7D%3B%0A%20%20fn.prototype%20%3D%20b.prototype%3B%0A%20%20a.prototype%20%3D%20new%20fn%3B%0A%20%20a.prototype.constructor%20%3D%20a%3B%0A%7D%3B%0A%7D%2C%7B%7D%5D%2C12%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(process)%7B%0A%2F**%0A%20*%20This%20is%20the%20web%20browser%20implementation%20of%20%60debug()%60.%0A%20*%0A%20*%20Expose%20%60debug()%60%20as%20the%20module.%0A%20*%2F%0A%0Aexports%20%3D%20module.exports%20%3D%20require('.%2Fdebug')%3B%0Aexports.log%20%3D%20log%3B%0Aexports.formatArgs%20%3D%20formatArgs%3B%0Aexports.save%20%3D%20save%3B%0Aexports.load%20%3D%20load%3B%0Aexports.useColors%20%3D%20useColors%3B%0Aexports.storage%20%3D%20'undefined'%20!%3D%20typeof%20chrome%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%26%20'undefined'%20!%3D%20typeof%20chrome.storage%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3F%20chrome.storage.local%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20localstorage()%3B%0A%0A%2F**%0A%20*%20Colors.%0A%20*%2F%0A%0Aexports.colors%20%3D%20%5B%0A%20%20'%230000CC'%2C%20'%230000FF'%2C%20'%230033CC'%2C%20'%230033FF'%2C%20'%230066CC'%2C%20'%230066FF'%2C%20'%230099CC'%2C%0A%20%20'%230099FF'%2C%20'%2300CC00'%2C%20'%2300CC33'%2C%20'%2300CC66'%2C%20'%2300CC99'%2C%20'%2300CCCC'%2C%20'%2300CCFF'%2C%0A%20%20'%233300CC'%2C%20'%233300FF'%2C%20'%233333CC'%2C%20'%233333FF'%2C%20'%233366CC'%2C%20'%233366FF'%2C%20'%233399CC'%2C%0A%20%20'%233399FF'%2C%20'%2333CC00'%2C%20'%2333CC33'%2C%20'%2333CC66'%2C%20'%2333CC99'%2C%20'%2333CCCC'%2C%20'%2333CCFF'%2C%0A%20%20'%236600CC'%2C%20'%236600FF'%2C%20'%236633CC'%2C%20'%236633FF'%2C%20'%2366CC00'%2C%20'%2366CC33'%2C%20'%239900CC'%2C%0A%20%20'%239900FF'%2C%20'%239933CC'%2C%20'%239933FF'%2C%20'%2399CC00'%2C%20'%2399CC33'%2C%20'%23CC0000'%2C%20'%23CC0033'%2C%0A%20%20'%23CC0066'%2C%20'%23CC0099'%2C%20'%23CC00CC'%2C%20'%23CC00FF'%2C%20'%23CC3300'%2C%20'%23CC3333'%2C%20'%23CC3366'%2C%0A%20%20'%23CC3399'%2C%20'%23CC33CC'%2C%20'%23CC33FF'%2C%20'%23CC6600'%2C%20'%23CC6633'%2C%20'%23CC9900'%2C%20'%23CC9933'%2C%0A%20%20'%23CCCC00'%2C%20'%23CCCC33'%2C%20'%23FF0000'%2C%20'%23FF0033'%2C%20'%23FF0066'%2C%20'%23FF0099'%2C%20'%23FF00CC'%2C%0A%20%20'%23FF00FF'%2C%20'%23FF3300'%2C%20'%23FF3333'%2C%20'%23FF3366'%2C%20'%23FF3399'%2C%20'%23FF33CC'%2C%20'%23FF33FF'%2C%0A%20%20'%23FF6600'%2C%20'%23FF6633'%2C%20'%23FF9900'%2C%20'%23FF9933'%2C%20'%23FFCC00'%2C%20'%23FFCC33'%0A%5D%3B%0A%0A%2F**%0A%20*%20Currently%20only%20WebKit-based%20Web%20Inspectors%2C%20Firefox%20%3E%3D%20v31%2C%0A%20*%20and%20the%20Firebug%20extension%20(any%20Firefox%20version)%20are%20known%0A%20*%20to%20support%20%22%25c%22%20CSS%20customizations.%0A%20*%0A%20*%20TODO%3A%20add%20a%20%60localStorage%60%20variable%20to%20explicitly%20enable%2Fdisable%20colors%0A%20*%2F%0A%0Afunction%20useColors()%20%7B%0A%20%20%2F%2F%20NB%3A%20In%20an%20Electron%20preload%20script%2C%20document%20will%20be%20defined%20but%20not%20fully%0A%20%20%2F%2F%20initialized.%20Since%20we%20know%20we're%20in%20Chrome%2C%20we'll%20just%20detect%20this%20case%0A%20%20%2F%2F%20explicitly%0A%20%20if%20(typeof%20window%20!%3D%3D%20'undefined'%20%26%26%20window.process%20%26%26%20window.process.type%20%3D%3D%3D%20'renderer')%20%7B%0A%20%20%20%20return%20true%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Internet%20Explorer%20and%20Edge%20do%20not%20support%20colors.%0A%20%20if%20(typeof%20navigator%20!%3D%3D%20'undefined'%20%26%26%20navigator.userAgent%20%26%26%20navigator.userAgent.toLowerCase().match(%2F(edge%7Ctrident)%5C%2F(%5Cd%2B)%2F))%20%7B%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20is%20webkit%3F%20http%3A%2F%2Fstackoverflow.com%2Fa%2F16459606%2F376773%0A%20%20%2F%2F%20document%20is%20undefined%20in%20react-native%3A%20https%3A%2F%2Fgithub.com%2Ffacebook%2Freact-native%2Fpull%2F1632%0A%20%20return%20(typeof%20document%20!%3D%3D%20'undefined'%20%26%26%20document.documentElement%20%26%26%20document.documentElement.style%20%26%26%20document.documentElement.style.WebkitAppearance)%20%7C%7C%0A%20%20%20%20%2F%2F%20is%20firebug%3F%20http%3A%2F%2Fstackoverflow.com%2Fa%2F398120%2F376773%0A%20%20%20%20(typeof%20window%20!%3D%3D%20'undefined'%20%26%26%20window.console%20%26%26%20(window.console.firebug%20%7C%7C%20(window.console.exception%20%26%26%20window.console.table)))%20%7C%7C%0A%20%20%20%20%2F%2F%20is%20firefox%20%3E%3D%20v31%3F%0A%20%20%20%20%2F%2F%20https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FTools%2FWeb_Console%23Styling_messages%0A%20%20%20%20(typeof%20navigator%20!%3D%3D%20'undefined'%20%26%26%20navigator.userAgent%20%26%26%20navigator.userAgent.toLowerCase().match(%2Ffirefox%5C%2F(%5Cd%2B)%2F)%20%26%26%20parseInt(RegExp.%241%2C%2010)%20%3E%3D%2031)%20%7C%7C%0A%20%20%20%20%2F%2F%20double%20check%20webkit%20in%20userAgent%20just%20in%20case%20we%20are%20in%20a%20worker%0A%20%20%20%20(typeof%20navigator%20!%3D%3D%20'undefined'%20%26%26%20navigator.userAgent%20%26%26%20navigator.userAgent.toLowerCase().match(%2Fapplewebkit%5C%2F(%5Cd%2B)%2F))%3B%0A%7D%0A%0A%2F**%0A%20*%20Map%20%25j%20to%20%60JSON.stringify()%60%2C%20since%20no%20Web%20Inspectors%20do%20that%20by%20default.%0A%20*%2F%0A%0Aexports.formatters.j%20%3D%20function(v)%20%7B%0A%20%20try%20%7B%0A%20%20%20%20return%20JSON.stringify(v)%3B%0A%20%20%7D%20catch%20(err)%20%7B%0A%20%20%20%20return%20'%5BUnexpectedJSONParseError%5D%3A%20'%20%2B%20err.message%3B%0A%20%20%7D%0A%7D%3B%0A%0A%0A%2F**%0A%20*%20Colorize%20log%20arguments%20if%20enabled.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20formatArgs(args)%20%7B%0A%20%20var%20useColors%20%3D%20this.useColors%3B%0A%0A%20%20args%5B0%5D%20%3D%20(useColors%20%3F%20'%25c'%20%3A%20'')%0A%20%20%20%20%2B%20this.namespace%0A%20%20%20%20%2B%20(useColors%20%3F%20'%20%25c'%20%3A%20'%20')%0A%20%20%20%20%2B%20args%5B0%5D%0A%20%20%20%20%2B%20(useColors%20%3F%20'%25c%20'%20%3A%20'%20')%0A%20%20%20%20%2B%20'%2B'%20%2B%20exports.humanize(this.diff)%3B%0A%0A%20%20if%20(!useColors)%20return%3B%0A%0A%20%20var%20c%20%3D%20'color%3A%20'%20%2B%20this.color%3B%0A%20%20args.splice(1%2C%200%2C%20c%2C%20'color%3A%20inherit')%0A%0A%20%20%2F%2F%20the%20final%20%22%25c%22%20is%20somewhat%20tricky%2C%20because%20there%20could%20be%20other%0A%20%20%2F%2F%20arguments%20passed%20either%20before%20or%20after%20the%20%25c%2C%20so%20we%20need%20to%0A%20%20%2F%2F%20figure%20out%20the%20correct%20index%20to%20insert%20the%20CSS%20into%0A%20%20var%20index%20%3D%200%3B%0A%20%20var%20lastC%20%3D%200%3B%0A%20%20args%5B0%5D.replace(%2F%25%5Ba-zA-Z%25%5D%2Fg%2C%20function(match)%20%7B%0A%20%20%20%20if%20('%25%25'%20%3D%3D%3D%20match)%20return%3B%0A%20%20%20%20index%2B%2B%3B%0A%20%20%20%20if%20('%25c'%20%3D%3D%3D%20match)%20%7B%0A%20%20%20%20%20%20%2F%2F%20we%20only%20are%20interested%20in%20the%20*last*%20%25c%0A%20%20%20%20%20%20%2F%2F%20(the%20user%20may%20have%20provided%20their%20own)%0A%20%20%20%20%20%20lastC%20%3D%20index%3B%0A%20%20%20%20%7D%0A%20%20%7D)%3B%0A%0A%20%20args.splice(lastC%2C%200%2C%20c)%3B%0A%7D%0A%0A%2F**%0A%20*%20Invokes%20%60console.log()%60%20when%20available.%0A%20*%20No-op%20when%20%60console.log%60%20is%20not%20a%20%22function%22.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20log()%20%7B%0A%20%20%2F%2F%20this%20hackery%20is%20required%20for%20IE8%2F9%2C%20where%0A%20%20%2F%2F%20the%20%60console.log%60%20function%20doesn't%20have%20'apply'%0A%20%20return%20'object'%20%3D%3D%3D%20typeof%20console%0A%20%20%20%20%26%26%20console.log%0A%20%20%20%20%26%26%20Function.prototype.apply.call(console.log%2C%20console%2C%20arguments)%3B%0A%7D%0A%0A%2F**%0A%20*%20Save%20%60namespaces%60.%0A%20*%0A%20*%20%40param%20%7BString%7D%20namespaces%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20save(namespaces)%20%7B%0A%20%20try%20%7B%0A%20%20%20%20if%20(null%20%3D%3D%20namespaces)%20%7B%0A%20%20%20%20%20%20exports.storage.removeItem('debug')%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20exports.storage.debug%20%3D%20namespaces%3B%0A%20%20%20%20%7D%0A%20%20%7D%20catch(e)%20%7B%7D%0A%7D%0A%0A%2F**%0A%20*%20Load%20%60namespaces%60.%0A%20*%0A%20*%20%40return%20%7BString%7D%20returns%20the%20previously%20persisted%20debug%20modes%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20load()%20%7B%0A%20%20var%20r%3B%0A%20%20try%20%7B%0A%20%20%20%20r%20%3D%20exports.storage.debug%3B%0A%20%20%7D%20catch(e)%20%7B%7D%0A%0A%20%20%2F%2F%20If%20debug%20isn't%20set%20in%20LS%2C%20and%20we're%20in%20Electron%2C%20try%20to%20load%20%24DEBUG%0A%20%20if%20(!r%20%26%26%20typeof%20process%20!%3D%3D%20'undefined'%20%26%26%20'env'%20in%20process)%20%7B%0A%20%20%20%20r%20%3D%20process.env.DEBUG%3B%0A%20%20%7D%0A%0A%20%20return%20r%3B%0A%7D%0A%0A%2F**%0A%20*%20Enable%20namespaces%20listed%20in%20%60localStorage.debug%60%20initially.%0A%20*%2F%0A%0Aexports.enable(load())%3B%0A%0A%2F**%0A%20*%20Localstorage%20attempts%20to%20return%20the%20localstorage.%0A%20*%0A%20*%20This%20is%20necessary%20because%20safari%20throws%0A%20*%20when%20a%20user%20disables%20cookies%2Flocalstorage%0A%20*%20and%20you%20attempt%20to%20access%20it.%0A%20*%0A%20*%20%40return%20%7BLocalStorage%7D%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20localstorage()%20%7B%0A%20%20try%20%7B%0A%20%20%20%20return%20window.localStorage%3B%0A%20%20%7D%20catch%20(e)%20%7B%7D%0A%7D%0A%0A%7D).call(this%2Crequire('_process'))%0A%7D%2C%7B%22.%2Fdebug%22%3A13%2C%22_process%22%3A34%7D%5D%2C13%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0A%2F**%0A%20*%20This%20is%20the%20common%20logic%20for%20both%20the%20Node.js%20and%20web%20browser%0A%20*%20implementations%20of%20%60debug()%60.%0A%20*%0A%20*%20Expose%20%60debug()%60%20as%20the%20module.%0A%20*%2F%0A%0Aexports%20%3D%20module.exports%20%3D%20createDebug.debug%20%3D%20createDebug%5B'default'%5D%20%3D%20createDebug%3B%0Aexports.coerce%20%3D%20coerce%3B%0Aexports.disable%20%3D%20disable%3B%0Aexports.enable%20%3D%20enable%3B%0Aexports.enabled%20%3D%20enabled%3B%0Aexports.humanize%20%3D%20require('ms')%3B%0A%0A%2F**%0A%20*%20Active%20%60debug%60%20instances.%0A%20*%2F%0Aexports.instances%20%3D%20%5B%5D%3B%0A%0A%2F**%0A%20*%20The%20currently%20active%20debug%20mode%20names%2C%20and%20names%20to%20skip.%0A%20*%2F%0A%0Aexports.names%20%3D%20%5B%5D%3B%0Aexports.skips%20%3D%20%5B%5D%3B%0A%0A%2F**%0A%20*%20Map%20of%20special%20%22%25n%22%20handling%20functions%2C%20for%20the%20debug%20%22format%22%20argument.%0A%20*%0A%20*%20Valid%20key%20names%20are%20a%20single%2C%20lower%20or%20upper-case%20letter%2C%20i.e.%20%22n%22%20and%20%22N%22.%0A%20*%2F%0A%0Aexports.formatters%20%3D%20%7B%7D%3B%0A%0A%2F**%0A%20*%20Select%20a%20color.%0A%20*%20%40param%20%7BString%7D%20namespace%0A%20*%20%40return%20%7BNumber%7D%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20selectColor(namespace)%20%7B%0A%20%20var%20hash%20%3D%200%2C%20i%3B%0A%0A%20%20for%20(i%20in%20namespace)%20%7B%0A%20%20%20%20hash%20%20%3D%20((hash%20%3C%3C%205)%20-%20hash)%20%2B%20namespace.charCodeAt(i)%3B%0A%20%20%20%20hash%20%7C%3D%200%3B%20%2F%2F%20Convert%20to%2032bit%20integer%0A%20%20%7D%0A%0A%20%20return%20exports.colors%5BMath.abs(hash)%20%25%20exports.colors.length%5D%3B%0A%7D%0A%0A%2F**%0A%20*%20Create%20a%20debugger%20with%20the%20given%20%60namespace%60.%0A%20*%0A%20*%20%40param%20%7BString%7D%20namespace%0A%20*%20%40return%20%7BFunction%7D%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20createDebug(namespace)%20%7B%0A%0A%20%20var%20prevTime%3B%0A%0A%20%20function%20debug()%20%7B%0A%20%20%20%20%2F%2F%20disabled%3F%0A%20%20%20%20if%20(!debug.enabled)%20return%3B%0A%0A%20%20%20%20var%20self%20%3D%20debug%3B%0A%0A%20%20%20%20%2F%2F%20set%20%60diff%60%20timestamp%0A%20%20%20%20var%20curr%20%3D%20%2Bnew%20Date()%3B%0A%20%20%20%20var%20ms%20%3D%20curr%20-%20(prevTime%20%7C%7C%20curr)%3B%0A%20%20%20%20self.diff%20%3D%20ms%3B%0A%20%20%20%20self.prev%20%3D%20prevTime%3B%0A%20%20%20%20self.curr%20%3D%20curr%3B%0A%20%20%20%20prevTime%20%3D%20curr%3B%0A%0A%20%20%20%20%2F%2F%20turn%20the%20%60arguments%60%20into%20a%20proper%20Array%0A%20%20%20%20var%20args%20%3D%20new%20Array(arguments.length)%3B%0A%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20args.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20args%5Bi%5D%20%3D%20arguments%5Bi%5D%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20args%5B0%5D%20%3D%20exports.coerce(args%5B0%5D)%3B%0A%0A%20%20%20%20if%20('string'%20!%3D%3D%20typeof%20args%5B0%5D)%20%7B%0A%20%20%20%20%20%20%2F%2F%20anything%20else%20let's%20inspect%20with%20%25O%0A%20%20%20%20%20%20args.unshift('%25O')%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20apply%20any%20%60formatters%60%20transformations%0A%20%20%20%20var%20index%20%3D%200%3B%0A%20%20%20%20args%5B0%5D%20%3D%20args%5B0%5D.replace(%2F%25(%5Ba-zA-Z%25%5D)%2Fg%2C%20function(match%2C%20format)%20%7B%0A%20%20%20%20%20%20%2F%2F%20if%20we%20encounter%20an%20escaped%20%25%20then%20don't%20increase%20the%20array%20index%0A%20%20%20%20%20%20if%20(match%20%3D%3D%3D%20'%25%25')%20return%20match%3B%0A%20%20%20%20%20%20index%2B%2B%3B%0A%20%20%20%20%20%20var%20formatter%20%3D%20exports.formatters%5Bformat%5D%3B%0A%20%20%20%20%20%20if%20('function'%20%3D%3D%3D%20typeof%20formatter)%20%7B%0A%20%20%20%20%20%20%20%20var%20val%20%3D%20args%5Bindex%5D%3B%0A%20%20%20%20%20%20%20%20match%20%3D%20formatter.call(self%2C%20val)%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20now%20we%20need%20to%20remove%20%60args%5Bindex%5D%60%20since%20it's%20inlined%20in%20the%20%60format%60%0A%20%20%20%20%20%20%20%20args.splice(index%2C%201)%3B%0A%20%20%20%20%20%20%20%20index--%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20match%3B%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%2F%2F%20apply%20env-specific%20formatting%20(colors%2C%20etc.)%0A%20%20%20%20exports.formatArgs.call(self%2C%20args)%3B%0A%0A%20%20%20%20var%20logFn%20%3D%20debug.log%20%7C%7C%20exports.log%20%7C%7C%20console.log.bind(console)%3B%0A%20%20%20%20logFn.apply(self%2C%20args)%3B%0A%20%20%7D%0A%0A%20%20debug.namespace%20%3D%20namespace%3B%0A%20%20debug.enabled%20%3D%20exports.enabled(namespace)%3B%0A%20%20debug.useColors%20%3D%20exports.useColors()%3B%0A%20%20debug.color%20%3D%20selectColor(namespace)%3B%0A%20%20debug.destroy%20%3D%20destroy%3B%0A%0A%20%20%2F%2F%20env-specific%20initialization%20logic%20for%20debug%20instances%0A%20%20if%20('function'%20%3D%3D%3D%20typeof%20exports.init)%20%7B%0A%20%20%20%20exports.init(debug)%3B%0A%20%20%7D%0A%0A%20%20exports.instances.push(debug)%3B%0A%0A%20%20return%20debug%3B%0A%7D%0A%0Afunction%20destroy%20()%20%7B%0A%20%20var%20index%20%3D%20exports.instances.indexOf(this)%3B%0A%20%20if%20(index%20!%3D%3D%20-1)%20%7B%0A%20%20%20%20exports.instances.splice(index%2C%201)%3B%0A%20%20%20%20return%20true%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%7D%0A%0A%2F**%0A%20*%20Enables%20a%20debug%20mode%20by%20namespaces.%20This%20can%20include%20modes%0A%20*%20separated%20by%20a%20colon%20and%20wildcards.%0A%20*%0A%20*%20%40param%20%7BString%7D%20namespaces%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20enable(namespaces)%20%7B%0A%20%20exports.save(namespaces)%3B%0A%0A%20%20exports.names%20%3D%20%5B%5D%3B%0A%20%20exports.skips%20%3D%20%5B%5D%3B%0A%0A%20%20var%20i%3B%0A%20%20var%20split%20%3D%20(typeof%20namespaces%20%3D%3D%3D%20'string'%20%3F%20namespaces%20%3A%20'').split(%2F%5B%5Cs%2C%5D%2B%2F)%3B%0A%20%20var%20len%20%3D%20split.length%3B%0A%0A%20%20for%20(i%20%3D%200%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20if%20(!split%5Bi%5D)%20continue%3B%20%2F%2F%20ignore%20empty%20strings%0A%20%20%20%20namespaces%20%3D%20split%5Bi%5D.replace(%2F%5C*%2Fg%2C%20'.*%3F')%3B%0A%20%20%20%20if%20(namespaces%5B0%5D%20%3D%3D%3D%20'-')%20%7B%0A%20%20%20%20%20%20exports.skips.push(new%20RegExp('%5E'%20%2B%20namespaces.substr(1)%20%2B%20'%24'))%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20exports.names.push(new%20RegExp('%5E'%20%2B%20namespaces%20%2B%20'%24'))%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20for%20(i%20%3D%200%3B%20i%20%3C%20exports.instances.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20var%20instance%20%3D%20exports.instances%5Bi%5D%3B%0A%20%20%20%20instance.enabled%20%3D%20exports.enabled(instance.namespace)%3B%0A%20%20%7D%0A%7D%0A%0A%2F**%0A%20*%20Disable%20debug%20output.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20disable()%20%7B%0A%20%20exports.enable('')%3B%0A%7D%0A%0A%2F**%0A%20*%20Returns%20true%20if%20the%20given%20mode%20name%20is%20enabled%2C%20false%20otherwise.%0A%20*%0A%20*%20%40param%20%7BString%7D%20name%0A%20*%20%40return%20%7BBoolean%7D%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20enabled(name)%20%7B%0A%20%20if%20(name%5Bname.length%20-%201%5D%20%3D%3D%3D%20'*')%20%7B%0A%20%20%20%20return%20true%3B%0A%20%20%7D%0A%20%20var%20i%2C%20len%3B%0A%20%20for%20(i%20%3D%200%2C%20len%20%3D%20exports.skips.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20if%20(exports.skips%5Bi%5D.test(name))%20%7B%0A%20%20%20%20%20%20return%20false%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20for%20(i%20%3D%200%2C%20len%20%3D%20exports.names.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20if%20(exports.names%5Bi%5D.test(name))%20%7B%0A%20%20%20%20%20%20return%20true%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20return%20false%3B%0A%7D%0A%0A%2F**%0A%20*%20Coerce%20%60val%60.%0A%20*%0A%20*%20%40param%20%7BMixed%7D%20val%0A%20*%20%40return%20%7BMixed%7D%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20coerce(val)%20%7B%0A%20%20if%20(val%20instanceof%20Error)%20return%20val.stack%20%7C%7C%20val.message%3B%0A%20%20return%20val%3B%0A%7D%0A%0A%7D%2C%7B%22ms%22%3A31%7D%5D%2C14%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0Amodule.exports%20%3D%20require('.%2Fsocket')%3B%0A%0A%2F**%0A%20*%20Exports%20parser%0A%20*%0A%20*%20%40api%20public%0A%20*%0A%20*%2F%0Amodule.exports.parser%20%3D%20require('engine.io-parser')%3B%0A%0A%7D%2C%7B%22.%2Fsocket%22%3A15%2C%22engine.io-parser%22%3A23%7D%5D%2C15%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%2F**%0A%20*%20Module%20dependencies.%0A%20*%2F%0A%0Avar%20transports%20%3D%20require('.%2Ftransports%2Findex')%3B%0Avar%20Emitter%20%3D%20require('component-emitter')%3B%0Avar%20debug%20%3D%20require('debug')('engine.io-client%3Asocket')%3B%0Avar%20index%20%3D%20require('indexof')%3B%0Avar%20parser%20%3D%20require('engine.io-parser')%3B%0Avar%20parseuri%20%3D%20require('parseuri')%3B%0Avar%20parseqs%20%3D%20require('parseqs')%3B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20Socket%3B%0A%0A%2F**%0A%20*%20Socket%20constructor.%0A%20*%0A%20*%20%40param%20%7BString%7CObject%7D%20uri%20or%20options%0A%20*%20%40param%20%7BObject%7D%20options%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20Socket%20(uri%2C%20opts)%20%7B%0A%20%20if%20(!(this%20instanceof%20Socket))%20return%20new%20Socket(uri%2C%20opts)%3B%0A%0A%20%20opts%20%3D%20opts%20%7C%7C%20%7B%7D%3B%0A%0A%20%20if%20(uri%20%26%26%20'object'%20%3D%3D%3D%20typeof%20uri)%20%7B%0A%20%20%20%20opts%20%3D%20uri%3B%0A%20%20%20%20uri%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20if%20(uri)%20%7B%0A%20%20%20%20uri%20%3D%20parseuri(uri)%3B%0A%20%20%20%20opts.hostname%20%3D%20uri.host%3B%0A%20%20%20%20opts.secure%20%3D%20uri.protocol%20%3D%3D%3D%20'https'%20%7C%7C%20uri.protocol%20%3D%3D%3D%20'wss'%3B%0A%20%20%20%20opts.port%20%3D%20uri.port%3B%0A%20%20%20%20if%20(uri.query)%20opts.query%20%3D%20uri.query%3B%0A%20%20%7D%20else%20if%20(opts.host)%20%7B%0A%20%20%20%20opts.hostname%20%3D%20parseuri(opts.host).host%3B%0A%20%20%7D%0A%0A%20%20this.secure%20%3D%20null%20!%3D%20opts.secure%20%3F%20opts.secure%0A%20%20%20%20%3A%20(global.location%20%26%26%20'https%3A'%20%3D%3D%3D%20location.protocol)%3B%0A%0A%20%20if%20(opts.hostname%20%26%26%20!opts.port)%20%7B%0A%20%20%20%20%2F%2F%20if%20no%20port%20is%20specified%20manually%2C%20use%20the%20protocol%20default%0A%20%20%20%20opts.port%20%3D%20this.secure%20%3F%20'443'%20%3A%20'80'%3B%0A%20%20%7D%0A%0A%20%20this.agent%20%3D%20opts.agent%20%7C%7C%20false%3B%0A%20%20this.hostname%20%3D%20opts.hostname%20%7C%7C%0A%20%20%20%20(global.location%20%3F%20location.hostname%20%3A%20'localhost')%3B%0A%20%20this.port%20%3D%20opts.port%20%7C%7C%20(global.location%20%26%26%20location.port%0A%20%20%20%20%20%20%3F%20location.port%0A%20%20%20%20%20%20%3A%20(this.secure%20%3F%20443%20%3A%2080))%3B%0A%20%20this.query%20%3D%20opts.query%20%7C%7C%20%7B%7D%3B%0A%20%20if%20('string'%20%3D%3D%3D%20typeof%20this.query)%20this.query%20%3D%20parseqs.decode(this.query)%3B%0A%20%20this.upgrade%20%3D%20false%20!%3D%3D%20opts.upgrade%3B%0A%20%20this.path%20%3D%20(opts.path%20%7C%7C%20'%2Fengine.io').replace(%2F%5C%2F%24%2F%2C%20'')%20%2B%20'%2F'%3B%0A%20%20this.forceJSONP%20%3D%20!!opts.forceJSONP%3B%0A%20%20this.jsonp%20%3D%20false%20!%3D%3D%20opts.jsonp%3B%0A%20%20this.forceBase64%20%3D%20!!opts.forceBase64%3B%0A%20%20this.enablesXDR%20%3D%20!!opts.enablesXDR%3B%0A%20%20this.timestampParam%20%3D%20opts.timestampParam%20%7C%7C%20't'%3B%0A%20%20this.timestampRequests%20%3D%20opts.timestampRequests%3B%0A%20%20this.transports%20%3D%20opts.transports%20%7C%7C%20%5B'polling'%2C%20'websocket'%5D%3B%0A%20%20this.transportOptions%20%3D%20opts.transportOptions%20%7C%7C%20%7B%7D%3B%0A%20%20this.readyState%20%3D%20''%3B%0A%20%20this.writeBuffer%20%3D%20%5B%5D%3B%0A%20%20this.prevBufferLen%20%3D%200%3B%0A%20%20this.policyPort%20%3D%20opts.policyPort%20%7C%7C%20843%3B%0A%20%20this.rememberUpgrade%20%3D%20opts.rememberUpgrade%20%7C%7C%20false%3B%0A%20%20this.binaryType%20%3D%20null%3B%0A%20%20this.onlyBinaryUpgrades%20%3D%20opts.onlyBinaryUpgrades%3B%0A%20%20this.perMessageDeflate%20%3D%20false%20!%3D%3D%20opts.perMessageDeflate%20%3F%20(opts.perMessageDeflate%20%7C%7C%20%7B%7D)%20%3A%20false%3B%0A%0A%20%20if%20(true%20%3D%3D%3D%20this.perMessageDeflate)%20this.perMessageDeflate%20%3D%20%7B%7D%3B%0A%20%20if%20(this.perMessageDeflate%20%26%26%20null%20%3D%3D%20this.perMessageDeflate.threshold)%20%7B%0A%20%20%20%20this.perMessageDeflate.threshold%20%3D%201024%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20SSL%20options%20for%20Node.js%20client%0A%20%20this.pfx%20%3D%20opts.pfx%20%7C%7C%20null%3B%0A%20%20this.key%20%3D%20opts.key%20%7C%7C%20null%3B%0A%20%20this.passphrase%20%3D%20opts.passphrase%20%7C%7C%20null%3B%0A%20%20this.cert%20%3D%20opts.cert%20%7C%7C%20null%3B%0A%20%20this.ca%20%3D%20opts.ca%20%7C%7C%20null%3B%0A%20%20this.ciphers%20%3D%20opts.ciphers%20%7C%7C%20null%3B%0A%20%20this.rejectUnauthorized%20%3D%20opts.rejectUnauthorized%20%3D%3D%3D%20undefined%20%3F%20true%20%3A%20opts.rejectUnauthorized%3B%0A%20%20this.forceNode%20%3D%20!!opts.forceNode%3B%0A%0A%20%20%2F%2F%20other%20options%20for%20Node.js%20client%0A%20%20var%20freeGlobal%20%3D%20typeof%20global%20%3D%3D%3D%20'object'%20%26%26%20global%3B%0A%20%20if%20(freeGlobal.global%20%3D%3D%3D%20freeGlobal)%20%7B%0A%20%20%20%20if%20(opts.extraHeaders%20%26%26%20Object.keys(opts.extraHeaders).length%20%3E%200)%20%7B%0A%20%20%20%20%20%20this.extraHeaders%20%3D%20opts.extraHeaders%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(opts.localAddress)%20%7B%0A%20%20%20%20%20%20this.localAddress%20%3D%20opts.localAddress%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F%2F%20set%20on%20handshake%0A%20%20this.id%20%3D%20null%3B%0A%20%20this.upgrades%20%3D%20null%3B%0A%20%20this.pingInterval%20%3D%20null%3B%0A%20%20this.pingTimeout%20%3D%20null%3B%0A%0A%20%20%2F%2F%20set%20on%20heartbeat%0A%20%20this.pingIntervalTimer%20%3D%20null%3B%0A%20%20this.pingTimeoutTimer%20%3D%20null%3B%0A%0A%20%20this.open()%3B%0A%7D%0A%0ASocket.priorWebsocketSuccess%20%3D%20false%3B%0A%0A%2F**%0A%20*%20Mix%20in%20%60Emitter%60.%0A%20*%2F%0A%0AEmitter(Socket.prototype)%3B%0A%0A%2F**%0A%20*%20Protocol%20version.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0ASocket.protocol%20%3D%20parser.protocol%3B%20%2F%2F%20this%20is%20an%20int%0A%0A%2F**%0A%20*%20Expose%20deps%20for%20legacy%20compatibility%0A%20*%20and%20standalone%20browser%20access.%0A%20*%2F%0A%0ASocket.Socket%20%3D%20Socket%3B%0ASocket.Transport%20%3D%20require('.%2Ftransport')%3B%0ASocket.transports%20%3D%20require('.%2Ftransports%2Findex')%3B%0ASocket.parser%20%3D%20require('engine.io-parser')%3B%0A%0A%2F**%0A%20*%20Creates%20transport%20of%20the%20given%20type.%0A%20*%0A%20*%20%40param%20%7BString%7D%20transport%20name%0A%20*%20%40return%20%7BTransport%7D%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.createTransport%20%3D%20function%20(name)%20%7B%0A%20%20debug('creating%20transport%20%22%25s%22'%2C%20name)%3B%0A%20%20var%20query%20%3D%20clone(this.query)%3B%0A%0A%20%20%2F%2F%20append%20engine.io%20protocol%20identifier%0A%20%20query.EIO%20%3D%20parser.protocol%3B%0A%0A%20%20%2F%2F%20transport%20name%0A%20%20query.transport%20%3D%20name%3B%0A%0A%20%20%2F%2F%20per-transport%20options%0A%20%20var%20options%20%3D%20this.transportOptions%5Bname%5D%20%7C%7C%20%7B%7D%3B%0A%0A%20%20%2F%2F%20session%20id%20if%20we%20already%20have%20one%0A%20%20if%20(this.id)%20query.sid%20%3D%20this.id%3B%0A%0A%20%20var%20transport%20%3D%20new%20transports%5Bname%5D(%7B%0A%20%20%20%20query%3A%20query%2C%0A%20%20%20%20socket%3A%20this%2C%0A%20%20%20%20agent%3A%20options.agent%20%7C%7C%20this.agent%2C%0A%20%20%20%20hostname%3A%20options.hostname%20%7C%7C%20this.hostname%2C%0A%20%20%20%20port%3A%20options.port%20%7C%7C%20this.port%2C%0A%20%20%20%20secure%3A%20options.secure%20%7C%7C%20this.secure%2C%0A%20%20%20%20path%3A%20options.path%20%7C%7C%20this.path%2C%0A%20%20%20%20forceJSONP%3A%20options.forceJSONP%20%7C%7C%20this.forceJSONP%2C%0A%20%20%20%20jsonp%3A%20options.jsonp%20%7C%7C%20this.jsonp%2C%0A%20%20%20%20forceBase64%3A%20options.forceBase64%20%7C%7C%20this.forceBase64%2C%0A%20%20%20%20enablesXDR%3A%20options.enablesXDR%20%7C%7C%20this.enablesXDR%2C%0A%20%20%20%20timestampRequests%3A%20options.timestampRequests%20%7C%7C%20this.timestampRequests%2C%0A%20%20%20%20timestampParam%3A%20options.timestampParam%20%7C%7C%20this.timestampParam%2C%0A%20%20%20%20policyPort%3A%20options.policyPort%20%7C%7C%20this.policyPort%2C%0A%20%20%20%20pfx%3A%20options.pfx%20%7C%7C%20this.pfx%2C%0A%20%20%20%20key%3A%20options.key%20%7C%7C%20this.key%2C%0A%20%20%20%20passphrase%3A%20options.passphrase%20%7C%7C%20this.passphrase%2C%0A%20%20%20%20cert%3A%20options.cert%20%7C%7C%20this.cert%2C%0A%20%20%20%20ca%3A%20options.ca%20%7C%7C%20this.ca%2C%0A%20%20%20%20ciphers%3A%20options.ciphers%20%7C%7C%20this.ciphers%2C%0A%20%20%20%20rejectUnauthorized%3A%20options.rejectUnauthorized%20%7C%7C%20this.rejectUnauthorized%2C%0A%20%20%20%20perMessageDeflate%3A%20options.perMessageDeflate%20%7C%7C%20this.perMessageDeflate%2C%0A%20%20%20%20extraHeaders%3A%20options.extraHeaders%20%7C%7C%20this.extraHeaders%2C%0A%20%20%20%20forceNode%3A%20options.forceNode%20%7C%7C%20this.forceNode%2C%0A%20%20%20%20localAddress%3A%20options.localAddress%20%7C%7C%20this.localAddress%2C%0A%20%20%20%20requestTimeout%3A%20options.requestTimeout%20%7C%7C%20this.requestTimeout%2C%0A%20%20%20%20protocols%3A%20options.protocols%20%7C%7C%20void%20(0)%0A%20%20%7D)%3B%0A%0A%20%20return%20transport%3B%0A%7D%3B%0A%0Afunction%20clone%20(obj)%20%7B%0A%20%20var%20o%20%3D%20%7B%7D%3B%0A%20%20for%20(var%20i%20in%20obj)%20%7B%0A%20%20%20%20if%20(obj.hasOwnProperty(i))%20%7B%0A%20%20%20%20%20%20o%5Bi%5D%20%3D%20obj%5Bi%5D%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20return%20o%3B%0A%7D%0A%0A%2F**%0A%20*%20Initializes%20transport%20to%20use%20and%20starts%20probe.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0ASocket.prototype.open%20%3D%20function%20()%20%7B%0A%20%20var%20transport%3B%0A%20%20if%20(this.rememberUpgrade%20%26%26%20Socket.priorWebsocketSuccess%20%26%26%20this.transports.indexOf('websocket')%20!%3D%3D%20-1)%20%7B%0A%20%20%20%20transport%20%3D%20'websocket'%3B%0A%20%20%7D%20else%20if%20(0%20%3D%3D%3D%20this.transports.length)%20%7B%0A%20%20%20%20%2F%2F%20Emit%20error%20on%20next%20tick%20so%20it%20can%20be%20listened%20to%0A%20%20%20%20var%20self%20%3D%20this%3B%0A%20%20%20%20setTimeout(function%20()%20%7B%0A%20%20%20%20%20%20self.emit('error'%2C%20'No%20transports%20available')%3B%0A%20%20%20%20%7D%2C%200)%3B%0A%20%20%20%20return%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20transport%20%3D%20this.transports%5B0%5D%3B%0A%20%20%7D%0A%20%20this.readyState%20%3D%20'opening'%3B%0A%0A%20%20%2F%2F%20Retry%20with%20the%20next%20transport%20if%20the%20transport%20is%20disabled%20(jsonp%3A%20false)%0A%20%20try%20%7B%0A%20%20%20%20transport%20%3D%20this.createTransport(transport)%3B%0A%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20this.transports.shift()%3B%0A%20%20%20%20this.open()%3B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%0A%20%20transport.open()%3B%0A%20%20this.setTransport(transport)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sets%20the%20current%20transport.%20Disables%20the%20existing%20one%20(if%20any).%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.setTransport%20%3D%20function%20(transport)%20%7B%0A%20%20debug('setting%20transport%20%25s'%2C%20transport.name)%3B%0A%20%20var%20self%20%3D%20this%3B%0A%0A%20%20if%20(this.transport)%20%7B%0A%20%20%20%20debug('clearing%20existing%20transport%20%25s'%2C%20this.transport.name)%3B%0A%20%20%20%20this.transport.removeAllListeners()%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20set%20up%20transport%0A%20%20this.transport%20%3D%20transport%3B%0A%0A%20%20%2F%2F%20set%20up%20transport%20listeners%0A%20%20transport%0A%20%20.on('drain'%2C%20function%20()%20%7B%0A%20%20%20%20self.onDrain()%3B%0A%20%20%7D)%0A%20%20.on('packet'%2C%20function%20(packet)%20%7B%0A%20%20%20%20self.onPacket(packet)%3B%0A%20%20%7D)%0A%20%20.on('error'%2C%20function%20(e)%20%7B%0A%20%20%20%20self.onError(e)%3B%0A%20%20%7D)%0A%20%20.on('close'%2C%20function%20()%20%7B%0A%20%20%20%20self.onClose('transport%20close')%3B%0A%20%20%7D)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Probes%20a%20transport.%0A%20*%0A%20*%20%40param%20%7BString%7D%20transport%20name%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.probe%20%3D%20function%20(name)%20%7B%0A%20%20debug('probing%20transport%20%22%25s%22'%2C%20name)%3B%0A%20%20var%20transport%20%3D%20this.createTransport(name%2C%20%7B%20probe%3A%201%20%7D)%3B%0A%20%20var%20failed%20%3D%20false%3B%0A%20%20var%20self%20%3D%20this%3B%0A%0A%20%20Socket.priorWebsocketSuccess%20%3D%20false%3B%0A%0A%20%20function%20onTransportOpen%20()%20%7B%0A%20%20%20%20if%20(self.onlyBinaryUpgrades)%20%7B%0A%20%20%20%20%20%20var%20upgradeLosesBinary%20%3D%20!this.supportsBinary%20%26%26%20self.transport.supportsBinary%3B%0A%20%20%20%20%20%20failed%20%3D%20failed%20%7C%7C%20upgradeLosesBinary%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20(failed)%20return%3B%0A%0A%20%20%20%20debug('probe%20transport%20%22%25s%22%20opened'%2C%20name)%3B%0A%20%20%20%20transport.send(%5B%7B%20type%3A%20'ping'%2C%20data%3A%20'probe'%20%7D%5D)%3B%0A%20%20%20%20transport.once('packet'%2C%20function%20(msg)%20%7B%0A%20%20%20%20%20%20if%20(failed)%20return%3B%0A%20%20%20%20%20%20if%20('pong'%20%3D%3D%3D%20msg.type%20%26%26%20'probe'%20%3D%3D%3D%20msg.data)%20%7B%0A%20%20%20%20%20%20%20%20debug('probe%20transport%20%22%25s%22%20pong'%2C%20name)%3B%0A%20%20%20%20%20%20%20%20self.upgrading%20%3D%20true%3B%0A%20%20%20%20%20%20%20%20self.emit('upgrading'%2C%20transport)%3B%0A%20%20%20%20%20%20%20%20if%20(!transport)%20return%3B%0A%20%20%20%20%20%20%20%20Socket.priorWebsocketSuccess%20%3D%20'websocket'%20%3D%3D%3D%20transport.name%3B%0A%0A%20%20%20%20%20%20%20%20debug('pausing%20current%20transport%20%22%25s%22'%2C%20self.transport.name)%3B%0A%20%20%20%20%20%20%20%20self.transport.pause(function%20()%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(failed)%20return%3B%0A%20%20%20%20%20%20%20%20%20%20if%20('closed'%20%3D%3D%3D%20self.readyState)%20return%3B%0A%20%20%20%20%20%20%20%20%20%20debug('changing%20transport%20and%20sending%20upgrade%20packet')%3B%0A%0A%20%20%20%20%20%20%20%20%20%20cleanup()%3B%0A%0A%20%20%20%20%20%20%20%20%20%20self.setTransport(transport)%3B%0A%20%20%20%20%20%20%20%20%20%20transport.send(%5B%7B%20type%3A%20'upgrade'%20%7D%5D)%3B%0A%20%20%20%20%20%20%20%20%20%20self.emit('upgrade'%2C%20transport)%3B%0A%20%20%20%20%20%20%20%20%20%20transport%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20%20%20self.upgrading%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20self.flush()%3B%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20debug('probe%20transport%20%22%25s%22%20failed'%2C%20name)%3B%0A%20%20%20%20%20%20%20%20var%20err%20%3D%20new%20Error('probe%20error')%3B%0A%20%20%20%20%20%20%20%20err.transport%20%3D%20transport.name%3B%0A%20%20%20%20%20%20%20%20self.emit('upgradeError'%2C%20err)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20function%20freezeTransport%20()%20%7B%0A%20%20%20%20if%20(failed)%20return%3B%0A%0A%20%20%20%20%2F%2F%20Any%20callback%20called%20by%20transport%20should%20be%20ignored%20since%20now%0A%20%20%20%20failed%20%3D%20true%3B%0A%0A%20%20%20%20cleanup()%3B%0A%0A%20%20%20%20transport.close()%3B%0A%20%20%20%20transport%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Handle%20any%20error%20that%20happens%20while%20probing%0A%20%20function%20onerror%20(err)%20%7B%0A%20%20%20%20var%20error%20%3D%20new%20Error('probe%20error%3A%20'%20%2B%20err)%3B%0A%20%20%20%20error.transport%20%3D%20transport.name%3B%0A%0A%20%20%20%20freezeTransport()%3B%0A%0A%20%20%20%20debug('probe%20transport%20%22%25s%22%20failed%20because%20of%20error%3A%20%25s'%2C%20name%2C%20err)%3B%0A%0A%20%20%20%20self.emit('upgradeError'%2C%20error)%3B%0A%20%20%7D%0A%0A%20%20function%20onTransportClose%20()%20%7B%0A%20%20%20%20onerror('transport%20closed')%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20When%20the%20socket%20is%20closed%20while%20we're%20probing%0A%20%20function%20onclose%20()%20%7B%0A%20%20%20%20onerror('socket%20closed')%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20When%20the%20socket%20is%20upgraded%20while%20we're%20probing%0A%20%20function%20onupgrade%20(to)%20%7B%0A%20%20%20%20if%20(transport%20%26%26%20to.name%20!%3D%3D%20transport.name)%20%7B%0A%20%20%20%20%20%20debug('%22%25s%22%20works%20-%20aborting%20%22%25s%22'%2C%20to.name%2C%20transport.name)%3B%0A%20%20%20%20%20%20freezeTransport()%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F%2F%20Remove%20all%20listeners%20on%20the%20transport%20and%20on%20self%0A%20%20function%20cleanup%20()%20%7B%0A%20%20%20%20transport.removeListener('open'%2C%20onTransportOpen)%3B%0A%20%20%20%20transport.removeListener('error'%2C%20onerror)%3B%0A%20%20%20%20transport.removeListener('close'%2C%20onTransportClose)%3B%0A%20%20%20%20self.removeListener('close'%2C%20onclose)%3B%0A%20%20%20%20self.removeListener('upgrading'%2C%20onupgrade)%3B%0A%20%20%7D%0A%0A%20%20transport.once('open'%2C%20onTransportOpen)%3B%0A%20%20transport.once('error'%2C%20onerror)%3B%0A%20%20transport.once('close'%2C%20onTransportClose)%3B%0A%0A%20%20this.once('close'%2C%20onclose)%3B%0A%20%20this.once('upgrading'%2C%20onupgrade)%3B%0A%0A%20%20transport.open()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20when%20connection%20is%20deemed%20open.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0ASocket.prototype.onOpen%20%3D%20function%20()%20%7B%0A%20%20debug('socket%20open')%3B%0A%20%20this.readyState%20%3D%20'open'%3B%0A%20%20Socket.priorWebsocketSuccess%20%3D%20'websocket'%20%3D%3D%3D%20this.transport.name%3B%0A%20%20this.emit('open')%3B%0A%20%20this.flush()%3B%0A%0A%20%20%2F%2F%20we%20check%20for%20%60readyState%60%20in%20case%20an%20%60open%60%0A%20%20%2F%2F%20listener%20already%20closed%20the%20socket%0A%20%20if%20('open'%20%3D%3D%3D%20this.readyState%20%26%26%20this.upgrade%20%26%26%20this.transport.pause)%20%7B%0A%20%20%20%20debug('starting%20upgrade%20probes')%3B%0A%20%20%20%20for%20(var%20i%20%3D%200%2C%20l%20%3D%20this.upgrades.length%3B%20i%20%3C%20l%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20this.probe(this.upgrades%5Bi%5D)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Handles%20a%20packet.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onPacket%20%3D%20function%20(packet)%20%7B%0A%20%20if%20('opening'%20%3D%3D%3D%20this.readyState%20%7C%7C%20'open'%20%3D%3D%3D%20this.readyState%20%7C%7C%0A%20%20%20%20%20%20'closing'%20%3D%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20debug('socket%20receive%3A%20type%20%22%25s%22%2C%20data%20%22%25s%22'%2C%20packet.type%2C%20packet.data)%3B%0A%0A%20%20%20%20this.emit('packet'%2C%20packet)%3B%0A%0A%20%20%20%20%2F%2F%20Socket%20is%20live%20-%20any%20packet%20counts%0A%20%20%20%20this.emit('heartbeat')%3B%0A%0A%20%20%20%20switch%20(packet.type)%20%7B%0A%20%20%20%20%20%20case%20'open'%3A%0A%20%20%20%20%20%20%20%20this.onHandshake(JSON.parse(packet.data))%3B%0A%20%20%20%20%20%20%20%20break%3B%0A%0A%20%20%20%20%20%20case%20'pong'%3A%0A%20%20%20%20%20%20%20%20this.setPing()%3B%0A%20%20%20%20%20%20%20%20this.emit('pong')%3B%0A%20%20%20%20%20%20%20%20break%3B%0A%0A%20%20%20%20%20%20case%20'error'%3A%0A%20%20%20%20%20%20%20%20var%20err%20%3D%20new%20Error('server%20error')%3B%0A%20%20%20%20%20%20%20%20err.code%20%3D%20packet.data%3B%0A%20%20%20%20%20%20%20%20this.onError(err)%3B%0A%20%20%20%20%20%20%20%20break%3B%0A%0A%20%20%20%20%20%20case%20'message'%3A%0A%20%20%20%20%20%20%20%20this.emit('data'%2C%20packet.data)%3B%0A%20%20%20%20%20%20%20%20this.emit('message'%2C%20packet.data)%3B%0A%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%7D%0A%20%20%7D%20else%20%7B%0A%20%20%20%20debug('packet%20received%20with%20socket%20readyState%20%22%25s%22'%2C%20this.readyState)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20handshake%20completion.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20handshake%20obj%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onHandshake%20%3D%20function%20(data)%20%7B%0A%20%20this.emit('handshake'%2C%20data)%3B%0A%20%20this.id%20%3D%20data.sid%3B%0A%20%20this.transport.query.sid%20%3D%20data.sid%3B%0A%20%20this.upgrades%20%3D%20this.filterUpgrades(data.upgrades)%3B%0A%20%20this.pingInterval%20%3D%20data.pingInterval%3B%0A%20%20this.pingTimeout%20%3D%20data.pingTimeout%3B%0A%20%20this.onOpen()%3B%0A%20%20%2F%2F%20In%20case%20open%20handler%20closes%20socket%0A%20%20if%20('closed'%20%3D%3D%3D%20this.readyState)%20return%3B%0A%20%20this.setPing()%3B%0A%0A%20%20%2F%2F%20Prolong%20liveness%20of%20socket%20on%20heartbeat%0A%20%20this.removeListener('heartbeat'%2C%20this.onHeartbeat)%3B%0A%20%20this.on('heartbeat'%2C%20this.onHeartbeat)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Resets%20ping%20timeout.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onHeartbeat%20%3D%20function%20(timeout)%20%7B%0A%20%20clearTimeout(this.pingTimeoutTimer)%3B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20self.pingTimeoutTimer%20%3D%20setTimeout(function%20()%20%7B%0A%20%20%20%20if%20('closed'%20%3D%3D%3D%20self.readyState)%20return%3B%0A%20%20%20%20self.onClose('ping%20timeout')%3B%0A%20%20%7D%2C%20timeout%20%7C%7C%20(self.pingInterval%20%2B%20self.pingTimeout))%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Pings%20server%20every%20%60this.pingInterval%60%20and%20expects%20response%0A%20*%20within%20%60this.pingTimeout%60%20or%20closes%20connection.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.setPing%20%3D%20function%20()%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20clearTimeout(self.pingIntervalTimer)%3B%0A%20%20self.pingIntervalTimer%20%3D%20setTimeout(function%20()%20%7B%0A%20%20%20%20debug('writing%20ping%20packet%20-%20expecting%20pong%20within%20%25sms'%2C%20self.pingTimeout)%3B%0A%20%20%20%20self.ping()%3B%0A%20%20%20%20self.onHeartbeat(self.pingTimeout)%3B%0A%20%20%7D%2C%20self.pingInterval)%3B%0A%7D%3B%0A%0A%2F**%0A*%20Sends%20a%20ping%20packet.%0A*%0A*%20%40api%20private%0A*%2F%0A%0ASocket.prototype.ping%20%3D%20function%20()%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20this.sendPacket('ping'%2C%20function%20()%20%7B%0A%20%20%20%20self.emit('ping')%3B%0A%20%20%7D)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20on%20%60drain%60%20event%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onDrain%20%3D%20function%20()%20%7B%0A%20%20this.writeBuffer.splice(0%2C%20this.prevBufferLen)%3B%0A%0A%20%20%2F%2F%20setting%20prevBufferLen%20%3D%200%20is%20very%20important%0A%20%20%2F%2F%20for%20example%2C%20when%20upgrading%2C%20upgrade%20packet%20is%20sent%20over%2C%0A%20%20%2F%2F%20and%20a%20nonzero%20prevBufferLen%20could%20cause%20problems%20on%20%60drain%60%0A%20%20this.prevBufferLen%20%3D%200%3B%0A%0A%20%20if%20(0%20%3D%3D%3D%20this.writeBuffer.length)%20%7B%0A%20%20%20%20this.emit('drain')%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20this.flush()%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Flush%20write%20buffers.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.flush%20%3D%20function%20()%20%7B%0A%20%20if%20('closed'%20!%3D%3D%20this.readyState%20%26%26%20this.transport.writable%20%26%26%0A%20%20%20%20!this.upgrading%20%26%26%20this.writeBuffer.length)%20%7B%0A%20%20%20%20debug('flushing%20%25d%20packets%20in%20socket'%2C%20this.writeBuffer.length)%3B%0A%20%20%20%20this.transport.send(this.writeBuffer)%3B%0A%20%20%20%20%2F%2F%20keep%20track%20of%20current%20length%20of%20writeBuffer%0A%20%20%20%20%2F%2F%20splice%20writeBuffer%20and%20callbackBuffer%20on%20%60drain%60%0A%20%20%20%20this.prevBufferLen%20%3D%20this.writeBuffer.length%3B%0A%20%20%20%20this.emit('flush')%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Sends%20a%20message.%0A%20*%0A%20*%20%40param%20%7BString%7D%20message.%0A%20*%20%40param%20%7BFunction%7D%20callback%20function.%0A%20*%20%40param%20%7BObject%7D%20options.%0A%20*%20%40return%20%7BSocket%7D%20for%20chaining.%0A%20*%20%40api%20public%0A%20*%2F%0A%0ASocket.prototype.write%20%3D%0ASocket.prototype.send%20%3D%20function%20(msg%2C%20options%2C%20fn)%20%7B%0A%20%20this.sendPacket('message'%2C%20msg%2C%20options%2C%20fn)%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sends%20a%20packet.%0A%20*%0A%20*%20%40param%20%7BString%7D%20packet%20type.%0A%20*%20%40param%20%7BString%7D%20data.%0A%20*%20%40param%20%7BObject%7D%20options.%0A%20*%20%40param%20%7BFunction%7D%20callback%20function.%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.sendPacket%20%3D%20function%20(type%2C%20data%2C%20options%2C%20fn)%20%7B%0A%20%20if%20('function'%20%3D%3D%3D%20typeof%20data)%20%7B%0A%20%20%20%20fn%20%3D%20data%3B%0A%20%20%20%20data%20%3D%20undefined%3B%0A%20%20%7D%0A%0A%20%20if%20('function'%20%3D%3D%3D%20typeof%20options)%20%7B%0A%20%20%20%20fn%20%3D%20options%3B%0A%20%20%20%20options%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20if%20('closing'%20%3D%3D%3D%20this.readyState%20%7C%7C%20'closed'%20%3D%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%0A%20%20options%20%3D%20options%20%7C%7C%20%7B%7D%3B%0A%20%20options.compress%20%3D%20false%20!%3D%3D%20options.compress%3B%0A%0A%20%20var%20packet%20%3D%20%7B%0A%20%20%20%20type%3A%20type%2C%0A%20%20%20%20data%3A%20data%2C%0A%20%20%20%20options%3A%20options%0A%20%20%7D%3B%0A%20%20this.emit('packetCreate'%2C%20packet)%3B%0A%20%20this.writeBuffer.push(packet)%3B%0A%20%20if%20(fn)%20this.once('flush'%2C%20fn)%3B%0A%20%20this.flush()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Closes%20the%20connection.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.close%20%3D%20function%20()%20%7B%0A%20%20if%20('opening'%20%3D%3D%3D%20this.readyState%20%7C%7C%20'open'%20%3D%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20this.readyState%20%3D%20'closing'%3B%0A%0A%20%20%20%20var%20self%20%3D%20this%3B%0A%0A%20%20%20%20if%20(this.writeBuffer.length)%20%7B%0A%20%20%20%20%20%20this.once('drain'%2C%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20if%20(this.upgrading)%20%7B%0A%20%20%20%20%20%20%20%20%20%20waitForUpgrade()%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20close()%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D%20else%20if%20(this.upgrading)%20%7B%0A%20%20%20%20%20%20waitForUpgrade()%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20close()%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20function%20close%20()%20%7B%0A%20%20%20%20self.onClose('forced%20close')%3B%0A%20%20%20%20debug('socket%20closing%20-%20telling%20transport%20to%20close')%3B%0A%20%20%20%20self.transport.close()%3B%0A%20%20%7D%0A%0A%20%20function%20cleanupAndClose%20()%20%7B%0A%20%20%20%20self.removeListener('upgrade'%2C%20cleanupAndClose)%3B%0A%20%20%20%20self.removeListener('upgradeError'%2C%20cleanupAndClose)%3B%0A%20%20%20%20close()%3B%0A%20%20%7D%0A%0A%20%20function%20waitForUpgrade%20()%20%7B%0A%20%20%20%20%2F%2F%20wait%20for%20upgrade%20to%20finish%20since%20we%20can't%20send%20packets%20while%20pausing%20a%20transport%0A%20%20%20%20self.once('upgrade'%2C%20cleanupAndClose)%3B%0A%20%20%20%20self.once('upgradeError'%2C%20cleanupAndClose)%3B%0A%20%20%7D%0A%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20transport%20error%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onError%20%3D%20function%20(err)%20%7B%0A%20%20debug('socket%20error%20%25j'%2C%20err)%3B%0A%20%20Socket.priorWebsocketSuccess%20%3D%20false%3B%0A%20%20this.emit('error'%2C%20err)%3B%0A%20%20this.onClose('transport%20error'%2C%20err)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20transport%20close.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onClose%20%3D%20function%20(reason%2C%20desc)%20%7B%0A%20%20if%20('opening'%20%3D%3D%3D%20this.readyState%20%7C%7C%20'open'%20%3D%3D%3D%20this.readyState%20%7C%7C%20'closing'%20%3D%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20debug('socket%20close%20with%20reason%3A%20%22%25s%22'%2C%20reason)%3B%0A%20%20%20%20var%20self%20%3D%20this%3B%0A%0A%20%20%20%20%2F%2F%20clear%20timers%0A%20%20%20%20clearTimeout(this.pingIntervalTimer)%3B%0A%20%20%20%20clearTimeout(this.pingTimeoutTimer)%3B%0A%0A%20%20%20%20%2F%2F%20stop%20event%20from%20firing%20again%20for%20transport%0A%20%20%20%20this.transport.removeAllListeners('close')%3B%0A%0A%20%20%20%20%2F%2F%20ensure%20transport%20won't%20stay%20open%0A%20%20%20%20this.transport.close()%3B%0A%0A%20%20%20%20%2F%2F%20ignore%20further%20transport%20communication%0A%20%20%20%20this.transport.removeAllListeners()%3B%0A%0A%20%20%20%20%2F%2F%20set%20ready%20state%0A%20%20%20%20this.readyState%20%3D%20'closed'%3B%0A%0A%20%20%20%20%2F%2F%20clear%20session%20id%0A%20%20%20%20this.id%20%3D%20null%3B%0A%0A%20%20%20%20%2F%2F%20emit%20close%20event%0A%20%20%20%20this.emit('close'%2C%20reason%2C%20desc)%3B%0A%0A%20%20%20%20%2F%2F%20clean%20buffers%20after%2C%20so%20users%20can%20still%0A%20%20%20%20%2F%2F%20grab%20the%20buffers%20on%20%60close%60%20event%0A%20%20%20%20self.writeBuffer%20%3D%20%5B%5D%3B%0A%20%20%20%20self.prevBufferLen%20%3D%200%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Filters%20upgrades%2C%20returning%20only%20those%20matching%20client%20transports.%0A%20*%0A%20*%20%40param%20%7BArray%7D%20server%20upgrades%0A%20*%20%40api%20private%0A%20*%0A%20*%2F%0A%0ASocket.prototype.filterUpgrades%20%3D%20function%20(upgrades)%20%7B%0A%20%20var%20filteredUpgrades%20%3D%20%5B%5D%3B%0A%20%20for%20(var%20i%20%3D%200%2C%20j%20%3D%20upgrades.length%3B%20i%20%3C%20j%3B%20i%2B%2B)%20%7B%0A%20%20%20%20if%20(~index(this.transports%2C%20upgrades%5Bi%5D))%20filteredUpgrades.push(upgrades%5Bi%5D)%3B%0A%20%20%7D%0A%20%20return%20filteredUpgrades%3B%0A%7D%3B%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%22.%2Ftransport%22%3A16%2C%22.%2Ftransports%2Findex%22%3A17%2C%22component-emitter%22%3A10%2C%22debug%22%3A12%2C%22engine.io-parser%22%3A23%2C%22indexof%22%3A29%2C%22parseqs%22%3A32%2C%22parseuri%22%3A33%7D%5D%2C16%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F**%0A%20*%20Module%20dependencies.%0A%20*%2F%0A%0Avar%20parser%20%3D%20require('engine.io-parser')%3B%0Avar%20Emitter%20%3D%20require('component-emitter')%3B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20Transport%3B%0A%0A%2F**%0A%20*%20Transport%20abstract%20constructor.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20options.%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20Transport%20(opts)%20%7B%0A%20%20this.path%20%3D%20opts.path%3B%0A%20%20this.hostname%20%3D%20opts.hostname%3B%0A%20%20this.port%20%3D%20opts.port%3B%0A%20%20this.secure%20%3D%20opts.secure%3B%0A%20%20this.query%20%3D%20opts.query%3B%0A%20%20this.timestampParam%20%3D%20opts.timestampParam%3B%0A%20%20this.timestampRequests%20%3D%20opts.timestampRequests%3B%0A%20%20this.readyState%20%3D%20''%3B%0A%20%20this.agent%20%3D%20opts.agent%20%7C%7C%20false%3B%0A%20%20this.socket%20%3D%20opts.socket%3B%0A%20%20this.enablesXDR%20%3D%20opts.enablesXDR%3B%0A%0A%20%20%2F%2F%20SSL%20options%20for%20Node.js%20client%0A%20%20this.pfx%20%3D%20opts.pfx%3B%0A%20%20this.key%20%3D%20opts.key%3B%0A%20%20this.passphrase%20%3D%20opts.passphrase%3B%0A%20%20this.cert%20%3D%20opts.cert%3B%0A%20%20this.ca%20%3D%20opts.ca%3B%0A%20%20this.ciphers%20%3D%20opts.ciphers%3B%0A%20%20this.rejectUnauthorized%20%3D%20opts.rejectUnauthorized%3B%0A%20%20this.forceNode%20%3D%20opts.forceNode%3B%0A%0A%20%20%2F%2F%20other%20options%20for%20Node.js%20client%0A%20%20this.extraHeaders%20%3D%20opts.extraHeaders%3B%0A%20%20this.localAddress%20%3D%20opts.localAddress%3B%0A%7D%0A%0A%2F**%0A%20*%20Mix%20in%20%60Emitter%60.%0A%20*%2F%0A%0AEmitter(Transport.prototype)%3B%0A%0A%2F**%0A%20*%20Emits%20an%20error.%0A%20*%0A%20*%20%40param%20%7BString%7D%20str%0A%20*%20%40return%20%7BTransport%7D%20for%20chaining%0A%20*%20%40api%20public%0A%20*%2F%0A%0ATransport.prototype.onError%20%3D%20function%20(msg%2C%20desc)%20%7B%0A%20%20var%20err%20%3D%20new%20Error(msg)%3B%0A%20%20err.type%20%3D%20'TransportError'%3B%0A%20%20err.description%20%3D%20desc%3B%0A%20%20this.emit('error'%2C%20err)%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Opens%20the%20transport.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0ATransport.prototype.open%20%3D%20function%20()%20%7B%0A%20%20if%20('closed'%20%3D%3D%3D%20this.readyState%20%7C%7C%20''%20%3D%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20this.readyState%20%3D%20'opening'%3B%0A%20%20%20%20this.doOpen()%3B%0A%20%20%7D%0A%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Closes%20the%20transport.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ATransport.prototype.close%20%3D%20function%20()%20%7B%0A%20%20if%20('opening'%20%3D%3D%3D%20this.readyState%20%7C%7C%20'open'%20%3D%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20this.doClose()%3B%0A%20%20%20%20this.onClose()%3B%0A%20%20%7D%0A%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sends%20multiple%20packets.%0A%20*%0A%20*%20%40param%20%7BArray%7D%20packets%0A%20*%20%40api%20private%0A%20*%2F%0A%0ATransport.prototype.send%20%3D%20function%20(packets)%20%7B%0A%20%20if%20('open'%20%3D%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20this.write(packets)%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20throw%20new%20Error('Transport%20not%20open')%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20open%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ATransport.prototype.onOpen%20%3D%20function%20()%20%7B%0A%20%20this.readyState%20%3D%20'open'%3B%0A%20%20this.writable%20%3D%20true%3B%0A%20%20this.emit('open')%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20with%20data.%0A%20*%0A%20*%20%40param%20%7BString%7D%20data%0A%20*%20%40api%20private%0A%20*%2F%0A%0ATransport.prototype.onData%20%3D%20function%20(data)%20%7B%0A%20%20var%20packet%20%3D%20parser.decodePacket(data%2C%20this.socket.binaryType)%3B%0A%20%20this.onPacket(packet)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20with%20a%20decoded%20packet.%0A%20*%2F%0A%0ATransport.prototype.onPacket%20%3D%20function%20(packet)%20%7B%0A%20%20this.emit('packet'%2C%20packet)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20close.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ATransport.prototype.onClose%20%3D%20function%20()%20%7B%0A%20%20this.readyState%20%3D%20'closed'%3B%0A%20%20this.emit('close')%3B%0A%7D%3B%0A%0A%7D%2C%7B%22component-emitter%22%3A10%2C%22engine.io-parser%22%3A23%7D%5D%2C17%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%2F**%0A%20*%20Module%20dependencies%0A%20*%2F%0A%0Avar%20XMLHttpRequest%20%3D%20require('xmlhttprequest-ssl')%3B%0Avar%20XHR%20%3D%20require('.%2Fpolling-xhr')%3B%0Avar%20JSONP%20%3D%20require('.%2Fpolling-jsonp')%3B%0Avar%20websocket%20%3D%20require('.%2Fwebsocket')%3B%0A%0A%2F**%0A%20*%20Export%20transports.%0A%20*%2F%0A%0Aexports.polling%20%3D%20polling%3B%0Aexports.websocket%20%3D%20websocket%3B%0A%0A%2F**%0A%20*%20Polling%20transport%20polymorphic%20constructor.%0A%20*%20Decides%20on%20xhr%20vs%20jsonp%20based%20on%20feature%20detection.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20polling%20(opts)%20%7B%0A%20%20var%20xhr%3B%0A%20%20var%20xd%20%3D%20false%3B%0A%20%20var%20xs%20%3D%20false%3B%0A%20%20var%20jsonp%20%3D%20false%20!%3D%3D%20opts.jsonp%3B%0A%0A%20%20if%20(global.location)%20%7B%0A%20%20%20%20var%20isSSL%20%3D%20'https%3A'%20%3D%3D%3D%20location.protocol%3B%0A%20%20%20%20var%20port%20%3D%20location.port%3B%0A%0A%20%20%20%20%2F%2F%20some%20user%20agents%20have%20empty%20%60location.port%60%0A%20%20%20%20if%20(!port)%20%7B%0A%20%20%20%20%20%20port%20%3D%20isSSL%20%3F%20443%20%3A%2080%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20xd%20%3D%20opts.hostname%20!%3D%3D%20location.hostname%20%7C%7C%20port%20!%3D%3D%20opts.port%3B%0A%20%20%20%20xs%20%3D%20opts.secure%20!%3D%3D%20isSSL%3B%0A%20%20%7D%0A%0A%20%20opts.xdomain%20%3D%20xd%3B%0A%20%20opts.xscheme%20%3D%20xs%3B%0A%20%20xhr%20%3D%20new%20XMLHttpRequest(opts)%3B%0A%0A%20%20if%20('open'%20in%20xhr%20%26%26%20!opts.forceJSONP)%20%7B%0A%20%20%20%20return%20new%20XHR(opts)%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20if%20(!jsonp)%20throw%20new%20Error('JSONP%20disabled')%3B%0A%20%20%20%20return%20new%20JSONP(opts)%3B%0A%20%20%7D%0A%7D%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%22.%2Fpolling-jsonp%22%3A18%2C%22.%2Fpolling-xhr%22%3A19%2C%22.%2Fwebsocket%22%3A21%2C%22xmlhttprequest-ssl%22%3A22%7D%5D%2C18%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%0A%2F**%0A%20*%20Module%20requirements.%0A%20*%2F%0A%0Avar%20Polling%20%3D%20require('.%2Fpolling')%3B%0Avar%20inherit%20%3D%20require('component-inherit')%3B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20JSONPPolling%3B%0A%0A%2F**%0A%20*%20Cached%20regular%20expressions.%0A%20*%2F%0A%0Avar%20rNewline%20%3D%20%2F%5Cn%2Fg%3B%0Avar%20rEscapedNewline%20%3D%20%2F%5C%5Cn%2Fg%3B%0A%0A%2F**%0A%20*%20Global%20JSONP%20callbacks.%0A%20*%2F%0A%0Avar%20callbacks%3B%0A%0A%2F**%0A%20*%20Noop.%0A%20*%2F%0A%0Afunction%20empty%20()%20%7B%20%7D%0A%0A%2F**%0A%20*%20JSONP%20Polling%20constructor.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20opts.%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20JSONPPolling%20(opts)%20%7B%0A%20%20Polling.call(this%2C%20opts)%3B%0A%0A%20%20this.query%20%3D%20this.query%20%7C%7C%20%7B%7D%3B%0A%0A%20%20%2F%2F%20define%20global%20callbacks%20array%20if%20not%20present%0A%20%20%2F%2F%20we%20do%20this%20here%20(lazily)%20to%20avoid%20unneeded%20global%20pollution%0A%20%20if%20(!callbacks)%20%7B%0A%20%20%20%20%2F%2F%20we%20need%20to%20consider%20multiple%20engines%20in%20the%20same%20page%0A%20%20%20%20if%20(!global.___eio)%20global.___eio%20%3D%20%5B%5D%3B%0A%20%20%20%20callbacks%20%3D%20global.___eio%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20callback%20identifier%0A%20%20this.index%20%3D%20callbacks.length%3B%0A%0A%20%20%2F%2F%20add%20callback%20to%20jsonp%20global%0A%20%20var%20self%20%3D%20this%3B%0A%20%20callbacks.push(function%20(msg)%20%7B%0A%20%20%20%20self.onData(msg)%3B%0A%20%20%7D)%3B%0A%0A%20%20%2F%2F%20append%20to%20query%20string%0A%20%20this.query.j%20%3D%20this.index%3B%0A%0A%20%20%2F%2F%20prevent%20spurious%20errors%20from%20being%20emitted%20when%20the%20window%20is%20unloaded%0A%20%20if%20(global.document%20%26%26%20global.addEventListener)%20%7B%0A%20%20%20%20global.addEventListener('beforeunload'%2C%20function%20()%20%7B%0A%20%20%20%20%20%20if%20(self.script)%20self.script.onerror%20%3D%20empty%3B%0A%20%20%20%20%7D%2C%20false)%3B%0A%20%20%7D%0A%7D%0A%0A%2F**%0A%20*%20Inherits%20from%20Polling.%0A%20*%2F%0A%0Ainherit(JSONPPolling%2C%20Polling)%3B%0A%0A%2F*%0A%20*%20JSONP%20only%20supports%20binary%20as%20base64%20encoded%20strings%0A%20*%2F%0A%0AJSONPPolling.prototype.supportsBinary%20%3D%20false%3B%0A%0A%2F**%0A%20*%20Closes%20the%20socket.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AJSONPPolling.prototype.doClose%20%3D%20function%20()%20%7B%0A%20%20if%20(this.script)%20%7B%0A%20%20%20%20this.script.parentNode.removeChild(this.script)%3B%0A%20%20%20%20this.script%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20if%20(this.form)%20%7B%0A%20%20%20%20this.form.parentNode.removeChild(this.form)%3B%0A%20%20%20%20this.form%20%3D%20null%3B%0A%20%20%20%20this.iframe%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20Polling.prototype.doClose.call(this)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Starts%20a%20poll%20cycle.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AJSONPPolling.prototype.doPoll%20%3D%20function%20()%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20var%20script%20%3D%20document.createElement('script')%3B%0A%0A%20%20if%20(this.script)%20%7B%0A%20%20%20%20this.script.parentNode.removeChild(this.script)%3B%0A%20%20%20%20this.script%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20script.async%20%3D%20true%3B%0A%20%20script.src%20%3D%20this.uri()%3B%0A%20%20script.onerror%20%3D%20function%20(e)%20%7B%0A%20%20%20%20self.onError('jsonp%20poll%20error'%2C%20e)%3B%0A%20%20%7D%3B%0A%0A%20%20var%20insertAt%20%3D%20document.getElementsByTagName('script')%5B0%5D%3B%0A%20%20if%20(insertAt)%20%7B%0A%20%20%20%20insertAt.parentNode.insertBefore(script%2C%20insertAt)%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20(document.head%20%7C%7C%20document.body).appendChild(script)%3B%0A%20%20%7D%0A%20%20this.script%20%3D%20script%3B%0A%0A%20%20var%20isUAgecko%20%3D%20'undefined'%20!%3D%3D%20typeof%20navigator%20%26%26%20%2Fgecko%2Fi.test(navigator.userAgent)%3B%0A%0A%20%20if%20(isUAgecko)%20%7B%0A%20%20%20%20setTimeout(function%20()%20%7B%0A%20%20%20%20%20%20var%20iframe%20%3D%20document.createElement('iframe')%3B%0A%20%20%20%20%20%20document.body.appendChild(iframe)%3B%0A%20%20%20%20%20%20document.body.removeChild(iframe)%3B%0A%20%20%20%20%7D%2C%20100)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Writes%20with%20a%20hidden%20iframe.%0A%20*%0A%20*%20%40param%20%7BString%7D%20data%20to%20send%0A%20*%20%40param%20%7BFunction%7D%20called%20upon%20flush.%0A%20*%20%40api%20private%0A%20*%2F%0A%0AJSONPPolling.prototype.doWrite%20%3D%20function%20(data%2C%20fn)%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%0A%20%20if%20(!this.form)%20%7B%0A%20%20%20%20var%20form%20%3D%20document.createElement('form')%3B%0A%20%20%20%20var%20area%20%3D%20document.createElement('textarea')%3B%0A%20%20%20%20var%20id%20%3D%20this.iframeId%20%3D%20'eio_iframe_'%20%2B%20this.index%3B%0A%20%20%20%20var%20iframe%3B%0A%0A%20%20%20%20form.className%20%3D%20'socketio'%3B%0A%20%20%20%20form.style.position%20%3D%20'absolute'%3B%0A%20%20%20%20form.style.top%20%3D%20'-1000px'%3B%0A%20%20%20%20form.style.left%20%3D%20'-1000px'%3B%0A%20%20%20%20form.target%20%3D%20id%3B%0A%20%20%20%20form.method%20%3D%20'POST'%3B%0A%20%20%20%20form.setAttribute('accept-charset'%2C%20'utf-8')%3B%0A%20%20%20%20area.name%20%3D%20'd'%3B%0A%20%20%20%20form.appendChild(area)%3B%0A%20%20%20%20document.body.appendChild(form)%3B%0A%0A%20%20%20%20this.form%20%3D%20form%3B%0A%20%20%20%20this.area%20%3D%20area%3B%0A%20%20%7D%0A%0A%20%20this.form.action%20%3D%20this.uri()%3B%0A%0A%20%20function%20complete%20()%20%7B%0A%20%20%20%20initIframe()%3B%0A%20%20%20%20fn()%3B%0A%20%20%7D%0A%0A%20%20function%20initIframe%20()%20%7B%0A%20%20%20%20if%20(self.iframe)%20%7B%0A%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20self.form.removeChild(self.iframe)%3B%0A%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%20%20%20%20self.onError('jsonp%20polling%20iframe%20removal%20error'%2C%20e)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%2F%2F%20ie6%20dynamic%20iframes%20with%20target%3D%22%22%20support%20(thanks%20Chris%20Lambacher)%0A%20%20%20%20%20%20var%20html%20%3D%20'%3Ciframe%20src%3D%22javascript%3A0%22%20name%3D%22'%20%2B%20self.iframeId%20%2B%20'%22%3E'%3B%0A%20%20%20%20%20%20iframe%20%3D%20document.createElement(html)%3B%0A%20%20%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%20%20iframe%20%3D%20document.createElement('iframe')%3B%0A%20%20%20%20%20%20iframe.name%20%3D%20self.iframeId%3B%0A%20%20%20%20%20%20iframe.src%20%3D%20'javascript%3A0'%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20iframe.id%20%3D%20self.iframeId%3B%0A%0A%20%20%20%20self.form.appendChild(iframe)%3B%0A%20%20%20%20self.iframe%20%3D%20iframe%3B%0A%20%20%7D%0A%0A%20%20initIframe()%3B%0A%0A%20%20%2F%2F%20escape%20%5Cn%20to%20prevent%20it%20from%20being%20converted%20into%20%5Cr%5Cn%20by%20some%20UAs%0A%20%20%2F%2F%20double%20escaping%20is%20required%20for%20escaped%20new%20lines%20because%20unescaping%20of%20new%20lines%20can%20be%20done%20safely%20on%20server-side%0A%20%20data%20%3D%20data.replace(rEscapedNewline%2C%20'%5C%5C%5Cn')%3B%0A%20%20this.area.value%20%3D%20data.replace(rNewline%2C%20'%5C%5Cn')%3B%0A%0A%20%20try%20%7B%0A%20%20%20%20this.form.submit()%3B%0A%20%20%7D%20catch%20(e)%20%7B%7D%0A%0A%20%20if%20(this.iframe.attachEvent)%20%7B%0A%20%20%20%20this.iframe.onreadystatechange%20%3D%20function%20()%20%7B%0A%20%20%20%20%20%20if%20(self.iframe.readyState%20%3D%3D%3D%20'complete')%20%7B%0A%20%20%20%20%20%20%20%20complete()%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20this.iframe.onload%20%3D%20complete%3B%0A%20%20%7D%0A%7D%3B%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%22.%2Fpolling%22%3A20%2C%22component-inherit%22%3A11%7D%5D%2C19%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%2F**%0A%20*%20Module%20requirements.%0A%20*%2F%0A%0Avar%20XMLHttpRequest%20%3D%20require('xmlhttprequest-ssl')%3B%0Avar%20Polling%20%3D%20require('.%2Fpolling')%3B%0Avar%20Emitter%20%3D%20require('component-emitter')%3B%0Avar%20inherit%20%3D%20require('component-inherit')%3B%0Avar%20debug%20%3D%20require('debug')('engine.io-client%3Apolling-xhr')%3B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20XHR%3B%0Amodule.exports.Request%20%3D%20Request%3B%0A%0A%2F**%0A%20*%20Empty%20function%0A%20*%2F%0A%0Afunction%20empty%20()%20%7B%7D%0A%0A%2F**%0A%20*%20XHR%20Polling%20constructor.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20opts%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20XHR%20(opts)%20%7B%0A%20%20Polling.call(this%2C%20opts)%3B%0A%20%20this.requestTimeout%20%3D%20opts.requestTimeout%3B%0A%20%20this.extraHeaders%20%3D%20opts.extraHeaders%3B%0A%0A%20%20if%20(global.location)%20%7B%0A%20%20%20%20var%20isSSL%20%3D%20'https%3A'%20%3D%3D%3D%20location.protocol%3B%0A%20%20%20%20var%20port%20%3D%20location.port%3B%0A%0A%20%20%20%20%2F%2F%20some%20user%20agents%20have%20empty%20%60location.port%60%0A%20%20%20%20if%20(!port)%20%7B%0A%20%20%20%20%20%20port%20%3D%20isSSL%20%3F%20443%20%3A%2080%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20this.xd%20%3D%20opts.hostname%20!%3D%3D%20global.location.hostname%20%7C%7C%0A%20%20%20%20%20%20port%20!%3D%3D%20opts.port%3B%0A%20%20%20%20this.xs%20%3D%20opts.secure%20!%3D%3D%20isSSL%3B%0A%20%20%7D%0A%7D%0A%0A%2F**%0A%20*%20Inherits%20from%20Polling.%0A%20*%2F%0A%0Ainherit(XHR%2C%20Polling)%3B%0A%0A%2F**%0A%20*%20XHR%20supports%20binary%0A%20*%2F%0A%0AXHR.prototype.supportsBinary%20%3D%20true%3B%0A%0A%2F**%0A%20*%20Creates%20a%20request.%0A%20*%0A%20*%20%40param%20%7BString%7D%20method%0A%20*%20%40api%20private%0A%20*%2F%0A%0AXHR.prototype.request%20%3D%20function%20(opts)%20%7B%0A%20%20opts%20%3D%20opts%20%7C%7C%20%7B%7D%3B%0A%20%20opts.uri%20%3D%20this.uri()%3B%0A%20%20opts.xd%20%3D%20this.xd%3B%0A%20%20opts.xs%20%3D%20this.xs%3B%0A%20%20opts.agent%20%3D%20this.agent%20%7C%7C%20false%3B%0A%20%20opts.supportsBinary%20%3D%20this.supportsBinary%3B%0A%20%20opts.enablesXDR%20%3D%20this.enablesXDR%3B%0A%0A%20%20%2F%2F%20SSL%20options%20for%20Node.js%20client%0A%20%20opts.pfx%20%3D%20this.pfx%3B%0A%20%20opts.key%20%3D%20this.key%3B%0A%20%20opts.passphrase%20%3D%20this.passphrase%3B%0A%20%20opts.cert%20%3D%20this.cert%3B%0A%20%20opts.ca%20%3D%20this.ca%3B%0A%20%20opts.ciphers%20%3D%20this.ciphers%3B%0A%20%20opts.rejectUnauthorized%20%3D%20this.rejectUnauthorized%3B%0A%20%20opts.requestTimeout%20%3D%20this.requestTimeout%3B%0A%0A%20%20%2F%2F%20other%20options%20for%20Node.js%20client%0A%20%20opts.extraHeaders%20%3D%20this.extraHeaders%3B%0A%0A%20%20return%20new%20Request(opts)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sends%20data.%0A%20*%0A%20*%20%40param%20%7BString%7D%20data%20to%20send.%0A%20*%20%40param%20%7BFunction%7D%20called%20upon%20flush.%0A%20*%20%40api%20private%0A%20*%2F%0A%0AXHR.prototype.doWrite%20%3D%20function%20(data%2C%20fn)%20%7B%0A%20%20var%20isBinary%20%3D%20typeof%20data%20!%3D%3D%20'string'%20%26%26%20data%20!%3D%3D%20undefined%3B%0A%20%20var%20req%20%3D%20this.request(%7B%20method%3A%20'POST'%2C%20data%3A%20data%2C%20isBinary%3A%20isBinary%20%7D)%3B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20req.on('success'%2C%20fn)%3B%0A%20%20req.on('error'%2C%20function%20(err)%20%7B%0A%20%20%20%20self.onError('xhr%20post%20error'%2C%20err)%3B%0A%20%20%7D)%3B%0A%20%20this.sendXhr%20%3D%20req%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Starts%20a%20poll%20cycle.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AXHR.prototype.doPoll%20%3D%20function%20()%20%7B%0A%20%20debug('xhr%20poll')%3B%0A%20%20var%20req%20%3D%20this.request()%3B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20req.on('data'%2C%20function%20(data)%20%7B%0A%20%20%20%20self.onData(data)%3B%0A%20%20%7D)%3B%0A%20%20req.on('error'%2C%20function%20(err)%20%7B%0A%20%20%20%20self.onError('xhr%20poll%20error'%2C%20err)%3B%0A%20%20%7D)%3B%0A%20%20this.pollXhr%20%3D%20req%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Request%20constructor%0A%20*%0A%20*%20%40param%20%7BObject%7D%20options%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20Request%20(opts)%20%7B%0A%20%20this.method%20%3D%20opts.method%20%7C%7C%20'GET'%3B%0A%20%20this.uri%20%3D%20opts.uri%3B%0A%20%20this.xd%20%3D%20!!opts.xd%3B%0A%20%20this.xs%20%3D%20!!opts.xs%3B%0A%20%20this.async%20%3D%20false%20!%3D%3D%20opts.async%3B%0A%20%20this.data%20%3D%20undefined%20!%3D%3D%20opts.data%20%3F%20opts.data%20%3A%20null%3B%0A%20%20this.agent%20%3D%20opts.agent%3B%0A%20%20this.isBinary%20%3D%20opts.isBinary%3B%0A%20%20this.supportsBinary%20%3D%20opts.supportsBinary%3B%0A%20%20this.enablesXDR%20%3D%20opts.enablesXDR%3B%0A%20%20this.requestTimeout%20%3D%20opts.requestTimeout%3B%0A%0A%20%20%2F%2F%20SSL%20options%20for%20Node.js%20client%0A%20%20this.pfx%20%3D%20opts.pfx%3B%0A%20%20this.key%20%3D%20opts.key%3B%0A%20%20this.passphrase%20%3D%20opts.passphrase%3B%0A%20%20this.cert%20%3D%20opts.cert%3B%0A%20%20this.ca%20%3D%20opts.ca%3B%0A%20%20this.ciphers%20%3D%20opts.ciphers%3B%0A%20%20this.rejectUnauthorized%20%3D%20opts.rejectUnauthorized%3B%0A%0A%20%20%2F%2F%20other%20options%20for%20Node.js%20client%0A%20%20this.extraHeaders%20%3D%20opts.extraHeaders%3B%0A%0A%20%20this.create()%3B%0A%7D%0A%0A%2F**%0A%20*%20Mix%20in%20%60Emitter%60.%0A%20*%2F%0A%0AEmitter(Request.prototype)%3B%0A%0A%2F**%0A%20*%20Creates%20the%20XHR%20object%20and%20sends%20the%20request.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ARequest.prototype.create%20%3D%20function%20()%20%7B%0A%20%20var%20opts%20%3D%20%7B%20agent%3A%20this.agent%2C%20xdomain%3A%20this.xd%2C%20xscheme%3A%20this.xs%2C%20enablesXDR%3A%20this.enablesXDR%20%7D%3B%0A%0A%20%20%2F%2F%20SSL%20options%20for%20Node.js%20client%0A%20%20opts.pfx%20%3D%20this.pfx%3B%0A%20%20opts.key%20%3D%20this.key%3B%0A%20%20opts.passphrase%20%3D%20this.passphrase%3B%0A%20%20opts.cert%20%3D%20this.cert%3B%0A%20%20opts.ca%20%3D%20this.ca%3B%0A%20%20opts.ciphers%20%3D%20this.ciphers%3B%0A%20%20opts.rejectUnauthorized%20%3D%20this.rejectUnauthorized%3B%0A%0A%20%20var%20xhr%20%3D%20this.xhr%20%3D%20new%20XMLHttpRequest(opts)%3B%0A%20%20var%20self%20%3D%20this%3B%0A%0A%20%20try%20%7B%0A%20%20%20%20debug('xhr%20open%20%25s%3A%20%25s'%2C%20this.method%2C%20this.uri)%3B%0A%20%20%20%20xhr.open(this.method%2C%20this.uri%2C%20this.async)%3B%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20if%20(this.extraHeaders)%20%7B%0A%20%20%20%20%20%20%20%20xhr.setDisableHeaderCheck%20%26%26%20xhr.setDisableHeaderCheck(true)%3B%0A%20%20%20%20%20%20%20%20for%20(var%20i%20in%20this.extraHeaders)%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(this.extraHeaders.hasOwnProperty(i))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20xhr.setRequestHeader(i%2C%20this.extraHeaders%5Bi%5D)%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%0A%20%20%20%20if%20('POST'%20%3D%3D%3D%20this.method)%20%7B%0A%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20if%20(this.isBinary)%20%7B%0A%20%20%20%20%20%20%20%20%20%20xhr.setRequestHeader('Content-type'%2C%20'application%2Foctet-stream')%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20xhr.setRequestHeader('Content-type'%2C%20'text%2Fplain%3Bcharset%3DUTF-8')%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20xhr.setRequestHeader('Accept'%2C%20'*%2F*')%3B%0A%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%0A%20%20%20%20%2F%2F%20ie6%20check%0A%20%20%20%20if%20('withCredentials'%20in%20xhr)%20%7B%0A%20%20%20%20%20%20xhr.withCredentials%20%3D%20true%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(this.requestTimeout)%20%7B%0A%20%20%20%20%20%20xhr.timeout%20%3D%20this.requestTimeout%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(this.hasXDR())%20%7B%0A%20%20%20%20%20%20xhr.onload%20%3D%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20self.onLoad()%3B%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20xhr.onerror%20%3D%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20self.onError(xhr.responseText)%3B%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20xhr.onreadystatechange%20%3D%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20if%20(xhr.readyState%20%3D%3D%3D%202)%20%7B%0A%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20contentType%20%3D%20xhr.getResponseHeader('Content-Type')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(self.supportsBinary%20%26%26%20contentType%20%3D%3D%3D%20'application%2Foctet-stream')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20xhr.responseType%20%3D%20'arraybuffer'%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20(4%20!%3D%3D%20xhr.readyState)%20return%3B%0A%20%20%20%20%20%20%20%20if%20(200%20%3D%3D%3D%20xhr.status%20%7C%7C%201223%20%3D%3D%3D%20xhr.status)%20%7B%0A%20%20%20%20%20%20%20%20%20%20self.onLoad()%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20make%20sure%20the%20%60error%60%20event%20handler%20that's%20user-set%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20does%20not%20throw%20in%20the%20same%20tick%20and%20gets%20caught%20here%0A%20%20%20%20%20%20%20%20%20%20setTimeout(function%20()%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20self.onError(xhr.status)%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%2C%200)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20debug('xhr%20data%20%25s'%2C%20this.data)%3B%0A%20%20%20%20xhr.send(this.data)%3B%0A%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%2F%2F%20Need%20to%20defer%20since%20.create()%20is%20called%20directly%20fhrom%20the%20constructor%0A%20%20%20%20%2F%2F%20and%20thus%20the%20'error'%20event%20can%20only%20be%20only%20bound%20*after*%20this%20exception%0A%20%20%20%20%2F%2F%20occurs.%20%20Therefore%2C%20also%2C%20we%20cannot%20throw%20here%20at%20all.%0A%20%20%20%20setTimeout(function%20()%20%7B%0A%20%20%20%20%20%20self.onError(e)%3B%0A%20%20%20%20%7D%2C%200)%3B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%0A%20%20if%20(global.document)%20%7B%0A%20%20%20%20this.index%20%3D%20Request.requestsCount%2B%2B%3B%0A%20%20%20%20Request.requests%5Bthis.index%5D%20%3D%20this%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20successful%20response.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ARequest.prototype.onSuccess%20%3D%20function%20()%20%7B%0A%20%20this.emit('success')%3B%0A%20%20this.cleanup()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20if%20we%20have%20data.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ARequest.prototype.onData%20%3D%20function%20(data)%20%7B%0A%20%20this.emit('data'%2C%20data)%3B%0A%20%20this.onSuccess()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20error.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ARequest.prototype.onError%20%3D%20function%20(err)%20%7B%0A%20%20this.emit('error'%2C%20err)%3B%0A%20%20this.cleanup(true)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Cleans%20up%20house.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ARequest.prototype.cleanup%20%3D%20function%20(fromError)%20%7B%0A%20%20if%20('undefined'%20%3D%3D%3D%20typeof%20this.xhr%20%7C%7C%20null%20%3D%3D%3D%20this.xhr)%20%7B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%20%20%2F%2F%20xmlhttprequest%0A%20%20if%20(this.hasXDR())%20%7B%0A%20%20%20%20this.xhr.onload%20%3D%20this.xhr.onerror%20%3D%20empty%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20this.xhr.onreadystatechange%20%3D%20empty%3B%0A%20%20%7D%0A%0A%20%20if%20(fromError)%20%7B%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20this.xhr.abort()%3B%0A%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%20%20%7D%0A%0A%20%20if%20(global.document)%20%7B%0A%20%20%20%20delete%20Request.requests%5Bthis.index%5D%3B%0A%20%20%7D%0A%0A%20%20this.xhr%20%3D%20null%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20load.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ARequest.prototype.onLoad%20%3D%20function%20()%20%7B%0A%20%20var%20data%3B%0A%20%20try%20%7B%0A%20%20%20%20var%20contentType%3B%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20contentType%20%3D%20this.xhr.getResponseHeader('Content-Type')%3B%0A%20%20%20%20%7D%20catch%20(e)%20%7B%7D%0A%20%20%20%20if%20(contentType%20%3D%3D%3D%20'application%2Foctet-stream')%20%7B%0A%20%20%20%20%20%20data%20%3D%20this.xhr.response%20%7C%7C%20this.xhr.responseText%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20data%20%3D%20this.xhr.responseText%3B%0A%20%20%20%20%7D%0A%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20this.onError(e)%3B%0A%20%20%7D%0A%20%20if%20(null%20!%3D%20data)%20%7B%0A%20%20%20%20this.onData(data)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Check%20if%20it%20has%20XDomainRequest.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ARequest.prototype.hasXDR%20%3D%20function%20()%20%7B%0A%20%20return%20'undefined'%20!%3D%3D%20typeof%20global.XDomainRequest%20%26%26%20!this.xs%20%26%26%20this.enablesXDR%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Aborts%20the%20request.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0ARequest.prototype.abort%20%3D%20function%20()%20%7B%0A%20%20this.cleanup()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Aborts%20pending%20requests%20when%20unloading%20the%20window.%20This%20is%20needed%20to%20prevent%0A%20*%20memory%20leaks%20(e.g.%20when%20using%20IE)%20and%20to%20ensure%20that%20no%20spurious%20error%20is%0A%20*%20emitted.%0A%20*%2F%0A%0ARequest.requestsCount%20%3D%200%3B%0ARequest.requests%20%3D%20%7B%7D%3B%0A%0Aif%20(global.document)%20%7B%0A%20%20if%20(global.attachEvent)%20%7B%0A%20%20%20%20global.attachEvent('onunload'%2C%20unloadHandler)%3B%0A%20%20%7D%20else%20if%20(global.addEventListener)%20%7B%0A%20%20%20%20global.addEventListener('beforeunload'%2C%20unloadHandler%2C%20false)%3B%0A%20%20%7D%0A%7D%0A%0Afunction%20unloadHandler%20()%20%7B%0A%20%20for%20(var%20i%20in%20Request.requests)%20%7B%0A%20%20%20%20if%20(Request.requests.hasOwnProperty(i))%20%7B%0A%20%20%20%20%20%20Request.requests%5Bi%5D.abort()%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%22.%2Fpolling%22%3A20%2C%22component-emitter%22%3A10%2C%22component-inherit%22%3A11%2C%22debug%22%3A12%2C%22xmlhttprequest-ssl%22%3A22%7D%5D%2C20%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F**%0A%20*%20Module%20dependencies.%0A%20*%2F%0A%0Avar%20Transport%20%3D%20require('..%2Ftransport')%3B%0Avar%20parseqs%20%3D%20require('parseqs')%3B%0Avar%20parser%20%3D%20require('engine.io-parser')%3B%0Avar%20inherit%20%3D%20require('component-inherit')%3B%0Avar%20yeast%20%3D%20require('yeast')%3B%0Avar%20debug%20%3D%20require('debug')('engine.io-client%3Apolling')%3B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20Polling%3B%0A%0A%2F**%0A%20*%20Is%20XHR2%20supported%3F%0A%20*%2F%0A%0Avar%20hasXHR2%20%3D%20(function%20()%20%7B%0A%20%20var%20XMLHttpRequest%20%3D%20require('xmlhttprequest-ssl')%3B%0A%20%20var%20xhr%20%3D%20new%20XMLHttpRequest(%7B%20xdomain%3A%20false%20%7D)%3B%0A%20%20return%20null%20!%3D%20xhr.responseType%3B%0A%7D)()%3B%0A%0A%2F**%0A%20*%20Polling%20interface.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20opts%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20Polling%20(opts)%20%7B%0A%20%20var%20forceBase64%20%3D%20(opts%20%26%26%20opts.forceBase64)%3B%0A%20%20if%20(!hasXHR2%20%7C%7C%20forceBase64)%20%7B%0A%20%20%20%20this.supportsBinary%20%3D%20false%3B%0A%20%20%7D%0A%20%20Transport.call(this%2C%20opts)%3B%0A%7D%0A%0A%2F**%0A%20*%20Inherits%20from%20Transport.%0A%20*%2F%0A%0Ainherit(Polling%2C%20Transport)%3B%0A%0A%2F**%0A%20*%20Transport%20name.%0A%20*%2F%0A%0APolling.prototype.name%20%3D%20'polling'%3B%0A%0A%2F**%0A%20*%20Opens%20the%20socket%20(triggers%20polling).%20We%20write%20a%20PING%20message%20to%20determine%0A%20*%20when%20the%20transport%20is%20open.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0APolling.prototype.doOpen%20%3D%20function%20()%20%7B%0A%20%20this.poll()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Pauses%20polling.%0A%20*%0A%20*%20%40param%20%7BFunction%7D%20callback%20upon%20buffers%20are%20flushed%20and%20transport%20is%20paused%0A%20*%20%40api%20private%0A%20*%2F%0A%0APolling.prototype.pause%20%3D%20function%20(onPause)%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%0A%20%20this.readyState%20%3D%20'pausing'%3B%0A%0A%20%20function%20pause%20()%20%7B%0A%20%20%20%20debug('paused')%3B%0A%20%20%20%20self.readyState%20%3D%20'paused'%3B%0A%20%20%20%20onPause()%3B%0A%20%20%7D%0A%0A%20%20if%20(this.polling%20%7C%7C%20!this.writable)%20%7B%0A%20%20%20%20var%20total%20%3D%200%3B%0A%0A%20%20%20%20if%20(this.polling)%20%7B%0A%20%20%20%20%20%20debug('we%20are%20currently%20polling%20-%20waiting%20to%20pause')%3B%0A%20%20%20%20%20%20total%2B%2B%3B%0A%20%20%20%20%20%20this.once('pollComplete'%2C%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20debug('pre-pause%20polling%20complete')%3B%0A%20%20%20%20%20%20%20%20--total%20%7C%7C%20pause()%3B%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(!this.writable)%20%7B%0A%20%20%20%20%20%20debug('we%20are%20currently%20writing%20-%20waiting%20to%20pause')%3B%0A%20%20%20%20%20%20total%2B%2B%3B%0A%20%20%20%20%20%20this.once('drain'%2C%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20debug('pre-pause%20writing%20complete')%3B%0A%20%20%20%20%20%20%20%20--total%20%7C%7C%20pause()%3B%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D%0A%20%20%7D%20else%20%7B%0A%20%20%20%20pause()%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Starts%20polling%20cycle.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0APolling.prototype.poll%20%3D%20function%20()%20%7B%0A%20%20debug('polling')%3B%0A%20%20this.polling%20%3D%20true%3B%0A%20%20this.doPoll()%3B%0A%20%20this.emit('poll')%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Overloads%20onData%20to%20detect%20payloads.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0APolling.prototype.onData%20%3D%20function%20(data)%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20debug('polling%20got%20data%20%25s'%2C%20data)%3B%0A%20%20var%20callback%20%3D%20function%20(packet%2C%20index%2C%20total)%20%7B%0A%20%20%20%20%2F%2F%20if%20its%20the%20first%20message%20we%20consider%20the%20transport%20open%0A%20%20%20%20if%20('opening'%20%3D%3D%3D%20self.readyState)%20%7B%0A%20%20%20%20%20%20self.onOpen()%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20if%20its%20a%20close%20packet%2C%20we%20close%20the%20ongoing%20requests%0A%20%20%20%20if%20('close'%20%3D%3D%3D%20packet.type)%20%7B%0A%20%20%20%20%20%20self.onClose()%3B%0A%20%20%20%20%20%20return%20false%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20otherwise%20bypass%20onData%20and%20handle%20the%20message%0A%20%20%20%20self.onPacket(packet)%3B%0A%20%20%7D%3B%0A%0A%20%20%2F%2F%20decode%20payload%0A%20%20parser.decodePayload(data%2C%20this.socket.binaryType%2C%20callback)%3B%0A%0A%20%20%2F%2F%20if%20an%20event%20did%20not%20trigger%20closing%0A%20%20if%20('closed'%20!%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20%2F%2F%20if%20we%20got%20data%20we're%20not%20polling%0A%20%20%20%20this.polling%20%3D%20false%3B%0A%20%20%20%20this.emit('pollComplete')%3B%0A%0A%20%20%20%20if%20('open'%20%3D%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20%20%20this.poll()%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20debug('ignoring%20poll%20-%20transport%20state%20%22%25s%22'%2C%20this.readyState)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20For%20polling%2C%20send%20a%20close%20packet.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0APolling.prototype.doClose%20%3D%20function%20()%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%0A%20%20function%20close%20()%20%7B%0A%20%20%20%20debug('writing%20close%20packet')%3B%0A%20%20%20%20self.write(%5B%7B%20type%3A%20'close'%20%7D%5D)%3B%0A%20%20%7D%0A%0A%20%20if%20('open'%20%3D%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20debug('transport%20open%20-%20closing')%3B%0A%20%20%20%20close()%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20%2F%2F%20in%20case%20we're%20trying%20to%20close%20while%0A%20%20%20%20%2F%2F%20handshaking%20is%20in%20progress%20(GH-164)%0A%20%20%20%20debug('transport%20not%20open%20-%20deferring%20close')%3B%0A%20%20%20%20this.once('open'%2C%20close)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Writes%20a%20packets%20payload.%0A%20*%0A%20*%20%40param%20%7BArray%7D%20data%20packets%0A%20*%20%40param%20%7BFunction%7D%20drain%20callback%0A%20*%20%40api%20private%0A%20*%2F%0A%0APolling.prototype.write%20%3D%20function%20(packets)%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20this.writable%20%3D%20false%3B%0A%20%20var%20callbackfn%20%3D%20function%20()%20%7B%0A%20%20%20%20self.writable%20%3D%20true%3B%0A%20%20%20%20self.emit('drain')%3B%0A%20%20%7D%3B%0A%0A%20%20parser.encodePayload(packets%2C%20this.supportsBinary%2C%20function%20(data)%20%7B%0A%20%20%20%20self.doWrite(data%2C%20callbackfn)%3B%0A%20%20%7D)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Generates%20uri%20for%20connection.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0APolling.prototype.uri%20%3D%20function%20()%20%7B%0A%20%20var%20query%20%3D%20this.query%20%7C%7C%20%7B%7D%3B%0A%20%20var%20schema%20%3D%20this.secure%20%3F%20'https'%20%3A%20'http'%3B%0A%20%20var%20port%20%3D%20''%3B%0A%0A%20%20%2F%2F%20cache%20busting%20is%20forced%0A%20%20if%20(false%20!%3D%3D%20this.timestampRequests)%20%7B%0A%20%20%20%20query%5Bthis.timestampParam%5D%20%3D%20yeast()%3B%0A%20%20%7D%0A%0A%20%20if%20(!this.supportsBinary%20%26%26%20!query.sid)%20%7B%0A%20%20%20%20query.b64%20%3D%201%3B%0A%20%20%7D%0A%0A%20%20query%20%3D%20parseqs.encode(query)%3B%0A%0A%20%20%2F%2F%20avoid%20port%20if%20default%20for%20schema%0A%20%20if%20(this.port%20%26%26%20(('https'%20%3D%3D%3D%20schema%20%26%26%20Number(this.port)%20!%3D%3D%20443)%20%7C%7C%0A%20%20%20%20%20('http'%20%3D%3D%3D%20schema%20%26%26%20Number(this.port)%20!%3D%3D%2080)))%20%7B%0A%20%20%20%20port%20%3D%20'%3A'%20%2B%20this.port%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20prepend%20%3F%20to%20query%0A%20%20if%20(query.length)%20%7B%0A%20%20%20%20query%20%3D%20'%3F'%20%2B%20query%3B%0A%20%20%7D%0A%0A%20%20var%20ipv6%20%3D%20this.hostname.indexOf('%3A')%20!%3D%3D%20-1%3B%0A%20%20return%20schema%20%2B%20'%3A%2F%2F'%20%2B%20(ipv6%20%3F%20'%5B'%20%2B%20this.hostname%20%2B%20'%5D'%20%3A%20this.hostname)%20%2B%20port%20%2B%20this.path%20%2B%20query%3B%0A%7D%3B%0A%0A%7D%2C%7B%22..%2Ftransport%22%3A16%2C%22component-inherit%22%3A11%2C%22debug%22%3A12%2C%22engine.io-parser%22%3A23%2C%22parseqs%22%3A32%2C%22xmlhttprequest-ssl%22%3A22%2C%22yeast%22%3A44%7D%5D%2C21%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%2F**%0A%20*%20Module%20dependencies.%0A%20*%2F%0A%0Avar%20Transport%20%3D%20require('..%2Ftransport')%3B%0Avar%20parser%20%3D%20require('engine.io-parser')%3B%0Avar%20parseqs%20%3D%20require('parseqs')%3B%0Avar%20inherit%20%3D%20require('component-inherit')%3B%0Avar%20yeast%20%3D%20require('yeast')%3B%0Avar%20debug%20%3D%20require('debug')('engine.io-client%3Awebsocket')%3B%0Avar%20BrowserWebSocket%20%3D%20global.WebSocket%20%7C%7C%20global.MozWebSocket%3B%0Avar%20NodeWebSocket%3B%0Aif%20(typeof%20window%20%3D%3D%3D%20'undefined')%20%7B%0A%20%20try%20%7B%0A%20%20%20%20NodeWebSocket%20%3D%20require('ws')%3B%0A%20%20%7D%20catch%20(e)%20%7B%20%7D%0A%7D%0A%0A%2F**%0A%20*%20Get%20either%20the%20%60WebSocket%60%20or%20%60MozWebSocket%60%20globals%0A%20*%20in%20the%20browser%20or%20try%20to%20resolve%20WebSocket-compatible%0A%20*%20interface%20exposed%20by%20%60ws%60%20for%20Node-like%20environment.%0A%20*%2F%0A%0Avar%20WebSocket%20%3D%20BrowserWebSocket%3B%0Aif%20(!WebSocket%20%26%26%20typeof%20window%20%3D%3D%3D%20'undefined')%20%7B%0A%20%20WebSocket%20%3D%20NodeWebSocket%3B%0A%7D%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20WS%3B%0A%0A%2F**%0A%20*%20WebSocket%20transport%20constructor.%0A%20*%0A%20*%20%40api%20%7BObject%7D%20connection%20options%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20WS%20(opts)%20%7B%0A%20%20var%20forceBase64%20%3D%20(opts%20%26%26%20opts.forceBase64)%3B%0A%20%20if%20(forceBase64)%20%7B%0A%20%20%20%20this.supportsBinary%20%3D%20false%3B%0A%20%20%7D%0A%20%20this.perMessageDeflate%20%3D%20opts.perMessageDeflate%3B%0A%20%20this.usingBrowserWebSocket%20%3D%20BrowserWebSocket%20%26%26%20!opts.forceNode%3B%0A%20%20this.protocols%20%3D%20opts.protocols%3B%0A%20%20if%20(!this.usingBrowserWebSocket)%20%7B%0A%20%20%20%20WebSocket%20%3D%20NodeWebSocket%3B%0A%20%20%7D%0A%20%20Transport.call(this%2C%20opts)%3B%0A%7D%0A%0A%2F**%0A%20*%20Inherits%20from%20Transport.%0A%20*%2F%0A%0Ainherit(WS%2C%20Transport)%3B%0A%0A%2F**%0A%20*%20Transport%20name.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0AWS.prototype.name%20%3D%20'websocket'%3B%0A%0A%2F*%0A%20*%20WebSockets%20support%20binary%0A%20*%2F%0A%0AWS.prototype.supportsBinary%20%3D%20true%3B%0A%0A%2F**%0A%20*%20Opens%20socket.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AWS.prototype.doOpen%20%3D%20function%20()%20%7B%0A%20%20if%20(!this.check())%20%7B%0A%20%20%20%20%2F%2F%20let%20probe%20timeout%0A%20%20%20%20return%3B%0A%20%20%7D%0A%0A%20%20var%20uri%20%3D%20this.uri()%3B%0A%20%20var%20protocols%20%3D%20this.protocols%3B%0A%20%20var%20opts%20%3D%20%7B%0A%20%20%20%20agent%3A%20this.agent%2C%0A%20%20%20%20perMessageDeflate%3A%20this.perMessageDeflate%0A%20%20%7D%3B%0A%0A%20%20%2F%2F%20SSL%20options%20for%20Node.js%20client%0A%20%20opts.pfx%20%3D%20this.pfx%3B%0A%20%20opts.key%20%3D%20this.key%3B%0A%20%20opts.passphrase%20%3D%20this.passphrase%3B%0A%20%20opts.cert%20%3D%20this.cert%3B%0A%20%20opts.ca%20%3D%20this.ca%3B%0A%20%20opts.ciphers%20%3D%20this.ciphers%3B%0A%20%20opts.rejectUnauthorized%20%3D%20this.rejectUnauthorized%3B%0A%20%20if%20(this.extraHeaders)%20%7B%0A%20%20%20%20opts.headers%20%3D%20this.extraHeaders%3B%0A%20%20%7D%0A%20%20if%20(this.localAddress)%20%7B%0A%20%20%20%20opts.localAddress%20%3D%20this.localAddress%3B%0A%20%20%7D%0A%0A%20%20try%20%7B%0A%20%20%20%20this.ws%20%3D%20this.usingBrowserWebSocket%20%3F%20(protocols%20%3F%20new%20WebSocket(uri%2C%20protocols)%20%3A%20new%20WebSocket(uri))%20%3A%20new%20WebSocket(uri%2C%20protocols%2C%20opts)%3B%0A%20%20%7D%20catch%20(err)%20%7B%0A%20%20%20%20return%20this.emit('error'%2C%20err)%3B%0A%20%20%7D%0A%0A%20%20if%20(this.ws.binaryType%20%3D%3D%3D%20undefined)%20%7B%0A%20%20%20%20this.supportsBinary%20%3D%20false%3B%0A%20%20%7D%0A%0A%20%20if%20(this.ws.supports%20%26%26%20this.ws.supports.binary)%20%7B%0A%20%20%20%20this.supportsBinary%20%3D%20true%3B%0A%20%20%20%20this.ws.binaryType%20%3D%20'nodebuffer'%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20this.ws.binaryType%20%3D%20'arraybuffer'%3B%0A%20%20%7D%0A%0A%20%20this.addEventListeners()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Adds%20event%20listeners%20to%20the%20socket%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AWS.prototype.addEventListeners%20%3D%20function%20()%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%0A%20%20this.ws.onopen%20%3D%20function%20()%20%7B%0A%20%20%20%20self.onOpen()%3B%0A%20%20%7D%3B%0A%20%20this.ws.onclose%20%3D%20function%20()%20%7B%0A%20%20%20%20self.onClose()%3B%0A%20%20%7D%3B%0A%20%20this.ws.onmessage%20%3D%20function%20(ev)%20%7B%0A%20%20%20%20self.onData(ev.data)%3B%0A%20%20%7D%3B%0A%20%20this.ws.onerror%20%3D%20function%20(e)%20%7B%0A%20%20%20%20self.onError('websocket%20error'%2C%20e)%3B%0A%20%20%7D%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Writes%20data%20to%20socket.%0A%20*%0A%20*%20%40param%20%7BArray%7D%20array%20of%20packets.%0A%20*%20%40api%20private%0A%20*%2F%0A%0AWS.prototype.write%20%3D%20function%20(packets)%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20this.writable%20%3D%20false%3B%0A%0A%20%20%2F%2F%20encodePacket%20efficient%20as%20it%20uses%20WS%20framing%0A%20%20%2F%2F%20no%20need%20for%20encodePayload%0A%20%20var%20total%20%3D%20packets.length%3B%0A%20%20for%20(var%20i%20%3D%200%2C%20l%20%3D%20total%3B%20i%20%3C%20l%3B%20i%2B%2B)%20%7B%0A%20%20%20%20(function%20(packet)%20%7B%0A%20%20%20%20%20%20parser.encodePacket(packet%2C%20self.supportsBinary%2C%20function%20(data)%20%7B%0A%20%20%20%20%20%20%20%20if%20(!self.usingBrowserWebSocket)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20always%20create%20a%20new%20object%20(GH-437)%0A%20%20%20%20%20%20%20%20%20%20var%20opts%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20%20%20%20%20if%20(packet.options)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20opts.compress%20%3D%20packet.options.compress%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20if%20(self.perMessageDeflate)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20len%20%3D%20'string'%20%3D%3D%3D%20typeof%20data%20%3F%20global.Buffer.byteLength(data)%20%3A%20data.length%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(len%20%3C%20self.perMessageDeflate.threshold)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20opts.compress%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20Sometimes%20the%20websocket%20has%20already%20been%20closed%20but%20the%20browser%20didn't%0A%20%20%20%20%20%20%20%20%2F%2F%20have%20a%20chance%20of%20informing%20us%20about%20it%20yet%2C%20in%20that%20case%20send%20will%0A%20%20%20%20%20%20%20%20%2F%2F%20throw%20an%20error%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(self.usingBrowserWebSocket)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20TypeError%20is%20thrown%20when%20passing%20the%20second%20argument%20on%20Safari%0A%20%20%20%20%20%20%20%20%20%20%20%20self.ws.send(data)%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20self.ws.send(data%2C%20opts)%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%20%20%20%20%20%20debug('websocket%20closed%20before%20onclose%20event')%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20--total%20%7C%7C%20done()%3B%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D)(packets%5Bi%5D)%3B%0A%20%20%7D%0A%0A%20%20function%20done%20()%20%7B%0A%20%20%20%20self.emit('flush')%3B%0A%0A%20%20%20%20%2F%2F%20fake%20drain%0A%20%20%20%20%2F%2F%20defer%20to%20next%20tick%20to%20allow%20Socket%20to%20clear%20writeBuffer%0A%20%20%20%20setTimeout(function%20()%20%7B%0A%20%20%20%20%20%20self.writable%20%3D%20true%3B%0A%20%20%20%20%20%20self.emit('drain')%3B%0A%20%20%20%20%7D%2C%200)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20close%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AWS.prototype.onClose%20%3D%20function%20()%20%7B%0A%20%20Transport.prototype.onClose.call(this)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Closes%20socket.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AWS.prototype.doClose%20%3D%20function%20()%20%7B%0A%20%20if%20(typeof%20this.ws%20!%3D%3D%20'undefined')%20%7B%0A%20%20%20%20this.ws.close()%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Generates%20uri%20for%20connection.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AWS.prototype.uri%20%3D%20function%20()%20%7B%0A%20%20var%20query%20%3D%20this.query%20%7C%7C%20%7B%7D%3B%0A%20%20var%20schema%20%3D%20this.secure%20%3F%20'wss'%20%3A%20'ws'%3B%0A%20%20var%20port%20%3D%20''%3B%0A%0A%20%20%2F%2F%20avoid%20port%20if%20default%20for%20schema%0A%20%20if%20(this.port%20%26%26%20(('wss'%20%3D%3D%3D%20schema%20%26%26%20Number(this.port)%20!%3D%3D%20443)%20%7C%7C%0A%20%20%20%20('ws'%20%3D%3D%3D%20schema%20%26%26%20Number(this.port)%20!%3D%3D%2080)))%20%7B%0A%20%20%20%20port%20%3D%20'%3A'%20%2B%20this.port%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20append%20timestamp%20to%20URI%0A%20%20if%20(this.timestampRequests)%20%7B%0A%20%20%20%20query%5Bthis.timestampParam%5D%20%3D%20yeast()%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20communicate%20binary%20support%20capabilities%0A%20%20if%20(!this.supportsBinary)%20%7B%0A%20%20%20%20query.b64%20%3D%201%3B%0A%20%20%7D%0A%0A%20%20query%20%3D%20parseqs.encode(query)%3B%0A%0A%20%20%2F%2F%20prepend%20%3F%20to%20query%0A%20%20if%20(query.length)%20%7B%0A%20%20%20%20query%20%3D%20'%3F'%20%2B%20query%3B%0A%20%20%7D%0A%0A%20%20var%20ipv6%20%3D%20this.hostname.indexOf('%3A')%20!%3D%3D%20-1%3B%0A%20%20return%20schema%20%2B%20'%3A%2F%2F'%20%2B%20(ipv6%20%3F%20'%5B'%20%2B%20this.hostname%20%2B%20'%5D'%20%3A%20this.hostname)%20%2B%20port%20%2B%20this.path%20%2B%20query%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Feature%20detection%20for%20WebSocket.%0A%20*%0A%20*%20%40return%20%7BBoolean%7D%20whether%20this%20transport%20is%20available.%0A%20*%20%40api%20public%0A%20*%2F%0A%0AWS.prototype.check%20%3D%20function%20()%20%7B%0A%20%20return%20!!WebSocket%20%26%26%20!('__initialize'%20in%20WebSocket%20%26%26%20this.name%20%3D%3D%3D%20WS.prototype.name)%3B%0A%7D%3B%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%22..%2Ftransport%22%3A16%2C%22component-inherit%22%3A11%2C%22debug%22%3A12%2C%22engine.io-parser%22%3A23%2C%22parseqs%22%3A32%2C%22ws%22%3A7%2C%22yeast%22%3A44%7D%5D%2C22%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%2F%2F%20browser%20shim%20for%20xmlhttprequest%20module%0A%0Avar%20hasCORS%20%3D%20require('has-cors')%3B%0A%0Amodule.exports%20%3D%20function%20(opts)%20%7B%0A%20%20var%20xdomain%20%3D%20opts.xdomain%3B%0A%0A%20%20%2F%2F%20scheme%20must%20be%20same%20when%20usign%20XDomainRequest%0A%20%20%2F%2F%20http%3A%2F%2Fblogs.msdn.com%2Fb%2Fieinternals%2Farchive%2F2010%2F05%2F13%2Fxdomainrequest-restrictions-limitations-and-workarounds.aspx%0A%20%20var%20xscheme%20%3D%20opts.xscheme%3B%0A%0A%20%20%2F%2F%20XDomainRequest%20has%20a%20flow%20of%20not%20sending%20cookie%2C%20therefore%20it%20should%20be%20disabled%20as%20a%20default.%0A%20%20%2F%2F%20https%3A%2F%2Fgithub.com%2FAutomattic%2Fengine.io-client%2Fpull%2F217%0A%20%20var%20enablesXDR%20%3D%20opts.enablesXDR%3B%0A%0A%20%20%2F%2F%20XMLHttpRequest%20can%20be%20disabled%20on%20IE%0A%20%20try%20%7B%0A%20%20%20%20if%20('undefined'%20!%3D%3D%20typeof%20XMLHttpRequest%20%26%26%20(!xdomain%20%7C%7C%20hasCORS))%20%7B%0A%20%20%20%20%20%20return%20new%20XMLHttpRequest()%3B%0A%20%20%20%20%7D%0A%20%20%7D%20catch%20(e)%20%7B%20%7D%0A%0A%20%20%2F%2F%20Use%20XDomainRequest%20for%20IE8%20if%20enablesXDR%20is%20true%0A%20%20%2F%2F%20because%20loading%20bar%20keeps%20flashing%20when%20using%20jsonp-polling%0A%20%20%2F%2F%20https%3A%2F%2Fgithub.com%2Fyujiosaka%2Fsocke.io-ie8-loading-example%0A%20%20try%20%7B%0A%20%20%20%20if%20('undefined'%20!%3D%3D%20typeof%20XDomainRequest%20%26%26%20!xscheme%20%26%26%20enablesXDR)%20%7B%0A%20%20%20%20%20%20return%20new%20XDomainRequest()%3B%0A%20%20%20%20%7D%0A%20%20%7D%20catch%20(e)%20%7B%20%7D%0A%0A%20%20if%20(!xdomain)%20%7B%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20return%20new%20global%5B%5B'Active'%5D.concat('Object').join('X')%5D('Microsoft.XMLHTTP')%3B%0A%20%20%20%20%7D%20catch%20(e)%20%7B%20%7D%0A%20%20%7D%0A%7D%3B%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%22has-cors%22%3A27%7D%5D%2C23%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%2F**%0A%20*%20Module%20dependencies.%0A%20*%2F%0A%0Avar%20keys%20%3D%20require('.%2Fkeys')%3B%0Avar%20hasBinary%20%3D%20require('has-binary2')%3B%0Avar%20sliceBuffer%20%3D%20require('arraybuffer.slice')%3B%0Avar%20after%20%3D%20require('after')%3B%0Avar%20utf8%20%3D%20require('.%2Futf8')%3B%0A%0Avar%20base64encoder%3B%0Aif%20(global%20%26%26%20global.ArrayBuffer)%20%7B%0A%20%20base64encoder%20%3D%20require('base64-arraybuffer')%3B%0A%7D%0A%0A%2F**%0A%20*%20Check%20if%20we%20are%20running%20an%20android%20browser.%20That%20requires%20us%20to%20use%0A%20*%20ArrayBuffer%20with%20polling%20transports...%0A%20*%0A%20*%20http%3A%2F%2Fghinda.net%2Fjpeg-blob-ajax-android%2F%0A%20*%2F%0A%0Avar%20isAndroid%20%3D%20typeof%20navigator%20!%3D%3D%20'undefined'%20%26%26%20%2FAndroid%2Fi.test(navigator.userAgent)%3B%0A%0A%2F**%0A%20*%20Check%20if%20we%20are%20running%20in%20PhantomJS.%0A%20*%20Uploading%20a%20Blob%20with%20PhantomJS%20does%20not%20work%20correctly%2C%20as%20reported%20here%3A%0A%20*%20https%3A%2F%2Fgithub.com%2Fariya%2Fphantomjs%2Fissues%2F11395%0A%20*%20%40type%20boolean%0A%20*%2F%0Avar%20isPhantomJS%20%3D%20typeof%20navigator%20!%3D%3D%20'undefined'%20%26%26%20%2FPhantomJS%2Fi.test(navigator.userAgent)%3B%0A%0A%2F**%0A%20*%20When%20true%2C%20avoids%20using%20Blobs%20to%20encode%20payloads.%0A%20*%20%40type%20boolean%0A%20*%2F%0Avar%20dontSendBlobs%20%3D%20isAndroid%20%7C%7C%20isPhantomJS%3B%0A%0A%2F**%0A%20*%20Current%20protocol%20version.%0A%20*%2F%0A%0Aexports.protocol%20%3D%203%3B%0A%0A%2F**%0A%20*%20Packet%20types.%0A%20*%2F%0A%0Avar%20packets%20%3D%20exports.packets%20%3D%20%7B%0A%20%20%20%20open%3A%20%20%20%20%200%20%20%20%20%2F%2F%20non-ws%0A%20%20%2C%20close%3A%20%20%20%201%20%20%20%20%2F%2F%20non-ws%0A%20%20%2C%20ping%3A%20%20%20%20%202%0A%20%20%2C%20pong%3A%20%20%20%20%203%0A%20%20%2C%20message%3A%20%204%0A%20%20%2C%20upgrade%3A%20%205%0A%20%20%2C%20noop%3A%20%20%20%20%206%0A%7D%3B%0A%0Avar%20packetslist%20%3D%20keys(packets)%3B%0A%0A%2F**%0A%20*%20Premade%20error%20packet.%0A%20*%2F%0A%0Avar%20err%20%3D%20%7B%20type%3A%20'error'%2C%20data%3A%20'parser%20error'%20%7D%3B%0A%0A%2F**%0A%20*%20Create%20a%20blob%20api%20even%20for%20blob%20builder%20when%20vendor%20prefixes%20exist%0A%20*%2F%0A%0Avar%20Blob%20%3D%20require('blob')%3B%0A%0A%2F**%0A%20*%20Encodes%20a%20packet.%0A%20*%0A%20*%20%20%20%20%20%3Cpacket%20type%20id%3E%20%5B%20%3Cdata%3E%20%5D%0A%20*%0A%20*%20Example%3A%0A%20*%0A%20*%20%20%20%20%205hello%20world%0A%20*%20%20%20%20%203%0A%20*%20%20%20%20%204%0A%20*%0A%20*%20Binary%20is%20encoded%20in%20an%20identical%20principle%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0Aexports.encodePacket%20%3D%20function%20(packet%2C%20supportsBinary%2C%20utf8encode%2C%20callback)%20%7B%0A%20%20if%20(typeof%20supportsBinary%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20callback%20%3D%20supportsBinary%3B%0A%20%20%20%20supportsBinary%20%3D%20false%3B%0A%20%20%7D%0A%0A%20%20if%20(typeof%20utf8encode%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20callback%20%3D%20utf8encode%3B%0A%20%20%20%20utf8encode%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20var%20data%20%3D%20(packet.data%20%3D%3D%3D%20undefined)%0A%20%20%20%20%3F%20undefined%0A%20%20%20%20%3A%20packet.data.buffer%20%7C%7C%20packet.data%3B%0A%0A%20%20if%20(global.ArrayBuffer%20%26%26%20data%20instanceof%20ArrayBuffer)%20%7B%0A%20%20%20%20return%20encodeArrayBuffer(packet%2C%20supportsBinary%2C%20callback)%3B%0A%20%20%7D%20else%20if%20(Blob%20%26%26%20data%20instanceof%20global.Blob)%20%7B%0A%20%20%20%20return%20encodeBlob(packet%2C%20supportsBinary%2C%20callback)%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20might%20be%20an%20object%20with%20%7B%20base64%3A%20true%2C%20data%3A%20dataAsBase64String%20%7D%0A%20%20if%20(data%20%26%26%20data.base64)%20%7B%0A%20%20%20%20return%20encodeBase64Object(packet%2C%20callback)%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20Sending%20data%20as%20a%20utf-8%20string%0A%20%20var%20encoded%20%3D%20packets%5Bpacket.type%5D%3B%0A%0A%20%20%2F%2F%20data%20fragment%20is%20optional%0A%20%20if%20(undefined%20!%3D%3D%20packet.data)%20%7B%0A%20%20%20%20encoded%20%2B%3D%20utf8encode%20%3F%20utf8.encode(String(packet.data)%2C%20%7B%20strict%3A%20false%20%7D)%20%3A%20String(packet.data)%3B%0A%20%20%7D%0A%0A%20%20return%20callback(''%20%2B%20encoded)%3B%0A%0A%7D%3B%0A%0Afunction%20encodeBase64Object(packet%2C%20callback)%20%7B%0A%20%20%2F%2F%20packet%20data%20is%20an%20object%20%7B%20base64%3A%20true%2C%20data%3A%20dataAsBase64String%20%7D%0A%20%20var%20message%20%3D%20'b'%20%2B%20exports.packets%5Bpacket.type%5D%20%2B%20packet.data.data%3B%0A%20%20return%20callback(message)%3B%0A%7D%0A%0A%2F**%0A%20*%20Encode%20packet%20helpers%20for%20binary%20types%0A%20*%2F%0A%0Afunction%20encodeArrayBuffer(packet%2C%20supportsBinary%2C%20callback)%20%7B%0A%20%20if%20(!supportsBinary)%20%7B%0A%20%20%20%20return%20exports.encodeBase64Packet(packet%2C%20callback)%3B%0A%20%20%7D%0A%0A%20%20var%20data%20%3D%20packet.data%3B%0A%20%20var%20contentArray%20%3D%20new%20Uint8Array(data)%3B%0A%20%20var%20resultBuffer%20%3D%20new%20Uint8Array(1%20%2B%20data.byteLength)%3B%0A%0A%20%20resultBuffer%5B0%5D%20%3D%20packets%5Bpacket.type%5D%3B%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20contentArray.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20resultBuffer%5Bi%2B1%5D%20%3D%20contentArray%5Bi%5D%3B%0A%20%20%7D%0A%0A%20%20return%20callback(resultBuffer.buffer)%3B%0A%7D%0A%0Afunction%20encodeBlobAsArrayBuffer(packet%2C%20supportsBinary%2C%20callback)%20%7B%0A%20%20if%20(!supportsBinary)%20%7B%0A%20%20%20%20return%20exports.encodeBase64Packet(packet%2C%20callback)%3B%0A%20%20%7D%0A%0A%20%20var%20fr%20%3D%20new%20FileReader()%3B%0A%20%20fr.onload%20%3D%20function()%20%7B%0A%20%20%20%20packet.data%20%3D%20fr.result%3B%0A%20%20%20%20exports.encodePacket(packet%2C%20supportsBinary%2C%20true%2C%20callback)%3B%0A%20%20%7D%3B%0A%20%20return%20fr.readAsArrayBuffer(packet.data)%3B%0A%7D%0A%0Afunction%20encodeBlob(packet%2C%20supportsBinary%2C%20callback)%20%7B%0A%20%20if%20(!supportsBinary)%20%7B%0A%20%20%20%20return%20exports.encodeBase64Packet(packet%2C%20callback)%3B%0A%20%20%7D%0A%0A%20%20if%20(dontSendBlobs)%20%7B%0A%20%20%20%20return%20encodeBlobAsArrayBuffer(packet%2C%20supportsBinary%2C%20callback)%3B%0A%20%20%7D%0A%0A%20%20var%20length%20%3D%20new%20Uint8Array(1)%3B%0A%20%20length%5B0%5D%20%3D%20packets%5Bpacket.type%5D%3B%0A%20%20var%20blob%20%3D%20new%20Blob(%5Blength.buffer%2C%20packet.data%5D)%3B%0A%0A%20%20return%20callback(blob)%3B%0A%7D%0A%0A%2F**%0A%20*%20Encodes%20a%20packet%20with%20binary%20data%20in%20a%20base64%20string%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%2C%20has%20%60type%60%20and%20%60data%60%0A%20*%20%40return%20%7BString%7D%20base64%20encoded%20message%0A%20*%2F%0A%0Aexports.encodeBase64Packet%20%3D%20function(packet%2C%20callback)%20%7B%0A%20%20var%20message%20%3D%20'b'%20%2B%20exports.packets%5Bpacket.type%5D%3B%0A%20%20if%20(Blob%20%26%26%20packet.data%20instanceof%20global.Blob)%20%7B%0A%20%20%20%20var%20fr%20%3D%20new%20FileReader()%3B%0A%20%20%20%20fr.onload%20%3D%20function()%20%7B%0A%20%20%20%20%20%20var%20b64%20%3D%20fr.result.split('%2C')%5B1%5D%3B%0A%20%20%20%20%20%20callback(message%20%2B%20b64)%3B%0A%20%20%20%20%7D%3B%0A%20%20%20%20return%20fr.readAsDataURL(packet.data)%3B%0A%20%20%7D%0A%0A%20%20var%20b64data%3B%0A%20%20try%20%7B%0A%20%20%20%20b64data%20%3D%20String.fromCharCode.apply(null%2C%20new%20Uint8Array(packet.data))%3B%0A%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%2F%2F%20iPhone%20Safari%20doesn't%20let%20you%20apply%20with%20typed%20arrays%0A%20%20%20%20var%20typed%20%3D%20new%20Uint8Array(packet.data)%3B%0A%20%20%20%20var%20basic%20%3D%20new%20Array(typed.length)%3B%0A%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20typed.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20basic%5Bi%5D%20%3D%20typed%5Bi%5D%3B%0A%20%20%20%20%7D%0A%20%20%20%20b64data%20%3D%20String.fromCharCode.apply(null%2C%20basic)%3B%0A%20%20%7D%0A%20%20message%20%2B%3D%20global.btoa(b64data)%3B%0A%20%20return%20callback(message)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Decodes%20a%20packet.%20Changes%20format%20to%20Blob%20if%20requested.%0A%20*%0A%20*%20%40return%20%7BObject%7D%20with%20%60type%60%20and%20%60data%60%20(if%20any)%0A%20*%20%40api%20private%0A%20*%2F%0A%0Aexports.decodePacket%20%3D%20function%20(data%2C%20binaryType%2C%20utf8decode)%20%7B%0A%20%20if%20(data%20%3D%3D%3D%20undefined)%20%7B%0A%20%20%20%20return%20err%3B%0A%20%20%7D%0A%20%20%2F%2F%20String%20data%0A%20%20if%20(typeof%20data%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20if%20(data.charAt(0)%20%3D%3D%3D%20'b')%20%7B%0A%20%20%20%20%20%20return%20exports.decodeBase64Packet(data.substr(1)%2C%20binaryType)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(utf8decode)%20%7B%0A%20%20%20%20%20%20data%20%3D%20tryDecode(data)%3B%0A%20%20%20%20%20%20if%20(data%20%3D%3D%3D%20false)%20%7B%0A%20%20%20%20%20%20%20%20return%20err%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20var%20type%20%3D%20data.charAt(0)%3B%0A%0A%20%20%20%20if%20(Number(type)%20!%3D%20type%20%7C%7C%20!packetslist%5Btype%5D)%20%7B%0A%20%20%20%20%20%20return%20err%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(data.length%20%3E%201)%20%7B%0A%20%20%20%20%20%20return%20%7B%20type%3A%20packetslist%5Btype%5D%2C%20data%3A%20data.substring(1)%20%7D%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20return%20%7B%20type%3A%20packetslist%5Btype%5D%20%7D%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20var%20asArray%20%3D%20new%20Uint8Array(data)%3B%0A%20%20var%20type%20%3D%20asArray%5B0%5D%3B%0A%20%20var%20rest%20%3D%20sliceBuffer(data%2C%201)%3B%0A%20%20if%20(Blob%20%26%26%20binaryType%20%3D%3D%3D%20'blob')%20%7B%0A%20%20%20%20rest%20%3D%20new%20Blob(%5Brest%5D)%3B%0A%20%20%7D%0A%20%20return%20%7B%20type%3A%20packetslist%5Btype%5D%2C%20data%3A%20rest%20%7D%3B%0A%7D%3B%0A%0Afunction%20tryDecode(data)%20%7B%0A%20%20try%20%7B%0A%20%20%20%20data%20%3D%20utf8.decode(data%2C%20%7B%20strict%3A%20false%20%7D)%3B%0A%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%20%20return%20data%3B%0A%7D%0A%0A%2F**%0A%20*%20Decodes%20a%20packet%20encoded%20in%20a%20base64%20string%0A%20*%0A%20*%20%40param%20%7BString%7D%20base64%20encoded%20message%0A%20*%20%40return%20%7BObject%7D%20with%20%60type%60%20and%20%60data%60%20(if%20any)%0A%20*%2F%0A%0Aexports.decodeBase64Packet%20%3D%20function(msg%2C%20binaryType)%20%7B%0A%20%20var%20type%20%3D%20packetslist%5Bmsg.charAt(0)%5D%3B%0A%20%20if%20(!base64encoder)%20%7B%0A%20%20%20%20return%20%7B%20type%3A%20type%2C%20data%3A%20%7B%20base64%3A%20true%2C%20data%3A%20msg.substr(1)%20%7D%20%7D%3B%0A%20%20%7D%0A%0A%20%20var%20data%20%3D%20base64encoder.decode(msg.substr(1))%3B%0A%0A%20%20if%20(binaryType%20%3D%3D%3D%20'blob'%20%26%26%20Blob)%20%7B%0A%20%20%20%20data%20%3D%20new%20Blob(%5Bdata%5D)%3B%0A%20%20%7D%0A%0A%20%20return%20%7B%20type%3A%20type%2C%20data%3A%20data%20%7D%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Encodes%20multiple%20messages%20(payload).%0A%20*%0A%20*%20%20%20%20%20%3Clength%3E%3Adata%0A%20*%0A%20*%20Example%3A%0A%20*%0A%20*%20%20%20%20%2011%3Ahello%20world2%3Ahi%0A%20*%0A%20*%20If%20any%20contents%20are%20binary%2C%20they%20will%20be%20encoded%20as%20base64%20strings.%20Base64%0A%20*%20encoded%20strings%20are%20marked%20with%20a%20b%20before%20the%20length%20specifier%0A%20*%0A%20*%20%40param%20%7BArray%7D%20packets%0A%20*%20%40api%20private%0A%20*%2F%0A%0Aexports.encodePayload%20%3D%20function%20(packets%2C%20supportsBinary%2C%20callback)%20%7B%0A%20%20if%20(typeof%20supportsBinary%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20callback%20%3D%20supportsBinary%3B%0A%20%20%20%20supportsBinary%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20var%20isBinary%20%3D%20hasBinary(packets)%3B%0A%0A%20%20if%20(supportsBinary%20%26%26%20isBinary)%20%7B%0A%20%20%20%20if%20(Blob%20%26%26%20!dontSendBlobs)%20%7B%0A%20%20%20%20%20%20return%20exports.encodePayloadAsBlob(packets%2C%20callback)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20return%20exports.encodePayloadAsArrayBuffer(packets%2C%20callback)%3B%0A%20%20%7D%0A%0A%20%20if%20(!packets.length)%20%7B%0A%20%20%20%20return%20callback('0%3A')%3B%0A%20%20%7D%0A%0A%20%20function%20setLengthHeader(message)%20%7B%0A%20%20%20%20return%20message.length%20%2B%20'%3A'%20%2B%20message%3B%0A%20%20%7D%0A%0A%20%20function%20encodeOne(packet%2C%20doneCallback)%20%7B%0A%20%20%20%20exports.encodePacket(packet%2C%20!isBinary%20%3F%20false%20%3A%20supportsBinary%2C%20false%2C%20function(message)%20%7B%0A%20%20%20%20%20%20doneCallback(null%2C%20setLengthHeader(message))%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20map(packets%2C%20encodeOne%2C%20function(err%2C%20results)%20%7B%0A%20%20%20%20return%20callback(results.join(''))%3B%0A%20%20%7D)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Async%20array%20map%20using%20after%0A%20*%2F%0A%0Afunction%20map(ary%2C%20each%2C%20done)%20%7B%0A%20%20var%20result%20%3D%20new%20Array(ary.length)%3B%0A%20%20var%20next%20%3D%20after(ary.length%2C%20done)%3B%0A%0A%20%20var%20eachWithIndex%20%3D%20function(i%2C%20el%2C%20cb)%20%7B%0A%20%20%20%20each(el%2C%20function(error%2C%20msg)%20%7B%0A%20%20%20%20%20%20result%5Bi%5D%20%3D%20msg%3B%0A%20%20%20%20%20%20cb(error%2C%20result)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%3B%0A%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20ary.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20eachWithIndex(i%2C%20ary%5Bi%5D%2C%20next)%3B%0A%20%20%7D%0A%7D%0A%0A%2F*%0A%20*%20Decodes%20data%20when%20a%20payload%20is%20maybe%20expected.%20Possible%20binary%20contents%20are%0A%20*%20decoded%20from%20their%20base64%20representation%0A%20*%0A%20*%20%40param%20%7BString%7D%20data%2C%20callback%20method%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.decodePayload%20%3D%20function%20(data%2C%20binaryType%2C%20callback)%20%7B%0A%20%20if%20(typeof%20data%20!%3D%3D%20'string')%20%7B%0A%20%20%20%20return%20exports.decodePayloadAsBinary(data%2C%20binaryType%2C%20callback)%3B%0A%20%20%7D%0A%0A%20%20if%20(typeof%20binaryType%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20callback%20%3D%20binaryType%3B%0A%20%20%20%20binaryType%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20var%20packet%3B%0A%20%20if%20(data%20%3D%3D%3D%20'')%20%7B%0A%20%20%20%20%2F%2F%20parser%20error%20-%20ignoring%20payload%0A%20%20%20%20return%20callback(err%2C%200%2C%201)%3B%0A%20%20%7D%0A%0A%20%20var%20length%20%3D%20''%2C%20n%2C%20msg%3B%0A%0A%20%20for%20(var%20i%20%3D%200%2C%20l%20%3D%20data.length%3B%20i%20%3C%20l%3B%20i%2B%2B)%20%7B%0A%20%20%20%20var%20chr%20%3D%20data.charAt(i)%3B%0A%0A%20%20%20%20if%20(chr%20!%3D%3D%20'%3A')%20%7B%0A%20%20%20%20%20%20length%20%2B%3D%20chr%3B%0A%20%20%20%20%20%20continue%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(length%20%3D%3D%3D%20''%20%7C%7C%20(length%20!%3D%20(n%20%3D%20Number(length))))%20%7B%0A%20%20%20%20%20%20%2F%2F%20parser%20error%20-%20ignoring%20payload%0A%20%20%20%20%20%20return%20callback(err%2C%200%2C%201)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20msg%20%3D%20data.substr(i%20%2B%201%2C%20n)%3B%0A%0A%20%20%20%20if%20(length%20!%3D%20msg.length)%20%7B%0A%20%20%20%20%20%20%2F%2F%20parser%20error%20-%20ignoring%20payload%0A%20%20%20%20%20%20return%20callback(err%2C%200%2C%201)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(msg.length)%20%7B%0A%20%20%20%20%20%20packet%20%3D%20exports.decodePacket(msg%2C%20binaryType%2C%20false)%3B%0A%0A%20%20%20%20%20%20if%20(err.type%20%3D%3D%3D%20packet.type%20%26%26%20err.data%20%3D%3D%3D%20packet.data)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20parser%20error%20in%20individual%20packet%20-%20ignoring%20payload%0A%20%20%20%20%20%20%20%20return%20callback(err%2C%200%2C%201)%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20var%20ret%20%3D%20callback(packet%2C%20i%20%2B%20n%2C%20l)%3B%0A%20%20%20%20%20%20if%20(false%20%3D%3D%3D%20ret)%20return%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20advance%20cursor%0A%20%20%20%20i%20%2B%3D%20n%3B%0A%20%20%20%20length%20%3D%20''%3B%0A%20%20%7D%0A%0A%20%20if%20(length%20!%3D%3D%20'')%20%7B%0A%20%20%20%20%2F%2F%20parser%20error%20-%20ignoring%20payload%0A%20%20%20%20return%20callback(err%2C%200%2C%201)%3B%0A%20%20%7D%0A%0A%7D%3B%0A%0A%2F**%0A%20*%20Encodes%20multiple%20messages%20(payload)%20as%20binary.%0A%20*%0A%20*%20%3C1%20%3D%20binary%2C%200%20%3D%20string%3E%3Cnumber%20from%200-9%3E%3Cnumber%20from%200-9%3E%5B...%5D%3Cnumber%0A%20*%20255%3E%3Cdata%3E%0A%20*%0A%20*%20Example%3A%0A%20*%201%203%20255%201%202%203%2C%20if%20the%20binary%20contents%20are%20interpreted%20as%208%20bit%20integers%0A%20*%0A%20*%20%40param%20%7BArray%7D%20packets%0A%20*%20%40return%20%7BArrayBuffer%7D%20encoded%20payload%0A%20*%20%40api%20private%0A%20*%2F%0A%0Aexports.encodePayloadAsArrayBuffer%20%3D%20function(packets%2C%20callback)%20%7B%0A%20%20if%20(!packets.length)%20%7B%0A%20%20%20%20return%20callback(new%20ArrayBuffer(0))%3B%0A%20%20%7D%0A%0A%20%20function%20encodeOne(packet%2C%20doneCallback)%20%7B%0A%20%20%20%20exports.encodePacket(packet%2C%20true%2C%20true%2C%20function(data)%20%7B%0A%20%20%20%20%20%20return%20doneCallback(null%2C%20data)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20map(packets%2C%20encodeOne%2C%20function(err%2C%20encodedPackets)%20%7B%0A%20%20%20%20var%20totalLength%20%3D%20encodedPackets.reduce(function(acc%2C%20p)%20%7B%0A%20%20%20%20%20%20var%20len%3B%0A%20%20%20%20%20%20if%20(typeof%20p%20%3D%3D%3D%20'string')%7B%0A%20%20%20%20%20%20%20%20len%20%3D%20p.length%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20len%20%3D%20p.byteLength%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20acc%20%2B%20len.toString().length%20%2B%20len%20%2B%202%3B%20%2F%2F%20string%2Fbinary%20identifier%20%2B%20separator%20%3D%202%0A%20%20%20%20%7D%2C%200)%3B%0A%0A%20%20%20%20var%20resultArray%20%3D%20new%20Uint8Array(totalLength)%3B%0A%0A%20%20%20%20var%20bufferIndex%20%3D%200%3B%0A%20%20%20%20encodedPackets.forEach(function(p)%20%7B%0A%20%20%20%20%20%20var%20isString%20%3D%20typeof%20p%20%3D%3D%3D%20'string'%3B%0A%20%20%20%20%20%20var%20ab%20%3D%20p%3B%0A%20%20%20%20%20%20if%20(isString)%20%7B%0A%20%20%20%20%20%20%20%20var%20view%20%3D%20new%20Uint8Array(p.length)%3B%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20p.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20view%5Bi%5D%20%3D%20p.charCodeAt(i)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20ab%20%3D%20view.buffer%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20(isString)%20%7B%20%2F%2F%20not%20true%20binary%0A%20%20%20%20%20%20%20%20resultArray%5BbufferIndex%2B%2B%5D%20%3D%200%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%20%2F%2F%20true%20binary%0A%20%20%20%20%20%20%20%20resultArray%5BbufferIndex%2B%2B%5D%20%3D%201%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20var%20lenStr%20%3D%20ab.byteLength.toString()%3B%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20lenStr.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20resultArray%5BbufferIndex%2B%2B%5D%20%3D%20parseInt(lenStr%5Bi%5D)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20resultArray%5BbufferIndex%2B%2B%5D%20%3D%20255%3B%0A%0A%20%20%20%20%20%20var%20view%20%3D%20new%20Uint8Array(ab)%3B%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20view.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20resultArray%5BbufferIndex%2B%2B%5D%20%3D%20view%5Bi%5D%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20return%20callback(resultArray.buffer)%3B%0A%20%20%7D)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Encode%20as%20Blob%0A%20*%2F%0A%0Aexports.encodePayloadAsBlob%20%3D%20function(packets%2C%20callback)%20%7B%0A%20%20function%20encodeOne(packet%2C%20doneCallback)%20%7B%0A%20%20%20%20exports.encodePacket(packet%2C%20true%2C%20true%2C%20function(encoded)%20%7B%0A%20%20%20%20%20%20var%20binaryIdentifier%20%3D%20new%20Uint8Array(1)%3B%0A%20%20%20%20%20%20binaryIdentifier%5B0%5D%20%3D%201%3B%0A%20%20%20%20%20%20if%20(typeof%20encoded%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20%20%20%20%20var%20view%20%3D%20new%20Uint8Array(encoded.length)%3B%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20encoded.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20view%5Bi%5D%20%3D%20encoded.charCodeAt(i)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20encoded%20%3D%20view.buffer%3B%0A%20%20%20%20%20%20%20%20binaryIdentifier%5B0%5D%20%3D%200%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20var%20len%20%3D%20(encoded%20instanceof%20ArrayBuffer)%0A%20%20%20%20%20%20%20%20%3F%20encoded.byteLength%0A%20%20%20%20%20%20%20%20%3A%20encoded.size%3B%0A%0A%20%20%20%20%20%20var%20lenStr%20%3D%20len.toString()%3B%0A%20%20%20%20%20%20var%20lengthAry%20%3D%20new%20Uint8Array(lenStr.length%20%2B%201)%3B%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20lenStr.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20lengthAry%5Bi%5D%20%3D%20parseInt(lenStr%5Bi%5D)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20lengthAry%5BlenStr.length%5D%20%3D%20255%3B%0A%0A%20%20%20%20%20%20if%20(Blob)%20%7B%0A%20%20%20%20%20%20%20%20var%20blob%20%3D%20new%20Blob(%5BbinaryIdentifier.buffer%2C%20lengthAry.buffer%2C%20encoded%5D)%3B%0A%20%20%20%20%20%20%20%20doneCallback(null%2C%20blob)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20map(packets%2C%20encodeOne%2C%20function(err%2C%20results)%20%7B%0A%20%20%20%20return%20callback(new%20Blob(results))%3B%0A%20%20%7D)%3B%0A%7D%3B%0A%0A%2F*%0A%20*%20Decodes%20data%20when%20a%20payload%20is%20maybe%20expected.%20Strings%20are%20decoded%20by%0A%20*%20interpreting%20each%20byte%20as%20a%20key%20code%20for%20entries%20marked%20to%20start%20with%200.%20See%0A%20*%20description%20of%20encodePayloadAsBinary%0A%20*%0A%20*%20%40param%20%7BArrayBuffer%7D%20data%2C%20callback%20method%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.decodePayloadAsBinary%20%3D%20function%20(data%2C%20binaryType%2C%20callback)%20%7B%0A%20%20if%20(typeof%20binaryType%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20callback%20%3D%20binaryType%3B%0A%20%20%20%20binaryType%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20var%20bufferTail%20%3D%20data%3B%0A%20%20var%20buffers%20%3D%20%5B%5D%3B%0A%0A%20%20while%20(bufferTail.byteLength%20%3E%200)%20%7B%0A%20%20%20%20var%20tailArray%20%3D%20new%20Uint8Array(bufferTail)%3B%0A%20%20%20%20var%20isString%20%3D%20tailArray%5B0%5D%20%3D%3D%3D%200%3B%0A%20%20%20%20var%20msgLength%20%3D%20''%3B%0A%0A%20%20%20%20for%20(var%20i%20%3D%201%3B%20%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20if%20(tailArray%5Bi%5D%20%3D%3D%3D%20255)%20break%3B%0A%0A%20%20%20%20%20%20%2F%2F%20310%20%3D%20char%20length%20of%20Number.MAX_VALUE%0A%20%20%20%20%20%20if%20(msgLength.length%20%3E%20310)%20%7B%0A%20%20%20%20%20%20%20%20return%20callback(err%2C%200%2C%201)%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20msgLength%20%2B%3D%20tailArray%5Bi%5D%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20bufferTail%20%3D%20sliceBuffer(bufferTail%2C%202%20%2B%20msgLength.length)%3B%0A%20%20%20%20msgLength%20%3D%20parseInt(msgLength)%3B%0A%0A%20%20%20%20var%20msg%20%3D%20sliceBuffer(bufferTail%2C%200%2C%20msgLength)%3B%0A%20%20%20%20if%20(isString)%20%7B%0A%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20msg%20%3D%20String.fromCharCode.apply(null%2C%20new%20Uint8Array(msg))%3B%0A%20%20%20%20%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20iPhone%20Safari%20doesn't%20let%20you%20apply%20to%20typed%20arrays%0A%20%20%20%20%20%20%20%20var%20typed%20%3D%20new%20Uint8Array(msg)%3B%0A%20%20%20%20%20%20%20%20msg%20%3D%20''%3B%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20typed.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20msg%20%2B%3D%20String.fromCharCode(typed%5Bi%5D)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20buffers.push(msg)%3B%0A%20%20%20%20bufferTail%20%3D%20sliceBuffer(bufferTail%2C%20msgLength)%3B%0A%20%20%7D%0A%0A%20%20var%20total%20%3D%20buffers.length%3B%0A%20%20buffers.forEach(function(buffer%2C%20i)%20%7B%0A%20%20%20%20callback(exports.decodePacket(buffer%2C%20binaryType%2C%20true)%2C%20i%2C%20total)%3B%0A%20%20%7D)%3B%0A%7D%3B%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%22.%2Fkeys%22%3A24%2C%22.%2Futf8%22%3A25%2C%22after%22%3A1%2C%22arraybuffer.slice%22%3A2%2C%22base64-arraybuffer%22%3A4%2C%22blob%22%3A6%2C%22has-binary2%22%3A26%7D%5D%2C24%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0A%2F**%0A%20*%20Gets%20the%20keys%20for%20an%20object.%0A%20*%0A%20*%20%40return%20%7BArray%7D%20keys%0A%20*%20%40api%20private%0A%20*%2F%0A%0Amodule.exports%20%3D%20Object.keys%20%7C%7C%20function%20keys%20(obj)%7B%0A%20%20var%20arr%20%3D%20%5B%5D%3B%0A%20%20var%20has%20%3D%20Object.prototype.hasOwnProperty%3B%0A%0A%20%20for%20(var%20i%20in%20obj)%20%7B%0A%20%20%20%20if%20(has.call(obj%2C%20i))%20%7B%0A%20%20%20%20%20%20arr.push(i)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20return%20arr%3B%0A%7D%3B%0A%0A%7D%2C%7B%7D%5D%2C25%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%2F*!%20https%3A%2F%2Fmths.be%2Futf8js%20v2.1.2%20by%20%40mathias%20*%2F%0A%3B(function(root)%20%7B%0A%0A%09%2F%2F%20Detect%20free%20variables%20%60exports%60%0A%09var%20freeExports%20%3D%20typeof%20exports%20%3D%3D%20'object'%20%26%26%20exports%3B%0A%0A%09%2F%2F%20Detect%20free%20variable%20%60module%60%0A%09var%20freeModule%20%3D%20typeof%20module%20%3D%3D%20'object'%20%26%26%20module%20%26%26%0A%09%09module.exports%20%3D%3D%20freeExports%20%26%26%20module%3B%0A%0A%09%2F%2F%20Detect%20free%20variable%20%60global%60%2C%20from%20Node.js%20or%20Browserified%20code%2C%0A%09%2F%2F%20and%20use%20it%20as%20%60root%60%0A%09var%20freeGlobal%20%3D%20typeof%20global%20%3D%3D%20'object'%20%26%26%20global%3B%0A%09if%20(freeGlobal.global%20%3D%3D%3D%20freeGlobal%20%7C%7C%20freeGlobal.window%20%3D%3D%3D%20freeGlobal)%20%7B%0A%09%09root%20%3D%20freeGlobal%3B%0A%09%7D%0A%0A%09%2F*--------------------------------------------------------------------------*%2F%0A%0A%09var%20stringFromCharCode%20%3D%20String.fromCharCode%3B%0A%0A%09%2F%2F%20Taken%20from%20https%3A%2F%2Fmths.be%2Fpunycode%0A%09function%20ucs2decode(string)%20%7B%0A%09%09var%20output%20%3D%20%5B%5D%3B%0A%09%09var%20counter%20%3D%200%3B%0A%09%09var%20length%20%3D%20string.length%3B%0A%09%09var%20value%3B%0A%09%09var%20extra%3B%0A%09%09while%20(counter%20%3C%20length)%20%7B%0A%09%09%09value%20%3D%20string.charCodeAt(counter%2B%2B)%3B%0A%09%09%09if%20(value%20%3E%3D%200xD800%20%26%26%20value%20%3C%3D%200xDBFF%20%26%26%20counter%20%3C%20length)%20%7B%0A%09%09%09%09%2F%2F%20high%20surrogate%2C%20and%20there%20is%20a%20next%20character%0A%09%09%09%09extra%20%3D%20string.charCodeAt(counter%2B%2B)%3B%0A%09%09%09%09if%20((extra%20%26%200xFC00)%20%3D%3D%200xDC00)%20%7B%20%2F%2F%20low%20surrogate%0A%09%09%09%09%09output.push(((value%20%26%200x3FF)%20%3C%3C%2010)%20%2B%20(extra%20%26%200x3FF)%20%2B%200x10000)%3B%0A%09%09%09%09%7D%20else%20%7B%0A%09%09%09%09%09%2F%2F%20unmatched%20surrogate%3B%20only%20append%20this%20code%20unit%2C%20in%20case%20the%20next%0A%09%09%09%09%09%2F%2F%20code%20unit%20is%20the%20high%20surrogate%20of%20a%20surrogate%20pair%0A%09%09%09%09%09output.push(value)%3B%0A%09%09%09%09%09counter--%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%20else%20%7B%0A%09%09%09%09output.push(value)%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%09return%20output%3B%0A%09%7D%0A%0A%09%2F%2F%20Taken%20from%20https%3A%2F%2Fmths.be%2Fpunycode%0A%09function%20ucs2encode(array)%20%7B%0A%09%09var%20length%20%3D%20array.length%3B%0A%09%09var%20index%20%3D%20-1%3B%0A%09%09var%20value%3B%0A%09%09var%20output%20%3D%20''%3B%0A%09%09while%20(%2B%2Bindex%20%3C%20length)%20%7B%0A%09%09%09value%20%3D%20array%5Bindex%5D%3B%0A%09%09%09if%20(value%20%3E%200xFFFF)%20%7B%0A%09%09%09%09value%20-%3D%200x10000%3B%0A%09%09%09%09output%20%2B%3D%20stringFromCharCode(value%20%3E%3E%3E%2010%20%26%200x3FF%20%7C%200xD800)%3B%0A%09%09%09%09value%20%3D%200xDC00%20%7C%20value%20%26%200x3FF%3B%0A%09%09%09%7D%0A%09%09%09output%20%2B%3D%20stringFromCharCode(value)%3B%0A%09%09%7D%0A%09%09return%20output%3B%0A%09%7D%0A%0A%09function%20checkScalarValue(codePoint%2C%20strict)%20%7B%0A%09%09if%20(codePoint%20%3E%3D%200xD800%20%26%26%20codePoint%20%3C%3D%200xDFFF)%20%7B%0A%09%09%09if%20(strict)%20%7B%0A%09%09%09%09throw%20Error(%0A%09%09%09%09%09'Lone%20surrogate%20U%2B'%20%2B%20codePoint.toString(16).toUpperCase()%20%2B%0A%09%09%09%09%09'%20is%20not%20a%20scalar%20value'%0A%09%09%09%09)%3B%0A%09%09%09%7D%0A%09%09%09return%20false%3B%0A%09%09%7D%0A%09%09return%20true%3B%0A%09%7D%0A%09%2F*--------------------------------------------------------------------------*%2F%0A%0A%09function%20createByte(codePoint%2C%20shift)%20%7B%0A%09%09return%20stringFromCharCode(((codePoint%20%3E%3E%20shift)%20%26%200x3F)%20%7C%200x80)%3B%0A%09%7D%0A%0A%09function%20encodeCodePoint(codePoint%2C%20strict)%20%7B%0A%09%09if%20((codePoint%20%26%200xFFFFFF80)%20%3D%3D%200)%20%7B%20%2F%2F%201-byte%20sequence%0A%09%09%09return%20stringFromCharCode(codePoint)%3B%0A%09%09%7D%0A%09%09var%20symbol%20%3D%20''%3B%0A%09%09if%20((codePoint%20%26%200xFFFFF800)%20%3D%3D%200)%20%7B%20%2F%2F%202-byte%20sequence%0A%09%09%09symbol%20%3D%20stringFromCharCode(((codePoint%20%3E%3E%206)%20%26%200x1F)%20%7C%200xC0)%3B%0A%09%09%7D%0A%09%09else%20if%20((codePoint%20%26%200xFFFF0000)%20%3D%3D%200)%20%7B%20%2F%2F%203-byte%20sequence%0A%09%09%09if%20(!checkScalarValue(codePoint%2C%20strict))%20%7B%0A%09%09%09%09codePoint%20%3D%200xFFFD%3B%0A%09%09%09%7D%0A%09%09%09symbol%20%3D%20stringFromCharCode(((codePoint%20%3E%3E%2012)%20%26%200x0F)%20%7C%200xE0)%3B%0A%09%09%09symbol%20%2B%3D%20createByte(codePoint%2C%206)%3B%0A%09%09%7D%0A%09%09else%20if%20((codePoint%20%26%200xFFE00000)%20%3D%3D%200)%20%7B%20%2F%2F%204-byte%20sequence%0A%09%09%09symbol%20%3D%20stringFromCharCode(((codePoint%20%3E%3E%2018)%20%26%200x07)%20%7C%200xF0)%3B%0A%09%09%09symbol%20%2B%3D%20createByte(codePoint%2C%2012)%3B%0A%09%09%09symbol%20%2B%3D%20createByte(codePoint%2C%206)%3B%0A%09%09%7D%0A%09%09symbol%20%2B%3D%20stringFromCharCode((codePoint%20%26%200x3F)%20%7C%200x80)%3B%0A%09%09return%20symbol%3B%0A%09%7D%0A%0A%09function%20utf8encode(string%2C%20opts)%20%7B%0A%09%09opts%20%3D%20opts%20%7C%7C%20%7B%7D%3B%0A%09%09var%20strict%20%3D%20false%20!%3D%3D%20opts.strict%3B%0A%0A%09%09var%20codePoints%20%3D%20ucs2decode(string)%3B%0A%09%09var%20length%20%3D%20codePoints.length%3B%0A%09%09var%20index%20%3D%20-1%3B%0A%09%09var%20codePoint%3B%0A%09%09var%20byteString%20%3D%20''%3B%0A%09%09while%20(%2B%2Bindex%20%3C%20length)%20%7B%0A%09%09%09codePoint%20%3D%20codePoints%5Bindex%5D%3B%0A%09%09%09byteString%20%2B%3D%20encodeCodePoint(codePoint%2C%20strict)%3B%0A%09%09%7D%0A%09%09return%20byteString%3B%0A%09%7D%0A%0A%09%2F*--------------------------------------------------------------------------*%2F%0A%0A%09function%20readContinuationByte()%20%7B%0A%09%09if%20(byteIndex%20%3E%3D%20byteCount)%20%7B%0A%09%09%09throw%20Error('Invalid%20byte%20index')%3B%0A%09%09%7D%0A%0A%09%09var%20continuationByte%20%3D%20byteArray%5BbyteIndex%5D%20%26%200xFF%3B%0A%09%09byteIndex%2B%2B%3B%0A%0A%09%09if%20((continuationByte%20%26%200xC0)%20%3D%3D%200x80)%20%7B%0A%09%09%09return%20continuationByte%20%26%200x3F%3B%0A%09%09%7D%0A%0A%09%09%2F%2F%20If%20we%20end%20up%20here%2C%20it%E2%80%99s%20not%20a%20continuation%20byte%0A%09%09throw%20Error('Invalid%20continuation%20byte')%3B%0A%09%7D%0A%0A%09function%20decodeSymbol(strict)%20%7B%0A%09%09var%20byte1%3B%0A%09%09var%20byte2%3B%0A%09%09var%20byte3%3B%0A%09%09var%20byte4%3B%0A%09%09var%20codePoint%3B%0A%0A%09%09if%20(byteIndex%20%3E%20byteCount)%20%7B%0A%09%09%09throw%20Error('Invalid%20byte%20index')%3B%0A%09%09%7D%0A%0A%09%09if%20(byteIndex%20%3D%3D%20byteCount)%20%7B%0A%09%09%09return%20false%3B%0A%09%09%7D%0A%0A%09%09%2F%2F%20Read%20first%20byte%0A%09%09byte1%20%3D%20byteArray%5BbyteIndex%5D%20%26%200xFF%3B%0A%09%09byteIndex%2B%2B%3B%0A%0A%09%09%2F%2F%201-byte%20sequence%20(no%20continuation%20bytes)%0A%09%09if%20((byte1%20%26%200x80)%20%3D%3D%200)%20%7B%0A%09%09%09return%20byte1%3B%0A%09%09%7D%0A%0A%09%09%2F%2F%202-byte%20sequence%0A%09%09if%20((byte1%20%26%200xE0)%20%3D%3D%200xC0)%20%7B%0A%09%09%09byte2%20%3D%20readContinuationByte()%3B%0A%09%09%09codePoint%20%3D%20((byte1%20%26%200x1F)%20%3C%3C%206)%20%7C%20byte2%3B%0A%09%09%09if%20(codePoint%20%3E%3D%200x80)%20%7B%0A%09%09%09%09return%20codePoint%3B%0A%09%09%09%7D%20else%20%7B%0A%09%09%09%09throw%20Error('Invalid%20continuation%20byte')%3B%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09%2F%2F%203-byte%20sequence%20(may%20include%20unpaired%20surrogates)%0A%09%09if%20((byte1%20%26%200xF0)%20%3D%3D%200xE0)%20%7B%0A%09%09%09byte2%20%3D%20readContinuationByte()%3B%0A%09%09%09byte3%20%3D%20readContinuationByte()%3B%0A%09%09%09codePoint%20%3D%20((byte1%20%26%200x0F)%20%3C%3C%2012)%20%7C%20(byte2%20%3C%3C%206)%20%7C%20byte3%3B%0A%09%09%09if%20(codePoint%20%3E%3D%200x0800)%20%7B%0A%09%09%09%09return%20checkScalarValue(codePoint%2C%20strict)%20%3F%20codePoint%20%3A%200xFFFD%3B%0A%09%09%09%7D%20else%20%7B%0A%09%09%09%09throw%20Error('Invalid%20continuation%20byte')%3B%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09%2F%2F%204-byte%20sequence%0A%09%09if%20((byte1%20%26%200xF8)%20%3D%3D%200xF0)%20%7B%0A%09%09%09byte2%20%3D%20readContinuationByte()%3B%0A%09%09%09byte3%20%3D%20readContinuationByte()%3B%0A%09%09%09byte4%20%3D%20readContinuationByte()%3B%0A%09%09%09codePoint%20%3D%20((byte1%20%26%200x07)%20%3C%3C%200x12)%20%7C%20(byte2%20%3C%3C%200x0C)%20%7C%0A%09%09%09%09(byte3%20%3C%3C%200x06)%20%7C%20byte4%3B%0A%09%09%09if%20(codePoint%20%3E%3D%200x010000%20%26%26%20codePoint%20%3C%3D%200x10FFFF)%20%7B%0A%09%09%09%09return%20codePoint%3B%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09throw%20Error('Invalid%20UTF-8%20detected')%3B%0A%09%7D%0A%0A%09var%20byteArray%3B%0A%09var%20byteCount%3B%0A%09var%20byteIndex%3B%0A%09function%20utf8decode(byteString%2C%20opts)%20%7B%0A%09%09opts%20%3D%20opts%20%7C%7C%20%7B%7D%3B%0A%09%09var%20strict%20%3D%20false%20!%3D%3D%20opts.strict%3B%0A%0A%09%09byteArray%20%3D%20ucs2decode(byteString)%3B%0A%09%09byteCount%20%3D%20byteArray.length%3B%0A%09%09byteIndex%20%3D%200%3B%0A%09%09var%20codePoints%20%3D%20%5B%5D%3B%0A%09%09var%20tmp%3B%0A%09%09while%20((tmp%20%3D%20decodeSymbol(strict))%20!%3D%3D%20false)%20%7B%0A%09%09%09codePoints.push(tmp)%3B%0A%09%09%7D%0A%09%09return%20ucs2encode(codePoints)%3B%0A%09%7D%0A%0A%09%2F*--------------------------------------------------------------------------*%2F%0A%0A%09var%20utf8%20%3D%20%7B%0A%09%09'version'%3A%20'2.1.2'%2C%0A%09%09'encode'%3A%20utf8encode%2C%0A%09%09'decode'%3A%20utf8decode%0A%09%7D%3B%0A%0A%09%2F%2F%20Some%20AMD%20build%20optimizers%2C%20like%20r.js%2C%20check%20for%20specific%20condition%20patterns%0A%09%2F%2F%20like%20the%20following%3A%0A%09if%20(%0A%09%09typeof%20define%20%3D%3D%20'function'%20%26%26%0A%09%09typeof%20define.amd%20%3D%3D%20'object'%20%26%26%0A%09%09define.amd%0A%09)%20%7B%0A%09%09define(function()%20%7B%0A%09%09%09return%20utf8%3B%0A%09%09%7D)%3B%0A%09%7D%09else%20if%20(freeExports%20%26%26%20!freeExports.nodeType)%20%7B%0A%09%09if%20(freeModule)%20%7B%20%2F%2F%20in%20Node.js%20or%20RingoJS%20v0.8.0%2B%0A%09%09%09freeModule.exports%20%3D%20utf8%3B%0A%09%09%7D%20else%20%7B%20%2F%2F%20in%20Narwhal%20or%20RingoJS%20v0.7.0-%0A%09%09%09var%20object%20%3D%20%7B%7D%3B%0A%09%09%09var%20hasOwnProperty%20%3D%20object.hasOwnProperty%3B%0A%09%09%09for%20(var%20key%20in%20utf8)%20%7B%0A%09%09%09%09hasOwnProperty.call(utf8%2C%20key)%20%26%26%20(freeExports%5Bkey%5D%20%3D%20utf8%5Bkey%5D)%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%20else%20%7B%20%2F%2F%20in%20Rhino%20or%20a%20web%20browser%0A%09%09root.utf8%20%3D%20utf8%3B%0A%09%7D%0A%0A%7D(this))%3B%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%7D%5D%2C26%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(Buffer)%7B%0A%2F*%20global%20Blob%20File%20*%2F%0A%0A%2F*%0A%20*%20Module%20requirements.%0A%20*%2F%0A%0Avar%20isArray%20%3D%20require('isarray')%3B%0A%0Avar%20toString%20%3D%20Object.prototype.toString%3B%0Avar%20withNativeBlob%20%3D%20typeof%20Blob%20%3D%3D%3D%20'function'%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20Blob%20!%3D%3D%20'undefined'%20%26%26%20toString.call(Blob)%20%3D%3D%3D%20'%5Bobject%20BlobConstructor%5D'%3B%0Avar%20withNativeFile%20%3D%20typeof%20File%20%3D%3D%3D%20'function'%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20typeof%20File%20!%3D%3D%20'undefined'%20%26%26%20toString.call(File)%20%3D%3D%3D%20'%5Bobject%20FileConstructor%5D'%3B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20hasBinary%3B%0A%0A%2F**%0A%20*%20Checks%20for%20binary%20data.%0A%20*%0A%20*%20Supports%20Buffer%2C%20ArrayBuffer%2C%20Blob%20and%20File.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20anything%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20hasBinary%20(obj)%20%7B%0A%20%20if%20(!obj%20%7C%7C%20typeof%20obj%20!%3D%3D%20'object')%20%7B%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%0A%20%20if%20(isArray(obj))%20%7B%0A%20%20%20%20for%20(var%20i%20%3D%200%2C%20l%20%3D%20obj.length%3B%20i%20%3C%20l%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20if%20(hasBinary(obj%5Bi%5D))%20%7B%0A%20%20%20%20%20%20%20%20return%20true%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%0A%20%20if%20((typeof%20Buffer%20%3D%3D%3D%20'function'%20%26%26%20Buffer.isBuffer%20%26%26%20Buffer.isBuffer(obj))%20%7C%7C%0A%20%20%20%20(typeof%20ArrayBuffer%20%3D%3D%3D%20'function'%20%26%26%20obj%20instanceof%20ArrayBuffer)%20%7C%7C%0A%20%20%20%20(withNativeBlob%20%26%26%20obj%20instanceof%20Blob)%20%7C%7C%0A%20%20%20%20(withNativeFile%20%26%26%20obj%20instanceof%20File)%0A%20%20)%20%7B%0A%20%20%20%20return%20true%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20see%3A%20https%3A%2F%2Fgithub.com%2FAutomattic%2Fhas-binary%2Fpull%2F4%0A%20%20if%20(obj.toJSON%20%26%26%20typeof%20obj.toJSON%20%3D%3D%3D%20'function'%20%26%26%20arguments.length%20%3D%3D%3D%201)%20%7B%0A%20%20%20%20return%20hasBinary(obj.toJSON()%2C%20true)%3B%0A%20%20%7D%0A%0A%20%20for%20(var%20key%20in%20obj)%20%7B%0A%20%20%20%20if%20(Object.prototype.hasOwnProperty.call(obj%2C%20key)%20%26%26%20hasBinary(obj%5Bkey%5D))%20%7B%0A%20%20%20%20%20%20return%20true%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20return%20false%3B%0A%7D%0A%0A%7D).call(this%2Crequire(%22buffer%22).Buffer)%0A%7D%2C%7B%22buffer%22%3A8%2C%22isarray%22%3A30%7D%5D%2C27%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%0A%20*%20Logic%20borrowed%20from%20Modernizr%3A%0A%20*%0A%20*%20%20%20-%20https%3A%2F%2Fgithub.com%2FModernizr%2FModernizr%2Fblob%2Fmaster%2Ffeature-detects%2Fcors.js%0A%20*%2F%0A%0Atry%20%7B%0A%20%20module.exports%20%3D%20typeof%20XMLHttpRequest%20!%3D%3D%20'undefined'%20%26%26%0A%20%20%20%20'withCredentials'%20in%20new%20XMLHttpRequest()%3B%0A%7D%20catch%20(err)%20%7B%0A%20%20%2F%2F%20if%20XMLHttp%20support%20is%20disabled%20in%20IE%20then%20it%20will%20throw%0A%20%20%2F%2F%20when%20trying%20to%20create%0A%20%20module.exports%20%3D%20false%3B%0A%7D%0A%0A%7D%2C%7B%7D%5D%2C28%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0Aexports.read%20%3D%20function%20(buffer%2C%20offset%2C%20isLE%2C%20mLen%2C%20nBytes)%20%7B%0A%20%20var%20e%2C%20m%0A%20%20var%20eLen%20%3D%20(nBytes%20*%208)%20-%20mLen%20-%201%0A%20%20var%20eMax%20%3D%20(1%20%3C%3C%20eLen)%20-%201%0A%20%20var%20eBias%20%3D%20eMax%20%3E%3E%201%0A%20%20var%20nBits%20%3D%20-7%0A%20%20var%20i%20%3D%20isLE%20%3F%20(nBytes%20-%201)%20%3A%200%0A%20%20var%20d%20%3D%20isLE%20%3F%20-1%20%3A%201%0A%20%20var%20s%20%3D%20buffer%5Boffset%20%2B%20i%5D%0A%0A%20%20i%20%2B%3D%20d%0A%0A%20%20e%20%3D%20s%20%26%20((1%20%3C%3C%20(-nBits))%20-%201)%0A%20%20s%20%3E%3E%3D%20(-nBits)%0A%20%20nBits%20%2B%3D%20eLen%0A%20%20for%20(%3B%20nBits%20%3E%200%3B%20e%20%3D%20(e%20*%20256)%20%2B%20buffer%5Boffset%20%2B%20i%5D%2C%20i%20%2B%3D%20d%2C%20nBits%20-%3D%208)%20%7B%7D%0A%0A%20%20m%20%3D%20e%20%26%20((1%20%3C%3C%20(-nBits))%20-%201)%0A%20%20e%20%3E%3E%3D%20(-nBits)%0A%20%20nBits%20%2B%3D%20mLen%0A%20%20for%20(%3B%20nBits%20%3E%200%3B%20m%20%3D%20(m%20*%20256)%20%2B%20buffer%5Boffset%20%2B%20i%5D%2C%20i%20%2B%3D%20d%2C%20nBits%20-%3D%208)%20%7B%7D%0A%0A%20%20if%20(e%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20e%20%3D%201%20-%20eBias%0A%20%20%7D%20else%20if%20(e%20%3D%3D%3D%20eMax)%20%7B%0A%20%20%20%20return%20m%20%3F%20NaN%20%3A%20((s%20%3F%20-1%20%3A%201)%20*%20Infinity)%0A%20%20%7D%20else%20%7B%0A%20%20%20%20m%20%3D%20m%20%2B%20Math.pow(2%2C%20mLen)%0A%20%20%20%20e%20%3D%20e%20-%20eBias%0A%20%20%7D%0A%20%20return%20(s%20%3F%20-1%20%3A%201)%20*%20m%20*%20Math.pow(2%2C%20e%20-%20mLen)%0A%7D%0A%0Aexports.write%20%3D%20function%20(buffer%2C%20value%2C%20offset%2C%20isLE%2C%20mLen%2C%20nBytes)%20%7B%0A%20%20var%20e%2C%20m%2C%20c%0A%20%20var%20eLen%20%3D%20(nBytes%20*%208)%20-%20mLen%20-%201%0A%20%20var%20eMax%20%3D%20(1%20%3C%3C%20eLen)%20-%201%0A%20%20var%20eBias%20%3D%20eMax%20%3E%3E%201%0A%20%20var%20rt%20%3D%20(mLen%20%3D%3D%3D%2023%20%3F%20Math.pow(2%2C%20-24)%20-%20Math.pow(2%2C%20-77)%20%3A%200)%0A%20%20var%20i%20%3D%20isLE%20%3F%200%20%3A%20(nBytes%20-%201)%0A%20%20var%20d%20%3D%20isLE%20%3F%201%20%3A%20-1%0A%20%20var%20s%20%3D%20value%20%3C%200%20%7C%7C%20(value%20%3D%3D%3D%200%20%26%26%201%20%2F%20value%20%3C%200)%20%3F%201%20%3A%200%0A%0A%20%20value%20%3D%20Math.abs(value)%0A%0A%20%20if%20(isNaN(value)%20%7C%7C%20value%20%3D%3D%3D%20Infinity)%20%7B%0A%20%20%20%20m%20%3D%20isNaN(value)%20%3F%201%20%3A%200%0A%20%20%20%20e%20%3D%20eMax%0A%20%20%7D%20else%20%7B%0A%20%20%20%20e%20%3D%20Math.floor(Math.log(value)%20%2F%20Math.LN2)%0A%20%20%20%20if%20(value%20*%20(c%20%3D%20Math.pow(2%2C%20-e))%20%3C%201)%20%7B%0A%20%20%20%20%20%20e--%0A%20%20%20%20%20%20c%20*%3D%202%0A%20%20%20%20%7D%0A%20%20%20%20if%20(e%20%2B%20eBias%20%3E%3D%201)%20%7B%0A%20%20%20%20%20%20value%20%2B%3D%20rt%20%2F%20c%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20value%20%2B%3D%20rt%20*%20Math.pow(2%2C%201%20-%20eBias)%0A%20%20%20%20%7D%0A%20%20%20%20if%20(value%20*%20c%20%3E%3D%202)%20%7B%0A%20%20%20%20%20%20e%2B%2B%0A%20%20%20%20%20%20c%20%2F%3D%202%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(e%20%2B%20eBias%20%3E%3D%20eMax)%20%7B%0A%20%20%20%20%20%20m%20%3D%200%0A%20%20%20%20%20%20e%20%3D%20eMax%0A%20%20%20%20%7D%20else%20if%20(e%20%2B%20eBias%20%3E%3D%201)%20%7B%0A%20%20%20%20%20%20m%20%3D%20((value%20*%20c)%20-%201)%20*%20Math.pow(2%2C%20mLen)%0A%20%20%20%20%20%20e%20%3D%20e%20%2B%20eBias%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20m%20%3D%20value%20*%20Math.pow(2%2C%20eBias%20-%201)%20*%20Math.pow(2%2C%20mLen)%0A%20%20%20%20%20%20e%20%3D%200%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20for%20(%3B%20mLen%20%3E%3D%208%3B%20buffer%5Boffset%20%2B%20i%5D%20%3D%20m%20%26%200xff%2C%20i%20%2B%3D%20d%2C%20m%20%2F%3D%20256%2C%20mLen%20-%3D%208)%20%7B%7D%0A%0A%20%20e%20%3D%20(e%20%3C%3C%20mLen)%20%7C%20m%0A%20%20eLen%20%2B%3D%20mLen%0A%20%20for%20(%3B%20eLen%20%3E%200%3B%20buffer%5Boffset%20%2B%20i%5D%20%3D%20e%20%26%200xff%2C%20i%20%2B%3D%20d%2C%20e%20%2F%3D%20256%2C%20eLen%20-%3D%208)%20%7B%7D%0A%0A%20%20buffer%5Boffset%20%2B%20i%20-%20d%5D%20%7C%3D%20s%20*%20128%0A%7D%0A%0A%7D%2C%7B%7D%5D%2C29%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0Avar%20indexOf%20%3D%20%5B%5D.indexOf%3B%0A%0Amodule.exports%20%3D%20function(arr%2C%20obj)%7B%0A%20%20if%20(indexOf)%20return%20arr.indexOf(obj)%3B%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20arr.length%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20if%20(arr%5Bi%5D%20%3D%3D%3D%20obj)%20return%20i%3B%0A%20%20%7D%0A%20%20return%20-1%3B%0A%7D%3B%0A%7D%2C%7B%7D%5D%2C30%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0Avar%20toString%20%3D%20%7B%7D.toString%3B%0A%0Amodule.exports%20%3D%20Array.isArray%20%7C%7C%20function%20(arr)%20%7B%0A%20%20return%20toString.call(arr)%20%3D%3D%20'%5Bobject%20Array%5D'%3B%0A%7D%3B%0A%0A%7D%2C%7B%7D%5D%2C31%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F**%0A%20*%20Helpers.%0A%20*%2F%0A%0Avar%20s%20%3D%201000%3B%0Avar%20m%20%3D%20s%20*%2060%3B%0Avar%20h%20%3D%20m%20*%2060%3B%0Avar%20d%20%3D%20h%20*%2024%3B%0Avar%20y%20%3D%20d%20*%20365.25%3B%0A%0A%2F**%0A%20*%20Parse%20or%20format%20the%20given%20%60val%60.%0A%20*%0A%20*%20Options%3A%0A%20*%0A%20*%20%20-%20%60long%60%20verbose%20formatting%20%5Bfalse%5D%0A%20*%0A%20*%20%40param%20%7BString%7CNumber%7D%20val%0A%20*%20%40param%20%7BObject%7D%20%5Boptions%5D%0A%20*%20%40throws%20%7BError%7D%20throw%20an%20error%20if%20val%20is%20not%20a%20non-empty%20string%20or%20a%20number%0A%20*%20%40return%20%7BString%7CNumber%7D%0A%20*%20%40api%20public%0A%20*%2F%0A%0Amodule.exports%20%3D%20function(val%2C%20options)%20%7B%0A%20%20options%20%3D%20options%20%7C%7C%20%7B%7D%3B%0A%20%20var%20type%20%3D%20typeof%20val%3B%0A%20%20if%20(type%20%3D%3D%3D%20'string'%20%26%26%20val.length%20%3E%200)%20%7B%0A%20%20%20%20return%20parse(val)%3B%0A%20%20%7D%20else%20if%20(type%20%3D%3D%3D%20'number'%20%26%26%20isNaN(val)%20%3D%3D%3D%20false)%20%7B%0A%20%20%20%20return%20options.long%20%3F%20fmtLong(val)%20%3A%20fmtShort(val)%3B%0A%20%20%7D%0A%20%20throw%20new%20Error(%0A%20%20%20%20'val%20is%20not%20a%20non-empty%20string%20or%20a%20valid%20number.%20val%3D'%20%2B%0A%20%20%20%20%20%20JSON.stringify(val)%0A%20%20)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Parse%20the%20given%20%60str%60%20and%20return%20milliseconds.%0A%20*%0A%20*%20%40param%20%7BString%7D%20str%0A%20*%20%40return%20%7BNumber%7D%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20parse(str)%20%7B%0A%20%20str%20%3D%20String(str)%3B%0A%20%20if%20(str.length%20%3E%20100)%20%7B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%20%20var%20match%20%3D%20%2F%5E((%3F%3A%5Cd%2B)%3F%5C.%3F%5Cd%2B)%20*(milliseconds%3F%7Cmsecs%3F%7Cms%7Cseconds%3F%7Csecs%3F%7Cs%7Cminutes%3F%7Cmins%3F%7Cm%7Chours%3F%7Chrs%3F%7Ch%7Cdays%3F%7Cd%7Cyears%3F%7Cyrs%3F%7Cy)%3F%24%2Fi.exec(%0A%20%20%20%20str%0A%20%20)%3B%0A%20%20if%20(!match)%20%7B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%20%20var%20n%20%3D%20parseFloat(match%5B1%5D)%3B%0A%20%20var%20type%20%3D%20(match%5B2%5D%20%7C%7C%20'ms').toLowerCase()%3B%0A%20%20switch%20(type)%20%7B%0A%20%20%20%20case%20'years'%3A%0A%20%20%20%20case%20'year'%3A%0A%20%20%20%20case%20'yrs'%3A%0A%20%20%20%20case%20'yr'%3A%0A%20%20%20%20case%20'y'%3A%0A%20%20%20%20%20%20return%20n%20*%20y%3B%0A%20%20%20%20case%20'days'%3A%0A%20%20%20%20case%20'day'%3A%0A%20%20%20%20case%20'd'%3A%0A%20%20%20%20%20%20return%20n%20*%20d%3B%0A%20%20%20%20case%20'hours'%3A%0A%20%20%20%20case%20'hour'%3A%0A%20%20%20%20case%20'hrs'%3A%0A%20%20%20%20case%20'hr'%3A%0A%20%20%20%20case%20'h'%3A%0A%20%20%20%20%20%20return%20n%20*%20h%3B%0A%20%20%20%20case%20'minutes'%3A%0A%20%20%20%20case%20'minute'%3A%0A%20%20%20%20case%20'mins'%3A%0A%20%20%20%20case%20'min'%3A%0A%20%20%20%20case%20'm'%3A%0A%20%20%20%20%20%20return%20n%20*%20m%3B%0A%20%20%20%20case%20'seconds'%3A%0A%20%20%20%20case%20'second'%3A%0A%20%20%20%20case%20'secs'%3A%0A%20%20%20%20case%20'sec'%3A%0A%20%20%20%20case%20's'%3A%0A%20%20%20%20%20%20return%20n%20*%20s%3B%0A%20%20%20%20case%20'milliseconds'%3A%0A%20%20%20%20case%20'millisecond'%3A%0A%20%20%20%20case%20'msecs'%3A%0A%20%20%20%20case%20'msec'%3A%0A%20%20%20%20case%20'ms'%3A%0A%20%20%20%20%20%20return%20n%3B%0A%20%20%20%20default%3A%0A%20%20%20%20%20%20return%20undefined%3B%0A%20%20%7D%0A%7D%0A%0A%2F**%0A%20*%20Short%20format%20for%20%60ms%60.%0A%20*%0A%20*%20%40param%20%7BNumber%7D%20ms%0A%20*%20%40return%20%7BString%7D%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20fmtShort(ms)%20%7B%0A%20%20if%20(ms%20%3E%3D%20d)%20%7B%0A%20%20%20%20return%20Math.round(ms%20%2F%20d)%20%2B%20'd'%3B%0A%20%20%7D%0A%20%20if%20(ms%20%3E%3D%20h)%20%7B%0A%20%20%20%20return%20Math.round(ms%20%2F%20h)%20%2B%20'h'%3B%0A%20%20%7D%0A%20%20if%20(ms%20%3E%3D%20m)%20%7B%0A%20%20%20%20return%20Math.round(ms%20%2F%20m)%20%2B%20'm'%3B%0A%20%20%7D%0A%20%20if%20(ms%20%3E%3D%20s)%20%7B%0A%20%20%20%20return%20Math.round(ms%20%2F%20s)%20%2B%20's'%3B%0A%20%20%7D%0A%20%20return%20ms%20%2B%20'ms'%3B%0A%7D%0A%0A%2F**%0A%20*%20Long%20format%20for%20%60ms%60.%0A%20*%0A%20*%20%40param%20%7BNumber%7D%20ms%0A%20*%20%40return%20%7BString%7D%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20fmtLong(ms)%20%7B%0A%20%20return%20plural(ms%2C%20d%2C%20'day')%20%7C%7C%0A%20%20%20%20plural(ms%2C%20h%2C%20'hour')%20%7C%7C%0A%20%20%20%20plural(ms%2C%20m%2C%20'minute')%20%7C%7C%0A%20%20%20%20plural(ms%2C%20s%2C%20'second')%20%7C%7C%0A%20%20%20%20ms%20%2B%20'%20ms'%3B%0A%7D%0A%0A%2F**%0A%20*%20Pluralization%20helper.%0A%20*%2F%0A%0Afunction%20plural(ms%2C%20n%2C%20name)%20%7B%0A%20%20if%20(ms%20%3C%20n)%20%7B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%20%20if%20(ms%20%3C%20n%20*%201.5)%20%7B%0A%20%20%20%20return%20Math.floor(ms%20%2F%20n)%20%2B%20'%20'%20%2B%20name%3B%0A%20%20%7D%0A%20%20return%20Math.ceil(ms%20%2F%20n)%20%2B%20'%20'%20%2B%20name%20%2B%20's'%3B%0A%7D%0A%0A%7D%2C%7B%7D%5D%2C32%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F**%0D%0A%20*%20Compiles%20a%20querystring%0D%0A%20*%20Returns%20string%20representation%20of%20the%20object%0D%0A%20*%0D%0A%20*%20%40param%20%7BObject%7D%0D%0A%20*%20%40api%20private%0D%0A%20*%2F%0D%0A%0D%0Aexports.encode%20%3D%20function%20(obj)%20%7B%0D%0A%20%20var%20str%20%3D%20''%3B%0D%0A%0D%0A%20%20for%20(var%20i%20in%20obj)%20%7B%0D%0A%20%20%20%20if%20(obj.hasOwnProperty(i))%20%7B%0D%0A%20%20%20%20%20%20if%20(str.length)%20str%20%2B%3D%20'%26'%3B%0D%0A%20%20%20%20%20%20str%20%2B%3D%20encodeURIComponent(i)%20%2B%20'%3D'%20%2B%20encodeURIComponent(obj%5Bi%5D)%3B%0D%0A%20%20%20%20%7D%0D%0A%20%20%7D%0D%0A%0D%0A%20%20return%20str%3B%0D%0A%7D%3B%0D%0A%0D%0A%2F**%0D%0A%20*%20Parses%20a%20simple%20querystring%20into%20an%20object%0D%0A%20*%0D%0A%20*%20%40param%20%7BString%7D%20qs%0D%0A%20*%20%40api%20private%0D%0A%20*%2F%0D%0A%0D%0Aexports.decode%20%3D%20function(qs)%7B%0D%0A%20%20var%20qry%20%3D%20%7B%7D%3B%0D%0A%20%20var%20pairs%20%3D%20qs.split('%26')%3B%0D%0A%20%20for%20(var%20i%20%3D%200%2C%20l%20%3D%20pairs.length%3B%20i%20%3C%20l%3B%20i%2B%2B)%20%7B%0D%0A%20%20%20%20var%20pair%20%3D%20pairs%5Bi%5D.split('%3D')%3B%0D%0A%20%20%20%20qry%5BdecodeURIComponent(pair%5B0%5D)%5D%20%3D%20decodeURIComponent(pair%5B1%5D)%3B%0D%0A%20%20%7D%0D%0A%20%20return%20qry%3B%0D%0A%7D%3B%0D%0A%0A%7D%2C%7B%7D%5D%2C33%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F**%0D%0A%20*%20Parses%20an%20URI%0D%0A%20*%0D%0A%20*%20%40author%20Steven%20Levithan%20%3Cstevenlevithan.com%3E%20(MIT%20license)%0D%0A%20*%20%40api%20private%0D%0A%20*%2F%0D%0A%0D%0Avar%20re%20%3D%20%2F%5E(%3F%3A(%3F!%5B%5E%3A%40%5D%2B%3A%5B%5E%3A%40%5C%2F%5D*%40)(http%7Chttps%7Cws%7Cwss)%3A%5C%2F%5C%2F)%3F((%3F%3A((%5B%5E%3A%40%5D*)(%3F%3A%3A(%5B%5E%3A%40%5D*))%3F)%3F%40)%3F((%3F%3A%5Ba-f0-9%5D%7B0%2C4%7D%3A)%7B2%2C7%7D%5Ba-f0-9%5D%7B0%2C4%7D%7C%5B%5E%3A%5C%2F%3F%23%5D*)(%3F%3A%3A(%5Cd*))%3F)(((%5C%2F(%3F%3A%5B%5E%3F%23%5D(%3F!%5B%5E%3F%23%5C%2F%5D*%5C.%5B%5E%3F%23%5C%2F.%5D%2B(%3F%3A%5B%3F%23%5D%7C%24)))*%5C%2F%3F)%3F(%5B%5E%3F%23%5C%2F%5D*))(%3F%3A%5C%3F(%5B%5E%23%5D*))%3F(%3F%3A%23(.*))%3F)%2F%3B%0D%0A%0D%0Avar%20parts%20%3D%20%5B%0D%0A%20%20%20%20'source'%2C%20'protocol'%2C%20'authority'%2C%20'userInfo'%2C%20'user'%2C%20'password'%2C%20'host'%2C%20'port'%2C%20'relative'%2C%20'path'%2C%20'directory'%2C%20'file'%2C%20'query'%2C%20'anchor'%0D%0A%5D%3B%0D%0A%0D%0Amodule.exports%20%3D%20function%20parseuri(str)%20%7B%0D%0A%20%20%20%20var%20src%20%3D%20str%2C%0D%0A%20%20%20%20%20%20%20%20b%20%3D%20str.indexOf('%5B')%2C%0D%0A%20%20%20%20%20%20%20%20e%20%3D%20str.indexOf('%5D')%3B%0D%0A%0D%0A%20%20%20%20if%20(b%20!%3D%20-1%20%26%26%20e%20!%3D%20-1)%20%7B%0D%0A%20%20%20%20%20%20%20%20str%20%3D%20str.substring(0%2C%20b)%20%2B%20str.substring(b%2C%20e).replace(%2F%3A%2Fg%2C%20'%3B')%20%2B%20str.substring(e%2C%20str.length)%3B%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20var%20m%20%3D%20re.exec(str%20%7C%7C%20'')%2C%0D%0A%20%20%20%20%20%20%20%20uri%20%3D%20%7B%7D%2C%0D%0A%20%20%20%20%20%20%20%20i%20%3D%2014%3B%0D%0A%0D%0A%20%20%20%20while%20(i--)%20%7B%0D%0A%20%20%20%20%20%20%20%20uri%5Bparts%5Bi%5D%5D%20%3D%20m%5Bi%5D%20%7C%7C%20''%3B%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20if%20(b%20!%3D%20-1%20%26%26%20e%20!%3D%20-1)%20%7B%0D%0A%20%20%20%20%20%20%20%20uri.source%20%3D%20src%3B%0D%0A%20%20%20%20%20%20%20%20uri.host%20%3D%20uri.host.substring(1%2C%20uri.host.length%20-%201).replace(%2F%3B%2Fg%2C%20'%3A')%3B%0D%0A%20%20%20%20%20%20%20%20uri.authority%20%3D%20uri.authority.replace('%5B'%2C%20'').replace('%5D'%2C%20'').replace(%2F%3B%2Fg%2C%20'%3A')%3B%0D%0A%20%20%20%20%20%20%20%20uri.ipv6uri%20%3D%20true%3B%0D%0A%20%20%20%20%7D%0D%0A%0D%0A%20%20%20%20return%20uri%3B%0D%0A%7D%3B%0D%0A%0A%7D%2C%7B%7D%5D%2C34%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F%2F%20shim%20for%20using%20process%20in%20browser%0Avar%20process%20%3D%20module.exports%20%3D%20%7B%7D%3B%0A%0A%2F%2F%20cached%20from%20whatever%20global%20is%20present%20so%20that%20test%20runners%20that%20stub%20it%0A%2F%2F%20don't%20break%20things.%20%20But%20we%20need%20to%20wrap%20it%20in%20a%20try%20catch%20in%20case%20it%20is%0A%2F%2F%20wrapped%20in%20strict%20mode%20code%20which%20doesn't%20define%20any%20globals.%20%20It's%20inside%20a%0A%2F%2F%20function%20because%20try%2Fcatches%20deoptimize%20in%20certain%20engines.%0A%0Avar%20cachedSetTimeout%3B%0Avar%20cachedClearTimeout%3B%0A%0Afunction%20defaultSetTimout()%20%7B%0A%20%20%20%20throw%20new%20Error('setTimeout%20has%20not%20been%20defined')%3B%0A%7D%0Afunction%20defaultClearTimeout%20()%20%7B%0A%20%20%20%20throw%20new%20Error('clearTimeout%20has%20not%20been%20defined')%3B%0A%7D%0A(function%20()%20%7B%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20if%20(typeof%20setTimeout%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20cachedSetTimeout%20%3D%20setTimeout%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20cachedSetTimeout%20%3D%20defaultSetTimout%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%20%20%20%20cachedSetTimeout%20%3D%20defaultSetTimout%3B%0A%20%20%20%20%7D%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20if%20(typeof%20clearTimeout%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20cachedClearTimeout%20%3D%20clearTimeout%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20cachedClearTimeout%20%3D%20defaultClearTimeout%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20%20%20%20%20cachedClearTimeout%20%3D%20defaultClearTimeout%3B%0A%20%20%20%20%7D%0A%7D%20())%0Afunction%20runTimeout(fun)%20%7B%0A%20%20%20%20if%20(cachedSetTimeout%20%3D%3D%3D%20setTimeout)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2Fnormal%20enviroments%20in%20sane%20situations%0A%20%20%20%20%20%20%20%20return%20setTimeout(fun%2C%200)%3B%0A%20%20%20%20%7D%0A%20%20%20%20%2F%2F%20if%20setTimeout%20wasn't%20available%20but%20was%20latter%20defined%0A%20%20%20%20if%20((cachedSetTimeout%20%3D%3D%3D%20defaultSetTimout%20%7C%7C%20!cachedSetTimeout)%20%26%26%20setTimeout)%20%7B%0A%20%20%20%20%20%20%20%20cachedSetTimeout%20%3D%20setTimeout%3B%0A%20%20%20%20%20%20%20%20return%20setTimeout(fun%2C%200)%3B%0A%20%20%20%20%7D%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20when%20when%20somebody%20has%20screwed%20with%20setTimeout%20but%20no%20I.E.%20maddness%0A%20%20%20%20%20%20%20%20return%20cachedSetTimeout(fun%2C%200)%3B%0A%20%20%20%20%7D%20catch(e)%7B%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20When%20we%20are%20in%20I.E.%20but%20the%20script%20has%20been%20evaled%20so%20I.E.%20doesn't%20trust%20the%20global%20object%20when%20called%20normally%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20cachedSetTimeout.call(null%2C%20fun%2C%200)%3B%0A%20%20%20%20%20%20%20%20%7D%20catch(e)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20same%20as%20above%20but%20when%20it's%20a%20version%20of%20I.E.%20that%20must%20have%20the%20global%20object%20for%20'this'%2C%20hopfully%20our%20context%20correct%20otherwise%20it%20will%20throw%20a%20global%20error%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20cachedSetTimeout.call(this%2C%20fun%2C%200)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%0A%7D%0Afunction%20runClearTimeout(marker)%20%7B%0A%20%20%20%20if%20(cachedClearTimeout%20%3D%3D%3D%20clearTimeout)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2Fnormal%20enviroments%20in%20sane%20situations%0A%20%20%20%20%20%20%20%20return%20clearTimeout(marker)%3B%0A%20%20%20%20%7D%0A%20%20%20%20%2F%2F%20if%20clearTimeout%20wasn't%20available%20but%20was%20latter%20defined%0A%20%20%20%20if%20((cachedClearTimeout%20%3D%3D%3D%20defaultClearTimeout%20%7C%7C%20!cachedClearTimeout)%20%26%26%20clearTimeout)%20%7B%0A%20%20%20%20%20%20%20%20cachedClearTimeout%20%3D%20clearTimeout%3B%0A%20%20%20%20%20%20%20%20return%20clearTimeout(marker)%3B%0A%20%20%20%20%7D%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20when%20when%20somebody%20has%20screwed%20with%20setTimeout%20but%20no%20I.E.%20maddness%0A%20%20%20%20%20%20%20%20return%20cachedClearTimeout(marker)%3B%0A%20%20%20%20%7D%20catch%20(e)%7B%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20When%20we%20are%20in%20I.E.%20but%20the%20script%20has%20been%20evaled%20so%20I.E.%20doesn't%20%20trust%20the%20global%20object%20when%20called%20normally%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20cachedClearTimeout.call(null%2C%20marker)%3B%0A%20%20%20%20%20%20%20%20%7D%20catch%20(e)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20same%20as%20above%20but%20when%20it's%20a%20version%20of%20I.E.%20that%20must%20have%20the%20global%20object%20for%20'this'%2C%20hopfully%20our%20context%20correct%20otherwise%20it%20will%20throw%20a%20global%20error.%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Some%20versions%20of%20I.E.%20have%20different%20rules%20for%20clearTimeout%20vs%20setTimeout%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20cachedClearTimeout.call(this%2C%20marker)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%0A%0A%7D%0Avar%20queue%20%3D%20%5B%5D%3B%0Avar%20draining%20%3D%20false%3B%0Avar%20currentQueue%3B%0Avar%20queueIndex%20%3D%20-1%3B%0A%0Afunction%20cleanUpNextTick()%20%7B%0A%20%20%20%20if%20(!draining%20%7C%7C%20!currentQueue)%20%7B%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%20%20%20%20draining%20%3D%20false%3B%0A%20%20%20%20if%20(currentQueue.length)%20%7B%0A%20%20%20%20%20%20%20%20queue%20%3D%20currentQueue.concat(queue)%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20queueIndex%20%3D%20-1%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20(queue.length)%20%7B%0A%20%20%20%20%20%20%20%20drainQueue()%3B%0A%20%20%20%20%7D%0A%7D%0A%0Afunction%20drainQueue()%20%7B%0A%20%20%20%20if%20(draining)%20%7B%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%20%20%20%20var%20timeout%20%3D%20runTimeout(cleanUpNextTick)%3B%0A%20%20%20%20draining%20%3D%20true%3B%0A%0A%20%20%20%20var%20len%20%3D%20queue.length%3B%0A%20%20%20%20while(len)%20%7B%0A%20%20%20%20%20%20%20%20currentQueue%20%3D%20queue%3B%0A%20%20%20%20%20%20%20%20queue%20%3D%20%5B%5D%3B%0A%20%20%20%20%20%20%20%20while%20(%2B%2BqueueIndex%20%3C%20len)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(currentQueue)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20currentQueue%5BqueueIndex%5D.run()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20queueIndex%20%3D%20-1%3B%0A%20%20%20%20%20%20%20%20len%20%3D%20queue.length%3B%0A%20%20%20%20%7D%0A%20%20%20%20currentQueue%20%3D%20null%3B%0A%20%20%20%20draining%20%3D%20false%3B%0A%20%20%20%20runClearTimeout(timeout)%3B%0A%7D%0A%0Aprocess.nextTick%20%3D%20function%20(fun)%20%7B%0A%20%20%20%20var%20args%20%3D%20new%20Array(arguments.length%20-%201)%3B%0A%20%20%20%20if%20(arguments.length%20%3E%201)%20%7B%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%201%3B%20i%20%3C%20arguments.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20args%5Bi%20-%201%5D%20%3D%20arguments%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20queue.push(new%20Item(fun%2C%20args))%3B%0A%20%20%20%20if%20(queue.length%20%3D%3D%3D%201%20%26%26%20!draining)%20%7B%0A%20%20%20%20%20%20%20%20runTimeout(drainQueue)%3B%0A%20%20%20%20%7D%0A%7D%3B%0A%0A%2F%2F%20v8%20likes%20predictible%20objects%0Afunction%20Item(fun%2C%20array)%20%7B%0A%20%20%20%20this.fun%20%3D%20fun%3B%0A%20%20%20%20this.array%20%3D%20array%3B%0A%7D%0AItem.prototype.run%20%3D%20function%20()%20%7B%0A%20%20%20%20this.fun.apply(null%2C%20this.array)%3B%0A%7D%3B%0Aprocess.title%20%3D%20'browser'%3B%0Aprocess.browser%20%3D%20true%3B%0Aprocess.env%20%3D%20%7B%7D%3B%0Aprocess.argv%20%3D%20%5B%5D%3B%0Aprocess.version%20%3D%20''%3B%20%2F%2F%20empty%20string%20to%20avoid%20regexp%20issues%0Aprocess.versions%20%3D%20%7B%7D%3B%0A%0Afunction%20noop()%20%7B%7D%0A%0Aprocess.on%20%3D%20noop%3B%0Aprocess.addListener%20%3D%20noop%3B%0Aprocess.once%20%3D%20noop%3B%0Aprocess.off%20%3D%20noop%3B%0Aprocess.removeListener%20%3D%20noop%3B%0Aprocess.removeAllListeners%20%3D%20noop%3B%0Aprocess.emit%20%3D%20noop%3B%0Aprocess.prependListener%20%3D%20noop%3B%0Aprocess.prependOnceListener%20%3D%20noop%3B%0A%0Aprocess.listeners%20%3D%20function%20(name)%20%7B%20return%20%5B%5D%20%7D%0A%0Aprocess.binding%20%3D%20function%20(name)%20%7B%0A%20%20%20%20throw%20new%20Error('process.binding%20is%20not%20supported')%3B%0A%7D%3B%0A%0Aprocess.cwd%20%3D%20function%20()%20%7B%20return%20'%2F'%20%7D%3B%0Aprocess.chdir%20%3D%20function%20(dir)%20%7B%0A%20%20%20%20throw%20new%20Error('process.chdir%20is%20not%20supported')%3B%0A%7D%3B%0Aprocess.umask%20%3D%20function()%20%7B%20return%200%3B%20%7D%3B%0A%0A%7D%2C%7B%7D%5D%2C35%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0A%2F**%0A%20*%20Module%20dependencies.%0A%20*%2F%0A%0Avar%20url%20%3D%20require('.%2Furl')%3B%0Avar%20parser%20%3D%20require('socket.io-parser')%3B%0Avar%20Manager%20%3D%20require('.%2Fmanager')%3B%0Avar%20debug%20%3D%20require('debug')('socket.io-client')%3B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20exports%20%3D%20lookup%3B%0A%0A%2F**%0A%20*%20Managers%20cache.%0A%20*%2F%0A%0Avar%20cache%20%3D%20exports.managers%20%3D%20%7B%7D%3B%0A%0A%2F**%0A%20*%20Looks%20up%20an%20existing%20%60Manager%60%20for%20multiplexing.%0A%20*%20If%20the%20user%20summons%3A%0A%20*%0A%20*%20%20%20%60io('http%3A%2F%2Flocalhost%2Fa')%3B%60%0A%20*%20%20%20%60io('http%3A%2F%2Flocalhost%2Fb')%3B%60%0A%20*%0A%20*%20We%20reuse%20the%20existing%20instance%20based%20on%20same%20scheme%2Fport%2Fhost%2C%0A%20*%20and%20we%20initialize%20sockets%20for%20each%20namespace.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20lookup%20(uri%2C%20opts)%20%7B%0A%20%20if%20(typeof%20uri%20%3D%3D%3D%20'object')%20%7B%0A%20%20%20%20opts%20%3D%20uri%3B%0A%20%20%20%20uri%20%3D%20undefined%3B%0A%20%20%7D%0A%0A%20%20opts%20%3D%20opts%20%7C%7C%20%7B%7D%3B%0A%0A%20%20var%20parsed%20%3D%20url(uri)%3B%0A%20%20var%20source%20%3D%20parsed.source%3B%0A%20%20var%20id%20%3D%20parsed.id%3B%0A%20%20var%20path%20%3D%20parsed.path%3B%0A%20%20var%20sameNamespace%20%3D%20cache%5Bid%5D%20%26%26%20path%20in%20cache%5Bid%5D.nsps%3B%0A%20%20var%20newConnection%20%3D%20opts.forceNew%20%7C%7C%20opts%5B'force%20new%20connection'%5D%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20false%20%3D%3D%3D%20opts.multiplex%20%7C%7C%20sameNamespace%3B%0A%0A%20%20var%20io%3B%0A%0A%20%20if%20(newConnection)%20%7B%0A%20%20%20%20debug('ignoring%20socket%20cache%20for%20%25s'%2C%20source)%3B%0A%20%20%20%20io%20%3D%20Manager(source%2C%20opts)%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20if%20(!cache%5Bid%5D)%20%7B%0A%20%20%20%20%20%20debug('new%20io%20instance%20for%20%25s'%2C%20source)%3B%0A%20%20%20%20%20%20cache%5Bid%5D%20%3D%20Manager(source%2C%20opts)%3B%0A%20%20%20%20%7D%0A%20%20%20%20io%20%3D%20cache%5Bid%5D%3B%0A%20%20%7D%0A%20%20if%20(parsed.query%20%26%26%20!opts.query)%20%7B%0A%20%20%20%20opts.query%20%3D%20parsed.query%3B%0A%20%20%7D%0A%20%20return%20io.socket(parsed.path%2C%20opts)%3B%0A%7D%0A%0A%2F**%0A%20*%20Protocol%20version.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.protocol%20%3D%20parser.protocol%3B%0A%0A%2F**%0A%20*%20%60connect%60.%0A%20*%0A%20*%20%40param%20%7BString%7D%20uri%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.connect%20%3D%20lookup%3B%0A%0A%2F**%0A%20*%20Expose%20constructors%20for%20standalone%20build.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.Manager%20%3D%20require('.%2Fmanager')%3B%0Aexports.Socket%20%3D%20require('.%2Fsocket')%3B%0A%0A%7D%2C%7B%22.%2Fmanager%22%3A36%2C%22.%2Fsocket%22%3A38%2C%22.%2Furl%22%3A39%2C%22debug%22%3A12%2C%22socket.io-parser%22%3A41%7D%5D%2C36%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0A%2F**%0A%20*%20Module%20dependencies.%0A%20*%2F%0A%0Avar%20eio%20%3D%20require('engine.io-client')%3B%0Avar%20Socket%20%3D%20require('.%2Fsocket')%3B%0Avar%20Emitter%20%3D%20require('component-emitter')%3B%0Avar%20parser%20%3D%20require('socket.io-parser')%3B%0Avar%20on%20%3D%20require('.%2Fon')%3B%0Avar%20bind%20%3D%20require('component-bind')%3B%0Avar%20debug%20%3D%20require('debug')('socket.io-client%3Amanager')%3B%0Avar%20indexOf%20%3D%20require('indexof')%3B%0Avar%20Backoff%20%3D%20require('backo2')%3B%0A%0A%2F**%0A%20*%20IE6%2B%20hasOwnProperty%0A%20*%2F%0A%0Avar%20has%20%3D%20Object.prototype.hasOwnProperty%3B%0A%0A%2F**%0A%20*%20Module%20exports%0A%20*%2F%0A%0Amodule.exports%20%3D%20Manager%3B%0A%0A%2F**%0A%20*%20%60Manager%60%20constructor.%0A%20*%0A%20*%20%40param%20%7BString%7D%20engine%20instance%20or%20engine%20uri%2Fopts%0A%20*%20%40param%20%7BObject%7D%20options%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20Manager%20(uri%2C%20opts)%20%7B%0A%20%20if%20(!(this%20instanceof%20Manager))%20return%20new%20Manager(uri%2C%20opts)%3B%0A%20%20if%20(uri%20%26%26%20('object'%20%3D%3D%3D%20typeof%20uri))%20%7B%0A%20%20%20%20opts%20%3D%20uri%3B%0A%20%20%20%20uri%20%3D%20undefined%3B%0A%20%20%7D%0A%20%20opts%20%3D%20opts%20%7C%7C%20%7B%7D%3B%0A%0A%20%20opts.path%20%3D%20opts.path%20%7C%7C%20'%2Fsocket.io'%3B%0A%20%20this.nsps%20%3D%20%7B%7D%3B%0A%20%20this.subs%20%3D%20%5B%5D%3B%0A%20%20this.opts%20%3D%20opts%3B%0A%20%20this.reconnection(opts.reconnection%20!%3D%3D%20false)%3B%0A%20%20this.reconnectionAttempts(opts.reconnectionAttempts%20%7C%7C%20Infinity)%3B%0A%20%20this.reconnectionDelay(opts.reconnectionDelay%20%7C%7C%201000)%3B%0A%20%20this.reconnectionDelayMax(opts.reconnectionDelayMax%20%7C%7C%205000)%3B%0A%20%20this.randomizationFactor(opts.randomizationFactor%20%7C%7C%200.5)%3B%0A%20%20this.backoff%20%3D%20new%20Backoff(%7B%0A%20%20%20%20min%3A%20this.reconnectionDelay()%2C%0A%20%20%20%20max%3A%20this.reconnectionDelayMax()%2C%0A%20%20%20%20jitter%3A%20this.randomizationFactor()%0A%20%20%7D)%3B%0A%20%20this.timeout(null%20%3D%3D%20opts.timeout%20%3F%2020000%20%3A%20opts.timeout)%3B%0A%20%20this.readyState%20%3D%20'closed'%3B%0A%20%20this.uri%20%3D%20uri%3B%0A%20%20this.connecting%20%3D%20%5B%5D%3B%0A%20%20this.lastPing%20%3D%20null%3B%0A%20%20this.encoding%20%3D%20false%3B%0A%20%20this.packetBuffer%20%3D%20%5B%5D%3B%0A%20%20var%20_parser%20%3D%20opts.parser%20%7C%7C%20parser%3B%0A%20%20this.encoder%20%3D%20new%20_parser.Encoder()%3B%0A%20%20this.decoder%20%3D%20new%20_parser.Decoder()%3B%0A%20%20this.autoConnect%20%3D%20opts.autoConnect%20!%3D%3D%20false%3B%0A%20%20if%20(this.autoConnect)%20this.open()%3B%0A%7D%0A%0A%2F**%0A%20*%20Propagate%20given%20event%20to%20sockets%20and%20emit%20on%20%60this%60%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.emitAll%20%3D%20function%20()%20%7B%0A%20%20this.emit.apply(this%2C%20arguments)%3B%0A%20%20for%20(var%20nsp%20in%20this.nsps)%20%7B%0A%20%20%20%20if%20(has.call(this.nsps%2C%20nsp))%20%7B%0A%20%20%20%20%20%20this.nsps%5Bnsp%5D.emit.apply(this.nsps%5Bnsp%5D%2C%20arguments)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Update%20%60socket.id%60%20of%20all%20sockets%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.updateSocketIds%20%3D%20function%20()%20%7B%0A%20%20for%20(var%20nsp%20in%20this.nsps)%20%7B%0A%20%20%20%20if%20(has.call(this.nsps%2C%20nsp))%20%7B%0A%20%20%20%20%20%20this.nsps%5Bnsp%5D.id%20%3D%20this.generateId(nsp)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20generate%20%60socket.id%60%20for%20the%20given%20%60nsp%60%0A%20*%0A%20*%20%40param%20%7BString%7D%20nsp%0A%20*%20%40return%20%7BString%7D%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.generateId%20%3D%20function%20(nsp)%20%7B%0A%20%20return%20(nsp%20%3D%3D%3D%20'%2F'%20%3F%20''%20%3A%20(nsp%20%2B%20'%23'))%20%2B%20this.engine.id%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Mix%20in%20%60Emitter%60.%0A%20*%2F%0A%0AEmitter(Manager.prototype)%3B%0A%0A%2F**%0A%20*%20Sets%20the%20%60reconnection%60%20config.%0A%20*%0A%20*%20%40param%20%7BBoolean%7D%20true%2Ffalse%20if%20it%20should%20automatically%20reconnect%0A%20*%20%40return%20%7BManager%7D%20self%20or%20value%0A%20*%20%40api%20public%0A%20*%2F%0A%0AManager.prototype.reconnection%20%3D%20function%20(v)%20%7B%0A%20%20if%20(!arguments.length)%20return%20this._reconnection%3B%0A%20%20this._reconnection%20%3D%20!!v%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sets%20the%20reconnection%20attempts%20config.%0A%20*%0A%20*%20%40param%20%7BNumber%7D%20max%20reconnection%20attempts%20before%20giving%20up%0A%20*%20%40return%20%7BManager%7D%20self%20or%20value%0A%20*%20%40api%20public%0A%20*%2F%0A%0AManager.prototype.reconnectionAttempts%20%3D%20function%20(v)%20%7B%0A%20%20if%20(!arguments.length)%20return%20this._reconnectionAttempts%3B%0A%20%20this._reconnectionAttempts%20%3D%20v%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sets%20the%20delay%20between%20reconnections.%0A%20*%0A%20*%20%40param%20%7BNumber%7D%20delay%0A%20*%20%40return%20%7BManager%7D%20self%20or%20value%0A%20*%20%40api%20public%0A%20*%2F%0A%0AManager.prototype.reconnectionDelay%20%3D%20function%20(v)%20%7B%0A%20%20if%20(!arguments.length)%20return%20this._reconnectionDelay%3B%0A%20%20this._reconnectionDelay%20%3D%20v%3B%0A%20%20this.backoff%20%26%26%20this.backoff.setMin(v)%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0AManager.prototype.randomizationFactor%20%3D%20function%20(v)%20%7B%0A%20%20if%20(!arguments.length)%20return%20this._randomizationFactor%3B%0A%20%20this._randomizationFactor%20%3D%20v%3B%0A%20%20this.backoff%20%26%26%20this.backoff.setJitter(v)%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sets%20the%20maximum%20delay%20between%20reconnections.%0A%20*%0A%20*%20%40param%20%7BNumber%7D%20delay%0A%20*%20%40return%20%7BManager%7D%20self%20or%20value%0A%20*%20%40api%20public%0A%20*%2F%0A%0AManager.prototype.reconnectionDelayMax%20%3D%20function%20(v)%20%7B%0A%20%20if%20(!arguments.length)%20return%20this._reconnectionDelayMax%3B%0A%20%20this._reconnectionDelayMax%20%3D%20v%3B%0A%20%20this.backoff%20%26%26%20this.backoff.setMax(v)%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sets%20the%20connection%20timeout.%20%60false%60%20to%20disable%0A%20*%0A%20*%20%40return%20%7BManager%7D%20self%20or%20value%0A%20*%20%40api%20public%0A%20*%2F%0A%0AManager.prototype.timeout%20%3D%20function%20(v)%20%7B%0A%20%20if%20(!arguments.length)%20return%20this._timeout%3B%0A%20%20this._timeout%20%3D%20v%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Starts%20trying%20to%20reconnect%20if%20reconnection%20is%20enabled%20and%20we%20have%20not%0A%20*%20started%20reconnecting%20yet%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.maybeReconnectOnOpen%20%3D%20function%20()%20%7B%0A%20%20%2F%2F%20Only%20try%20to%20reconnect%20if%20it's%20the%20first%20time%20we're%20connecting%0A%20%20if%20(!this.reconnecting%20%26%26%20this._reconnection%20%26%26%20this.backoff.attempts%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%2F%2F%20keeps%20reconnection%20from%20firing%20twice%20for%20the%20same%20reconnection%20loop%0A%20%20%20%20this.reconnect()%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Sets%20the%20current%20transport%20%60socket%60.%0A%20*%0A%20*%20%40param%20%7BFunction%7D%20optional%2C%20callback%0A%20*%20%40return%20%7BManager%7D%20self%0A%20*%20%40api%20public%0A%20*%2F%0A%0AManager.prototype.open%20%3D%0AManager.prototype.connect%20%3D%20function%20(fn%2C%20opts)%20%7B%0A%20%20debug('readyState%20%25s'%2C%20this.readyState)%3B%0A%20%20if%20(~this.readyState.indexOf('open'))%20return%20this%3B%0A%0A%20%20debug('opening%20%25s'%2C%20this.uri)%3B%0A%20%20this.engine%20%3D%20eio(this.uri%2C%20this.opts)%3B%0A%20%20var%20socket%20%3D%20this.engine%3B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20this.readyState%20%3D%20'opening'%3B%0A%20%20this.skipReconnect%20%3D%20false%3B%0A%0A%20%20%2F%2F%20emit%20%60open%60%0A%20%20var%20openSub%20%3D%20on(socket%2C%20'open'%2C%20function%20()%20%7B%0A%20%20%20%20self.onopen()%3B%0A%20%20%20%20fn%20%26%26%20fn()%3B%0A%20%20%7D)%3B%0A%0A%20%20%2F%2F%20emit%20%60connect_error%60%0A%20%20var%20errorSub%20%3D%20on(socket%2C%20'error'%2C%20function%20(data)%20%7B%0A%20%20%20%20debug('connect_error')%3B%0A%20%20%20%20self.cleanup()%3B%0A%20%20%20%20self.readyState%20%3D%20'closed'%3B%0A%20%20%20%20self.emitAll('connect_error'%2C%20data)%3B%0A%20%20%20%20if%20(fn)%20%7B%0A%20%20%20%20%20%20var%20err%20%3D%20new%20Error('Connection%20error')%3B%0A%20%20%20%20%20%20err.data%20%3D%20data%3B%0A%20%20%20%20%20%20fn(err)%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%2F%2F%20Only%20do%20this%20if%20there%20is%20no%20fn%20to%20handle%20the%20error%0A%20%20%20%20%20%20self.maybeReconnectOnOpen()%3B%0A%20%20%20%20%7D%0A%20%20%7D)%3B%0A%0A%20%20%2F%2F%20emit%20%60connect_timeout%60%0A%20%20if%20(false%20!%3D%3D%20this._timeout)%20%7B%0A%20%20%20%20var%20timeout%20%3D%20this._timeout%3B%0A%20%20%20%20debug('connect%20attempt%20will%20timeout%20after%20%25d'%2C%20timeout)%3B%0A%0A%20%20%20%20%2F%2F%20set%20timer%0A%20%20%20%20var%20timer%20%3D%20setTimeout(function%20()%20%7B%0A%20%20%20%20%20%20debug('connect%20attempt%20timed%20out%20after%20%25d'%2C%20timeout)%3B%0A%20%20%20%20%20%20openSub.destroy()%3B%0A%20%20%20%20%20%20socket.close()%3B%0A%20%20%20%20%20%20socket.emit('error'%2C%20'timeout')%3B%0A%20%20%20%20%20%20self.emitAll('connect_timeout'%2C%20timeout)%3B%0A%20%20%20%20%7D%2C%20timeout)%3B%0A%0A%20%20%20%20this.subs.push(%7B%0A%20%20%20%20%20%20destroy%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20clearTimeout(timer)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20this.subs.push(openSub)%3B%0A%20%20this.subs.push(errorSub)%3B%0A%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20transport%20open.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.onopen%20%3D%20function%20()%20%7B%0A%20%20debug('open')%3B%0A%0A%20%20%2F%2F%20clear%20old%20subs%0A%20%20this.cleanup()%3B%0A%0A%20%20%2F%2F%20mark%20as%20open%0A%20%20this.readyState%20%3D%20'open'%3B%0A%20%20this.emit('open')%3B%0A%0A%20%20%2F%2F%20add%20new%20subs%0A%20%20var%20socket%20%3D%20this.engine%3B%0A%20%20this.subs.push(on(socket%2C%20'data'%2C%20bind(this%2C%20'ondata')))%3B%0A%20%20this.subs.push(on(socket%2C%20'ping'%2C%20bind(this%2C%20'onping')))%3B%0A%20%20this.subs.push(on(socket%2C%20'pong'%2C%20bind(this%2C%20'onpong')))%3B%0A%20%20this.subs.push(on(socket%2C%20'error'%2C%20bind(this%2C%20'onerror')))%3B%0A%20%20this.subs.push(on(socket%2C%20'close'%2C%20bind(this%2C%20'onclose')))%3B%0A%20%20this.subs.push(on(this.decoder%2C%20'decoded'%2C%20bind(this%2C%20'ondecoded')))%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20a%20ping.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.onping%20%3D%20function%20()%20%7B%0A%20%20this.lastPing%20%3D%20new%20Date()%3B%0A%20%20this.emitAll('ping')%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20a%20packet.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.onpong%20%3D%20function%20()%20%7B%0A%20%20this.emitAll('pong'%2C%20new%20Date()%20-%20this.lastPing)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20with%20data.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.ondata%20%3D%20function%20(data)%20%7B%0A%20%20this.decoder.add(data)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20when%20parser%20fully%20decodes%20a%20packet.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.ondecoded%20%3D%20function%20(packet)%20%7B%0A%20%20this.emit('packet'%2C%20packet)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20socket%20error.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.onerror%20%3D%20function%20(err)%20%7B%0A%20%20debug('error'%2C%20err)%3B%0A%20%20this.emitAll('error'%2C%20err)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Creates%20a%20new%20socket%20for%20the%20given%20%60nsp%60.%0A%20*%0A%20*%20%40return%20%7BSocket%7D%0A%20*%20%40api%20public%0A%20*%2F%0A%0AManager.prototype.socket%20%3D%20function%20(nsp%2C%20opts)%20%7B%0A%20%20var%20socket%20%3D%20this.nsps%5Bnsp%5D%3B%0A%20%20if%20(!socket)%20%7B%0A%20%20%20%20socket%20%3D%20new%20Socket(this%2C%20nsp%2C%20opts)%3B%0A%20%20%20%20this.nsps%5Bnsp%5D%20%3D%20socket%3B%0A%20%20%20%20var%20self%20%3D%20this%3B%0A%20%20%20%20socket.on('connecting'%2C%20onConnecting)%3B%0A%20%20%20%20socket.on('connect'%2C%20function%20()%20%7B%0A%20%20%20%20%20%20socket.id%20%3D%20self.generateId(nsp)%3B%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20if%20(this.autoConnect)%20%7B%0A%20%20%20%20%20%20%2F%2F%20manually%20call%20here%20since%20connecting%20event%20is%20fired%20before%20listening%0A%20%20%20%20%20%20onConnecting()%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20function%20onConnecting%20()%20%7B%0A%20%20%20%20if%20(!~indexOf(self.connecting%2C%20socket))%20%7B%0A%20%20%20%20%20%20self.connecting.push(socket)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20return%20socket%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20a%20socket%20close.%0A%20*%0A%20*%20%40param%20%7BSocket%7D%20socket%0A%20*%2F%0A%0AManager.prototype.destroy%20%3D%20function%20(socket)%20%7B%0A%20%20var%20index%20%3D%20indexOf(this.connecting%2C%20socket)%3B%0A%20%20if%20(~index)%20this.connecting.splice(index%2C%201)%3B%0A%20%20if%20(this.connecting.length)%20return%3B%0A%0A%20%20this.close()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Writes%20a%20packet.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.packet%20%3D%20function%20(packet)%20%7B%0A%20%20debug('writing%20packet%20%25j'%2C%20packet)%3B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20if%20(packet.query%20%26%26%20packet.type%20%3D%3D%3D%200)%20packet.nsp%20%2B%3D%20'%3F'%20%2B%20packet.query%3B%0A%0A%20%20if%20(!self.encoding)%20%7B%0A%20%20%20%20%2F%2F%20encode%2C%20then%20write%20to%20engine%20with%20result%0A%20%20%20%20self.encoding%20%3D%20true%3B%0A%20%20%20%20this.encoder.encode(packet%2C%20function%20(encodedPackets)%20%7B%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20encodedPackets.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20self.engine.write(encodedPackets%5Bi%5D%2C%20packet.options)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20self.encoding%20%3D%20false%3B%0A%20%20%20%20%20%20self.processPacketQueue()%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%20else%20%7B%20%2F%2F%20add%20packet%20to%20the%20queue%0A%20%20%20%20self.packetBuffer.push(packet)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20If%20packet%20buffer%20is%20non-empty%2C%20begins%20encoding%20the%0A%20*%20next%20packet%20in%20line.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.processPacketQueue%20%3D%20function%20()%20%7B%0A%20%20if%20(this.packetBuffer.length%20%3E%200%20%26%26%20!this.encoding)%20%7B%0A%20%20%20%20var%20pack%20%3D%20this.packetBuffer.shift()%3B%0A%20%20%20%20this.packet(pack)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Clean%20up%20transport%20subscriptions%20and%20packet%20buffer.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.cleanup%20%3D%20function%20()%20%7B%0A%20%20debug('cleanup')%3B%0A%0A%20%20var%20subsLength%20%3D%20this.subs.length%3B%0A%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20subsLength%3B%20i%2B%2B)%20%7B%0A%20%20%20%20var%20sub%20%3D%20this.subs.shift()%3B%0A%20%20%20%20sub.destroy()%3B%0A%20%20%7D%0A%0A%20%20this.packetBuffer%20%3D%20%5B%5D%3B%0A%20%20this.encoding%20%3D%20false%3B%0A%20%20this.lastPing%20%3D%20null%3B%0A%0A%20%20this.decoder.destroy()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Close%20the%20current%20socket.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.close%20%3D%0AManager.prototype.disconnect%20%3D%20function%20()%20%7B%0A%20%20debug('disconnect')%3B%0A%20%20this.skipReconnect%20%3D%20true%3B%0A%20%20this.reconnecting%20%3D%20false%3B%0A%20%20if%20('opening'%20%3D%3D%3D%20this.readyState)%20%7B%0A%20%20%20%20%2F%2F%20%60onclose%60%20will%20not%20fire%20because%0A%20%20%20%20%2F%2F%20an%20open%20event%20never%20happened%0A%20%20%20%20this.cleanup()%3B%0A%20%20%7D%0A%20%20this.backoff.reset()%3B%0A%20%20this.readyState%20%3D%20'closed'%3B%0A%20%20if%20(this.engine)%20this.engine.close()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20engine%20close.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.onclose%20%3D%20function%20(reason)%20%7B%0A%20%20debug('onclose')%3B%0A%0A%20%20this.cleanup()%3B%0A%20%20this.backoff.reset()%3B%0A%20%20this.readyState%20%3D%20'closed'%3B%0A%20%20this.emit('close'%2C%20reason)%3B%0A%0A%20%20if%20(this._reconnection%20%26%26%20!this.skipReconnect)%20%7B%0A%20%20%20%20this.reconnect()%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Attempt%20a%20reconnection.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.reconnect%20%3D%20function%20()%20%7B%0A%20%20if%20(this.reconnecting%20%7C%7C%20this.skipReconnect)%20return%20this%3B%0A%0A%20%20var%20self%20%3D%20this%3B%0A%0A%20%20if%20(this.backoff.attempts%20%3E%3D%20this._reconnectionAttempts)%20%7B%0A%20%20%20%20debug('reconnect%20failed')%3B%0A%20%20%20%20this.backoff.reset()%3B%0A%20%20%20%20this.emitAll('reconnect_failed')%3B%0A%20%20%20%20this.reconnecting%20%3D%20false%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20var%20delay%20%3D%20this.backoff.duration()%3B%0A%20%20%20%20debug('will%20wait%20%25dms%20before%20reconnect%20attempt'%2C%20delay)%3B%0A%0A%20%20%20%20this.reconnecting%20%3D%20true%3B%0A%20%20%20%20var%20timer%20%3D%20setTimeout(function%20()%20%7B%0A%20%20%20%20%20%20if%20(self.skipReconnect)%20return%3B%0A%0A%20%20%20%20%20%20debug('attempting%20reconnect')%3B%0A%20%20%20%20%20%20self.emitAll('reconnect_attempt'%2C%20self.backoff.attempts)%3B%0A%20%20%20%20%20%20self.emitAll('reconnecting'%2C%20self.backoff.attempts)%3B%0A%0A%20%20%20%20%20%20%2F%2F%20check%20again%20for%20the%20case%20socket%20closed%20in%20above%20events%0A%20%20%20%20%20%20if%20(self.skipReconnect)%20return%3B%0A%0A%20%20%20%20%20%20self.open(function%20(err)%20%7B%0A%20%20%20%20%20%20%20%20if%20(err)%20%7B%0A%20%20%20%20%20%20%20%20%20%20debug('reconnect%20attempt%20error')%3B%0A%20%20%20%20%20%20%20%20%20%20self.reconnecting%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20self.reconnect()%3B%0A%20%20%20%20%20%20%20%20%20%20self.emitAll('reconnect_error'%2C%20err.data)%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20debug('reconnect%20success')%3B%0A%20%20%20%20%20%20%20%20%20%20self.onreconnect()%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D%2C%20delay)%3B%0A%0A%20%20%20%20this.subs.push(%7B%0A%20%20%20%20%20%20destroy%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20clearTimeout(timer)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20successful%20reconnect.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0AManager.prototype.onreconnect%20%3D%20function%20()%20%7B%0A%20%20var%20attempt%20%3D%20this.backoff.attempts%3B%0A%20%20this.reconnecting%20%3D%20false%3B%0A%20%20this.backoff.reset()%3B%0A%20%20this.updateSocketIds()%3B%0A%20%20this.emitAll('reconnect'%2C%20attempt)%3B%0A%7D%3B%0A%0A%7D%2C%7B%22.%2Fon%22%3A37%2C%22.%2Fsocket%22%3A38%2C%22backo2%22%3A3%2C%22component-bind%22%3A9%2C%22component-emitter%22%3A10%2C%22debug%22%3A12%2C%22engine.io-client%22%3A14%2C%22indexof%22%3A29%2C%22socket.io-parser%22%3A41%7D%5D%2C37%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20on%3B%0A%0A%2F**%0A%20*%20Helper%20for%20subscriptions.%0A%20*%0A%20*%20%40param%20%7BObject%7CEventEmitter%7D%20obj%20with%20%60Emitter%60%20mixin%20or%20%60EventEmitter%60%0A%20*%20%40param%20%7BString%7D%20event%20name%0A%20*%20%40param%20%7BFunction%7D%20callback%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20on%20(obj%2C%20ev%2C%20fn)%20%7B%0A%20%20obj.on(ev%2C%20fn)%3B%0A%20%20return%20%7B%0A%20%20%20%20destroy%3A%20function%20()%20%7B%0A%20%20%20%20%20%20obj.removeListener(ev%2C%20fn)%3B%0A%20%20%20%20%7D%0A%20%20%7D%3B%0A%7D%0A%0A%7D%2C%7B%7D%5D%2C38%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0A%2F**%0A%20*%20Module%20dependencies.%0A%20*%2F%0A%0Avar%20parser%20%3D%20require('socket.io-parser')%3B%0Avar%20Emitter%20%3D%20require('component-emitter')%3B%0Avar%20toArray%20%3D%20require('to-array')%3B%0Avar%20on%20%3D%20require('.%2Fon')%3B%0Avar%20bind%20%3D%20require('component-bind')%3B%0Avar%20debug%20%3D%20require('debug')('socket.io-client%3Asocket')%3B%0Avar%20parseqs%20%3D%20require('parseqs')%3B%0Avar%20hasBin%20%3D%20require('has-binary2')%3B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20exports%20%3D%20Socket%3B%0A%0A%2F**%0A%20*%20Internal%20events%20(blacklisted).%0A%20*%20These%20events%20can't%20be%20emitted%20by%20the%20user.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0Avar%20events%20%3D%20%7B%0A%20%20connect%3A%201%2C%0A%20%20connect_error%3A%201%2C%0A%20%20connect_timeout%3A%201%2C%0A%20%20connecting%3A%201%2C%0A%20%20disconnect%3A%201%2C%0A%20%20error%3A%201%2C%0A%20%20reconnect%3A%201%2C%0A%20%20reconnect_attempt%3A%201%2C%0A%20%20reconnect_failed%3A%201%2C%0A%20%20reconnect_error%3A%201%2C%0A%20%20reconnecting%3A%201%2C%0A%20%20ping%3A%201%2C%0A%20%20pong%3A%201%0A%7D%3B%0A%0A%2F**%0A%20*%20Shortcut%20to%20%60Emitter%23emit%60.%0A%20*%2F%0A%0Avar%20emit%20%3D%20Emitter.prototype.emit%3B%0A%0A%2F**%0A%20*%20%60Socket%60%20constructor.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20Socket%20(io%2C%20nsp%2C%20opts)%20%7B%0A%20%20this.io%20%3D%20io%3B%0A%20%20this.nsp%20%3D%20nsp%3B%0A%20%20this.json%20%3D%20this%3B%20%2F%2F%20compat%0A%20%20this.ids%20%3D%200%3B%0A%20%20this.acks%20%3D%20%7B%7D%3B%0A%20%20this.receiveBuffer%20%3D%20%5B%5D%3B%0A%20%20this.sendBuffer%20%3D%20%5B%5D%3B%0A%20%20this.connected%20%3D%20false%3B%0A%20%20this.disconnected%20%3D%20true%3B%0A%20%20this.flags%20%3D%20%7B%7D%3B%0A%20%20if%20(opts%20%26%26%20opts.query)%20%7B%0A%20%20%20%20this.query%20%3D%20opts.query%3B%0A%20%20%7D%0A%20%20if%20(this.io.autoConnect)%20this.open()%3B%0A%7D%0A%0A%2F**%0A%20*%20Mix%20in%20%60Emitter%60.%0A%20*%2F%0A%0AEmitter(Socket.prototype)%3B%0A%0A%2F**%0A%20*%20Subscribe%20to%20open%2C%20close%20and%20packet%20events%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.subEvents%20%3D%20function%20()%20%7B%0A%20%20if%20(this.subs)%20return%3B%0A%0A%20%20var%20io%20%3D%20this.io%3B%0A%20%20this.subs%20%3D%20%5B%0A%20%20%20%20on(io%2C%20'open'%2C%20bind(this%2C%20'onopen'))%2C%0A%20%20%20%20on(io%2C%20'packet'%2C%20bind(this%2C%20'onpacket'))%2C%0A%20%20%20%20on(io%2C%20'close'%2C%20bind(this%2C%20'onclose'))%0A%20%20%5D%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20%22Opens%22%20the%20socket.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0ASocket.prototype.open%20%3D%0ASocket.prototype.connect%20%3D%20function%20()%20%7B%0A%20%20if%20(this.connected)%20return%20this%3B%0A%0A%20%20this.subEvents()%3B%0A%20%20this.io.open()%3B%20%2F%2F%20ensure%20open%0A%20%20if%20('open'%20%3D%3D%3D%20this.io.readyState)%20this.onopen()%3B%0A%20%20this.emit('connecting')%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sends%20a%20%60message%60%20event.%0A%20*%0A%20*%20%40return%20%7BSocket%7D%20self%0A%20*%20%40api%20public%0A%20*%2F%0A%0ASocket.prototype.send%20%3D%20function%20()%20%7B%0A%20%20var%20args%20%3D%20toArray(arguments)%3B%0A%20%20args.unshift('message')%3B%0A%20%20this.emit.apply(this%2C%20args)%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Override%20%60emit%60.%0A%20*%20If%20the%20event%20is%20in%20%60events%60%2C%20it's%20emitted%20normally.%0A%20*%0A%20*%20%40param%20%7BString%7D%20event%20name%0A%20*%20%40return%20%7BSocket%7D%20self%0A%20*%20%40api%20public%0A%20*%2F%0A%0ASocket.prototype.emit%20%3D%20function%20(ev)%20%7B%0A%20%20if%20(events.hasOwnProperty(ev))%20%7B%0A%20%20%20%20emit.apply(this%2C%20arguments)%3B%0A%20%20%20%20return%20this%3B%0A%20%20%7D%0A%0A%20%20var%20args%20%3D%20toArray(arguments)%3B%0A%20%20var%20packet%20%3D%20%7B%0A%20%20%20%20type%3A%20(this.flags.binary%20!%3D%3D%20undefined%20%3F%20this.flags.binary%20%3A%20hasBin(args))%20%3F%20parser.BINARY_EVENT%20%3A%20parser.EVENT%2C%0A%20%20%20%20data%3A%20args%0A%20%20%7D%3B%0A%0A%20%20packet.options%20%3D%20%7B%7D%3B%0A%20%20packet.options.compress%20%3D%20!this.flags%20%7C%7C%20false%20!%3D%3D%20this.flags.compress%3B%0A%0A%20%20%2F%2F%20event%20ack%20callback%0A%20%20if%20('function'%20%3D%3D%3D%20typeof%20args%5Bargs.length%20-%201%5D)%20%7B%0A%20%20%20%20debug('emitting%20packet%20with%20ack%20id%20%25d'%2C%20this.ids)%3B%0A%20%20%20%20this.acks%5Bthis.ids%5D%20%3D%20args.pop()%3B%0A%20%20%20%20packet.id%20%3D%20this.ids%2B%2B%3B%0A%20%20%7D%0A%0A%20%20if%20(this.connected)%20%7B%0A%20%20%20%20this.packet(packet)%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20this.sendBuffer.push(packet)%3B%0A%20%20%7D%0A%0A%20%20this.flags%20%3D%20%7B%7D%3B%0A%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sends%20a%20packet.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.packet%20%3D%20function%20(packet)%20%7B%0A%20%20packet.nsp%20%3D%20this.nsp%3B%0A%20%20this.io.packet(packet)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20engine%20%60open%60.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onopen%20%3D%20function%20()%20%7B%0A%20%20debug('transport%20is%20open%20-%20connecting')%3B%0A%0A%20%20%2F%2F%20write%20connect%20packet%20if%20necessary%0A%20%20if%20('%2F'%20!%3D%3D%20this.nsp)%20%7B%0A%20%20%20%20if%20(this.query)%20%7B%0A%20%20%20%20%20%20var%20query%20%3D%20typeof%20this.query%20%3D%3D%3D%20'object'%20%3F%20parseqs.encode(this.query)%20%3A%20this.query%3B%0A%20%20%20%20%20%20debug('sending%20connect%20packet%20with%20query%20%25s'%2C%20query)%3B%0A%20%20%20%20%20%20this.packet(%7Btype%3A%20parser.CONNECT%2C%20query%3A%20query%7D)%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20this.packet(%7Btype%3A%20parser.CONNECT%7D)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20engine%20%60close%60.%0A%20*%0A%20*%20%40param%20%7BString%7D%20reason%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onclose%20%3D%20function%20(reason)%20%7B%0A%20%20debug('close%20(%25s)'%2C%20reason)%3B%0A%20%20this.connected%20%3D%20false%3B%0A%20%20this.disconnected%20%3D%20true%3B%0A%20%20delete%20this.id%3B%0A%20%20this.emit('disconnect'%2C%20reason)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20with%20socket%20packet.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onpacket%20%3D%20function%20(packet)%20%7B%0A%20%20var%20sameNamespace%20%3D%20packet.nsp%20%3D%3D%3D%20this.nsp%3B%0A%20%20var%20rootNamespaceError%20%3D%20packet.type%20%3D%3D%3D%20parser.ERROR%20%26%26%20packet.nsp%20%3D%3D%3D%20'%2F'%3B%0A%0A%20%20if%20(!sameNamespace%20%26%26%20!rootNamespaceError)%20return%3B%0A%0A%20%20switch%20(packet.type)%20%7B%0A%20%20%20%20case%20parser.CONNECT%3A%0A%20%20%20%20%20%20this.onconnect()%3B%0A%20%20%20%20%20%20break%3B%0A%0A%20%20%20%20case%20parser.EVENT%3A%0A%20%20%20%20%20%20this.onevent(packet)%3B%0A%20%20%20%20%20%20break%3B%0A%0A%20%20%20%20case%20parser.BINARY_EVENT%3A%0A%20%20%20%20%20%20this.onevent(packet)%3B%0A%20%20%20%20%20%20break%3B%0A%0A%20%20%20%20case%20parser.ACK%3A%0A%20%20%20%20%20%20this.onack(packet)%3B%0A%20%20%20%20%20%20break%3B%0A%0A%20%20%20%20case%20parser.BINARY_ACK%3A%0A%20%20%20%20%20%20this.onack(packet)%3B%0A%20%20%20%20%20%20break%3B%0A%0A%20%20%20%20case%20parser.DISCONNECT%3A%0A%20%20%20%20%20%20this.ondisconnect()%3B%0A%20%20%20%20%20%20break%3B%0A%0A%20%20%20%20case%20parser.ERROR%3A%0A%20%20%20%20%20%20this.emit('error'%2C%20packet.data)%3B%0A%20%20%20%20%20%20break%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20a%20server%20event.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onevent%20%3D%20function%20(packet)%20%7B%0A%20%20var%20args%20%3D%20packet.data%20%7C%7C%20%5B%5D%3B%0A%20%20debug('emitting%20event%20%25j'%2C%20args)%3B%0A%0A%20%20if%20(null%20!%3D%20packet.id)%20%7B%0A%20%20%20%20debug('attaching%20ack%20callback%20to%20event')%3B%0A%20%20%20%20args.push(this.ack(packet.id))%3B%0A%20%20%7D%0A%0A%20%20if%20(this.connected)%20%7B%0A%20%20%20%20emit.apply(this%2C%20args)%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20this.receiveBuffer.push(args)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Produces%20an%20ack%20callback%20to%20emit%20with%20an%20event.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.ack%20%3D%20function%20(id)%20%7B%0A%20%20var%20self%20%3D%20this%3B%0A%20%20var%20sent%20%3D%20false%3B%0A%20%20return%20function%20()%20%7B%0A%20%20%20%20%2F%2F%20prevent%20double%20callbacks%0A%20%20%20%20if%20(sent)%20return%3B%0A%20%20%20%20sent%20%3D%20true%3B%0A%20%20%20%20var%20args%20%3D%20toArray(arguments)%3B%0A%20%20%20%20debug('sending%20ack%20%25j'%2C%20args)%3B%0A%0A%20%20%20%20self.packet(%7B%0A%20%20%20%20%20%20type%3A%20hasBin(args)%20%3F%20parser.BINARY_ACK%20%3A%20parser.ACK%2C%0A%20%20%20%20%20%20id%3A%20id%2C%0A%20%20%20%20%20%20data%3A%20args%0A%20%20%20%20%7D)%3B%0A%20%20%7D%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20a%20server%20acknowlegement.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onack%20%3D%20function%20(packet)%20%7B%0A%20%20var%20ack%20%3D%20this.acks%5Bpacket.id%5D%3B%0A%20%20if%20('function'%20%3D%3D%3D%20typeof%20ack)%20%7B%0A%20%20%20%20debug('calling%20ack%20%25s%20with%20%25j'%2C%20packet.id%2C%20packet.data)%3B%0A%20%20%20%20ack.apply(this%2C%20packet.data)%3B%0A%20%20%20%20delete%20this.acks%5Bpacket.id%5D%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20debug('bad%20ack%20%25s'%2C%20packet.id)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20server%20connect.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.onconnect%20%3D%20function%20()%20%7B%0A%20%20this.connected%20%3D%20true%3B%0A%20%20this.disconnected%20%3D%20false%3B%0A%20%20this.emit('connect')%3B%0A%20%20this.emitBuffered()%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Emit%20buffered%20events%20(received%20and%20emitted).%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.emitBuffered%20%3D%20function%20()%20%7B%0A%20%20var%20i%3B%0A%20%20for%20(i%20%3D%200%3B%20i%20%3C%20this.receiveBuffer.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20emit.apply(this%2C%20this.receiveBuffer%5Bi%5D)%3B%0A%20%20%7D%0A%20%20this.receiveBuffer%20%3D%20%5B%5D%3B%0A%0A%20%20for%20(i%20%3D%200%3B%20i%20%3C%20this.sendBuffer.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20this.packet(this.sendBuffer%5Bi%5D)%3B%0A%20%20%7D%0A%20%20this.sendBuffer%20%3D%20%5B%5D%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20server%20disconnect.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ASocket.prototype.ondisconnect%20%3D%20function%20()%20%7B%0A%20%20debug('server%20disconnect%20(%25s)'%2C%20this.nsp)%3B%0A%20%20this.destroy()%3B%0A%20%20this.onclose('io%20server%20disconnect')%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Called%20upon%20forced%20client%2Fserver%20side%20disconnections%2C%0A%20*%20this%20method%20ensures%20the%20manager%20stops%20tracking%20us%20and%0A%20*%20that%20reconnections%20don't%20get%20triggered%20for%20this.%0A%20*%0A%20*%20%40api%20private.%0A%20*%2F%0A%0ASocket.prototype.destroy%20%3D%20function%20()%20%7B%0A%20%20if%20(this.subs)%20%7B%0A%20%20%20%20%2F%2F%20clean%20subscriptions%20to%20avoid%20reconnections%0A%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20this.subs.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20this.subs%5Bi%5D.destroy()%3B%0A%20%20%20%20%7D%0A%20%20%20%20this.subs%20%3D%20null%3B%0A%20%20%7D%0A%0A%20%20this.io.destroy(this)%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Disconnects%20the%20socket%20manually.%0A%20*%0A%20*%20%40return%20%7BSocket%7D%20self%0A%20*%20%40api%20public%0A%20*%2F%0A%0ASocket.prototype.close%20%3D%0ASocket.prototype.disconnect%20%3D%20function%20()%20%7B%0A%20%20if%20(this.connected)%20%7B%0A%20%20%20%20debug('performing%20disconnect%20(%25s)'%2C%20this.nsp)%3B%0A%20%20%20%20this.packet(%7B%20type%3A%20parser.DISCONNECT%20%7D)%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20remove%20socket%20from%20pool%0A%20%20this.destroy()%3B%0A%0A%20%20if%20(this.connected)%20%7B%0A%20%20%20%20%2F%2F%20fire%20events%0A%20%20%20%20this.onclose('io%20client%20disconnect')%3B%0A%20%20%7D%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sets%20the%20compress%20flag.%0A%20*%0A%20*%20%40param%20%7BBoolean%7D%20if%20%60true%60%2C%20compresses%20the%20sending%20data%0A%20*%20%40return%20%7BSocket%7D%20self%0A%20*%20%40api%20public%0A%20*%2F%0A%0ASocket.prototype.compress%20%3D%20function%20(compress)%20%7B%0A%20%20this.flags.compress%20%3D%20compress%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Sets%20the%20binary%20flag%0A%20*%0A%20*%20%40param%20%7BBoolean%7D%20whether%20the%20emitted%20data%20contains%20binary%0A%20*%20%40return%20%7BSocket%7D%20self%0A%20*%20%40api%20public%0A%20*%2F%0A%0ASocket.prototype.binary%20%3D%20function%20(binary)%20%7B%0A%20%20this.flags.binary%20%3D%20binary%3B%0A%20%20return%20this%3B%0A%7D%3B%0A%0A%7D%2C%7B%22.%2Fon%22%3A37%2C%22component-bind%22%3A9%2C%22component-emitter%22%3A10%2C%22debug%22%3A12%2C%22has-binary2%22%3A26%2C%22parseqs%22%3A32%2C%22socket.io-parser%22%3A41%2C%22to-array%22%3A43%7D%5D%2C39%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%0A%2F**%0A%20*%20Module%20dependencies.%0A%20*%2F%0A%0Avar%20parseuri%20%3D%20require('parseuri')%3B%0Avar%20debug%20%3D%20require('debug')('socket.io-client%3Aurl')%3B%0A%0A%2F**%0A%20*%20Module%20exports.%0A%20*%2F%0A%0Amodule.exports%20%3D%20url%3B%0A%0A%2F**%0A%20*%20URL%20parser.%0A%20*%0A%20*%20%40param%20%7BString%7D%20url%0A%20*%20%40param%20%7BObject%7D%20An%20object%20meant%20to%20mimic%20window.location.%0A%20*%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Defaults%20to%20window.location.%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20url%20(uri%2C%20loc)%20%7B%0A%20%20var%20obj%20%3D%20uri%3B%0A%0A%20%20%2F%2F%20default%20to%20window.location%0A%20%20loc%20%3D%20loc%20%7C%7C%20global.location%3B%0A%20%20if%20(null%20%3D%3D%20uri)%20uri%20%3D%20loc.protocol%20%2B%20'%2F%2F'%20%2B%20loc.host%3B%0A%0A%20%20%2F%2F%20relative%20path%20support%0A%20%20if%20('string'%20%3D%3D%3D%20typeof%20uri)%20%7B%0A%20%20%20%20if%20('%2F'%20%3D%3D%3D%20uri.charAt(0))%20%7B%0A%20%20%20%20%20%20if%20('%2F'%20%3D%3D%3D%20uri.charAt(1))%20%7B%0A%20%20%20%20%20%20%20%20uri%20%3D%20loc.protocol%20%2B%20uri%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20uri%20%3D%20loc.host%20%2B%20uri%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20if%20(!%2F%5E(https%3F%7Cwss%3F)%3A%5C%2F%5C%2F%2F.test(uri))%20%7B%0A%20%20%20%20%20%20debug('protocol-less%20url%20%25s'%2C%20uri)%3B%0A%20%20%20%20%20%20if%20('undefined'%20!%3D%3D%20typeof%20loc)%20%7B%0A%20%20%20%20%20%20%20%20uri%20%3D%20loc.protocol%20%2B%20'%2F%2F'%20%2B%20uri%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20uri%20%3D%20'https%3A%2F%2F'%20%2B%20uri%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20parse%0A%20%20%20%20debug('parse%20%25s'%2C%20uri)%3B%0A%20%20%20%20obj%20%3D%20parseuri(uri)%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20make%20sure%20we%20treat%20%60localhost%3A80%60%20and%20%60localhost%60%20equally%0A%20%20if%20(!obj.port)%20%7B%0A%20%20%20%20if%20(%2F%5E(http%7Cws)%24%2F.test(obj.protocol))%20%7B%0A%20%20%20%20%20%20obj.port%20%3D%20'80'%3B%0A%20%20%20%20%7D%20else%20if%20(%2F%5E(http%7Cws)s%24%2F.test(obj.protocol))%20%7B%0A%20%20%20%20%20%20obj.port%20%3D%20'443'%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20obj.path%20%3D%20obj.path%20%7C%7C%20'%2F'%3B%0A%0A%20%20var%20ipv6%20%3D%20obj.host.indexOf('%3A')%20!%3D%3D%20-1%3B%0A%20%20var%20host%20%3D%20ipv6%20%3F%20'%5B'%20%2B%20obj.host%20%2B%20'%5D'%20%3A%20obj.host%3B%0A%0A%20%20%2F%2F%20define%20unique%20id%0A%20%20obj.id%20%3D%20obj.protocol%20%2B%20'%3A%2F%2F'%20%2B%20host%20%2B%20'%3A'%20%2B%20obj.port%3B%0A%20%20%2F%2F%20define%20href%0A%20%20obj.href%20%3D%20obj.protocol%20%2B%20'%3A%2F%2F'%20%2B%20host%20%2B%20(loc%20%26%26%20loc.port%20%3D%3D%3D%20obj.port%20%3F%20''%20%3A%20('%3A'%20%2B%20obj.port))%3B%0A%0A%20%20return%20obj%3B%0A%7D%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%22debug%22%3A12%2C%22parseuri%22%3A33%7D%5D%2C40%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%2F*global%20Blob%2CFile*%2F%0A%0A%2F**%0A%20*%20Module%20requirements%0A%20*%2F%0A%0Avar%20isArray%20%3D%20require('isarray')%3B%0Avar%20isBuf%20%3D%20require('.%2Fis-buffer')%3B%0Avar%20toString%20%3D%20Object.prototype.toString%3B%0Avar%20withNativeBlob%20%3D%20typeof%20global.Blob%20%3D%3D%3D%20'function'%20%7C%7C%20toString.call(global.Blob)%20%3D%3D%3D%20'%5Bobject%20BlobConstructor%5D'%3B%0Avar%20withNativeFile%20%3D%20typeof%20global.File%20%3D%3D%3D%20'function'%20%7C%7C%20toString.call(global.File)%20%3D%3D%3D%20'%5Bobject%20FileConstructor%5D'%3B%0A%0A%2F**%0A%20*%20Replaces%20every%20Buffer%20%7C%20ArrayBuffer%20in%20packet%20with%20a%20numbered%20placeholder.%0A%20*%20Anything%20with%20blobs%20or%20files%20should%20be%20fed%20through%20removeBlobs%20before%20coming%0A%20*%20here.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%20-%20socket.io%20event%20packet%0A%20*%20%40return%20%7BObject%7D%20with%20deconstructed%20packet%20and%20list%20of%20buffers%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.deconstructPacket%20%3D%20function(packet)%20%7B%0A%20%20var%20buffers%20%3D%20%5B%5D%3B%0A%20%20var%20packetData%20%3D%20packet.data%3B%0A%20%20var%20pack%20%3D%20packet%3B%0A%20%20pack.data%20%3D%20_deconstructPacket(packetData%2C%20buffers)%3B%0A%20%20pack.attachments%20%3D%20buffers.length%3B%20%2F%2F%20number%20of%20binary%20'attachments'%0A%20%20return%20%7Bpacket%3A%20pack%2C%20buffers%3A%20buffers%7D%3B%0A%7D%3B%0A%0Afunction%20_deconstructPacket(data%2C%20buffers)%20%7B%0A%20%20if%20(!data)%20return%20data%3B%0A%0A%20%20if%20(isBuf(data))%20%7B%0A%20%20%20%20var%20placeholder%20%3D%20%7B%20_placeholder%3A%20true%2C%20num%3A%20buffers.length%20%7D%3B%0A%20%20%20%20buffers.push(data)%3B%0A%20%20%20%20return%20placeholder%3B%0A%20%20%7D%20else%20if%20(isArray(data))%20%7B%0A%20%20%20%20var%20newData%20%3D%20new%20Array(data.length)%3B%0A%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20data.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20newData%5Bi%5D%20%3D%20_deconstructPacket(data%5Bi%5D%2C%20buffers)%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20newData%3B%0A%20%20%7D%20else%20if%20(typeof%20data%20%3D%3D%3D%20'object'%20%26%26%20!(data%20instanceof%20Date))%20%7B%0A%20%20%20%20var%20newData%20%3D%20%7B%7D%3B%0A%20%20%20%20for%20(var%20key%20in%20data)%20%7B%0A%20%20%20%20%20%20newData%5Bkey%5D%20%3D%20_deconstructPacket(data%5Bkey%5D%2C%20buffers)%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20newData%3B%0A%20%20%7D%0A%20%20return%20data%3B%0A%7D%0A%0A%2F**%0A%20*%20Reconstructs%20a%20binary%20packet%20from%20its%20placeholder%20packet%20and%20buffers%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%20-%20event%20packet%20with%20placeholders%0A%20*%20%40param%20%7BArray%7D%20buffers%20-%20binary%20buffers%20to%20put%20in%20placeholder%20positions%0A%20*%20%40return%20%7BObject%7D%20reconstructed%20packet%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.reconstructPacket%20%3D%20function(packet%2C%20buffers)%20%7B%0A%20%20packet.data%20%3D%20_reconstructPacket(packet.data%2C%20buffers)%3B%0A%20%20packet.attachments%20%3D%20undefined%3B%20%2F%2F%20no%20longer%20useful%0A%20%20return%20packet%3B%0A%7D%3B%0A%0Afunction%20_reconstructPacket(data%2C%20buffers)%20%7B%0A%20%20if%20(!data)%20return%20data%3B%0A%0A%20%20if%20(data%20%26%26%20data._placeholder)%20%7B%0A%20%20%20%20return%20buffers%5Bdata.num%5D%3B%20%2F%2F%20appropriate%20buffer%20(should%20be%20natural%20order%20anyway)%0A%20%20%7D%20else%20if%20(isArray(data))%20%7B%0A%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20data.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20data%5Bi%5D%20%3D%20_reconstructPacket(data%5Bi%5D%2C%20buffers)%3B%0A%20%20%20%20%7D%0A%20%20%7D%20else%20if%20(typeof%20data%20%3D%3D%3D%20'object')%20%7B%0A%20%20%20%20for%20(var%20key%20in%20data)%20%7B%0A%20%20%20%20%20%20data%5Bkey%5D%20%3D%20_reconstructPacket(data%5Bkey%5D%2C%20buffers)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20return%20data%3B%0A%7D%0A%0A%2F**%0A%20*%20Asynchronously%20removes%20Blobs%20or%20Files%20from%20data%20via%0A%20*%20FileReader's%20readAsArrayBuffer%20method.%20Used%20before%20encoding%0A%20*%20data%20as%20msgpack.%20Calls%20callback%20with%20the%20blobless%20data.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20data%0A%20*%20%40param%20%7BFunction%7D%20callback%0A%20*%20%40api%20private%0A%20*%2F%0A%0Aexports.removeBlobs%20%3D%20function(data%2C%20callback)%20%7B%0A%20%20function%20_removeBlobs(obj%2C%20curKey%2C%20containingObject)%20%7B%0A%20%20%20%20if%20(!obj)%20return%20obj%3B%0A%0A%20%20%20%20%2F%2F%20convert%20any%20blob%0A%20%20%20%20if%20((withNativeBlob%20%26%26%20obj%20instanceof%20Blob)%20%7C%7C%0A%20%20%20%20%20%20%20%20(withNativeFile%20%26%26%20obj%20instanceof%20File))%20%7B%0A%20%20%20%20%20%20pendingBlobs%2B%2B%3B%0A%0A%20%20%20%20%20%20%2F%2F%20async%20filereader%0A%20%20%20%20%20%20var%20fileReader%20%3D%20new%20FileReader()%3B%0A%20%20%20%20%20%20fileReader.onload%20%3D%20function()%20%7B%20%2F%2F%20this.result%20%3D%3D%20arraybuffer%0A%20%20%20%20%20%20%20%20if%20(containingObject)%20%7B%0A%20%20%20%20%20%20%20%20%20%20containingObject%5BcurKey%5D%20%3D%20this.result%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20bloblessData%20%3D%20this.result%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20if%20nothing%20pending%20its%20callback%20time%0A%20%20%20%20%20%20%20%20if(!%20--pendingBlobs)%20%7B%0A%20%20%20%20%20%20%20%20%20%20callback(bloblessData)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%3B%0A%0A%20%20%20%20%20%20fileReader.readAsArrayBuffer(obj)%3B%20%2F%2F%20blob%20-%3E%20arraybuffer%0A%20%20%20%20%7D%20else%20if%20(isArray(obj))%20%7B%20%2F%2F%20handle%20array%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20obj.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20_removeBlobs(obj%5Bi%5D%2C%20i%2C%20obj)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%20else%20if%20(typeof%20obj%20%3D%3D%3D%20'object'%20%26%26%20!isBuf(obj))%20%7B%20%2F%2F%20and%20object%0A%20%20%20%20%20%20for%20(var%20key%20in%20obj)%20%7B%0A%20%20%20%20%20%20%20%20_removeBlobs(obj%5Bkey%5D%2C%20key%2C%20obj)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20var%20pendingBlobs%20%3D%200%3B%0A%20%20var%20bloblessData%20%3D%20data%3B%0A%20%20_removeBlobs(bloblessData)%3B%0A%20%20if%20(!pendingBlobs)%20%7B%0A%20%20%20%20callback(bloblessData)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%22.%2Fis-buffer%22%3A42%2C%22isarray%22%3A30%7D%5D%2C41%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%0A%2F**%0A%20*%20Module%20dependencies.%0A%20*%2F%0A%0Avar%20debug%20%3D%20require('debug')('socket.io-parser')%3B%0Avar%20Emitter%20%3D%20require('component-emitter')%3B%0Avar%20binary%20%3D%20require('.%2Fbinary')%3B%0Avar%20isArray%20%3D%20require('isarray')%3B%0Avar%20isBuf%20%3D%20require('.%2Fis-buffer')%3B%0A%0A%2F**%0A%20*%20Protocol%20version.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.protocol%20%3D%204%3B%0A%0A%2F**%0A%20*%20Packet%20types.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.types%20%3D%20%5B%0A%20%20'CONNECT'%2C%0A%20%20'DISCONNECT'%2C%0A%20%20'EVENT'%2C%0A%20%20'ACK'%2C%0A%20%20'ERROR'%2C%0A%20%20'BINARY_EVENT'%2C%0A%20%20'BINARY_ACK'%0A%5D%3B%0A%0A%2F**%0A%20*%20Packet%20type%20%60connect%60.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.CONNECT%20%3D%200%3B%0A%0A%2F**%0A%20*%20Packet%20type%20%60disconnect%60.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.DISCONNECT%20%3D%201%3B%0A%0A%2F**%0A%20*%20Packet%20type%20%60event%60.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.EVENT%20%3D%202%3B%0A%0A%2F**%0A%20*%20Packet%20type%20%60ack%60.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.ACK%20%3D%203%3B%0A%0A%2F**%0A%20*%20Packet%20type%20%60error%60.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.ERROR%20%3D%204%3B%0A%0A%2F**%0A%20*%20Packet%20type%20'binary%20event'%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.BINARY_EVENT%20%3D%205%3B%0A%0A%2F**%0A%20*%20Packet%20type%20%60binary%20ack%60.%20For%20acks%20with%20binary%20arguments.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.BINARY_ACK%20%3D%206%3B%0A%0A%2F**%0A%20*%20Encoder%20constructor.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.Encoder%20%3D%20Encoder%3B%0A%0A%2F**%0A%20*%20Decoder%20constructor.%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Aexports.Decoder%20%3D%20Decoder%3B%0A%0A%2F**%0A%20*%20A%20socket.io%20Encoder%20instance%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20Encoder()%20%7B%7D%0A%0Avar%20ERROR_PACKET%20%3D%20exports.ERROR%20%2B%20'%22encode%20error%22'%3B%0A%0A%2F**%0A%20*%20Encode%20a%20packet%20as%20a%20single%20string%20if%20non-binary%2C%20or%20as%20a%0A%20*%20buffer%20sequence%2C%20depending%20on%20packet%20type.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20obj%20-%20packet%20object%0A%20*%20%40param%20%7BFunction%7D%20callback%20-%20function%20to%20handle%20encodings%20(likely%20engine.write)%0A%20*%20%40return%20Calls%20callback%20with%20Array%20of%20encodings%0A%20*%20%40api%20public%0A%20*%2F%0A%0AEncoder.prototype.encode%20%3D%20function(obj%2C%20callback)%7B%0A%20%20debug('encoding%20packet%20%25j'%2C%20obj)%3B%0A%0A%20%20if%20(exports.BINARY_EVENT%20%3D%3D%3D%20obj.type%20%7C%7C%20exports.BINARY_ACK%20%3D%3D%3D%20obj.type)%20%7B%0A%20%20%20%20encodeAsBinary(obj%2C%20callback)%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20var%20encoding%20%3D%20encodeAsString(obj)%3B%0A%20%20%20%20callback(%5Bencoding%5D)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Encode%20packet%20as%20string.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%0A%20*%20%40return%20%7BString%7D%20encoded%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20encodeAsString(obj)%20%7B%0A%0A%20%20%2F%2F%20first%20is%20type%0A%20%20var%20str%20%3D%20''%20%2B%20obj.type%3B%0A%0A%20%20%2F%2F%20attachments%20if%20we%20have%20them%0A%20%20if%20(exports.BINARY_EVENT%20%3D%3D%3D%20obj.type%20%7C%7C%20exports.BINARY_ACK%20%3D%3D%3D%20obj.type)%20%7B%0A%20%20%20%20str%20%2B%3D%20obj.attachments%20%2B%20'-'%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20if%20we%20have%20a%20namespace%20other%20than%20%60%2F%60%0A%20%20%2F%2F%20we%20append%20it%20followed%20by%20a%20comma%20%60%2C%60%0A%20%20if%20(obj.nsp%20%26%26%20'%2F'%20!%3D%3D%20obj.nsp)%20%7B%0A%20%20%20%20str%20%2B%3D%20obj.nsp%20%2B%20'%2C'%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20immediately%20followed%20by%20the%20id%0A%20%20if%20(null%20!%3D%20obj.id)%20%7B%0A%20%20%20%20str%20%2B%3D%20obj.id%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20json%20data%0A%20%20if%20(null%20!%3D%20obj.data)%20%7B%0A%20%20%20%20var%20payload%20%3D%20tryStringify(obj.data)%3B%0A%20%20%20%20if%20(payload%20!%3D%3D%20false)%20%7B%0A%20%20%20%20%20%20str%20%2B%3D%20payload%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20return%20ERROR_PACKET%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20debug('encoded%20%25j%20as%20%25s'%2C%20obj%2C%20str)%3B%0A%20%20return%20str%3B%0A%7D%0A%0Afunction%20tryStringify(str)%20%7B%0A%20%20try%20%7B%0A%20%20%20%20return%20JSON.stringify(str)%3B%0A%20%20%7D%20catch(e)%7B%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%7D%0A%0A%2F**%0A%20*%20Encode%20packet%20as%20'buffer%20sequence'%20by%20removing%20blobs%2C%20and%0A%20*%20deconstructing%20packet%20into%20object%20with%20placeholders%20and%0A%20*%20a%20list%20of%20buffers.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%0A%20*%20%40return%20%7BBuffer%7D%20encoded%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20encodeAsBinary(obj%2C%20callback)%20%7B%0A%0A%20%20function%20writeEncoding(bloblessData)%20%7B%0A%20%20%20%20var%20deconstruction%20%3D%20binary.deconstructPacket(bloblessData)%3B%0A%20%20%20%20var%20pack%20%3D%20encodeAsString(deconstruction.packet)%3B%0A%20%20%20%20var%20buffers%20%3D%20deconstruction.buffers%3B%0A%0A%20%20%20%20buffers.unshift(pack)%3B%20%2F%2F%20add%20packet%20info%20to%20beginning%20of%20data%20list%0A%20%20%20%20callback(buffers)%3B%20%2F%2F%20write%20all%20the%20buffers%0A%20%20%7D%0A%0A%20%20binary.removeBlobs(obj%2C%20writeEncoding)%3B%0A%7D%0A%0A%2F**%0A%20*%20A%20socket.io%20Decoder%20instance%0A%20*%0A%20*%20%40return%20%7BObject%7D%20decoder%0A%20*%20%40api%20public%0A%20*%2F%0A%0Afunction%20Decoder()%20%7B%0A%20%20this.reconstructor%20%3D%20null%3B%0A%7D%0A%0A%2F**%0A%20*%20Mix%20in%20%60Emitter%60%20with%20Decoder.%0A%20*%2F%0A%0AEmitter(Decoder.prototype)%3B%0A%0A%2F**%0A%20*%20Decodes%20an%20ecoded%20packet%20string%20into%20packet%20JSON.%0A%20*%0A%20*%20%40param%20%7BString%7D%20obj%20-%20encoded%20packet%0A%20*%20%40return%20%7BObject%7D%20packet%0A%20*%20%40api%20public%0A%20*%2F%0A%0ADecoder.prototype.add%20%3D%20function(obj)%20%7B%0A%20%20var%20packet%3B%0A%20%20if%20(typeof%20obj%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20packet%20%3D%20decodeString(obj)%3B%0A%20%20%20%20if%20(exports.BINARY_EVENT%20%3D%3D%3D%20packet.type%20%7C%7C%20exports.BINARY_ACK%20%3D%3D%3D%20packet.type)%20%7B%20%2F%2F%20binary%20packet's%20json%0A%20%20%20%20%20%20this.reconstructor%20%3D%20new%20BinaryReconstructor(packet)%3B%0A%0A%20%20%20%20%20%20%2F%2F%20no%20attachments%2C%20labeled%20binary%20but%20no%20binary%20data%20to%20follow%0A%20%20%20%20%20%20if%20(this.reconstructor.reconPack.attachments%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20this.emit('decoded'%2C%20packet)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%20else%20%7B%20%2F%2F%20non-binary%20full%20packet%0A%20%20%20%20%20%20this.emit('decoded'%2C%20packet)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20else%20if%20(isBuf(obj)%20%7C%7C%20obj.base64)%20%7B%20%2F%2F%20raw%20binary%20data%0A%20%20%20%20if%20(!this.reconstructor)%20%7B%0A%20%20%20%20%20%20throw%20new%20Error('got%20binary%20data%20when%20not%20reconstructing%20a%20packet')%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20packet%20%3D%20this.reconstructor.takeBinaryData(obj)%3B%0A%20%20%20%20%20%20if%20(packet)%20%7B%20%2F%2F%20received%20final%20buffer%0A%20%20%20%20%20%20%20%20this.reconstructor%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20this.emit('decoded'%2C%20packet)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20else%20%7B%0A%20%20%20%20throw%20new%20Error('Unknown%20type%3A%20'%20%2B%20obj)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20Decode%20a%20packet%20String%20(JSON%20data)%0A%20*%0A%20*%20%40param%20%7BString%7D%20str%0A%20*%20%40return%20%7BObject%7D%20packet%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20decodeString(str)%20%7B%0A%20%20var%20i%20%3D%200%3B%0A%20%20%2F%2F%20look%20up%20type%0A%20%20var%20p%20%3D%20%7B%0A%20%20%20%20type%3A%20Number(str.charAt(0))%0A%20%20%7D%3B%0A%0A%20%20if%20(null%20%3D%3D%20exports.types%5Bp.type%5D)%20%7B%0A%20%20%20%20return%20error('unknown%20packet%20type%20'%20%2B%20p.type)%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20look%20up%20attachments%20if%20type%20binary%0A%20%20if%20(exports.BINARY_EVENT%20%3D%3D%3D%20p.type%20%7C%7C%20exports.BINARY_ACK%20%3D%3D%3D%20p.type)%20%7B%0A%20%20%20%20var%20buf%20%3D%20''%3B%0A%20%20%20%20while%20(str.charAt(%2B%2Bi)%20!%3D%3D%20'-')%20%7B%0A%20%20%20%20%20%20buf%20%2B%3D%20str.charAt(i)%3B%0A%20%20%20%20%20%20if%20(i%20%3D%3D%20str.length)%20break%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20(buf%20!%3D%20Number(buf)%20%7C%7C%20str.charAt(i)%20!%3D%3D%20'-')%20%7B%0A%20%20%20%20%20%20throw%20new%20Error('Illegal%20attachments')%3B%0A%20%20%20%20%7D%0A%20%20%20%20p.attachments%20%3D%20Number(buf)%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20look%20up%20namespace%20(if%20any)%0A%20%20if%20('%2F'%20%3D%3D%3D%20str.charAt(i%20%2B%201))%20%7B%0A%20%20%20%20p.nsp%20%3D%20''%3B%0A%20%20%20%20while%20(%2B%2Bi)%20%7B%0A%20%20%20%20%20%20var%20c%20%3D%20str.charAt(i)%3B%0A%20%20%20%20%20%20if%20('%2C'%20%3D%3D%3D%20c)%20break%3B%0A%20%20%20%20%20%20p.nsp%20%2B%3D%20c%3B%0A%20%20%20%20%20%20if%20(i%20%3D%3D%3D%20str.length)%20break%3B%0A%20%20%20%20%7D%0A%20%20%7D%20else%20%7B%0A%20%20%20%20p.nsp%20%3D%20'%2F'%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20look%20up%20id%0A%20%20var%20next%20%3D%20str.charAt(i%20%2B%201)%3B%0A%20%20if%20(''%20!%3D%3D%20next%20%26%26%20Number(next)%20%3D%3D%20next)%20%7B%0A%20%20%20%20p.id%20%3D%20''%3B%0A%20%20%20%20while%20(%2B%2Bi)%20%7B%0A%20%20%20%20%20%20var%20c%20%3D%20str.charAt(i)%3B%0A%20%20%20%20%20%20if%20(null%20%3D%3D%20c%20%7C%7C%20Number(c)%20!%3D%20c)%20%7B%0A%20%20%20%20%20%20%20%20--i%3B%0A%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20p.id%20%2B%3D%20str.charAt(i)%3B%0A%20%20%20%20%20%20if%20(i%20%3D%3D%3D%20str.length)%20break%3B%0A%20%20%20%20%7D%0A%20%20%20%20p.id%20%3D%20Number(p.id)%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20look%20up%20json%20data%0A%20%20if%20(str.charAt(%2B%2Bi))%20%7B%0A%20%20%20%20var%20payload%20%3D%20tryParse(str.substr(i))%3B%0A%20%20%20%20var%20isPayloadValid%20%3D%20payload%20!%3D%3D%20false%20%26%26%20(p.type%20%3D%3D%3D%20exports.ERROR%20%7C%7C%20isArray(payload))%3B%0A%20%20%20%20if%20(isPayloadValid)%20%7B%0A%20%20%20%20%20%20p.data%20%3D%20payload%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20return%20error('invalid%20payload')%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20debug('decoded%20%25s%20as%20%25j'%2C%20str%2C%20p)%3B%0A%20%20return%20p%3B%0A%7D%0A%0Afunction%20tryParse(str)%20%7B%0A%20%20try%20%7B%0A%20%20%20%20return%20JSON.parse(str)%3B%0A%20%20%7D%20catch(e)%7B%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%7D%0A%0A%2F**%0A%20*%20Deallocates%20a%20parser's%20resources%0A%20*%0A%20*%20%40api%20public%0A%20*%2F%0A%0ADecoder.prototype.destroy%20%3D%20function()%20%7B%0A%20%20if%20(this.reconstructor)%20%7B%0A%20%20%20%20this.reconstructor.finishedReconstruction()%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F**%0A%20*%20A%20manager%20of%20a%20binary%20event's%20'buffer%20sequence'.%20Should%0A%20*%20be%20constructed%20whenever%20a%20packet%20of%20type%20BINARY_EVENT%20is%0A%20*%20decoded.%0A%20*%0A%20*%20%40param%20%7BObject%7D%20packet%0A%20*%20%40return%20%7BBinaryReconstructor%7D%20initialized%20reconstructor%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20BinaryReconstructor(packet)%20%7B%0A%20%20this.reconPack%20%3D%20packet%3B%0A%20%20this.buffers%20%3D%20%5B%5D%3B%0A%7D%0A%0A%2F**%0A%20*%20Method%20to%20be%20called%20when%20binary%20data%20received%20from%20connection%0A%20*%20after%20a%20BINARY_EVENT%20packet.%0A%20*%0A%20*%20%40param%20%7BBuffer%20%7C%20ArrayBuffer%7D%20binData%20-%20the%20raw%20binary%20data%20received%0A%20*%20%40return%20%7Bnull%20%7C%20Object%7D%20returns%20null%20if%20more%20binary%20data%20is%20expected%20or%0A%20*%20%20%20a%20reconstructed%20packet%20object%20if%20all%20buffers%20have%20been%20received.%0A%20*%20%40api%20private%0A%20*%2F%0A%0ABinaryReconstructor.prototype.takeBinaryData%20%3D%20function(binData)%20%7B%0A%20%20this.buffers.push(binData)%3B%0A%20%20if%20(this.buffers.length%20%3D%3D%3D%20this.reconPack.attachments)%20%7B%20%2F%2F%20done%20with%20buffer%20list%0A%20%20%20%20var%20packet%20%3D%20binary.reconstructPacket(this.reconPack%2C%20this.buffers)%3B%0A%20%20%20%20this.finishedReconstruction()%3B%0A%20%20%20%20return%20packet%3B%0A%20%20%7D%0A%20%20return%20null%3B%0A%7D%3B%0A%0A%2F**%0A%20*%20Cleans%20up%20binary%20packet%20reconstruction%20variables.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0ABinaryReconstructor.prototype.finishedReconstruction%20%3D%20function()%20%7B%0A%20%20this.reconPack%20%3D%20null%3B%0A%20%20this.buffers%20%3D%20%5B%5D%3B%0A%7D%3B%0A%0Afunction%20error(msg)%20%7B%0A%20%20return%20%7B%0A%20%20%20%20type%3A%20exports.ERROR%2C%0A%20%20%20%20data%3A%20'parser%20error%3A%20'%20%2B%20msg%0A%20%20%7D%3B%0A%7D%0A%0A%7D%2C%7B%22.%2Fbinary%22%3A40%2C%22.%2Fis-buffer%22%3A42%2C%22component-emitter%22%3A10%2C%22debug%22%3A12%2C%22isarray%22%3A30%7D%5D%2C42%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A(function%20(global)%7B%0A%0Amodule.exports%20%3D%20isBuf%3B%0A%0Avar%20withNativeBuffer%20%3D%20typeof%20global.Buffer%20%3D%3D%3D%20'function'%20%26%26%20typeof%20global.Buffer.isBuffer%20%3D%3D%3D%20'function'%3B%0Avar%20withNativeArrayBuffer%20%3D%20typeof%20global.ArrayBuffer%20%3D%3D%3D%20'function'%3B%0A%0Avar%20isView%20%3D%20(function%20()%20%7B%0A%20%20if%20(withNativeArrayBuffer%20%26%26%20typeof%20global.ArrayBuffer.isView%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20return%20global.ArrayBuffer.isView%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20return%20function%20(obj)%20%7B%20return%20obj.buffer%20instanceof%20global.ArrayBuffer%3B%20%7D%3B%0A%20%20%7D%0A%7D)()%3B%0A%0A%2F**%0A%20*%20Returns%20true%20if%20obj%20is%20a%20buffer%20or%20an%20arraybuffer.%0A%20*%0A%20*%20%40api%20private%0A%20*%2F%0A%0Afunction%20isBuf(obj)%20%7B%0A%20%20return%20(withNativeBuffer%20%26%26%20global.Buffer.isBuffer(obj))%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20(withNativeArrayBuffer%20%26%26%20(obj%20instanceof%20global.ArrayBuffer%20%7C%7C%20isView(obj)))%3B%0A%7D%0A%0A%7D).call(this%2Ctypeof%20global%20!%3D%3D%20%22undefined%22%20%3F%20global%20%3A%20typeof%20self%20!%3D%3D%20%22undefined%22%20%3F%20self%20%3A%20typeof%20window%20!%3D%3D%20%22undefined%22%20%3F%20window%20%3A%20%7B%7D)%0A%7D%2C%7B%7D%5D%2C43%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0Amodule.exports%20%3D%20toArray%0A%0Afunction%20toArray(list%2C%20index)%20%7B%0A%20%20%20%20var%20array%20%3D%20%5B%5D%0A%0A%20%20%20%20index%20%3D%20index%20%7C%7C%200%0A%0A%20%20%20%20for%20(var%20i%20%3D%20index%20%7C%7C%200%3B%20i%20%3C%20list.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20array%5Bi%20-%20index%5D%20%3D%20list%5Bi%5D%0A%20%20%20%20%7D%0A%0A%20%20%20%20return%20array%0A%7D%0A%0A%7D%2C%7B%7D%5D%2C44%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A'use%20strict'%3B%0A%0Avar%20alphabet%20%3D%20'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_'.split('')%0A%20%20%2C%20length%20%3D%2064%0A%20%20%2C%20map%20%3D%20%7B%7D%0A%20%20%2C%20seed%20%3D%200%0A%20%20%2C%20i%20%3D%200%0A%20%20%2C%20prev%3B%0A%0A%2F**%0A%20*%20Return%20a%20string%20representing%20the%20specified%20number.%0A%20*%0A%20*%20%40param%20%7BNumber%7D%20num%20The%20number%20to%20convert.%0A%20*%20%40returns%20%7BString%7D%20The%20string%20representation%20of%20the%20number.%0A%20*%20%40api%20public%0A%20*%2F%0Afunction%20encode(num)%20%7B%0A%20%20var%20encoded%20%3D%20''%3B%0A%0A%20%20do%20%7B%0A%20%20%20%20encoded%20%3D%20alphabet%5Bnum%20%25%20length%5D%20%2B%20encoded%3B%0A%20%20%20%20num%20%3D%20Math.floor(num%20%2F%20length)%3B%0A%20%20%7D%20while%20(num%20%3E%200)%3B%0A%0A%20%20return%20encoded%3B%0A%7D%0A%0A%2F**%0A%20*%20Return%20the%20integer%20value%20specified%20by%20the%20given%20string.%0A%20*%0A%20*%20%40param%20%7BString%7D%20str%20The%20string%20to%20convert.%0A%20*%20%40returns%20%7BNumber%7D%20The%20integer%20value%20represented%20by%20the%20string.%0A%20*%20%40api%20public%0A%20*%2F%0Afunction%20decode(str)%20%7B%0A%20%20var%20decoded%20%3D%200%3B%0A%0A%20%20for%20(i%20%3D%200%3B%20i%20%3C%20str.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20decoded%20%3D%20decoded%20*%20length%20%2B%20map%5Bstr.charAt(i)%5D%3B%0A%20%20%7D%0A%0A%20%20return%20decoded%3B%0A%7D%0A%0A%2F**%0A%20*%20Yeast%3A%20A%20tiny%20growing%20id%20generator.%0A%20*%0A%20*%20%40returns%20%7BString%7D%20A%20unique%20id.%0A%20*%20%40api%20public%0A%20*%2F%0Afunction%20yeast()%20%7B%0A%20%20var%20now%20%3D%20encode(%2Bnew%20Date())%3B%0A%0A%20%20if%20(now%20!%3D%3D%20prev)%20return%20seed%20%3D%200%2C%20prev%20%3D%20now%3B%0A%20%20return%20now%20%2B'.'%2B%20encode(seed%2B%2B)%3B%0A%7D%0A%0A%2F%2F%0A%2F%2F%20Map%20each%20character%20to%20its%20index.%0A%2F%2F%0Afor%20(%3B%20i%20%3C%20length%3B%20i%2B%2B)%20map%5Balphabet%5Bi%5D%5D%20%3D%20i%3B%0A%0A%2F%2F%0A%2F%2F%20Expose%20the%20%60yeast%60%2C%20%60encode%60%20and%20%60decode%60%20functions.%0A%2F%2F%0Ayeast.encode%20%3D%20encode%3B%0Ayeast.decode%20%3D%20decode%3B%0Amodule.exports%20%3D%20yeast%3B%0A%0A%7D%2C%7B%7D%5D%2C45%3A%5Bfunction(require%2Cmodule%2Cexports)%7B%0A%2F%2F%20main%20worker%20file%0A%0Aconst%20io%20%3D%20require('socket.io-client')%3B%0Alet%20socket%20%3D%20null%3B%0A%0Aonmessage%20%3D%20function(e)%20%7B%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20switch(e.data.type)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20'make_connect'%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket%20%3D%20io(...e.data.content)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('connect'%2C%20function()%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'connect'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20undefined%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'id'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20socket.id%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('connect_error'%2C%20function(error)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'connect_error'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20error%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('connect_timeout'%2C%20function(timeout)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'connect_timeout'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20timeout%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('error'%2C%20function(error)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%3A%20'error'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20contnet%20%3A%20error%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('disconnect'%2C%20function(reason)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'disconnect'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20reason%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('reconnect'%2C%20function(attempt)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'reconnect'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20attempt%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('reconnect_attempt'%2C%20function(attempt)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'reconnect_attempt'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20attempt%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('reconnecting'%2C%20function(attempt)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'reconnecting'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20attempt%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('reconnect_error'%2C%20function(error)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'reconnect_error'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20attempt%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('reconnect_failed'%2C%20function()%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'reconnect_error'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20undefined%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('ping'%2C%20function()%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'ping'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20undefined%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on('pong'%2C%20function(latency)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20'pong'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20latency%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20'emit'%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(socket%20!%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.emit(...e.data.content)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20'emit_ack'%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(socket%20!%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.emit(...e.data.content%2C%20function(ack)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'emit_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ackId%20%3A%20e.data.ackId%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20ack%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20'on'%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(socket%20!%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.on(e.data.eventname%2C%20function(inboundMsg)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20postMessage(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%20%3A%20'on_cb'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eventname%20%3A%20e.data.eventname%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%20%3A%20inboundMsg%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20case%20'close'%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(socket)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20socket.close()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%20catch%20(err)%20%7B%0A%20%20%20%20%20%20%20%20postMessage(%7Btype%20%3A%20'error'%2C%20content%20%3A%20err.toString()%7D)%3B%0A%20%20%20%20%7D%0A%7D%0A%0A%7D%2C%7B%22socket.io-client%22%3A35%7D%5D%7D%2C%7B%7D%2C%5B45%5D)%3B%0A")], {type : 'application/javascript'});

    class socketworker {
        constructor(workerURI, socketURL, socketOptions) {
            const self = this;
            socketURL = socketURL || '/';
            socketOptions = socketOptions || {};
            self.worker = new Worker(workerURI);
            self.worker.postMessage({
                type : 'make_connect',
                content : [socketURL, socketOptions]
            });
            self.ackFunctions = {}; // key: ackId value: function
            self.onHandlers  = {}; // key: eventname value: Array of functions
            self.id = null;

            self.worker.onmessage = function(e) {
                switch (e.data.type) {
                    case 'error':
                        throw new Error(e.data.content);
                    case 'emit_cb':
                        self.ackFunctions[e.data.ackId](e.data.content);
                        delete self.ackFunctions[e.data.ackId];
                        break;
                    case 'on_cb':
                        if (self.onHandlers[e.data.eventname]) {
                            self.onHandlers[e.data.eventname]
                            .forEach(function(currentHandler) {
                                currentHandler(e.data.content);
                            });
                        }
                        break;
                    case 'id':
                        self.id = e.data.content;
                        break;
                }
            };
        }

        emit() {
            const self = this;
            const argumentsArray = Array.from(arguments);
            if (typeof argumentsArray[argumentsArray.length - 1] == 'function') {

                const ackFunc = argumentsArray.pop();
                let tempKey = null;
                do {
                    tempKey = Math.floor(Math.random()*100000).toString();
                } while (
                    Object.keys(self.ackFunctions).indexOf(tempKey) != -1
                );
                self.ackFunctions[tempKey] = ackFunc;
                self.worker.postMessage({
                    type : 'emit_ack',
                    ackId : tempKey,
                    content : argumentsArray
                });
            } else {
                self.worker.postMessage({
                    type : 'emit',
                    content : argumentsArray
                });
            }
        }

        on() {
            const self = this;
            if (typeof arguments[0] == 'string' && typeof arguments[1] == 'function' && arguments.length == 2) {
                const [currentEventName, currentOnCb] = Array.from(arguments);
                if (!self.onHandlers[currentEventName]) {
                    self.onHandlers[currentEventName] = [];
                }
                self.onHandlers[currentEventName].push(currentOnCb);
                self.worker.postMessage({
                    type : 'on',
                    eventName : arguments[0]
                });
            } else {
                throw new TypeError('.on() passed bad params');
            }
        }

        send() {
            const argumentsArray = Array.from(arguments);
            this.emit('message', ...argumentsArray);
        }

        close() {
            postMessage({
                type : 'close'
            });
        }

        disconnect() {
            this.close();
        }
    }

    return new socketworker(workerURI, socketURL, socketOptions)
};
